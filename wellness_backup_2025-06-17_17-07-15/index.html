<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SezonoweDobro - Aplikacja TCM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Elements */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
            font-size: 24px;
        }

        .floating-element:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            top: 60%;
            right: 10%;
            animation-delay: -7s;
        }

        .floating-element:nth-child(3) {
            top: 40%;
            left: 30%;
            animation-delay: -14s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        /* Liquid Glass Container */
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* Header */
        .header {
            padding: 50px 20px 20px;
            text-align: center;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(56, 142, 60, 0.2));
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784, #A5D6A7, #C8E6C9);
            animation: seasonalGlow 4s ease-in-out infinite;
        }

        @keyframes seasonalGlow {
            0%, 100% { opacity: 0.8; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tagline {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Season Indicator */
        .current-season {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .season-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            padding: 0 20px;
            background: rgba(76, 175, 80, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            background: none;
            font-size: 14px;
        }

        .nav-tab.active {
            color: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            border-radius: 2px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { width: 0; }
            to { width: 30px; }
        }

        /* Content Area */
        .content {
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            color: white;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

        .card-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .card-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 2px;
        }

        .card-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-item:hover {
            transform: scale(1.05);
            background: rgba(76, 175, 80, 0.35);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
            color: #4CAF50;
        }

        .feature-text {
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        /* Season Progress */
        .season-progress {
            margin: 20px 0;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784);
            border-radius: 4px;
            width: 65%;
            animation: progressGlow 2s ease-in-out infinite alternate;
        }

        @keyframes progressGlow {
            0% { box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); }
            100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.8), 0 0 30px rgba(76, 175, 80, 0.6); }
        }

        .progress-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
        }

        /* Recipe Cards */
        .recipe-card {
            display: flex;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recipe-card:hover {
            transform: translateX(5px);
            background: rgba(76, 175, 80, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .recipe-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .recipe-info {
            flex: 1;
            padding: 15px;
        }

        .recipe-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recipe-meta {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 414px;
            width: 100%;
            background: rgba(45, 90, 45, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 12px;
            position: relative;
        }

        .bottom-nav-item.active {
            color: white;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 12px;
        }

        .bottom-nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        /* AI Assistant Styles */
        .ai-message, .user-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            animation: fadeInUp 0.3s ease;
        }

        .ai-message {
            background: rgba(76, 175, 80, 0.15);
            border-left: 3px solid #4CAF50;
        }

        .user-message {
            background: rgba(102, 187, 106, 0.15);
            border-right: 3px solid #66BB6A;
            text-align: right;
        }

        .quick-action-btn {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            padding: 6px 12px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .quick-action-btn:hover {
            background: rgba(76, 175, 80, 0.4);
            transform: translateY(-2px);
        }

        .voice-recording {
            background: linear-gradient(135deg, #f44336, #ff5722) !important;
            animation: pulse 1s infinite;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4CAF50;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #4CAF50;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .shopping-list {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        .shopping-list h4 {
            color: #4CAF50;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .shopping-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .shopping-list li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(76, 175, 80, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .shopping-list li:last-child {
            border-bottom: none;
        }

        /* Season Element Hover Effects */
        .season-element {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .season-element:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .season-element:active {
            transform: scale(1.02);
        }

        /* Season Details Modal */
        .season-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .season-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .season-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .season-modal-icon {
            font-size: 48px;
            margin-right: 20px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .season-modal-title {
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        .season-modal-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 5px;
        }

        .season-info-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .season-info-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .season-info-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .season-info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .season-info-list li {
            padding: 5px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .close-modal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Recipe Modal Styles */
        .recipe-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .recipe-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .recipe-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .recipe-modal-icon {
            font-size: 60px;
            margin-right: 20px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .recipe-modal-title {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recipe-modal-meta {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .recipe-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .recipe-section-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipe-ingredients-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .recipe-ingredients-list li {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .recipe-instructions {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }

        .recipe-instructions ol {
            padding-left: 20px;
        }

        .recipe-instructions li {
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .recipe-benefits {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(102, 187, 106, 0.1));
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .recipe-card.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-card.clickable:hover {
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Herbs and Emotions Modal Styles */
        .herbs-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .herbs-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .herbs-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .herbs-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .herbs-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .herbs-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .herbs-category-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .herbs-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .herbs-category.expanded .herbs-expand-icon {
            transform: rotate(180deg);
        }

        .herbs-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .herbs-category.expanded .herbs-category-content {
            max-height: 800px;
        }

        .herbs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .herb-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .herb-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .herb-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .herb-emoji {
            font-size: 24px;
        }

        .herb-name {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .herb-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .herb-properties {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .herb-properties-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .herb-properties-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            line-height: 1.4;
        }

        /* Face Yoga Modal Styles */
        .face-yoga-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .face-yoga-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .yoga-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .yoga-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .yoga-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .yoga-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-category-icon {
            font-size: 28px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .yoga-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .yoga-category.expanded .yoga-expand-icon {
            transform: rotate(180deg);
        }

        .yoga-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .yoga-category.expanded .yoga-category-content {
            max-height: 1000px;
        }

        .yoga-exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .yoga-exercise-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .yoga-exercise-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .yoga-exercise-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .yoga-exercise-emoji {
            font-size: 32px;
        }

        .yoga-exercise-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-exercise-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .yoga-exercise-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #4CAF50;
            margin-bottom: 15px;
        }

        .yoga-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .yoga-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .yoga-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .yoga-steps-list li:before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-size: 10px;
        }

        .yoga-benefits {
            background: rgba(76, 175, 80, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }

        .yoga-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .yoga-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
        }

        .yoga-duration {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Seasonal Energy Modal Styles */
        .seasonal-energy-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .seasonal-energy-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 850px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .energy-practice-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .energy-practice-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .energy-practice-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .energy-practice-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .energy-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .energy-practice-category.expanded .energy-expand-icon {
            transform: rotate(180deg);
        }

        .energy-practice-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .energy-practice-category.expanded .energy-practice-content {
            max-height: 1000px;
        }

        .energy-practices-grid {
            padding: 20px;
        }

        .energy-practice-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .energy-practice-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .energy-practice-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .energy-practice-emoji {
            font-size: 28px;
        }

        .energy-practice-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .energy-practice-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid currentColor;
            margin-bottom: 15px;
        }

        .energy-practice-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .energy-practice-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .energy-practice-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .energy-practice-steps-list li:before {
            content: "üåü";
            position: absolute;
            left: 0;
            font-size: 12px;
        }

        .energy-practice-benefits {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .energy-practice-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .energy-practice-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
        }

        .energy-practice-duration {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Wellness Metrics */
        .wellness-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .metric-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #4CAF50;
            display: block;
            transition: all 0.3s ease;
        }

        .metric-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 15px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .wellness-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header {
                padding: 40px 20px 20px;
            }
            
            .logo {
                font-size: 24px;
            }
        }

        /* iOS Safari fixes */
        @supports (-webkit-touch-callout: none) {
            .app-container {
                background: #2d5a2d !important;
            }
            .glass-card {
                background: rgba(76, 175, 80, 0.3) !important;
            }
            .header {
                background: rgba(76, 175, 80, 0.2) !important;
            }
        }

        /* Login Screen Styles */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(76, 175, 80, 0.1);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .register-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .register-btn:hover {
            color: white;
        }

        /* Logout Animation */
        .logout-animation {
            animation: logoutFade 0.5s ease-out forwards;
        }

        @keyframes logoutFade {
            0% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.95);
            }
        }

        .login-animation {
            animation: loginFade 0.5s ease-out forwards;
        }

        @keyframes loginFade {
            0% { 
                opacity: 0; 
                transform: scale(0.95);
            }
            100% { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #F44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        /* Special Effects */
        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkle 1.5s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="floating-element">üå∏</div>
        <div class="floating-element">üçÉ</div>
        <div class="floating-element">‚ùÑÔ∏è</div>
    </div>

    <div class="app-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen" style="display: none;">
            <div class="login-container">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h1 class="logo">SezonoweDobro</h1>
                    <p class="tagline">Tradycyjna Medycyna Chi≈Ñska dla Wsp√≥≈Çczesnego ≈ªycia ‚Ä¢ 2025</p>
                </div>
                
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">Zaloguj siƒô</div>
                            <div class="card-subtitle">Witaj ponownie</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form id="loginForm" onsubmit="login(event)">
                            <div class="input-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email" required 
                                       placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="password">Has≈Ço:</label>
                                <input type="password" id="password" name="password" required 
                                       placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zaloguj siƒô
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <p style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                üë§ Demo: demo@example.com / demo123
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showRegister()">
                                Nie masz konta? Zarejestruj siƒô
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="glass-card" style="display: none; margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <div class="card-title">Za≈Ç√≥≈º konto</div>
                            <div class="card-subtitle">Do≈ÇƒÖcz do nas</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form onsubmit="register(event)">
                            <div class="input-group">
                                <label for="regName">Imiƒô:</label>
                                <input type="text" id="regName" name="name" required placeholder="Twoje imiƒô">
                            </div>
                            
                            <div class="input-group">
                                <label for="regEmail">Email:</label>
                                <input type="email" id="regEmail" name="email" required placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="regPassword">Has≈Ço:</label>
                                <input type="password" id="regPassword" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zarejestruj siƒô
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showLogin()">
                                Masz ju≈º konto? Zaloguj siƒô
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp">
            <!-- Header -->
            <header class="header">
                <h1 class="logo">SezonoweDobro</h1>
                <p class="tagline">Tradycyjna Medycyna Chi≈Ñska dla Wsp√≥≈Çczesnego ≈ªycia ‚Ä¢ 2025</p>
                <div class="current-season">
                    <i class="fas fa-fire season-icon"></i>
                    <span id="currentSeasonText">Sezon Ognia (Lato)</span>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab(event, 'home')">
                <i class="fas fa-home"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'calendar')">
                <i class="fas fa-calendar"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'wellness')">
                <i class="fas fa-heart"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'profile')">
                <i class="fas fa-user"></i>
            </button>
            <button class="nav-tab admin-tab" onclick="switchTab(event, 'admin')" style="display: none;">
                <i class="fas fa-cog"></i>
            </button>
        </nav>

        <!-- Content Area -->
        <main class="content">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-yin-yang"></i>
                        </div>
                        <div>
                                                    <div class="card-title" id="currentSeasonTitle">Sezon Ognia (Lato)</div>
                        <div class="card-subtitle season-description">Rado≈õƒá, aktywno≈õƒá i energia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <p id="seasonDescription">Dzisiejsza energia jest wyr√≥wnana z elementem Ognia. Skup siƒô na rado≈õci, aktywno≈õci i kultywowaniu ciep≈Ça wewnƒôtrznego.</p>
                        
                        <div class="season-progress">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="progress-text">Postƒôp Sezonu Ognia: 85%</div>
                        </div>
                    </div>
                </div>

                <div class="wellness-metrics">
                    <div class="metric-item">
                        <span class="metric-value" id="qiLevel">85</span>
                        <div class="metric-label">Poziom Qi</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="balanceLevel">92</span>
                        <div class="metric-label">R√≥wnowaga</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="energyLevel">78</span>
                        <div class="metric-label">Energia</div>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-item" onclick="showSeasonalEnergy()" id="seasonalEnergyButton">
                        <i class="fas fa-fire feature-icon" id="seasonalEnergyIcon"></i>
                        <div class="feature-text" id="seasonalEnergyText">Letnia Energia</div>
                    </div>
                    <div class="feature-item" onclick="showHerbsAndEmotions()">
                        <i class="fas fa-seedling feature-icon"></i>
                        <div class="feature-text">Zio≈Ça i Emocje</div>
                    </div>
                    <div class="feature-item" onclick="showFaceYoga()">
                        <i class="fas fa-smile feature-icon"></i>
                        <div class="feature-text">Joga Twarzy</div>
                    </div>
                    <div class="feature-item" onclick="startElementTest()">
                        <i class="fas fa-search feature-icon"></i>
                        <div class="feature-text">Odkryj sw√≥j ≈ºywio≈Ç</div>
                    </div>
                </div>

                <button class="action-btn" style="width: 100%;" onclick="showNotification('Rozpoczynamy TwojƒÖ podr√≥≈º dobrostanu!')">
                    Rozpocznij Dzisiejsze Praktyki
                </button>
                
                <!-- Hidden debug buttons for testing (only visible in development) -->
                <button class="action-btn" style="width: 100%; margin-top: 10px; background: rgba(255,193,7,0.2); border: 1px solid rgba(255,193,7,0.5); font-size: 12px;" onclick="resetHealthMetrics()">
                    üîÑ Reset wska≈∫nik√≥w (test)
                </button>
                <button class="action-btn" style="width: 100%; margin-top: 5px; background: rgba(33,150,243,0.2); border: 1px solid rgba(33,150,243,0.5); font-size: 12px;" onclick="resetWeeklyProgress(); showNotification('üìä Tygodniowy postƒôp zosta≈Ç zresetowany!');">
                    üìä Reset tygodniowego postƒôpu
                </button>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Kalendarz Piƒôciu P√≥r Roku</div>
                            <div class="card-subtitle">Tradycyjne Cykle TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item season-element" onclick="showSeasonDetails('Drewno')" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1)); cursor: pointer;">
                                <i class="fas fa-seedling feature-icon" style="color: #4CAF50;"></i>
                                <div class="feature-text">Drewno<br><small>Wiosna</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Ogie≈Ñ')" style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.1)); cursor: pointer;">
                                <i class="fas fa-fire feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">Ogie≈Ñ<br><small>Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Ziemia')" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.1)); cursor: pointer;">
                                <i class="fas fa-mountain feature-icon" style="color: #FFC107;"></i>
                                <div class="feature-text">Ziemia<br><small>P√≥≈∫ne Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Metal')" style="background: linear-gradient(135deg, rgba(158, 158, 158, 0.3), rgba(158, 158, 158, 0.1)); cursor: pointer;">
                                <i class="fas fa-wind feature-icon" style="color: #9E9E9E;"></i>
                                <div class="feature-text">Metal<br><small>Jesie≈Ñ</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Woda')" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.3), rgba(33, 150, 243, 0.1)); cursor: pointer;">
                                <i class="fas fa-snowflake feature-icon" style="color: #2196F3;"></i>
                                <div class="feature-text">Woda<br><small>Zima</small></div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: white; margin-bottom: 10px;">Dzisiejsze Zalecenia</h4>
                            <ul id="dailyRecommendations" style="color: rgba(255,255,255,0.9); line-height: 1.8; list-style: none;">
                                <li>‚òÄÔ∏è Unikaj przegrzewania w gorƒÖce dni</li>
                                <li>üßò Praktykuj spokojnƒÖ medytacjƒô</li>
                                <li>üçâ Jedz ch≈ÇodzƒÖce owoce jak arbuz</li>
                                <li>üèä P≈Çywaj lub r√≥b ƒáwiczenia w cieniu</li>
                                <li>üåô ≈öpij wcze≈õnie by uniknƒÖƒá ciep≈Ça</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipes Tab -->
            <div id="recipes" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div>
                            <div class="card-title">Sezonowe Przepisy</div>
                            <div class="card-subtitle" id="recipesSubtitle">Ulubione Sezonu Ognia</div>
                        </div>
                    </div>
                </div>

                <div id="recipesContainer">
                    <!-- Dynamic recipes will be loaded here -->
                </div>

                <button class="action-btn" style="width: 100%; margin-top: 20px;" onclick="generateShoppingList()">
                    üìù Wygeneruj Listƒô Zakup√≥w Sezonowych
                </button>
            </div>

            <!-- Wellness Tab -->
            <div id="wellness" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div>
                            <div class="card-title">Praktyki Zdrowotne</div>
                            <div class="card-subtitle">Umys≈Ç, Cia≈Ço i Duch</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="showWellnessPractice('akupresura')">
                                <i class="fas fa-spa feature-icon"></i>
                                <div class="feature-text">Akupresura</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('qigong')">
                                <i class="fas fa-dumbbell feature-icon"></i>
                                <div class="feature-text">Qigong</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('medytacja')">
                                <i class="fas fa-brain feature-icon"></i>
                                <div class="feature-text">Medytacja</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('oddychanie')">
                                <i class="fas fa-lungs feature-icon"></i>
                                <div class="feature-text">Oddychanie</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <div class="card-title">Tygodniowy Postƒôp</div>
                            <div class="card-subtitle">Twoja podr√≥≈º do zdrowia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="wellness-metrics">
                            <div class="metric-item">
                                <span id="weeklyPracticeDays" class="metric-value">0</span>
                                <div class="metric-label">Dni Praktyki</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyMinutes" class="metric-value">0</span>
                                <div class="metric-label">Minuty</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyRecipes" class="metric-value">0</span>
                                <div class="metric-label">Przepisy Wypr√≥bowane</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant Tab -->
            <div id="ai-assistant" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="card-title">AI Asystent TCM</div>
                            <div class="card-subtitle">Ekspert Medycyny Chi≈Ñskiej</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div id="aiStatus" style="color: #4CAF50; font-size: 14px;">
                                ü§ñ Gotowy do pomocy
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="glass-card" style="min-height: 400px;">
                    <div class="card-content">
                        <div id="chatMessages" style="
                            height: 300px; 
                            overflow-y: auto; 
                            border: 1px solid rgba(255,255,255,0.2); 
                            border-radius: 12px; 
                            padding: 15px; 
                            margin-bottom: 15px;
                            background: rgba(0,0,0,0.1);
                        ">
                            <div class="ai-message">
                                <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">ü§ñ AI Asystent:</div>
                                <div style="color: rgba(255,255,255,0.9);">
                                    Witaj! Jestem Twoim ekspertem w dziedzinie Tradycyjnej Medycyny Chi≈Ñskiej. 
                                    Mogƒô pom√≥c Ci w:
                                    <br>‚Ä¢ üçΩÔ∏è Przepisach sezonowych
                                    <br>‚Ä¢ üßò ƒÜwiczeniach wed≈Çug sezonu
                                    <br>‚Ä¢ üõí Listach zakup√≥w
                                    <br>‚Ä¢ üåø Poradach zdrowotnych TCM
                                    <br><br>Zapytaj mnie o cokolwiek!
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div style="flex: 1;">
                                <textarea 
                                    id="userInput" 
                                    placeholder="Zapytaj o przepisy, ƒáwiczenia, porady TCM..."
                                    style="
                                        width: 100%;
                                        min-height: 60px;
                                        max-height: 120px;
                                        padding: 12px;
                                        border: 1px solid rgba(255,255,255,0.3);
                                        border-radius: 12px;
                                        background: rgba(76, 175, 80, 0.1);
                                        color: white;
                                        font-size: 14px;
                                        resize: vertical;
                                        font-family: inherit;
                                        box-sizing: border-box;
                                    "
                                    onkeypress="handleEnterKey(event)"
                                ></textarea>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button 
                                    id="voiceBtn" 
                                    onclick="toggleVoiceRecording()"
                                    style="
                                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="Nagrywanie g≈Çosowe"
                                >
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button 
                                    onclick="sendMessage()"
                                    style="
                                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="Wy≈õlij wiadomo≈õƒá"
                                >
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="margin-top: 15px;">
                            <div style="color: white; font-size: 12px; margin-bottom: 8px;">Szybkie akcje:</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="quick-action-btn" onclick="quickAction('przepisy')">
                                    üçΩÔ∏è Przepisy sezonowe
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('cwiczenia')">
                                    üßò ƒÜwiczenia
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('lista')">
                                    üõí Lista zakup√≥w
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('porady')">
                                    üåø Porady TCM
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">Tw√≥j Profil</div>
                            <div class="card-subtitle">Konstytucja TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="user-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #4CAF50, #66BB6A); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('user')">
                                    üë§
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(76, 175, 80, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('user')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="user-display-name" style="color: white; margin-bottom: 5px;">Eksplorator Zdrowia</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Zr√≥wnowa≈ºona Konstytucja</p>
                        </div>
                        
                        <div class="feature-grid">
                            <div class="feature-item" onclick="editUserProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="showPremiumModal()">
                                <i class="fas fa-crown feature-icon" style="color: #FFD700;"></i>
                                <div class="feature-text">Premium</div>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-bell feature-icon"></i>
                                <div class="feature-text">Powiadomienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-download feature-icon" id="offline-icon"></i>
                                <div class="feature-text" id="offline-text">Tryb Offline</div>
                            </div>
                            <div class="feature-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">Wyloguj</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Panel Administratora</div>
                            <div class="card-subtitle">ZarzƒÖdzanie aplikacjƒÖ</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="admin-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #FF6B35, #F7931E); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('admin')">
                                    üëë
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(255, 107, 53, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('admin')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="admin-display-name" style="color: white; margin-bottom: 5px;">Administrator</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Pe≈Çne uprawnienia systemu</p>
                        </div>
                        
                        <div class="feature-grid" style="margin-bottom: 20px;">
                            <div class="feature-item" onclick="editAdminProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-profile-offline-icon"></i>
                                <div class="feature-text" id="admin-profile-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div>
                            <div class="card-title">Narzƒôdzia Systemowe</div>
                            <div class="card-subtitle">Konfiguracja i monitoring</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="performBackup()">
                                <i class="fas fa-database feature-icon"></i>
                                <div class="feature-text">Backup</div>
                            </div>
                            <div class="feature-item" onclick="showSystemLogs()">
                                <i class="fas fa-file-alt feature-icon"></i>
                                <div class="feature-text">Logi</div>
                            </div>
                            <div class="feature-item" onclick="showRestoreModal()">
                                <i class="fas fa-upload feature-icon"></i>
                                <div class="feature-text">Przywr√≥ƒá</div>
                            </div>
                            <div class="feature-item" onclick="showSystemSettings()">
                                <i class="fas fa-cogs feature-icon"></i>
                                <div class="feature-text">Ustawienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-offline-icon"></i>
                                <div class="feature-text" id="admin-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="bottom-nav-item active" onclick="switchBottomTab(event, 'home')">
                <i class="fas fa-home"></i>
                <span>G≈Ç√≥wna</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'calendar')">
                <i class="fas fa-calendar-alt"></i>
                <span>Kalendarz</span>
                <div class="notification-badge">3</div>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
                <span>Przepisy</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'wellness')">
                <i class="fas fa-spa"></i>
                <span>Zdrowie</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
                <span>AI Asystent</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'profile')">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
            <div class="bottom-nav-item admin-nav" onclick="switchBottomTab(event, 'admin')" style="display: none;">
                <i class="fas fa-shield-alt"></i>
                <span>Admin</span>
            </div>
        </nav>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div id="profileEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 400px; margin: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-edit" style="margin-right: 10px; color: #4CAF50;"></i>
                    Edytuj Profil
                </h3>
                <button onclick="closeProfileEditModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-user" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nazwa u≈ºytkownika
                </label>
                <input type="text" id="editDisplayName" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowad≈∫ nowƒÖ nazwƒô">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-envelope" style="margin-right: 8px; color: #4CAF50;"></i>
                    Email / Login
                </label>
                <input type="email" id="editEmail" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowad≈∫ nowy email">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-lock" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nowe has≈Ço (opcjonalnie)
                </label>
                <input type="password" id="editPassword" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowad≈∫ nowe has≈Ço">
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button onclick="closeProfileEditModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Anuluj
                </button>
                <button onclick="saveProfileChanges()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-save" style="margin-right: 8px;"></i>
                    Zapisz
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile picture upload -->
    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">

    <!-- Wellness Practice Modal -->
    <div id="wellnessPracticeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 600px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 id="practiceTitle" style="color: white; margin: 0; font-size: 22px;">
                    <i id="practiceIcon" class="fas fa-spa" style="margin-right: 10px; color: #4CAF50;"></i>
                    Praktyka Zdrowotna
                </h3>
                <button onclick="closeWellnessPractice()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="practiceContent">
                <!-- Practice content will be dynamically loaded here -->
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="startPracticeSession()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-play" style="margin-right: 8px;"></i>
                    Rozpocznij Praktykƒô
                </button>
                <button onclick="closeWellnessPractice()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Zamknij
                </button>
            </div>
        </div>
    </div>

    <!-- Element Test Modal -->
    <div id="elementTestModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-search" style="margin-right: 10px; color: #4CAF50;"></i>
                    Odkryj sw√≥j ≈ºywio≈Ç TCM
                </h3>
                <button onclick="closeElementTest()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="testContent">
                <!-- Test questions will be dynamically loaded here -->
            </div>
            
            <div id="testResult" style="display: none;">
                <!-- Test results will be shown here -->
            </div>
            
            <div id="testNavigation" style="display: flex; gap: 15px; margin-top: 25px;">
                <button id="prevBtn" onclick="previousQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease; display: none;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
                    Poprzednie
                </button>
                <button id="nextBtn" onclick="nextQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    Nastƒôpne
                    <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2)); border: 2px solid rgba(255, 215, 0, 0.5); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: #FFD700; margin: 0; font-size: 22px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">
                    <i class="fas fa-crown" style="margin-right: 10px; color: #FFD700;"></i>
                    Premium AI Asystent
                </h3>
                <button onclick="closePremiumModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 15px;">ü§ñüëë</div>
                <h4 style="color: white; margin-bottom: 10px;">Status AI Asystenta</h4>
                <div id="aiUsageStatus" style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: #FFD700; font-weight: 600; margin-bottom: 5px;">Pozosta≈Çe zapytania bezp≈Çatne:</div>
                    <div id="remainingQueries" style="font-size: 24px; color: white; font-weight: 700;">10 / 10</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 12px; margin-top: 5px;">Reset codziennie o p√≥≈Çnocy</div>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: #FFD700; margin-bottom: 15px;">
                    <i class="fas fa-star" style="margin-right: 8px;"></i>
                    Premium Plan - 29.99 PLN/miesiƒÖc
                </h4>
                <ul style="color: white; list-style: none; padding: 0;">
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Nielimitowane zapytania AI</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Priorytetowe odpowiedzi</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Zaawansowane analizy TCM</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Personalne plany ≈ºywieniowe</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>24/7 dostƒôp bez limit√≥w</li>
                </ul>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
                <button id="subscribeBtn" onclick="initializeStripePayment()" style="width: 100%; padding: 15px; border-radius: 15px; border: none; background: linear-gradient(135deg, #FFD700, #FFC107); color: #000; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 215, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i class="fas fa-crown" style="margin-right: 10px;"></i>
                    Aktywuj Premium
                </button>
            </div>

            <div style="text-align: center;">
                <p style="color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 0;">
                    <i class="fas fa-shield-alt" style="margin-right: 5px;"></i>
                    Bezpieczne p≈Çatno≈õci przez Stripe ‚Ä¢ Anuluj w dowolnym momencie
                </p>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching
        function switchTab(evt, tabName) {
            var i, tabcontent, navtabs;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        function switchBottomTab(evt, tabName) {
            var i, tabcontent, navtabs, bottomNavItems;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }

            // Remove active class from all bottom nav items
            bottomNavItems = document.getElementsByClassName("bottom-nav-item");
            for (i = 0; i < bottomNavItems.length; i++) {
                bottomNavItems[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Find corresponding top nav tab and activate it
            const topNavTabs = document.querySelectorAll('.nav-tab');
            topNavTabs.forEach((tab, index) => {
                if (index === Array.from(bottomNavItems).indexOf(evt.currentTarget)) {
                    tab.classList.add('active');
                }
            });
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        // Sparkle Effect
        function createSparkle(event) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.innerHTML = '‚ú®';
            sparkle.style.left = event.clientX + 'px';
            sparkle.style.top = event.clientY + 'px';
            sparkle.style.position = 'fixed';
            sparkle.style.fontSize = '20px';
            sparkle.style.zIndex = '9999';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                document.body.removeChild(sparkle);
            }, 1500);
        }

        // Notification System
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(76, 175, 80, 0.9);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 14px;
                font-weight: 600;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Dynamic Season Updates
        function updateSeason() {
            const seasons = [
                { 
                    name: 'Sezon Drewna (Wiosna)', 
                    icon: 'üå±', 
                    element: 'Drewno',
                    color: '#4CAF50',
                    description: 'Wzrost, odnowa i oczyszczanie',
                    progress: 'Postƒôp Sezonu Drewna'
                },
                { 
                    name: 'Sezon Ognia (Lato)', 
                    icon: 'üî•', 
                    element: 'Ogie≈Ñ',
                    color: '#FF5722',
                    description: 'Rado≈õƒá, aktywno≈õƒá i energia',
                    progress: 'Postƒôp Sezonu Ognia'
                },
                { 
                    name: 'Sezon Ziemi (P√≥≈∫ne Lato)', 
                    icon: 'üåæ', 
                    element: 'Ziemia',
                    color: '#8D6E63',
                    description: 'R√≥wnowaga i stabilno≈õƒá',
                    progress: 'Postƒôp Sezonu Ziemi'
                },
                { 
                    name: 'Sezon Metalu (Jesie≈Ñ)', 
                    icon: 'üçÇ', 
                    element: 'Metal',
                    color: '#9E9E9E',
                    description: 'Refleksja i przygotowanie',
                    progress: 'Postƒôp Sezonu Metalu'
                },
                { 
                    name: 'Sezon Wody (Zima)', 
                    icon: '‚ùÑÔ∏è', 
                    element: 'Woda',
                    color: '#2196F3',
                    description: 'Odpoczynek i regeneracja',
                    progress: 'Postƒôp Sezonu Wody'
                }
            ];
            
            const currentDate = new Date();
            const month = currentDate.getMonth(); // 0-11
            const day = currentDate.getDate();
            let seasonIndex = 0;
            let seasonProgress = 0;
            
            // Dok≈Çadne daty sezon√≥w TCM
            if (month >= 2 && month <= 4) { // Marzec-Maj (Wiosna)
                seasonIndex = 0;
                seasonProgress = calculateSeasonProgress(month, day, 2, 4); // Mar-May
            } else if (month >= 5 && month <= 7) { // Czerwiec-Sierpie≈Ñ (Lato)  
                seasonIndex = 1;
                seasonProgress = calculateSeasonProgress(month, day, 5, 7); // Jun-Aug
            } else if (month === 8) { // Wrzesie≈Ñ (P√≥≈∫ne Lato)
                seasonIndex = 2;
                seasonProgress = Math.round((day / 30) * 100);
            } else if (month >= 9 && month <= 11) { // Pa≈∫dziernik-Grudzie≈Ñ (Jesie≈Ñ)
                seasonIndex = 3;
                seasonProgress = calculateSeasonProgress(month, day, 9, 11); // Oct-Dec
            } else { // Stycze≈Ñ-Luty (Zima)
                seasonIndex = 4;
                if (month <= 1) {
                    seasonProgress = Math.round(((month * 31 + day) / 59) * 100);
                } else {
                    seasonProgress = 100;
                }
            }
            
            const currentSeason = seasons[seasonIndex];
            
            // Update season display
            const seasonTextElement = document.getElementById('currentSeasonText');
            const seasonTitleElement = document.getElementById('currentSeasonTitle');
            const seasonIconElements = document.querySelectorAll('.season-icon');
            const seasonDescElement = document.querySelector('.season-description');
            const seasonDescriptionElement = document.getElementById('seasonDescription');
            const recipesSubtitleElement = document.getElementById('recipesSubtitle');
            const progressTextElement = document.querySelector('.progress-text');
            const progressFillElement = document.querySelector('.progress-fill');
            
            if (seasonTextElement) seasonTextElement.textContent = currentSeason.name;
            if (seasonTitleElement) seasonTitleElement.textContent = currentSeason.name;
            if (seasonDescElement) seasonDescElement.textContent = currentSeason.description;
            if (recipesSubtitleElement) recipesSubtitleElement.textContent = `Ulubione ${currentSeason.name}`;
            if (progressTextElement) progressTextElement.textContent = `${currentSeason.progress}: ${seasonProgress}%`;
            if (progressFillElement) progressFillElement.style.width = `${seasonProgress}%`;
            
            // Update all season icons
            seasonIconElements.forEach(icon => {
                icon.className = getSeasonIconClass(currentSeason.element);
                icon.textContent = currentSeason.icon;
            });
            
            // Update season description paragraph
            if (seasonDescriptionElement) {
                const elementDescriptions = {
                    'Drewno': 'Dzisiejsza energia jest wyr√≥wnana z elementem Drewna. Skup siƒô na wzro≈õcie, elastyczno≈õci i nowych poczƒÖtkach.',
                    'Ogie≈Ñ': 'Dzisiejsza energia jest wyr√≥wnana z elementem Ognia. Skup siƒô na rado≈õci, aktywno≈õci i kultywowaniu ciep≈Ça wewnƒôtrznego.',
                    'Ziemia': 'Dzisiejsza energia jest wyr√≥wnana z elementem Ziemi. Skup siƒô na r√≥wnowadze, stabilno≈õci i od≈ºywianiu.',
                    'Metal': 'Dzisiejsza energia jest wyr√≥wnana z elementem Metalu. Skup siƒô na refleksji, przygotowaniu i wewnƒôtrznej sile.',
                    'Woda': 'Dzisiejsza energia jest wyr√≥wnana z elementem Wody. Skup siƒô na odpoczynku, regeneracji i kultywowaniu energii wewnƒôtrznej.'
                };
                seasonDescriptionElement.textContent = elementDescriptions[currentSeason.element];
            }
            
            // Update season button
            const seasonButton = document.querySelector('.season-btn');
            if (seasonButton) {
                seasonButton.innerHTML = `
                    <span class="season-icon">${currentSeason.icon}</span>
                    ${currentSeason.name}
                `;
            }
            
            // Update daily recommendations
            const dailyRecommendationsElement = document.getElementById('dailyRecommendations');
            if (dailyRecommendationsElement) {
                const seasonalRecommendations = {
                    'Drewno': [
                        'üåÖ Wstawaj o wschodzie s≈Ço≈Ñca (6:30)',
                        'üßò Poranne ƒáwiczenia oddechowe',
                        'ü•¨ Jedz zielone warzywa li≈õciaste',
                        'üö∂ R√≥b ≈Çagodne spacery w naturze',
                        'üåô ≈öpij przed 23:00'
                    ],
                    'Ogie≈Ñ': [
                        '‚òÄÔ∏è Unikaj przegrzewania w gorƒÖce dni',
                        'üßò Praktykuj spokojnƒÖ medytacjƒô',
                        'üçâ Jedz ch≈ÇodzƒÖce owoce jak arbuz',
                        'üèä P≈Çywaj lub r√≥b ƒáwiczenia w cieniu',
                        'üåô ≈öpij wcze≈õnie by uniknƒÖƒá ciep≈Ça'
                    ],
                    'Ziemia': [
                        '‚öñÔ∏è Jedz regularne, zr√≥wnowa≈ºone posi≈Çki',
                        'üßò Praktykuj medytacjƒô uwa≈ºno≈õci',
                        'üåΩ Jedz s≈Çodkie i od≈ºywcze pokarmy',
                        'üö∂ R√≥b spokojne spacery po posi≈Çku',
                        'üòå Kultywuj spok√≥j i r√≥wnowagƒô'
                    ],
                    'Metal': [
                        'üçÉ Oddychaj g≈Çƒôboko ≈õwie≈ºym powietrzem',
                        'üßò Praktykuj ƒáwiczenia oddechowe',
                        'üçê Jedz bia≈Çe pokarmy jak gruszki',
                        'üìñ Po≈õwiƒôƒá czas na refleksjƒô',
                        'üåô K≈Çad≈∫ siƒô spaƒá wcze≈õniej'
                    ],
                    'Woda': [
                        'üî• Jedz ciep≈Çe, od≈ºywcze potrawy',
                        'üßò Praktykuj g≈ÇƒôbokƒÖ medytacjƒô',
                        'ü´ò Dodaj do diety czarne ziarna',
                        'üè† Oszczƒôdzaj energiƒô, zosta≈Ñ w domu',
                        'üí§ ≈öpij wiƒôcej, nawet do 9 godzin'
                    ]
                };
                
                const recommendations = seasonalRecommendations[currentSeason.element] || seasonalRecommendations['Ogie≈Ñ'];
                dailyRecommendationsElement.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            }
            
            return currentSeason;
        }
        
        function calculateSeasonProgress(currentMonth, currentDay, startMonth, endMonth) {
            const totalDays = (endMonth - startMonth + 1) * 30; // Przybli≈ºenie
            const currentDays = (currentMonth - startMonth) * 30 + currentDay;
            return Math.min(Math.round((currentDays / totalDays) * 100), 100);
        }
        
        function getSeasonIconClass(element) {
            const iconClasses = {
                'Drewno': 'fas fa-leaf',
                'Ogie≈Ñ': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return iconClasses[element] || 'fas fa-leaf';
        }

        // Authentication System
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userName = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (isLoggedIn) {
                showMainApp();
                updateUserName(userName);
                
                if (userRole === 'admin') {
                    showAdminFeatures();
                } else {
                    hideAdminFeatures();
                }
            } else {
                showLoginScreen();
            }
        }

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Admin credentials check
            if (email === 'admin@sezonoweDobro.pl' && password === 'admin123') {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userName', 'Administrator');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userRole', 'admin');
                
                addSystemLog('SUCCESS', 'AUTH', 'Administrator zalogowany pomy≈õlnie', `Email: ${email}`);
                showNotification('Zalogowano jako Administrator! üëë');
                
                setTimeout(() => {
                    showMainApp();
                    updateUserName('Administrator');
                    showAdminFeatures();
                }, 1000);
            }
            // Demo credentials check
            else if (email === 'demo@example.com' && password === 'demo123') {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userName', 'Demo User');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userRole', 'user');
                
                addSystemLog('SUCCESS', 'AUTH', 'U≈ºytkownik demo zalogowany pomy≈õlnie', `Email: ${email}`);
                showNotification('Pomy≈õlnie zalogowano! üéâ');
                
                setTimeout(() => {
                    showMainApp();
                    updateUserName('Demo User');
                    hideAdminFeatures();
                }, 1000);
            } else {
                addSystemLog('WARNING', 'AUTH', 'Nieudana pr√≥ba logowania', `Email: ${email}`);
                showNotification('Nieprawid≈Çowe dane logowania!');
            }
        }

        function register(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            // Simple registration simulation
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userName', name);
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userRole', 'user');
            
            addSystemLog('SUCCESS', 'AUTH', 'Nowe konto zosta≈Ço utworzone', `U≈ºytkownik: ${name}, Email: ${email}`);
            showNotification('Konto zosta≈Ço utworzone! üéâ');
            
            setTimeout(() => {
                showMainApp();
                updateUserName(name);
                hideAdminFeatures();
            }, 1000);
        }

        // Real-time Health Metrics System
        let healthMetrics = {
            qi: 85,
            balance: 92,
            energy: 78
        };

        // Load saved metrics or set defaults
        function loadHealthMetrics() {
            const saved = localStorage.getItem('healthMetrics');
            if (saved) {
                healthMetrics = { ...healthMetrics, ...JSON.parse(saved) };
            }
            updateMetricDisplays();
        }

        // Save metrics to localStorage
        function saveHealthMetrics() {
            localStorage.setItem('healthMetrics', JSON.stringify(healthMetrics));
        }

        // Update metric displays in real-time
        function updateMetricDisplays() {
            document.getElementById('qiLevel').textContent = Math.round(healthMetrics.qi);
            document.getElementById('balanceLevel').textContent = Math.round(healthMetrics.balance);
            document.getElementById('energyLevel').textContent = Math.round(healthMetrics.energy);
            
            // Add visual effects for changes
            animateMetricChange('qiLevel');
            animateMetricChange('balanceLevel');
            animateMetricChange('energyLevel');
        }

        // Animate metric changes
        function animateMetricChange(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                element.style.fontWeight = 'bold';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = '';
                    element.style.fontWeight = '';
                }, 600);
            }
        }

        // Increase metrics based on activities
        function increaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi + qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance + balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy + energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('SUCCESS', 'USER', `Wzrost wska≈∫nik√≥w zdrowia: ${reason}`, 
                    `Qi: ${oldQi}‚Üí${Math.round(healthMetrics.qi)}, R√≥wnowaga: ${oldBalance}‚Üí${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}‚Üí${Math.round(healthMetrics.energy)}`);
                
                showNotification(`üìà Wzrost zdrowia! ${reason}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Decrease metrics (stress, fatigue, etc.)
        function decreaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply negative changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi - qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance - balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy - energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('WARNING', 'USER', `Spadek wska≈∫nik√≥w zdrowia: ${reason}`, 
                    `Qi: ${oldQi}‚Üí${Math.round(healthMetrics.qi)}, R√≥wnowaga: ${oldBalance}‚Üí${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}‚Üí${Math.round(healthMetrics.energy)}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Daily natural fluctuations (simulate realistic changes)
        function simulateDailyFluctuations() {
            const currentHour = new Date().getHours();
            
            // Morning boost (6-10 AM)
            if (currentHour >= 6 && currentHour <= 10) {
                increaseMetrics(1, 0, 2, 'Poranny zastrzyk energii');
            }
            // Afternoon dip (13-15)
            else if (currentHour >= 13 && currentHour <= 15) {
                decreaseMetrics(0, 0, 1, 'Popo≈Çudniowe zmƒôczenie');
            }
            // Evening rebalance (18-20)
            else if (currentHour >= 18 && currentHour <= 20) {
                increaseMetrics(0, 1, 0, 'Wieczorna r√≥wnowaga');
            }
            // Night energy drop (22-24)
            else if (currentHour >= 22) {
                decreaseMetrics(0, 0, 2, 'Naturalne zmƒôczenie');
            }
        }

        // Reset metrics (for testing or new day)
        function resetHealthMetrics() {
            healthMetrics = { qi: 85, balance: 92, energy: 78 };
            saveHealthMetrics();
            updateMetricDisplays();
            addSystemLog('INFO', 'SYSTEM', 'Wska≈∫niki zdrowia zosta≈Çy zresetowane');
            showNotification('üîÑ Wska≈∫niki zdrowia zosta≈Çy zresetowane!');
        }

        // Weekly Progress Functions
        let weeklyProgress = {
            practiceDays: 0,
            totalMinutes: 0,
            recipesUsed: 0,
            lastPracticeDate: null,
            practicesThisWeek: [],
            recipesThisWeek: [],
            weekStart: getWeekStart()
        };

        function getWeekStart() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Monday start
            const monday = new Date(now.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function loadWeeklyProgress() {
            const saved = localStorage.getItem('weeklyProgress');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Check if it's a new week
                const currentWeekStart = getWeekStart();
                const savedWeekStart = new Date(data.weekStart);
                
                if (currentWeekStart.getTime() !== savedWeekStart.getTime()) {
                    // New week - reset progress
                    resetWeeklyProgress();
                } else {
                    // Same week - load saved data
                    weeklyProgress = {
                        ...data,
                        weekStart: currentWeekStart,
                        practicesThisWeek: data.practicesThisWeek || [],
                        recipesThisWeek: data.recipesThisWeek || []
                    };
                }
            } else {
                // First time - initialize
                resetWeeklyProgress();
            }
            
            updateWeeklyDisplay();
        }

        function resetWeeklyProgress() {
            weeklyProgress = {
                practiceDays: 0,
                totalMinutes: 0,
                recipesUsed: 0,
                lastPracticeDate: null,
                practicesThisWeek: [],
                recipesThisWeek: [],
                weekStart: getWeekStart()
            };
            saveWeeklyProgress();
        }

        function saveWeeklyProgress() {
            localStorage.setItem('weeklyProgress', JSON.stringify(weeklyProgress));
        }

        function updateWeeklyDisplay() {
            document.getElementById('weeklyPracticeDays').textContent = weeklyProgress.practiceDays;
            document.getElementById('weeklyMinutes').textContent = weeklyProgress.totalMinutes;
            document.getElementById('weeklyRecipes').textContent = weeklyProgress.recipesUsed;
            
            // Add animation effect
            animateMetricUpdate('weeklyPracticeDays');
            animateMetricUpdate('weeklyMinutes');
            animateMetricUpdate('weeklyRecipes');
        }

        function animateMetricUpdate(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = 'white';
                }, 300);
            }
        }

        function addPracticeToWeekly(practiceTitle, durationMinutes) {
            const today = new Date().toDateString();
            
            // Check if we already practiced today
            if (!weeklyProgress.practicesThisWeek.includes(today)) {
                weeklyProgress.practiceDays++;
                weeklyProgress.practicesThisWeek.push(today);
            }
            
            weeklyProgress.totalMinutes += durationMinutes;
            weeklyProgress.lastPracticeDate = today;
            
            saveWeeklyProgress();
            updateWeeklyDisplay();
            
            // Log the activity
            addSystemLog('SUCCESS', 'WEEKLY', `Dodano praktykƒô do tygodniowego postƒôpu`, `${practiceTitle} - ${durationMinutes} min`);
        }

        function addRecipeToWeekly(recipeName) {
            if (!weeklyProgress.recipesThisWeek.includes(recipeName)) {
                weeklyProgress.recipesUsed++;
                weeklyProgress.recipesThisWeek.push(recipeName);
                
                saveWeeklyProgress();
                updateWeeklyDisplay();
                
                // Log the activity
                addSystemLog('SUCCESS', 'WEEKLY', `Dodano przepis do tygodniowego postƒôpu`, recipeName);
                
                showNotification(`üìä +1 Przepis do tygodniowego postƒôpu!`);
            }
        }

        function getWeeklyStats() {
            return {
                practiceDays: weeklyProgress.practiceDays,
                totalMinutes: weeklyProgress.totalMinutes,
                recipesUsed: weeklyProgress.recipesUsed,
                averageMinutesPerDay: weeklyProgress.practiceDays > 0 ? Math.round(weeklyProgress.totalMinutes / weeklyProgress.practiceDays) : 0,
                weekProgress: Math.round((weeklyProgress.practiceDays / 7) * 100)
            };
        }

        // Wellness Practice Functions
        let currentPractice = '';
        
        const practiceData = {
            akupresura: {
                title: 'Akupresura TCM',
                icon: 'fas fa-spa',
                description: 'Akupresura to staro≈ºytna technika ucisku okre≈õlonych punkt√≥w na ciele w celu przywr√≥cenia r√≥wnowagi energetycznej.',
                benefits: [
                    'üéØ Zmniejsza napiƒôcie i stres',
                    'üíÜ ≈Åagodzi b√≥le g≈Çowy i migrenƒô',
                    '‚ö° Zwiƒôksza przep≈Çyw energii Qi',
                    'üòå Poprawia samopoczucie',
                    'üõ°Ô∏è Wzmacnia odporno≈õƒá'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie',
                        description: 'Znajd≈∫ spokojne miejsce. Umyj rƒôce i rozgrzej d≈Çonie tarcie nimi o siebie.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Punkt Yintang (Trzecie Oko)',
                        description: 'Umie≈õƒá kciuk miƒôdzy brwiami. Delikatnie uciskaj przez 30 sekund, oddychajƒÖc spokojnie.',
                        duration: '30 sek'
                    },
                    {
                        step: 3,
                        title: 'Punkt Baihui (Czubek G≈Çowy)',
                        description: 'Znajd≈∫ punkt na ≈õrodku czubka g≈Çowy. Uciskaj delikatnie palcem wskazujƒÖcym.',
                        duration: '30 sek'
                    },
                    {
                        step: 4,
                        title: 'Punkty Taiyang (Skronie)',
                        description: 'Umie≈õƒá oba kciuki na skroniach. Masuj okrƒô≈ºnymi ruchami w kierunku zgodnym z ruchem wskaz√≥wek zegara.',
                        duration: '1 min'
                    },
                    {
                        step: 5,
                        title: 'Punkt Hegu (D≈Ço≈Ñ)',
                        description: 'Znajd≈∫ punkt miƒôdzy kciukiem a palcem wskazujƒÖcym. Uciskaj przez 30 sekund na ka≈ºdej d≈Çoni.',
                        duration: '1 min'
                    }
                ],
                totalDuration: '5 minut'
            },
            qigong: {
                title: 'Qigong - Ruch Energii',
                icon: 'fas fa-dumbbell',
                description: 'Qigong ≈ÇƒÖczy powolne ruchy, oddychanie i medytacjƒô w celu harmonizacji przep≈Çywu energii Qi.',
                benefits: [
                    'üåä Harmonizuje przep≈Çyw energii Qi',
                    'üßò Uspokaja umys≈Ç i cia≈Ço',
                    'üí™ Wzmacnia miƒô≈õnie i elastyczno≈õƒá',
                    'ü´Å Poprawia funkcje uk≈Çadu oddechowego',
                    '‚öñÔ∏è Przywraca r√≥wnowagƒô energetycznƒÖ'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa Podstawowa',
                        description: 'Sta≈Ñ prosto, stopy na szeroko≈õƒá ramion. Kolana lekko ugiƒôte, ramiona swobodnie opuszczone.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Podnoszenie Nieba',
                        description: 'Powoli podnie≈õ rƒôce nad g≈Çowƒô, wdychajƒÖc. Opu≈õƒá rƒôce, wydychajƒÖc. Wyobra≈∫ sobie, ≈ºe trzymasz energiƒô.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Obejmowanie Drzewa',
                        description: 'Ramiona okrƒÖgle przed sobƒÖ, jakby≈õ obejmowa≈Ç du≈ºe drzewo. Oddychaj spokojnie przez 2 minuty.',
                        duration: '2 min'
                    },
                    {
                        step: 4,
                        title: 'Ko≈Çysanie Qi',
                        description: 'Delikatnie ko≈Çysz siƒô z boku na bok, pozwalajƒÖc energii swobodnie p≈ÇynƒÖƒá przez cia≈Ço.',
                        duration: '2 min'
                    },
                    {
                        step: 5,
                        title: 'Zako≈Ñczenie',
                        description: 'Po≈Ç√≥≈º d≈Çonie na brzuchu. Zr√≥b 3 g≈Çƒôbokie oddechy, koncentrujƒÖc siƒô na centrum energii.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '10 minut'
            },
            medytacja: {
                title: 'Medytacja TCM',
                icon: 'fas fa-brain',
                description: 'Medytacja wed≈Çug tradycji chi≈Ñskiej koncentruje siƒô na uspokojeniu umys≈Çu i harmonizacji energii.',
                benefits: [
                    'üß† Uspokaja umys≈Ç i my≈õli',
                    '‚ù§Ô∏è Obni≈ºa ci≈õnienie krwi',
                    'üòå Redukuje stres i niepok√≥j',
                    'üîÑ Przywraca r√≥wnowagƒô Yin-Yang',
                    '‚ú® Zwiƒôksza ≈õwiadomo≈õƒá'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie Miejsca',
                        description: 'Znajd≈∫ ciche miejsce. UsiƒÖd≈∫ wygodnie z prostymi plecami, nogi skrzy≈ºowane lub na krze≈õle.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Skupienie na Oddechu',
                        description: 'Zamknij oczy. Skup siƒô na naturalnym rytmie oddechu. Nie zmieniaj go, tylko obserwuj.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Medytacja Dantian',
                        description: 'Skieruj uwagƒô na punkt 5cm poni≈ºej pƒôpka. To centrum energii. Oddychaj do tego punktu.',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'U≈õmiech Wewnƒôtrzny',
                        description: 'Wy≈õlij ciep≈Çy u≈õmiech do swojego serca, nastƒôpnie do wszystkich organ√≥w. Poczuj wdziƒôczno≈õƒá.',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'Powr√≥t do ≈öwiadomo≈õci',
                        description: 'Powoli porusz palcami i stopami. Otw√≥rz oczy i przez chwilƒô pozosta≈Ñ w ciszy.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '15 minut'
            },
            oddychanie: {
                title: 'Oddychanie Terapeutyczne',
                icon: 'fas fa-lungs',
                description: 'Kontrolowane oddychanie wed≈Çug TCM oczyszcza energiƒô i wzmacnia ≈ºyciowƒÖ si≈Çƒô.',
                benefits: [
                    'ü´Å Wzmacnia p≈Çuca i uk≈Çad oddechowy',
                    '‚ö° Zwiƒôksza poziom energii ≈ºyciowej',
                    'üßò Uspokaja system nerwowy',
                    'üîÑ Oczyszcza toksyny z organizmu',
                    'üí§ Poprawia jako≈õƒá snu'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa i Przygotowanie',
                        description: 'UsiƒÖd≈∫ wygodnie z prostymi plecami. Jedna rƒôka na piersi, druga na brzuchu.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Oddech Brzuszny',
                        description: 'Wdech przez nos - brzuch podnosi siƒô, klatka piersiowa nieruchoma. Wydech przez usta - brzuch opada.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Rytm 4-7-8',
                        description: 'Wdech przez nos (4 sekundy), zatrzymaj oddech (7 sekund), wydech przez usta (8 sekund).',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'OczyszczajƒÖcy Oddech',
                        description: 'G≈Çƒôboki wdech przez nos, zatrzymaj na 3 sekundy, silny wydech przez usta ze ≈õwistem "Ahhhh".',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'Harmonizacja',
                        description: 'Powr√≥t do naturalnego rytmu oddechu. Poczuj jak energia krƒÖ≈ºy swobodnie po ciele.',
                        duration: '3 min'
                    }
                ],
                totalDuration: '15 minut'
            }
        };

        function showWellnessPractice(practiceType) {
            currentPractice = practiceType;
            const practice = practiceData[practiceType];
            
            const modal = document.getElementById('wellnessPracticeModal');
            const title = document.getElementById('practiceTitle');
            const icon = document.getElementById('practiceIcon');
            const content = document.getElementById('practiceContent');
            
            // Update title and icon
            title.innerHTML = `<i class="${practice.icon}" style="margin-right: 10px; color: #4CAF50;"></i>${practice.title}`;
            icon.className = practice.icon;
            
            // Generate content
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="color: rgba(255,255,255,0.9); font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                        ${practice.description}
                    </p>
                    
                    <div style="background: rgba(76, 175, 80, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                            ‚ú® Korzy≈õci:
                        </h4>
                        <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                            ${practice.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: #4CAF50; margin: 0; font-size: 16px;">
                                üìã Instrukcje krok po kroku:
                            </h4>
                            <div style="background: rgba(76, 175, 80, 0.3); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                ‚è±Ô∏è ${practice.totalDuration}
                            </div>
                        </div>
                        
                        ${practice.instructions.map((instruction, index) => `
                            <div style="border-left: 3px solid #4CAF50; padding-left: 15px; margin-bottom: 15px; position: relative;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h5 style="color: white; margin: 0; font-size: 14px;">
                                        <span style="background: #4CAF50; color: white; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 12px;">${instruction.step}</span>
                                        ${instruction.title}
                                    </h5>
                                    <span style="background: rgba(255,255,255,0.2); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">
                                        ${instruction.duration}
                                    </span>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 13px; line-height: 1.5; margin: 0;">
                                    ${instruction.description}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 15px;">
                        <div style="color: #FFC107; font-size: 14px; font-weight: 600; margin-bottom: 8px;">
                            üí° Wskaz√≥wka:
                        </div>
                        <p style="color: rgba(255,255,255,0.9); font-size: 13px; line-height: 1.5; margin: 0;">
                            Praktykuj regularnie, najlepiej codziennie o tej samej porze. S≈Çuchaj swojego cia≈Ça i nie wymuszaj ruch√≥w. Ka≈ºda praktyka to krok ku lepszemu zdrowiu!
                        </p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Log practice view
            addSystemLog('INFO', 'USER', `Wy≈õwietlono praktykƒô zdrowotnƒÖ: ${practice.title}`);
        }

        function closeWellnessPractice() {
            const modal = document.getElementById('wellnessPracticeModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function startPracticeSession() {
            const practice = practiceData[currentPractice];
            
            // Increase health metrics for starting practice
            increaseMetrics(2, 3, 1, `Rozpoczƒôcie praktyki: ${practice.title}`);
            
            // Add to weekly progress immediately (start tracking)
            const durationMinutes = parseDuration(practice.totalDuration) / (60 * 1000); // Convert to minutes
            addPracticeToWeekly(practice.title, durationMinutes);
            
            // Log practice start
            addSystemLog('SUCCESS', 'USER', `Rozpoczƒôto sesjƒô praktyki: ${practice.title}`, `Czas trwania: ${practice.totalDuration}`);
            
            showNotification(`üßò Rozpoczƒôto praktykƒô: ${practice.title}! Powodzenia!`);
            closeWellnessPractice();
            
            // Set timer for practice completion
            const duration = parseDuration(practice.totalDuration);
            setTimeout(() => {
                completePracticeSession(practice.title);
            }, duration);
        }

        function completePracticeSession(practiceTitle) {
            // Additional health boost for completing practice
            increaseMetrics(3, 5, 4, `Uko≈Ñczenie praktyki: ${practiceTitle}`);
            
            // Log practice completion
            addSystemLog('SUCCESS', 'USER', `Uko≈Ñczono praktykƒô zdrowotnƒÖ: ${practiceTitle}`);
            
            showNotification(`‚ú® Gratulacje! Uko≈Ñczy≈Çe≈õ praktykƒô: ${practiceTitle}`);
        }

        function parseDuration(durationStr) {
            // Convert duration string like "15 minut" to milliseconds
            const minutes = parseInt(durationStr.match(/\d+/)[0]);
            return minutes * 60 * 1000; // Convert to milliseconds
        }

        // Element Test Functions
        let currentQuestion = 0;
        let testAnswers = [];
        
        const elementQuestions = [
            {
                question: "Jak czujesz siƒô pod wzglƒôdem temperatury cia≈Ça?",
                icon: "fas fa-thermometer-half",
                answers: [
                    { text: "Czƒôsto jest mi zimno, marznƒÖ mi rƒôce i stopy", element: "Woda", points: 3 },
                    { text: "Czasami jest mi zimno, lubiƒô ciep≈Çe napoje", element: "Metal", points: 2 },
                    { text: "Czujƒô siƒô komfortowo w wiƒôkszo≈õci temperatur", element: "Ziemia", points: 1 },
                    { text: "Czƒôsto jest mi ciep≈Ço, lubiƒô ch≈Çodne miejsca", element: "Ogie≈Ñ", points: 2 },
                    { text: "Szybko siƒô rozgrzewam, czƒôsto mam gorƒÖce d≈Çonie", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jak wyglƒÖda Twoja energia w ciƒÖgu dnia?",
                icon: "fas fa-battery-half",
                answers: [
                    { text: "Rano jestem powolny/a, najlepiej czujƒô siƒô wieczorem", element: "Woda", points: 3 },
                    { text: "Potrzebujƒô czasu na rozruch, ale potem jestem wydajny/a", element: "Metal", points: 2 },
                    { text: "Moja energia jest stabilna przez ca≈Çy dzie≈Ñ", element: "Ziemia", points: 3 },
                    { text: "Jestem bardzo energiczny/a rano i w po≈Çudnie", element: "Ogie≈Ñ", points: 3 },
                    { text: "Mam du≈ºo energii rano, potem szybko siƒô mƒôczƒô", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak reagujesz na stres?",
                icon: "fas fa-brain",
                answers: [
                    { text: "Wycofujƒô siƒô, potrzebujƒô spokoju i samotno≈õci", element: "Woda", points: 3 },
                    { text: "Stajƒô siƒô smutny/a i pesymistyczny/a", element: "Metal", points: 3 },
                    { text: "Przejmujƒô siƒô nadmiernie wszystkim", element: "Ziemia", points: 3 },
                    { text: "Stajƒô siƒô podenerwowany/a i m√≥wiƒô za du≈ºo", element: "Ogie≈Ñ", points: 3 },
                    { text: "Denerwujƒô siƒô i mogƒô wybuchnƒÖƒá gniewem", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jakie masz preferencje ≈ºywieniowe?",
                icon: "fas fa-utensils",
                answers: [
                    { text: "Lubiƒô ciep≈Çe, gotowane potrawy i zupy", element: "Woda", points: 2 },
                    { text: "Preferujƒô proste, lekko pikantne jedzenie", element: "Metal", points: 2 },
                    { text: "Lubiƒô s≈Çodkie smaki i regularne posi≈Çki", element: "Ziemia", points: 3 },
                    { text: "Uwielbiam r√≥≈ºnorodno≈õƒá smak√≥w, czƒôsto pomijam posi≈Çki", element: "Ogie≈Ñ", points: 2 },
                    { text: "Lubiƒô kwa≈õne smaki i ≈õwie≈ºe produkty", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jaki jest Tw√≥j sen?",
                icon: "fas fa-bed",
                answers: [
                    { text: "≈öpiƒô du≈ºo, ale czƒôsto jestem zmƒôczony/a", element: "Woda", points: 3 },
                    { text: "Budzƒô siƒô wcze≈õnie rano, ale czasami mam problemy z zasypianiem", element: "Metal", points: 2 },
                    { text: "≈öpiƒô regularnie 7-8 godzin, rzadko mam problemy", element: "Ziemia", points: 3 },
                    { text: "≈öpiƒô ma≈Ço, ale czujƒô siƒô wypoczƒôty/a", element: "Ogie≈Ñ", points: 2 },
                    { text: "Sen bywa niespokojny, czƒôsto siƒô budzƒô", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak wyglƒÖdajƒÖ Twoje emocje?",
                icon: "fas fa-heart",
                answers: [
                    { text: "Jestem spokojny/a, ale czasami odczuwam lƒôk", element: "Woda", points: 3 },
                    { text: "Potrafiƒô byƒá melancholijny/a, czasami smutny/a", element: "Metal", points: 3 },
                    { text: "Jestem zr√≥wnowa≈ºony/a, ale czasami siƒô martwiƒô", element: "Ziemia", points: 3 },
                    { text: "Jestem radosny/a i towarzyski/a, ale czasami nadpobudliwy/a", element: "Ogie≈Ñ", points: 3 },
                    { text: "Jestem energiczny/a, ale czasami wybuchowy/a", element: "Drewno", points: 3 }
                ]
            }
        ];

        function startElementTest() {
            currentQuestion = 0;
            testAnswers = [];
            
            const modal = document.getElementById('elementTestModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            showQuestion();
            
            // Log test start
            addSystemLog('INFO', 'USER', 'Rozpoczƒôto test ≈ºywio≈Çu TCM');
        }

        function closeElementTest() {
            const modal = document.getElementById('elementTestModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function showQuestion() {
            const testContent = document.getElementById('testContent');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const testResult = document.getElementById('testResult');
            
            testResult.style.display = 'none';
            testContent.style.display = 'block';
            
            if (currentQuestion < elementQuestions.length) {
                const question = elementQuestions[currentQuestion];
                
                testContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="background: rgba(76, 175, 80, 0.2); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="${question.icon}" style="font-size: 24px; color: #4CAF50;"></i>
                        </div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 5px;">
                            Pytanie ${currentQuestion + 1} z ${elementQuestions.length}
                        </div>
                        <h4 style="color: white; margin: 0; font-size: 18px; line-height: 1.4;">
                            ${question.question}
                        </h4>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${question.answers.map((answer, index) => `
                            <label style="
                                display: flex;
                                align-items: center;
                                padding: 15px;
                                border: 1px solid rgba(255,255,255,0.3);
                                border-radius: 12px;
                                background: rgba(255,255,255,0.05);
                                cursor: pointer;
                                transition: all 0.3s ease;
                                position: relative;
                            " onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                <input type="radio" name="answer" value="${index}" style="margin-right: 12px; transform: scale(1.2);">
                                <span style="color: white; font-size: 14px; line-height: 1.4; flex: 1;">${answer.text}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                
                // Show/hide navigation buttons
                prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
                nextBtn.textContent = currentQuestion === elementQuestions.length - 1 ? 'Poka≈º wyniki' : 'Nastƒôpne';
                nextBtn.innerHTML = currentQuestion === elementQuestions.length - 1 ? 
                    '<i class="fas fa-trophy" style="margin-right: 8px;"></i>Poka≈º wyniki' :
                    'Nastƒôpne<i class="fas fa-arrow-right" style="margin-left: 8px;"></i>';
                
            } else {
                showTestResults();
            }
        }

        function nextQuestion() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedAnswer) {
                showNotification('‚ùå Proszƒô wybraƒá odpowied≈∫!');
                return;
            }
            
            const answerIndex = parseInt(selectedAnswer.value);
            const answer = elementQuestions[currentQuestion].answers[answerIndex];
            
            testAnswers.push({
                question: currentQuestion,
                answer: answer
            });
            
            currentQuestion++;
            
            if (currentQuestion < elementQuestions.length) {
                showQuestion();
            } else {
                showTestResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                testAnswers.pop(); // Remove last answer
                showQuestion();
            }
        }

        function showTestResults() {
            const testContent = document.getElementById('testContent');
            const testResult = document.getElementById('testResult');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            
            testContent.style.display = 'none';
            testResult.style.display = 'block';
            nextBtn.style.display = 'none';
            prevBtn.style.display = 'none';
            
            // Calculate element scores
            const scores = {
                'Drewno': 0,
                'Ogie≈Ñ': 0,
                'Ziemia': 0,
                'Metal': 0,
                'Woda': 0
            };
            
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            
            // Find dominant element
            const dominantElement = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            const elementData = getElementDetails(dominantElement);
            
            testResult.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="background: ${elementData.gradient}; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <div style="font-size: 32px;">${elementData.icon}</div>
                    </div>
                    <h3 style="color: white; margin: 0 0 10px 0; font-size: 24px;">
                        Tw√≥j dominujƒÖcy ≈ºywio≈Ç: ${dominantElement}
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); font-size: 16px; margin: 0;">
                        ${elementData.description}
                    </p>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        üéØ Zalecenia dla Ciebie:
                    </h4>
                    <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                        ${elementData.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        üìä Twoje wyniki:
                    </h4>
                    ${Object.entries(scores).map(([element, score]) => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: rgba(255,255,255,0.9);">${element}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 100px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${(score / Math.max(...Object.values(scores))) * 100}%; height: 100%; background: ${element === dominantElement ? '#4CAF50' : 'rgba(255,255,255,0.4)'}; transition: width 0.3s ease;"></div>
                                </div>
                                <span style="color: white; font-weight: 600; min-width: 20px;">${score}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button onclick="restartTest()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                        <i class="fas fa-redo" style="margin-right: 8px;"></i>
                        Powt√≥rz test
                    </button>
                    <button onclick="saveTestResults('${dominantElement}')" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-save" style="margin-right: 8px;"></i>
                        Zapisz wyniki
                    </button>
                </div>
            `;
            
            // Log test completion
            addSystemLog('SUCCESS', 'USER', 'Uko≈Ñczono test ≈ºywio≈Çu TCM', `DominujƒÖcy ≈ºywio≈Ç: ${dominantElement}`);
        }

        function getElementDetails(element) {
            const details = {
                'Drewno': {
                    icon: 'üå±',
                    gradient: 'linear-gradient(135deg, #4CAF50, #66BB6A)',
                    description: 'Jeste≈õ pe≈Çen/a energii i ambicji. Twoja konstytucja jest elastyczna i dynamiczna jak m≈Çode drzewo.',
                    recommendations: [
                        'üåø Jedz zielone warzywa li≈õciaste i kie≈Çki',
                        'üßò Praktykuj ƒáwiczenia rozciƒÖgajƒÖce i joga',
                        'üòå ZarzƒÖdzaj stresem i gniewem przez medytacjƒô',
                        'üåÖ Wstawaj wcze≈õnie rano (5:00-7:00)',
                        'üçã Dodaj kwa≈õne smaki do diety (cytryna, ocet)'
                    ]
                },
                'Ogie≈Ñ': {
                    icon: 'üî•',
                    gradient: 'linear-gradient(135deg, #F44336, #FF5722)',
                    description: 'Jeste≈õ radosny/a i towarzyski/a. Twoja energia emanuje ciep≈Çem i komunikatywno≈õciƒÖ.',
                    recommendations: [
                        'üçâ Jedz ch≈ÇodzƒÖce owoce (arbuz, melon)',
                        'üèä Unikaj nadmiernego wysi≈Çku w upa≈Ç',
                        'üßò Praktykuj uspokajajƒÖcƒÖ medytacjƒô',
                        '‚òÄÔ∏è Najlepszy czas aktywno≈õci: 11:00-13:00',
                        'üçÉ Pij zielone i bia≈Çe herbaty'
                    ]
                },
                'Ziemia': {
                    icon: 'üåæ',
                    gradient: 'linear-gradient(135deg, #FFC107, #FF9800)',
                    description: 'Jeste≈õ stabilny/a i zr√≥wnowa≈ºony/a. Twoja konstytucja jest fundamentem dla innych.',
                    recommendations: [
                        'ü•ï Jedz s≈Çodkie warzywa (marchew, dynia)',
                        'üçö W≈ÇƒÖcz ziarna zb√≥≈º do diety',
                        '‚öñÔ∏è Jedz regularne posi≈Çki o sta≈Çych porach',
                        'üßò Praktykuj medytacjƒô siedzƒÖcƒÖ',
                        'üçØ Umiarkowanie w s≈Çodkich smakach'
                    ]
                },
                'Metal': {
                    icon: 'üçÇ',
                    gradient: 'linear-gradient(135deg, #9E9E9E, #607D8B)',
                    description: 'Jeste≈õ precyzyjny/a i refleksyjny/a. Twoja konstytucja ceni porzƒÖdek i strukturƒô.',
                    recommendations: [
                        'üçê Jedz bia≈Çe produkty (gruszki, rzodkiew)',
                        'ü´Å Praktykuj ƒáwiczenia oddechowe',
                        'üåÖ Najlepszy czas aktywno≈õci: 5:00-7:00 rano',
                        'üå∂Ô∏è Dodaj ≈Çagodnie ostre smaki',
                        'üíß Unikaj sucho≈õci - nawil≈ºaj powietrze'
                    ]
                },
                'Woda': {
                    icon: '‚ùÑÔ∏è',
                    gradient: 'linear-gradient(135deg, #2196F3, #03A9F4)',
                    description: 'Jeste≈õ spokojny/a i mƒÖdry/a. Twoja konstytucja jest g≈Çƒôboka jak spokojne wody.',
                    recommendations: [
                        'ü•≤ Jedz ciep≈Çe, gotowane potrawy',
                        '‚òï Pij ciep≈Çe napoje i herbaty',
                        'üõèÔ∏è Dbaj o odpowiedni sen (8-9 godzin)',
                        'üåô Najlepszy czas aktywno≈õci: wieczorem',
                        'üßÇ Dodaj s≈Çone smaki w umiarkowanych ilo≈õciach'
                    ]
                }
            };
            
            return details[element];
        }

        function restartTest() {
            startElementTest();
        }

        function saveTestResults(dominantElement) {
            const testResult = {
                date: new Date().toISOString(),
                dominantElement: dominantElement,
                allScores: {},
                answers: testAnswers
            };
            
            // Calculate scores for saving
            const scores = { 'Drewno': 0, 'Ogie≈Ñ': 0, 'Ziemia': 0, 'Metal': 0, 'Woda': 0 };
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            testResult.allScores = scores;
            
            // Save to localStorage
            const savedResults = JSON.parse(localStorage.getItem('elementTestResults') || '[]');
            savedResults.unshift(testResult);
            localStorage.setItem('elementTestResults', JSON.stringify(savedResults.slice(0, 10))); // Keep last 10 results
            
            // Save current dominant element
            localStorage.setItem('userDominantElement', dominantElement);
            
            // Log the save
            addSystemLog('SUCCESS', 'USER', 'Zapisano wyniki testu ≈ºywio≈Çu', `≈ªywio≈Ç: ${dominantElement}`);
            
            // Increase health metrics for completing the test
            increaseMetrics(3, 5, 2, 'Uko≈Ñczenie testu ≈ºywio≈Çu TCM');
            
            showNotification('‚úÖ Wyniki testu zosta≈Çy zapisane!');
            closeElementTest();
        }

        // Profile Edit Functions
        let currentEditingProfile = 'user'; // 'user' or 'admin'

        function editUserProfile() {
            currentEditingProfile = 'user';
            openProfileEditModal();
        }

        function editAdminProfile() {
            currentEditingProfile = 'admin';
            openProfileEditModal();
        }

        function openProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            // Load current values
            if (currentEditingProfile === 'user') {
                nameInput.value = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
                emailInput.value = localStorage.getItem('userEmail') || '';
            } else {
                nameInput.value = localStorage.getItem('adminName') || 'Administrator';
                emailInput.value = localStorage.getItem('adminEmail') || '';
            }
            
            passwordInput.value = '';
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Focus on first input
            setTimeout(() => nameInput.focus(), 100);
        }

        function closeProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function saveProfileChanges() {
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            const newName = nameInput.value.trim();
            const newEmail = emailInput.value.trim();
            const newPassword = passwordInput.value.trim();

            // Validate inputs
            if (!newName) {
                showNotification('‚ùå Nazwa u≈ºytkownika nie mo≈ºe byƒá pusta!');
                return;
            }

            if (newEmail && !isValidEmail(newEmail)) {
                showNotification('‚ùå Wprowad≈∫ poprawny adres email!');
                return;
            }

            // Save changes based on profile type
            if (currentEditingProfile === 'user') {
                // Update user profile
                localStorage.setItem('userName', newName);
                if (newEmail) localStorage.setItem('userEmail', newEmail);
                if (newPassword) localStorage.setItem('userPassword', newPassword);

                // Update UI immediately
                document.getElementById('user-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'USER', 'Profil u≈ºytkownika zosta≈Ç zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('‚úÖ Profil u≈ºytkownika zosta≈Ç zaktualizowany!');
            } else {
                // Update admin profile
                localStorage.setItem('adminName', newName);
                if (newEmail) localStorage.setItem('adminEmail', newEmail);
                if (newPassword) localStorage.setItem('adminPassword', newPassword);

                // Update UI immediately
                document.getElementById('admin-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'SYSTEM', 'Profil administratora zosta≈Ç zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('‚úÖ Profil administratora zosta≈Ç zaktualizowany!');
            }

            closeProfileEditModal();
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Profile Picture Functions
        function changeProfilePicture(profileType) {
            currentEditingProfile = profileType;
            const fileInput = document.getElementById('profilePictureInput');
            
            // Reset the input to ensure onChange fires even if same file is selected
            fileInput.value = '';
            fileInput.click();
        }

        // Initialize profile picture upload handler
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('profilePictureInput');
            
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showNotification('‚ùå Proszƒô wybraƒá plik obrazu!');
                        return;
                    }
                    
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('‚ùå Plik jest za du≈ºy! Maksymalny rozmiar to 5MB.');
                        return;
                    }
                    
                    // Read file as base64
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        
                        // Save and update profile picture
                        if (currentEditingProfile === 'user') {
                            localStorage.setItem('userProfilePicture', imageData);
                            updateProfilePictureDisplay('user-profile-picture', imageData);
                            addSystemLog('INFO', 'USER', 'Zdjƒôcie profilowe u≈ºytkownika zosta≈Ço zmienione');
                            showNotification('‚úÖ Zdjƒôcie profilowe zosta≈Ço zaktualizowane!');
                        } else {
                            localStorage.setItem('adminProfilePicture', imageData);
                            updateProfilePictureDisplay('admin-profile-picture', imageData);
                            addSystemLog('INFO', 'SYSTEM', 'Zdjƒôcie profilowe administratora zosta≈Ço zmienione');
                            showNotification('‚úÖ Zdjƒôcie profilowe administratora zosta≈Ço zaktualizowane!');
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        });

        function updateProfilePictureDisplay(elementId, imageData) {
            const profilePictureElement = document.getElementById(elementId);
            if (profilePictureElement && imageData) {
                profilePictureElement.style.backgroundImage = `url(${imageData})`;
                profilePictureElement.style.backgroundSize = 'cover';
                profilePictureElement.style.backgroundPosition = 'center';
                profilePictureElement.innerHTML = ''; // Remove emoji/icon
            }
        }

        // Load saved profile pictures on page load
        function loadSavedProfilePictures() {
            const userPicture = localStorage.getItem('userProfilePicture');
            const adminPicture = localStorage.getItem('adminProfilePicture');
            
            if (userPicture) {
                updateProfilePictureDisplay('user-profile-picture', userPicture);
            }
            
            if (adminPicture) {
                updateProfilePictureDisplay('admin-profile-picture', adminPicture);
            }
            
            // Load saved names
            const userName = localStorage.getItem('userName');
            const adminName = localStorage.getItem('adminName');
            
            if (userName && document.getElementById('user-display-name')) {
                document.getElementById('user-display-name').textContent = userName;
            }
            
            if (adminName && document.getElementById('admin-display-name')) {
                document.getElementById('admin-display-name').textContent = adminName;
            }
        }

        function logout() {
            if (confirm('Czy na pewno chcesz siƒô wylogowaƒá?')) {
                const userName = localStorage.getItem('userName');
                const userEmail = localStorage.getItem('userEmail');
                
                addSystemLog('INFO', 'AUTH', 'U≈ºytkownik siƒô wylogowa≈Ç', `U≈ºytkownik: ${userName}, Email: ${userEmail}`);
                
                const mainApp = document.getElementById('mainApp');
                mainApp.classList.add('logout-animation');
                
                setTimeout(() => {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('userEmail');
                    
                    showLoginScreen();
                    showNotification('Zosta≈Çe≈õ wylogowany');
                }, 500);
            }
        }

        function showMainApp() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            mainApp.classList.remove('logout-animation');
            mainApp.classList.add('login-animation');
        }

        function showLoginScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            mainApp.style.display = 'none';
            loginScreen.style.display = 'block';
            loginScreen.classList.add('login-animation');
        }

        function showRegister() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            registerForm.classList.add('login-animation');
        }

        function showLogin() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            loginForm.classList.add('login-animation');
        }

        function updateUserName(name) {
            const userNameElement = document.getElementById('user-display-name');
            if (userNameElement) {
                userNameElement.textContent = name;
            }
            
            // Also update localStorage
            localStorage.setItem('userName', name);
        }

        // Admin Functions
        function showAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'block';
            });
        }

        function hideAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'none';
            });
        }

        // Backup functionality
        function performBackup() {
            // Check if in offline mode
            if (offlineMode && !isOnline) {
                performOfflineBackup();
                return;
            }
            
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Create downloadable backup file
            const backupJson = JSON.stringify(backupData, null, 2);
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Backup_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Update last backup time in localStorage
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('SUCCESS', 'BACKUP', 'Backup zosta≈Ç utworzony i pobrany', `Rozmiar backup: ${Math.round(backupJson.length / 1024)} KB`);
            
            // Show success notification
            showNotification('üíæ Backup zosta≈Ç utworzony i pobrany pomy≈õlnie!');
            
            // Increase health metrics for responsible data management
            increaseMetrics(1, 2, 0, 'Odpowiedzialne zarzƒÖdzanie danymi');
            
            // Update backup time display if settings modal is open
            updateBackupDisplay();
        }

        function updateBackupDisplay() {
            const lastBackup = localStorage.getItem('lastBackupTime');
            if (lastBackup) {
                const backupTime = new Date(lastBackup);
                const now = new Date();
                const diffMinutes = Math.floor((now - backupTime) / (1000 * 60));
                
                let timeAgo = '';
                if (diffMinutes < 1) {
                    timeAgo = 'teraz';
                } else if (diffMinutes < 60) {
                    timeAgo = `${diffMinutes} min. temu`;
                } else if (diffMinutes < 1440) {
                    const hours = Math.floor(diffMinutes / 60);
                    timeAgo = `${hours} godz. temu`;
                } else {
                    const days = Math.floor(diffMinutes / 1440);
                    timeAgo = `${days} dni temu`;
                }

                // Update backup display in settings modal if exists
                const backupDisplay = document.querySelector('[data-backup-time]');
                if (backupDisplay) {
                    backupDisplay.textContent = `üîÑ Ostatni backup: ${timeAgo}`;
                }
            }
        }

        // Restore functionality
        function showRestoreModal() {
            const restoreModal = document.createElement('div');
            restoreModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            restoreModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <h3 style="color: white; margin-bottom: 20px;">üìÅ Przywr√≥ƒá Backup</h3>
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
                        <p>Wybierz plik backup do przywr√≥cenia:</p>
                    </div>
                    <input type="file" id="backupFileInput" accept=".json" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.3);
                        border-radius: 8px;
                        padding: 10px;
                        color: white;
                        width: 100%;
                        margin-bottom: 20px;
                    ">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="performRestore()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Przywr√≥ƒá</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(restoreModal);
            window.currentModal = restoreModal;
        }

        function performRestore() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('‚ùå Wybierz plik backup do przywr√≥cenia!');
                return;
            }

            if (!file.name.endsWith('.json')) {
                showNotification('‚ùå Nieprawid≈Çowy format pliku! Wybierz plik .json');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup structure
                    if (!backupData.data || !backupData.timestamp) {
                        throw new Error('Nieprawid≈Çowa struktura pliku backup');
                    }

                    // Restore user profile data
                    if (backupData.data.userProfile) {
                        const profile = backupData.data.userProfile;
                        if (profile.userRole) localStorage.setItem('userRole', profile.userRole);
                        if (profile.preferences) localStorage.setItem('userPreferences', profile.preferences);
                        if (profile.settings) localStorage.setItem('appSettings', profile.settings);
                    }

                    // Restore session data
                    if (backupData.data.sessionData) {
                        const session = backupData.data.sessionData;
                        if (session.lastVisit) localStorage.setItem('lastVisit', session.lastVisit);
                        if (session.sessionCount) localStorage.setItem('sessionCount', session.sessionCount);
                        if (session.totalUsageTime) localStorage.setItem('totalUsageTime', session.totalUsageTime);
                    }

                    // Restore app data
                    if (backupData.data.appData) {
                        const appData = backupData.data.appData;
                        if (appData.favoriteRecipes) localStorage.setItem('favoriteRecipes', appData.favoriteRecipes);
                        if (appData.healthMetrics) localStorage.setItem('healthMetrics', appData.healthMetrics);
                        if (appData.reminders) localStorage.setItem('reminders', appData.reminders);
                        if (appData.notes) localStorage.setItem('userNotes', appData.notes);
                    }

                    // Restore wellness data
                    if (backupData.data.wellness) {
                        const wellness = backupData.data.wellness;
                        if (wellness.currentSeason) localStorage.setItem('currentSeason', wellness.currentSeason);
                        if (wellness.seasonProgress) localStorage.setItem('seasonProgress', wellness.seasonProgress);
                        if (wellness.dailyTips) localStorage.setItem('dailyTips', wellness.dailyTips);
                    }

                    // Set restore timestamp
                    localStorage.setItem('lastRestoreTime', new Date().toISOString());
                    localStorage.setItem('restoredFromBackup', backupData.timestamp);

                    // Add to system logs
                    addSystemLog('SUCCESS', 'BACKUP', 'Backup zosta≈Ç przywr√≥cony pomy≈õlnie', `Przywr√≥cono dane z: ${backupData.timestamp}`);

                    closeModal();
                    showNotification('‚úÖ Backup zosta≈Ç przywr√≥cony pomy≈õlnie!');
                    
                    // Refresh page to apply restored data
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);

                } catch (error) {
                    addSystemLog('ERROR', 'BACKUP', 'B≈ÇƒÖd podczas przywracania backup', error.message);
                    showNotification('‚ùå B≈ÇƒÖd podczas przywracania backup: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        // System Logs functionality
        function initializeLogging() {
            // Initialize logging if not already done
            if (!localStorage.getItem('systemLogs')) {
                const initialLogs = [
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        level: 'INFO',
                        category: 'SYSTEM',
                        message: 'Aplikacja SezonoweDobro zosta≈Ça uruchomiona',
                        details: 'Inicjalizacja systemu zako≈Ñczona pomy≈õlnie'
                    }
                ];
                localStorage.setItem('systemLogs', JSON.stringify(initialLogs));
            }
        }

        function addSystemLog(level, category, message, details = '') {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const newLog = {
                id: logs.length + 1,
                timestamp: new Date().toISOString(),
                level: level.toUpperCase(),
                category: category.toUpperCase(),
                message: message,
                details: details
            };
            
            logs.unshift(newLog); // Add to beginning
            
            // Keep only last 100 logs
            if (logs.length > 100) {
                logs.splice(100);
            }
            
            localStorage.setItem('systemLogs', JSON.stringify(logs));
        }

        function showSystemLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            const logsModal = document.createElement('div');
            logsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            logsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 800px;
                    width: 100%;
                    max-height: 80vh;
                    backdrop-filter: blur(20px);
                    display: flex;
                    flex-direction: column;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: white; margin: 0;">üìÑ Logi Systemowe</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="logLevelFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie poziomy</option>
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                                <option value="SUCCESS">SUCCESS</option>
                            </select>
                            <select id="logCategoryFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie kategorie</option>
                                <option value="SYSTEM">SYSTEM</option>
                                <option value="USER">USER</option>
                                <option value="BACKUP">BACKUP</option>
                                <option value="AUTH">AUTH</option>
                                <option value="API">API</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="logsContainer" style="
                        flex: 1;
                        overflow-y: auto;
                        background: rgba(0, 0, 0, 0.3);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 20px;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    ">
                        ${generateLogsHTML(logs)}
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportLogs()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">üìÅ Eksportuj</button>
                        <button onclick="clearLogs()" style="
                            background: linear-gradient(135deg, #f44336, #ff5722);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">üóëÔ∏è Wyczy≈õƒá</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(logsModal);
            window.currentModal = logsModal;
            
            // Add event listener for clicking outside
            logsModal.onclick = (e) => {
                if (e.target === logsModal) closeModal();
            };
        }

        function generateLogsHTML(logs) {
            if (logs.length === 0) {
                return '<div style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">Brak log√≥w do wy≈õwietlenia</div>';
            }
            
            return logs.map(log => {
                const levelColor = getLevelColor(log.level);
                const formattedTime = new Date(log.timestamp).toLocaleString('pl-PL');
                
                return `
                    <div style="
                        background: rgba(255, 255, 255, 0.05);
                        border-left: 4px solid ${levelColor};
                        margin-bottom: 10px;
                        padding: 12px;
                        border-radius: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="
                                    background: ${levelColor};
                                    color: white;
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                    font-weight: 600;
                                ">${log.level}</span>
                                <span style="
                                    background: rgba(255, 255, 255, 0.1);
                                    color: rgba(255, 255, 255, 0.8);
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                ">${log.category}</span>
                            </div>
                            <span style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">${formattedTime}</span>
                        </div>
                        <div style="color: white; font-weight: 500; margin-bottom: 5px;">${log.message}</div>
                        ${log.details ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 13px;">${log.details}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getLevelColor(level) {
            const colors = {
                'INFO': '#2196F3',
                'SUCCESS': '#4CAF50',
                'WARNING': '#FF9800',
                'ERROR': '#f44336'
            };
            return colors[level] || '#607D8B';
        }

        function filterLogs() {
            const levelFilter = document.getElementById('logLevelFilter').value;
            const categoryFilter = document.getElementById('logCategoryFilter').value;
            const allLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            let filteredLogs = allLogs;
            
            if (levelFilter) {
                filteredLogs = filteredLogs.filter(log => log.level === levelFilter);
            }
            
            if (categoryFilter) {
                filteredLogs = filteredLogs.filter(log => log.category === categoryFilter);
            }
            
            const container = document.getElementById('logsContainer');
            if (container) {
                container.innerHTML = generateLogsHTML(filteredLogs);
            }
        }

        function exportLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const exportData = {
                exported: new Date().toISOString(),
                version: "1.0.0",
                totalLogs: logs.length,
                logs: logs
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Logi_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addSystemLog('INFO', 'SYSTEM', 'Logi zosta≈Çy wyeksportowane', `Wyeksportowano ${logs.length} wpis√≥w`);
            showNotification('üìÅ Logi zosta≈Çy wyeksportowane pomy≈õlnie!');
        }

        function clearLogs() {
            if (confirm('Czy na pewno chcesz wyczy≈õciƒá wszystkie logi? Ta operacja jest nieodwracalna.')) {
                localStorage.removeItem('systemLogs');
                addSystemLog('WARNING', 'SYSTEM', 'Logi systemowe zosta≈Çy wyczyszczone', 'Wszystkie poprzednie logi zosta≈Çy usuniƒôte');
                
                const container = document.getElementById('logsContainer');
                if (container) {
                    const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
                    container.innerHTML = generateLogsHTML(logs);
                }
                
                showNotification('üóëÔ∏è Logi zosta≈Çy wyczyszczone');
            }
        }

        // Offline Mode functionality
        let isOnline = navigator.onLine;
        let offlineMode = false;

        function initializeOfflineMode() {
            // Check if offline mode is enabled from previous session
            offlineMode = localStorage.getItem('offlineMode') === 'true';
            updateOfflineStatus();
            
            // Listen for network status changes
            window.addEventListener('online', () => {
                isOnline = true;
                updateNetworkStatus();
                if (!offlineMode) {
                    syncOfflineData();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateNetworkStatus();
                if (!offlineMode) {
                    showNotification('‚ö†Ô∏è Brak po≈ÇƒÖczenia internetowego. Prze≈ÇƒÖczanie na tryb offline...');
                    setTimeout(() => enableOfflineMode(true), 2000);
                }
            });
            
            // Initial network status check
            updateNetworkStatus();
        }

        function toggleOfflineMode() {
            if (offlineMode) {
                disableOfflineMode();
            } else {
                enableOfflineMode();
            }
        }

        function enableOfflineMode(automatic = false) {
            offlineMode = true;
            localStorage.setItem('offlineMode', 'true');
            
            if (!automatic) {
                addSystemLog('INFO', 'SYSTEM', 'Tryb offline zosta≈Ç w≈ÇƒÖczony rƒôcznie', 'U≈ºytkownik prze≈ÇƒÖczy≈Ç aplikacjƒô w tryb offline');
            } else {
                addSystemLog('WARNING', 'SYSTEM', 'Tryb offline zosta≈Ç w≈ÇƒÖczony automatycznie', 'Brak po≈ÇƒÖczenia internetowego');
            }
            
            updateOfflineStatus();
            showOfflineModal();
            
            // Cache essential data
            cacheOfflineData();
        }

        function disableOfflineMode() {
            offlineMode = false;
            localStorage.setItem('offlineMode', 'false');
            
            addSystemLog('INFO', 'SYSTEM', 'Tryb offline zosta≈Ç wy≈ÇƒÖczony', 'Powr√≥t do trybu online');
            updateOfflineStatus();
            
            if (isOnline) {
                syncOfflineData();
                showNotification('üåê Powr√≥t do trybu online. Synchronizacja danych...');
            } else {
                showNotification('‚ö†Ô∏è Tryb offline wy≈ÇƒÖczony, ale brak po≈ÇƒÖczenia internetowego');
            }
        }

        function updateOfflineStatus() {
            const offlineIcon = document.getElementById('offline-icon');
            const offlineText = document.getElementById('offline-text');
            const adminOfflineIcon = document.getElementById('admin-offline-icon');
            const adminOfflineText = document.getElementById('admin-offline-text');
            
            if (offlineMode) {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-wifi-slash feature-icon';
                    offlineIcon.style.color = '#f44336';
                }
                if (offlineText) {
                    offlineText.textContent = 'Online';
                    offlineText.style.color = '#f44336';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi feature-icon';
                    adminOfflineIcon.style.color = '#4CAF50';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Online';
                    adminOfflineText.style.color = '#4CAF50';
                }
            } else {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-download feature-icon';
                    offlineIcon.style.color = '';
                }
                if (offlineText) {
                    offlineText.textContent = 'Tryb Offline';
                    offlineText.style.color = '';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi-slash feature-icon';
                    adminOfflineIcon.style.color = '';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Tryb Offline';
                    adminOfflineText.style.color = '';
                }
            }
        }

        function updateNetworkStatus() {
            // Add network status indicator to header
            let networkIndicator = document.getElementById('network-status');
            if (!networkIndicator) {
                networkIndicator = document.createElement('div');
                networkIndicator.id = 'network-status';
                networkIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 20px;
                    padding: 5px 10px;
                    border-radius: 15px;
                    font-size: 12px;
                    font-weight: 600;
                    z-index: 9999;
                    transition: all 0.3s ease;
                `;
                document.body.appendChild(networkIndicator);
            }
            
            if (offlineMode) {
                networkIndicator.style.background = 'rgba(255, 193, 7, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = 'üì± Offline';
            } else if (isOnline) {
                networkIndicator.style.background = 'rgba(76, 175, 80, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = 'üåê Online';
            } else {
                networkIndicator.style.background = 'rgba(244, 67, 54, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = '‚ö†Ô∏è Brak sieci';
            }
        }

        function showOfflineModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">üì±</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Tryb Offline Aktywny</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Aplikacja dzia≈Ça teraz w trybie offline.</p>
                        <br>
                        <p><strong>Dostƒôpne funkcje:</strong></p>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li>‚Ä¢ PrzeglƒÖdanie przepis√≥w</li>
                            <li>‚Ä¢ Kalendarz sezonowy</li>
                            <li>‚Ä¢ Notatki osobiste</li>
                            <li>‚Ä¢ Zapisane dane</li>
                        </ul>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Dane bƒôdƒÖ zsynchronizowane po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <button onclick="closeModal()" style="
                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 12px 24px;
                        cursor: pointer;
                        font-weight: 600;
                    ">Rozumiem</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            
            // Auto close after 10 seconds
            setTimeout(() => {
                if (window.currentModal === modal) {
                    closeModal();
                }
            }, 10000);
        }

        function cacheOfflineData() {
            const offlineCache = {
                timestamp: new Date().toISOString(),
                userData: {
                    profile: {
                        userName: localStorage.getItem('userName'),
                        userEmail: localStorage.getItem('userEmail'),
                        userRole: localStorage.getItem('userRole')
                    },
                    preferences: localStorage.getItem('userPreferences') || '{}',
                    settings: localStorage.getItem('appSettings') || '{}',
                    favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                    healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                    notes: localStorage.getItem('userNotes') || '[]'
                },
                appState: {
                    currentSeason: localStorage.getItem('currentSeason') || '',
                    seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                    lastVisit: localStorage.getItem('lastVisit') || ''
                }
            };
            
            localStorage.setItem('offlineCache', JSON.stringify(offlineCache));
            addSystemLog('INFO', 'SYSTEM', 'Dane zosta≈Çy zapisane w cache offline', `Rozmiar cache: ${Math.round(JSON.stringify(offlineCache).length / 1024)} KB`);
        }

        function syncOfflineData() {
            const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
            
            if (offlineChanges.length > 0) {
                showNotification('üîÑ Synchronizacja danych offline...');
                
                // Simulate sync process
                setTimeout(() => {
                    // Process offline changes
                    offlineChanges.forEach(change => {
                        addSystemLog('INFO', 'SYSTEM', 'Zsynchronizowano zmiany offline', `Typ: ${change.type}, Czas: ${change.timestamp}`);
                    });
                    
                    // Clear offline changes
                    localStorage.removeItem('offlineChanges');
                    
                    showNotification('‚úÖ Synchronizacja zako≈Ñczona pomy≈õlnie!');
                    addSystemLog('SUCCESS', 'SYSTEM', 'Synchronizacja danych offline zako≈Ñczona', `Zsynchronizowano ${offlineChanges.length} zmian`);
                }, 2000);
            }
        }

        function performOfflineBackup() {
            const offlineBackupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "offline",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        userName: localStorage.getItem('userName') || '',
                        userEmail: localStorage.getItem('userEmail') || '',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    },
                    systemData: {
                        logs: localStorage.getItem('systemLogs') || '[]',
                        offlineChanges: localStorage.getItem('offlineChanges') || '[]'
                    }
                }
            };

            // Store offline backup
            localStorage.setItem('offlineBackup', JSON.stringify(offlineBackupData));
            localStorage.setItem('lastOfflineBackup', new Date().toISOString());
            
            // Show offline backup modal
            showOfflineBackupModal(offlineBackupData);
            
            addSystemLog('SUCCESS', 'BACKUP', 'Backup offline zosta≈Ç utworzony', `Rozmiar: ${Math.round(JSON.stringify(offlineBackupData).length / 1024)} KB`);
            addOfflineChange('backup', { timestamp: new Date().toISOString(), size: JSON.stringify(offlineBackupData).length });
        }

        function showOfflineBackupModal(backupData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            const backupSize = Math.round(JSON.stringify(backupData).length / 1024);
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">üíæ</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Backup Offline Utworzony</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Backup zosta≈Ç zapisany lokalnie w trybie offline.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>üìä Szczeg√≥≈Çy backup:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;">‚Ä¢ Rozmiar: ${backupSize} KB</p>
                            <p style="font-size: 13px; margin: 5px 0;">‚Ä¢ Typ: Offline</p>
                            <p style="font-size: 13px; margin: 5px 0;">‚Ä¢ Czas: ${new Date().toLocaleString('pl-PL')}</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Backup bƒôdzie dostƒôpny do pobrania po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportOfflineBackup()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">üìÅ Zapisz Lokalnie</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        function exportOfflineBackup() {
            const offlineBackup = localStorage.getItem('offlineBackup');
            if (offlineBackup) {
                const blob = new Blob([offlineBackup], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                const currentDate = new Date().toISOString().split('T')[0];
                a.href = url;
                a.download = `SezonoweDobro_Offline_Backup_${currentDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('üíæ Offline backup zosta≈Ç pobrany!');
                addSystemLog('SUCCESS', 'BACKUP', 'Offline backup zosta≈Ç wyeksportowany', 'Plik zapisany lokalnie');
                closeModal();
            }
        }

        function addOfflineChange(type, data) {
            if (offlineMode) {
                const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
                offlineChanges.push({
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    type: type,
                    data: data
                });
                localStorage.setItem('offlineChanges', JSON.stringify(offlineChanges));
            }
        }

        function checkSettingsAccessError() {
            const settingsAccessError = localStorage.getItem('settingsAccessError');
            if (settingsAccessError) {
                showNotification('‚ùå ' + settingsAccessError);
                addSystemLog('WARNING', 'AUTH', 'Nieuprawiony dostƒôp do ustawie≈Ñ zosta≈Ç zablokowany', settingsAccessError);
                localStorage.removeItem('settingsAccessError');
            }
        }

        function showAdminNotification(feature) {
            showNotification(`üîß ${feature} - funkcja w rozwoju`);
        }

        function showSystemSettings() {
            // Check if user is admin
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (userRole !== 'admin') {
                showNotification('‚ùå Dostƒôp do ustawie≈Ñ tylko dla administrator√≥w!');
                addSystemLog('WARNING', 'AUTH', 'Pr√≥ba dostƒôpu do ustawie≈Ñ bez uprawnie≈Ñ administratora', `Rola u≈ºytkownika: ${userRole}`);
                return;
            }
            
            // Log access to settings
            addSystemLog('INFO', 'SYSTEM', 'Administrator wszed≈Ç do ustawie≈Ñ systemu', 'Otwarto panel ustawie≈Ñ');
            
            // Open settings.html in new tab/window
            try {
                const settingsWindow = window.open('settings.html', '_blank', 'width=800,height=900,scrollbars=yes,resizable=yes');
                
                if (settingsWindow) {
                    showNotification('‚öôÔ∏è Otwieranie panelu ustawie≈Ñ administratora...');
                    
                    // Focus the new window
                    settingsWindow.focus();
                    
                    // Add event listener to detect when settings window is closed
                    const checkClosed = setInterval(() => {
                        if (settingsWindow.closed) {
                            showNotification('‚úÖ Panel ustawie≈Ñ zosta≈Ç zamkniƒôty');
                            addSystemLog('INFO', 'SYSTEM', 'Panel ustawie≈Ñ zosta≈Ç zamkniƒôty', 'Powr√≥t do g≈Ç√≥wnej aplikacji');
                            clearInterval(checkClosed);
                        }
                    }, 1000);
                } else {
                    // Fallback if popup was blocked
                    showAdminSettingsModal();
                }
            } catch (error) {
                addSystemLog('ERROR', 'SYSTEM', 'B≈ÇƒÖd podczas otwierania ustawie≈Ñ', error.message);
                showAdminSettingsModal();
            }
        }

        function showAdminSettingsModal() {
            const settingsModal = document.createElement('div');
            settingsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            settingsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">‚öôÔ∏è</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Panel Ustawie≈Ñ Administratora</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Panel ustawie≈Ñ otwiera siƒô w nowym oknie.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>üìä Status systemu:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="server">‚Ä¢ Serwer: Online ‚Ä¢ 2025</p>
                            <p style="font-size: 13px; margin: 5px 0;">‚Ä¢ U≈ºycie dysku: 32%</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-backup-time>‚Ä¢ Ostatni backup: brak</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="active-users">‚Ä¢ Aktywni u≈ºytkownicy 2025: 347</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Je≈õli okno siƒô nie otworzy≈Ço, sprawd≈∫ blokadƒô popup w przeglƒÖdarce.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="openSettingsManually()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">üîó Otw√≥rz Ustawienia</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(settingsModal);
            window.currentModal = settingsModal;
            
            // Update backup display immediately
            updateBackupDisplay();
        }

        function openSettingsManually() {
            // Close current modal first
            closeModal();
            
            // Open settings page
            window.location.href = 'settings.html';
        }

        function closeModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }

        // Season Details Modal Functions
        function showSeasonDetails(element) {
            const seasonData = getSeasonData(element);
            const userRole = localStorage.getItem('userRole') || 'user';
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeSeasonModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${seasonData.color};">
                    <button class="close-modal-btn" onclick="closeSeasonModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${seasonData.color};">
                            ${seasonData.icon}
                        </div>
                        <div>
                            <div class="season-modal-title">${seasonData.name}</div>
                            <div class="season-modal-subtitle">${seasonData.period} ‚Ä¢ Element ${seasonData.element}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Opis Elementu
                        </div>
                        <div class="season-info-content">
                            ${seasonData.description}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-heart"></i>
                            PowiƒÖzane Organy
                        </div>
                        <div class="season-info-content">
                            <strong>G≈Ç√≥wny organ:</strong> ${seasonData.mainOrgan}<br>
                            <strong>Organ pomocniczy:</strong> ${seasonData.secondaryOrgan}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-utensils"></i>
                            Zalecane Pokarmy
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.foods.map(food => `<li>‚Ä¢ ${food}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-dumbbell"></i>
                            Zalecane ƒÜwiczenia
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.exercises.map(exercise => `<li>‚Ä¢ ${exercise}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Czego Unikaƒá
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.avoid.map(item => `<li>‚Ä¢ ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="season-info-section" style="border-left-color: ${seasonData.color}; background: rgba(255, 193, 7, 0.1);">
                        <div class="season-info-title">
                            <i class="fas fa-crown"></i>
                            Informacje dla Administratora
                        </div>
                        <div class="season-info-content">
                            <strong>Energia:</strong> ${seasonData.adminInfo.energy}<br>
                            <strong>Kierunek:</strong> ${seasonData.adminInfo.direction}<br>
                            <strong>Pora dnia:</strong> ${seasonData.adminInfo.timeOfDay}<br>
                            <strong>Emocja:</strong> ${seasonData.adminInfo.emotion}<br>
                            <strong>Smak:</strong> ${seasonData.adminInfo.taste}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentSeasonModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeSeasonModal() {
            if (window.currentSeasonModal) {
                window.currentSeasonModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentSeasonModal && document.body.contains(window.currentSeasonModal)) {
                        document.body.removeChild(window.currentSeasonModal);
                    }
                    window.currentSeasonModal = null;
                }, 300);
            }
        }

        function getSeasonData(element) {
            const seasonData = {
                'Drewno': {
                    name: 'Element Drewna',
                    period: 'Wiosna (Marzec - Maj)',
                    element: 'Drewno üå±',
                    icon: 'üå±',
                    color: '#4CAF50',
                    description: 'Element Drewna reprezentuje wzrost, elastyczno≈õƒá i nowe poczƒÖtki. To czas odnowy, oczyszczania organizmu i planowania przysz≈Ço≈õci. Energia ro≈õnie w g√≥rƒô jak m≈Çode pƒôdy.',
                    mainOrgan: 'WƒÖtroba (Gan)',
                    secondaryOrgan: 'Pƒôcherzyk ≈º√≥≈Çciowy (Dan)',
                    foods: [
                        'Zielone warzywa li≈õciaste (szpinak, rukola)',
                        'M≈Çode kie≈Çki i pƒôdy',
                        'Cytryna i limonka',
                        'Zielona herbata',
                        'Pokrzywy i mniszek lekarski'
                    ],
                    exercises: [
                        'Tai Chi w parku',
                        'Joga rozciƒÖgajƒÖca',
                        'Spacery w naturze',
                        'ƒÜwiczenia elastyczno≈õci',
                        'Oddychanie brzuchem'
                    ],
                    avoid: [
                        'Nadmierna z≈Ço≈õƒá i frustracja',
                        'Przejadanie siƒô',
                        'Alkohol i u≈ºywki',
                        'SiedzƒÖcy tryb ≈ºycia',
                        'Stres i napiƒôcie'
                    ],
                    adminInfo: {
                        energy: 'Yang rosnƒÖce',
                        direction: 'Wsch√≥d',
                        timeOfDay: 'Wczesny ranek (5:00-7:00)',
                        emotion: 'Gniew (kontrolowany)',
                        taste: 'Kwa≈õny'
                    }
                },
                'Ogie≈Ñ': {
                    name: 'Element Ognia',
                    period: 'Lato (Czerwiec - Sierpie≈Ñ)',
                    element: 'Ogie≈Ñ üî•',
                    icon: 'üî•',
                    color: '#F44336',
                    description: 'Element Ognia reprezentuje rado≈õƒá, komunikacjƒô i ekspansjƒô. To czas maksymalnej aktywno≈õci Yang, ciep≈Ça i spo≈Çecznych interakcji. Energia emanuje na zewnƒÖtrz.',
                    mainOrgan: 'Serce (Xin)',
                    secondaryOrgan: 'Jelito cienkie (Xiao Chang)',
                    foods: [
                        'Ch≈ÇodzƒÖce owoce (arbuz, melon)',
                        'Pomidory i og√≥rki',
                        'Miƒôta i bazylia',
                        'Zielona herbata i herbaty ch≈ÇodzƒÖce',
                        'Lekkie zupy i gazpacho'
                    ],
                    exercises: [
                        'Qigong o ≈õwicie',
                        'P≈Çywanie',
                        'Medytacja w cieniu',
                        'Joga ch≈ÇodzƒÖca (Yin)',
                        'Spacery w ch≈Çodniejszych porach'
                    ],
                    avoid: [
                        'Przegrzewanie organizmu',
                        'Intensywny wysi≈Çek w upa≈Ç',
                        'Pikantne i rozgrzewajƒÖce potrawy',
                        'Nadmierne emocje',
                        'D≈Çugie nas≈Çonecznienie'
                    ],
                    adminInfo: {
                        energy: 'Yang maksymalne',
                        direction: 'Po≈Çudnie',
                        timeOfDay: 'Po≈Çudnie (11:00-13:00)',
                        emotion: 'Rado≈õƒá',
                        taste: 'Gorzki'
                    }
                },
                'Ziemia': {
                    name: 'Element Ziemi',
                    period: 'P√≥≈∫ne Lato (Wrzesie≈Ñ)',
                    element: 'Ziemia üåæ',
                    icon: 'üåæ',
                    color: '#FFC107',
                    description: 'Element Ziemi reprezentuje stabilno≈õƒá, r√≥wnowagƒô i od≈ºywianie. To czas zbior√≥w, refleksji i przygotowania do jesieni. Energia koncentruje siƒô w centrum.',
                    mainOrgan: '≈öledziona (Pi)',
                    secondaryOrgan: '≈ªo≈ÇƒÖdek (Wei)',
                    foods: [
                        'S≈Çodkie warzywa (marchew, dynia)',
                        'Ziarna zb√≥≈º (proso, ry≈º)',
                        'S≈Çodkie owoce (daty, morele)',
                        'Korze≈Ñ lukrecji',
                        '≈ª√≥≈Çte i pomara≈Ñczowe produkty'
                    ],
                    exercises: [
                        'Medytacja siedzƒÖca',
                        '≈Åagodne spacery po posi≈Çku',
                        'ƒÜwiczenia r√≥wnowagi',
                        'Tai Chi w centrum',
                        'Joga stabilizujƒÖca'
                    ],
                    avoid: [
                        'Przejadanie siƒô',
                        'Zimne napoje z jedzeniem',
                        'Obsesyjne my≈õlenie',
                        'Nieregularne posi≈Çki',
                        'Nadmierne martwieniu'
                    ],
                    adminInfo: {
                        energy: 'Yin-Yang zr√≥wnowa≈ºone',
                        direction: 'Centrum',
                        timeOfDay: 'Ca≈Çodobowo (szczeg√≥lnie przej≈õcia)',
                        emotion: 'Troska (zr√≥wnowa≈ºona)',
                        taste: 'S≈Çodki'
                    }
                },
                'Metal': {
                    name: 'Element Metalu',
                    period: 'Jesie≈Ñ (Pa≈∫dziernik - Grudzie≈Ñ)',
                    element: 'Metal ‚ö°',
                    icon: 'üçÇ',
                    color: '#9E9E9E',
                    description: 'Element Metalu reprezentuje precyzjƒô, refleksjƒô i wewnƒôtrznƒÖ si≈Çƒô. To czas zbierania do≈õwiadcze≈Ñ, oczyszczania i przygotowania na zimƒô. Energia siƒô zagƒôszcza.',
                    mainOrgan: 'P≈Çuca (Fei)',
                    secondaryOrgan: 'Jelito grube (Da Chang)',
                    foods: [
                        'Bia≈Çe produkty (gruszki, rzodkiew)',
                        'Orzchy i nasiona',
                        'Korze≈Ñ lotosu',
                        'Bia≈Çy ry≈º i proso',
                        'Herbata bia≈Ça i oolong'
                    ],
                    exercises: [
                        'G≈Çƒôbokie oddychanie',
                        'Qigong dla p≈Çuc',
                        'Powolne spacery',
                        'Joga z naciskiem na oddech',
                        'Medytacja oddechowa'
                    ],
                    avoid: [
                        'Sucho≈õƒá powietrza',
                        'Nadmierny smutek',
                        'Intensywny wysi≈Çek',
                        'Zimne napoje',
                        'Zaniedbywanie higieny'
                    ],
                    adminInfo: {
                        energy: 'Yang malejƒÖce',
                        direction: 'Zach√≥d',
                        timeOfDay: 'Wczesny wiecz√≥r (17:00-19:00)',
                        emotion: 'Smutek (przemijajƒÖcy)',
                        taste: 'Ostry'
                    }
                },
                'Woda': {
                    name: 'Element Wody',
                    period: 'Zima (Stycze≈Ñ - Luty)',
                    element: 'Woda ‚ùÑÔ∏è',
                    icon: '‚ùÑÔ∏è',
                    color: '#2196F3',
                    description: 'Element Wody reprezentuje g≈Çƒôbiƒô, mƒÖdro≈õƒá i potencja≈Ç. To czas maksymalnego Yin, odpoczynku i kultywowania energii wewnƒôtrznej. Energia gromadzi siƒô w g≈Çƒôbi.',
                    mainOrgan: 'Nerki (Shen)',
                    secondaryOrgan: 'Pƒôcherz moczowy (Pang Guang)',
                    foods: [
                        'Ciemne produkty (czarne ziarna, goji)',
                        'Kostne buliony i zupy',
                        'Orzechy w≈Çoskie i nasiona',
                        'Ciep≈Çe napoje z imbirem',
                        'Morskie algi i owoce morza'
                    ],
                    exercises: [
                        'Delikatne rozciƒÖganie',
                        'Medytacja g≈Çƒôboka',
                        'Qigong dla nerek',
                        'Joga restoratywna',
                        'Spacery kontemplacyjne'
                    ],
                    avoid: [
                        'Wyczerpanie energii',
                        'Nadmierny lƒôk',
                        'Zimne otoczenie',
                        'Intensywne ƒáwiczenia',
                        'Bezsenno≈õƒá'
                    ],
                    adminInfo: {
                        energy: 'Yin maksymalne',
                        direction: 'P√≥≈Çnoc',
                        timeOfDay: 'Noc (23:00-1:00)',
                        emotion: 'Lƒôk (kontrolowany)',
                        taste: 'S≈Çony'
                    }
                }
            };
            
            return seasonData[element] || seasonData['Ogie≈Ñ'];
        }

        // Dynamic Recipes Functions
        function updateRecipes() {
            const currentSeason = updateSeason();
            const recipesContainer = document.getElementById('recipesContainer');
            
            if (!recipesContainer) return;
            
            const seasonalRecipes = getSeasonalRecipes(currentSeason.element);
            
            recipesContainer.innerHTML = seasonalRecipes.map((recipe, index) => `
                <div class="recipe-card clickable" onclick="showRecipeDetails('${currentSeason.element}', ${index})">
                    <div class="recipe-image">
                        ${recipe.emoji}
                    </div>
                    <div class="recipe-info">
                        <div class="recipe-title">${recipe.name}</div>
                        <div class="recipe-meta">
                            <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                            <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                            <span><i class="${getElementIcon(currentSeason.element)}"></i> ${currentSeason.element}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getSeasonalRecipes(element) {
            const recipes = {
                'Drewno': [
                    {
                        name: 'Wiosenna Sa≈Çatka Detoks',
                        emoji: 'ü•ó',
                        time: '15 min',
                        temperature: 'Ch≈ÇodzƒÖca',
                        ingredients: [
                            '2 szklanki m≈Çodych li≈õci szpinaku',
                            '1 szklanka roszponki',
                            '1/2 szklanki kie≈Çk√≥w rzodkiewki',
                            '1 og√≥rek',
                            '2 ≈Çy≈ºki nasion s≈Çonecznika',
                            '1 cytryna (sok)',
                            '2 ≈Çy≈ºki oliwy z oliwek',
                            '≈öwie≈ºa miƒôta do dekoracji'
                        ],
                        instructions: [
                            'Dok≈Çadnie umyj wszystkie zielone warzywa w zimnej wodzie.',
                            'Pokr√≥j og√≥rek w cienkie plasterki.',
                            'W du≈ºej misce po≈ÇƒÖcz szpinak, roszponkƒô i kie≈Çki.',
                            'Przygotuj dresing: wymieszaj sok z cytryny z oliwƒÖ.',
                            'Polej sa≈Çatkƒô dressingiem i delikatnie wymieszaj.',
                            'Posyp nasionami s≈Çonecznika i udekoruj miƒôtƒÖ.',
                            'Podawaj natychmiast, najlepiej o poranku.'
                        ],
                                                 benefits: `Ta sa≈Çatka oczyszcza wƒÖtrobƒô, dostarcza witaminy C i wspiera naturalne procesy detoksykacji organizmu wiosnƒÖ ${new Date().getFullYear()}.`,
                        tcmProperties: 'Ch≈Çodzi Ciep≈Ço WƒÖtroby, wzmacnia Qi ≈õledziony, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Mniszka Lekarskiego',
                        emoji: 'üçµ',
                        time: '10 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '2 ≈Çy≈ºeczki suszonych li≈õci mniszka',
                            '1 szklanka wody',
                            '1 plasterek cytryny',
                            '1 ≈Çy≈ºeczka miodu (opcjonalnie)',
                            '≈öwie≈ºe li≈õcie miƒôty'
                        ],
                        instructions: [
                            'Zagotuj wodƒô w czajniku.',
                            'W≈Ç√≥≈º suszone li≈õcie mniszka do zaparzacza.',
                            'Zalej wrzƒÖtkiem i pozostaw pod przykryciem na 7-8 minut.',
                            'Przeced≈∫ herbatƒô przez sitko.',
                            'Dodaj plasterek cytryny i mi√≥d wed≈Çug smaku.',
                            'Udekoruj listkami miƒôty.',
                            'Pij rano na czczo dla najlepszego efektu.'
                        ],
                        benefits: 'Wspiera funkcje wƒÖtroby, oczyszcza organizm z toksyn i pobudza trawienie po zimie.',
                        tcmProperties: 'Oczyszcza Ciep≈Ço-Wilgoƒá, wzmacnia Qi wƒÖtroby, reguluje przep≈Çyw Qi'
                    },
                    {
                        name: 'Zielona Owsianka EnergetyzujƒÖca',
                        emoji: 'ü•£',
                        time: '25 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '1 szklanka p≈Çatk√≥w owsianych',
                            '2 szklanki mleka ro≈õlinnego',
                            '1 ≈Çy≈ºka proszku z chlorelli',
                            '1 banan',
                            '2 ≈Çy≈ºki orzech√≥w w≈Çoskich',
                            '1 ≈Çy≈ºka miodu',
                            'Nasiona chia (1 ≈Çy≈ºka)',
                            '≈öwie≈ºe jagody (do dekoracji)'
                        ],
                        instructions: [
                            'W garnku zagotuj mleko ro≈õlinne.',
                            'Dodaj p≈Çatki owsiane i gotuj na ma≈Çym ogniu 15 minut.',
                            'Wmieszaj proszek z chlorelli (nadaje zielony kolor).',
                            'Pokr√≥j banana w plasterki.',
                            'Prze≈Ç√≥≈º owsiankƒô do miski, udekoruj bananem.',
                            'Posyp orzechami, nasionami chia i jagodami.',
                            'Skrop miodem i podawaj ciep≈ÇƒÖ.'
                        ],
                        benefits: 'Dostarcza energii na ca≈Çy dzie≈Ñ, wzmacnia wƒÖtrobƒô i wspiera wzrost nowych kom√≥rek.',
                        tcmProperties: 'Od≈ºywia Krew wƒÖtroby, wzmacnia Qi ≈õledziony, harmonizuje Shen'
                    }
                ],
                'Ogie≈Ñ': [
                    {
                        name: 'Gazpacho Andaluzyjskie',
                        emoji: 'üçÖ',
                        time: '20 min + ch≈Çodzenie',
                        temperature: 'Ch≈ÇodzƒÖca',
                        ingredients: [
                            '6 du≈ºych pomidor√≥w',
                            '1 og√≥rek',
                            '1 czerwona papryka',
                            '1/2 czerwonej cebuli',
                            '3 zƒÖbki czosnku',
                            '4 ≈Çy≈ºki oliwy z oliwek extra virgin',
                            '2 ≈Çy≈ºki octu sherry',
                            'S√≥l morska do smaku',
                            '≈öwie≈ºa bazylia do dekoracji'
                        ],
                        instructions: [
                            'Spar≈º pomidory, obierz ze sk√≥ry i usu≈Ñ nasiona.',
                            'Obierz og√≥rek i pokr√≥j w grube kawa≈Çki.',
                            'Paprykƒô oczy≈õƒá z nasion i pokr√≥j.',
                            'Wszystkie warzywa wrzuƒá do blendera.',
                            'Dodaj oliwƒô, ocet i przyprawy.',
                            'Miksuj do uzyskania g≈Çadkiej konsystencji.',
                            'Wstaw do lod√≥wki na minimum 2 godziny.',
                            'Podawaj ozdobione bazyliƒÖ.'
                        ],
                                                 benefits: `Och≈Çadza organizm w upalne letnie dni ${new Date().getFullYear()}, dostarcza licopenu i witamin.`,
                        tcmProperties: 'Oczyszcza Ciep≈Ço serca, nawadnia p≈Çyny ustrojowe, uspokaja Shen'
                    },
                    {
                        name: 'Smoothie z Arbuza i Miƒôty',
                        emoji: 'üçâ',
                        time: '5 min',
                        temperature: 'Ch≈ÇodzƒÖca',
                        ingredients: [
                            '3 szklanki pokrojonego arbuza',
                            '10 listk√≥w ≈õwie≈ºej miƒôty',
                            '1 limonka (sok)',
                            '1 ≈Çy≈ºka miodu',
                            '1/2 szklanki wody kokosowej',
                            'L√≥d do podania',
                            'Plastry limonki do dekoracji'
                        ],
                        instructions: [
                            'Usu≈Ñ pestki z arbuza i pokr√≥j miƒÖ≈ºsz.',
                            'Do blendera wrzuƒá arbuz i listki miƒôty.',
                            'Dodaj sok z limonki i mi√≥d.',
                            'Wlej wodƒô kokosowƒÖ.',
                            'Miksuj przez 30 sekund do g≈Çadko≈õci.',
                            'Przelej do szklanek z lodem.',
                            'Udekoruj plastrem limonki i miƒôtƒÖ.'
                        ],
                        benefits: 'Intensywnie nawadnia, ch≈Çodzi i wspiera pracƒô serca w gorƒÖce dni.',
                        tcmProperties: 'Ch≈Çodzi Ciep≈Ço serca, uzupe≈Çnia Yin, wzmacnia funkcje nerek'
                    },
                    {
                        name: 'Sa≈Çatka Grecka z BazyliƒÖ',
                        emoji: 'ü•í',
                        time: '15 min',
                        temperature: 'Ch≈ÇodzƒÖca',
                        ingredients: [
                            '3 du≈ºe pomidory',
                            '2 og√≥rki',
                            '1 czerwona cebula',
                            '200g sera feta',
                            '1/2 szklanki oliwek Kalamata',
                            '4 ≈Çy≈ºki oliwy z oliwek',
                            '2 ≈Çy≈ºki octu balsamicznego',
                            '≈öwie≈ºa bazylia',
                            'Oregano suszone'
                        ],
                        instructions: [
                            'Pokr√≥j pomidory w √≥semki.',
                            'Og√≥rki pokr√≥j w p√≥≈Çplasterki.',
                            'Cebulƒô pokr√≥j w cienkie plasterki.',
                            'Fetƒô pokrusz na wiƒôksze kawa≈Çki.',
                            'Po≈ÇƒÖcz wszystkie warzywa w misce.',
                            'Przygotuj dresing z oliwy i octu.',
                            'Polej sa≈Çatkƒô, wymieszaj delikatnie.',
                            'Posyp ≈õwie≈ºƒÖ bazyliƒÖ i oregano.'
                        ],
                        benefits: 'Wspiera zdrowie serca, dostarcza zdrowych t≈Çuszczy i elektrolit√≥w.',
                        tcmProperties: 'Od≈ºywia Yin serca, ch≈Çodzi Ciep≈Ço, harmonizuje emocje'
                    }
                ],
                'Ziemia': [
                    {
                        name: 'Zupa z Dyni i Marchwi',
                        emoji: 'üç≤',
                        time: '45 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '500g dyni Hokkaido',
                            '3 du≈ºe marchwie',
                            '1 cebula',
                            '2 cm ≈õwie≈ºego imbiru',
                            '1 litr bulionu warzywnego',
                            '200ml mleka kokosowego',
                            '2 ≈Çy≈ºki oliwy z oliwek',
                            'Nasiona dyni do dekoracji',
                            'S√≥l i pieprz do smaku'
                        ],
                        instructions: [
                            'Obierz dyniƒô i marchew, pokr√≥j w kostki.',
                            'Cebulƒô pokr√≥j drobno, imbir zetrzyj.',
                            'Rozgrzej oliwƒô w garnku, zeszklij cebulƒô.',
                            'Dodaj imbir, dyniƒô i marchew.',
                            'Zalej bulionem i gotuj 30 minut.',
                            'Zmiksuj na g≈Çadko blenderem.',
                            'Dodaj mleko kokosowe, dopraw.',
                            'Podawaj z pra≈ºonymi nasionami dyni.'
                        ],
                        benefits: 'Wzmacnia ≈õledzionƒô, poprawia trawienie i dostarcza beta-karotenu.',
                        tcmProperties: 'Wzmacnia Qi ≈õledziony, od≈ºywia Krew, harmonizuje ≈örodkowy Ogrzewacz'
                    },
                    {
                        name: 'Zapiekanka z Prosa i S≈Çodkich Ziemniak√≥w',
                        emoji: 'üç†',
                        time: '60 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '1 szklanka prosa',
                            '2 s≈Çodkie ziemniaki',
                            '1 cebula',
                            '2 szklanki bulionu',
                            '100g sera koziego',
                            '2 ≈Çy≈ºki mas≈Ça',
                            'Tymianek ≈õwie≈ºy',
                            'S√≥l i pieprz',
                            'Oliwa do smarowania'
                        ],
                        instructions: [
                            'Ugotuj proso w bulionie (20 min).',
                            'S≈Çodkie ziemniaki obierz i pokr√≥j w plasterki.',
                            'Cebulƒô pokr√≥j w p√≥≈Çksiƒô≈ºyce.',
                            'Naczynie ≈ºaroodporne posmaruj oliwƒÖ.',
                            'U≈Ç√≥≈º warstwami: proso, ziemniaki, cebulƒô.',
                            'Rozkrusz ser kozi na wierzchu.',
                            'Dodaj mas≈Ço w kawa≈Çkach i tymianek.',
                            'Piecz 35 minut w 180¬∞C.'
                        ],
                        benefits: 'Stabilizuje poziom cukru, wzmacnia ≈õledzionƒô i daje d≈Çugotrwa≈ÇƒÖ energiƒô.',
                        tcmProperties: 'Tonizuje Qi ≈õledziony, wzmacnia Yang nerek, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Korzeniem Lukrecji',
                        emoji: 'ü´ñ',
                        time: '15 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '1 ≈Çy≈ºeczka korzenia lukrecji (suszonego)',
                            '1 szklanka wody',
                            '1 plasterek ≈õwie≈ºego imbiru',
                            '1 ≈Çy≈ºeczka miodu',
                            'Cynamon w proszku (szczypta)',
                            'Plaster pomara≈Ñczy'
                        ],
                        instructions: [
                            'Korze≈Ñ lukrecji zalej wrzƒÖtkiem.',
                            'Dodaj plasterek imbiru.',
                            'Gotuj na ma≈Çym ogniu 10 minut.',
                            'Przeced≈∫ przez sitko.',
                            'Dodaj mi√≥d i cynamon.',
                            'Udekoruj plastrem pomara≈Ñczy.',
                            'Pij ciep≈ÇƒÖ, najlepiej po posi≈Çku.'
                        ],
                        benefits: 'Harmonizuje trawienie, ≈Çagodzi stres i wzmacnia nadnercza.',
                        tcmProperties: 'Harmonizuje wszystkie formu≈Çy, wzmacnia Qi ≈õledziony, od≈ºywia Yin'
                    }
                ],
                'Metal': [
                    {
                        name: 'Zupa Gruszkowa z Orzechami',
                        emoji: 'üçê',
                        time: '35 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '4 dojrza≈Çe gruszki',
                            '1/2 szklanki orzech√≥w w≈Çoskich',
                            '1 litr bulionu warzywnego',
                            '1 cebula',
                            '2 ≈Çy≈ºki mas≈Ça',
                            '1/4 szklanki ≈õmietany 18%',
                            'Tymianek ≈õwie≈ºy',
                            'S√≥l i bia≈Çy pieprz',
                            'Oliwa do skropienia'
                        ],
                        instructions: [
                            'Gruszki obierz i pokr√≥j w ƒáwiartki.',
                            'Cebulƒô pokr√≥j drobno.',
                            'Na ma≈õle zeszklij cebulƒô.',
                            'Dodaj gruszki i du≈õ 10 minut.',
                            'Zalej bulionem, gotuj 20 minut.',
                            'Zmiksuj z orzechami na g≈Çadko.',
                            'Dodaj ≈õmietanƒô, dopraw.',
                            'Podawaj z tymiankiem i oliwƒÖ.'
                        ],
                                                 benefits: `Nawil≈ºa p≈Çuca, ≈Çagodzi kaszel i wzmacnia system oddechowy jesieniƒÖ ${new Date().getFullYear()}.`,
                        tcmProperties: 'Od≈ºywia Yin p≈Çuc, oczyszcza Ciep≈Ço, ≈Çagodzi sucho≈õƒá'
                    },
                    {
                        name: 'Ry≈º z Korzeniem Lotosu',
                        emoji: 'üçö',
                        time: '40 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '1 szklanka bia≈Çego ry≈ºu',
                            '100g ≈õwie≈ºego korzenia lotosu',
                            '2 szklanki bulionu drobiowego',
                            '2 ≈Çy≈ºki oleju sezamowego',
                            '1 ≈Çy≈ºka sosu sojowego',
                            'Zielona cebulka',
                            'Nasiona sezamu',
                            'Bia≈Çy pieprz'
                        ],
                        instructions: [
                            'Korze≈Ñ lotosu obierz i pokr√≥j w plasterki.',
                            'Ry≈º przep≈Çucz do czystej wody.',
                            'W garnku rozgrzej olej sezamowy.',
                            'Podsma≈º korze≈Ñ lotosu 5 minut.',
                            'Dodaj ry≈º, mieszaj 2 minuty.',
                            'Zalej bulionem, gotuj pod przykryciem 25 min.',
                            'Dopraw sosem sojowym i pieprzem.',
                            'Posyp cebulkƒÖ i sezamem.'
                        ],
                        benefits: 'Wzmacnia p≈Çuca, wspiera trawienie i poprawia krƒÖ≈ºenie.',
                        tcmProperties: 'Tonizuje Qi p≈Çuc, wzmacnia ≈õledzionƒô, harmonizuje Qi'
                    },
                    {
                        name: 'Herbata Bia≈Ça z ChryzantemƒÖ',
                        emoji: 'üåº',
                        time: '8 min',
                        temperature: 'Ciep≈Ça',
                        ingredients: [
                            '1 ≈Çy≈ºeczka bia≈Çej herbaty',
                            '5-6 suszonych kwiat√≥w chryzantemy',
                            '1 szklanka wody (80¬∞C)',
                            '1 plasterek gruszki',
                            'Mi√≥d do smaku',
                            'Kilka listk√≥w miƒôty'
                        ],
                        instructions: [
                            'Wodƒô podgrzej do 80¬∞C (nie gotuj!).',
                            'W czajniczku po≈ÇƒÖcz herbatƒô z chryzantemƒÖ.',
                            'Zalej ciep≈ÇƒÖ wodƒÖ.',
                            'Zaparzaj 5-6 minut.',
                            'Przeced≈∫ do fili≈ºanki.',
                            'Dodaj plasterek gruszki i mi√≥d.',
                            'Udekoruj miƒôtƒÖ, pij powoli.'
                        ],
                        benefits: 'Oczyszcza p≈Çuca, uspokaja umys≈Ç i wspiera jasno≈õƒá my≈õlenia.',
                        tcmProperties: 'Oczyszcza Ciep≈Ço z p≈Çuc, uspokaja Shen, rozja≈õnia oczy'
                    }
                ],
                'Woda': [
                    {
                        name: 'Ros√≥≈Ç z Goji i Imbirem',
                        emoji: 'üçú',
                        time: '90 min',
                        temperature: 'GorƒÖca',
                        ingredients: [
                            '1 kg ko≈õci wo≈Çowych',
                            '2 ≈Çy≈ºki jag√≥d goji',
                            '5 cm ≈õwie≈ºego imbiru',
                            '2 marchwie',
                            '1 seler naciowy',
                            '1 cebula',
                            '2 li≈õcie laurowe',
                            'Pietruszka ≈õwie≈ºa',
                            'S√≥l morska'
                        ],
                        instructions: [
                            'Ko≈õci op≈Çucz i w≈Ç√≥≈º do garnka.',
                            'Zalej zimnƒÖ wodƒÖ, doprowad≈∫ do wrzenia.',
                            'Zdejmij pianƒô, dodaj pokrojone warzywa.',
                            'Dodaj imbir i li≈õcie laurowe.',
                            'Gotuj na ma≈Çym ogniu 90 minut.',
                            'Na 15 minut przed ko≈Ñcem dodaj goji.',
                            'Przeced≈∫ ros√≥≈Ç przez sitko.',
                            'Podawaj z pietruszkƒô i solƒÖ.'
                        ],
                                                 benefits: `Wzmacnia nerki, dostarcza kolagenu i rozgrzewa organizm zimƒÖ ${new Date().getFullYear()}.`,
                        tcmProperties: 'Tonizuje Yang nerek, wzmacnia esencjƒô Jing, od≈ºywia szpik kostny'
                    },
                    {
                        name: 'Pierogi z KapustƒÖ KiszonƒÖ',
                        emoji: 'ü•ü',
                        time: '120 min',
                        temperature: 'GorƒÖca',
                        ingredients: [
                            '500g mƒÖki pszennej',
                            '250ml ciep≈Çej wody',
                            '1 jajko',
                            '400g kapusty kiszonej',
                            '200g kie≈Çbasy',
                            '1 cebula',
                            '2 ≈Çy≈ºki mas≈Ça',
                            'Kminek',
                            'Pieprz czarny'
                        ],
                        instructions: [
                            'Z mƒÖki, wody i jajka wyr√≥b ciasto.',
                            'Pozostaw pod ≈õciereczkƒÖ na 30 minut.',
                            'Kapustƒô odsƒÖcz i drobno posiekaj.',
                            'Kie≈Çbasƒô i cebulƒô pokr√≥j w kostki.',
                            'Podsma≈º cebulƒô, dodaj kie≈Çbasƒô i kapustƒô.',
                            'Du≈õ 15 minut, dopraw.',
                            'Rozwa≈Çkuj ciasto, wytnij ko≈Ça.',
                            'Na≈Ç√≥≈º nadzienie, zlepi i ugotuj.'
                        ],
                        benefits: 'Wspiera trawienie, dostarcza probiotyk√≥w i rozgrzewa Qi nerek.',
                        tcmProperties: 'Wzmacnia Yang ≈õledziony, tonizuje Qi nerek, reguluje trawienie'
                    },
                    {
                        name: 'Herbata Pu-erh z CytrynƒÖ',
                        emoji: 'üçã',
                        time: '12 min',
                        temperature: 'GorƒÖca',
                        ingredients: [
                            '1 ≈Çy≈ºeczka herbaty pu-erh',
                            '1 szklanka wody',
                            '2 plasterki cytryny',
                            '1 cm ≈õwie≈ºego imbiru',
                            '1 ≈Çy≈ºeczka miodu',
                            'Cynamon w lasce',
                            'Go≈∫dziki (2 sztuki)'
                        ],
                        instructions: [
                            'Herbatƒô pu-erh przep≈Çucz ciep≈ÇƒÖ wodƒÖ.',
                            'Zagotuj wodƒô z imbirem i przyprawami.',
                            'Zalej herbatƒô, zaparzaj 8 minut.',
                            'Przeced≈∫ przez sitko.',
                            'Dodaj plasterki cytryny i mi√≥d.',
                            'Mieszaj delikatnie.',
                            'Pij gorƒÖcƒÖ, najlepiej wieczorem.'
                        ],
                        benefits: 'Wspiera trawienie t≈Çuszczy, oczyszcza organizm i rozgrzewa wnƒôtrzno≈õci.',
                        tcmProperties: 'Reguluje Qi ≈õledziony, rozpuszcza Wilgoƒá, wzmacnia Yang'
                    }
                ]
            };
            
            return recipes[element] || recipes['Ogie≈Ñ'];
        }

        function getElementIcon(element) {
            const icons = {
                'Drewno': 'fas fa-leaf',
                'Ogie≈Ñ': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return icons[element] || 'fas fa-utensils';
        }

        function showRecipeDetails(element, recipeIndex) {
            const recipes = getSeasonalRecipes(element);
            const recipe = recipes[recipeIndex];
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (!recipe) return;
            
            const modal = document.createElement('div');
            modal.className = 'recipe-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeRecipeModal();
            };
            
            modal.innerHTML = `
                <div class="recipe-modal-content" style="border-color: ${getElementColor(element)};">
                    <button class="close-modal-btn" onclick="closeRecipeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="recipe-modal-header">
                        <div class="recipe-modal-icon">
                            ${recipe.emoji}
                        </div>
                        <div style="flex: 1;">
                            <div class="recipe-modal-title">${recipe.name}</div>
                            <div class="recipe-modal-meta">
                                <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                                <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                                <span><i class="${getElementIcon(element)}"></i> Element ${element}</span>
                                <span><i class="fas fa-calendar"></i> Sezon ${new Date().getFullYear()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-shopping-cart"></i>
                            Sk≈Çadniki
                        </div>
                        <ul class="recipe-ingredients-list">
                            ${recipe.ingredients.map(ingredient => `<li>‚Ä¢ ${ingredient}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-list-ol"></i>
                            Spos√≥b przygotowania
                        </div>
                        <div class="recipe-instructions">
                            <ol>
                                ${recipe.instructions.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-heart"></i>
                            Korzy≈õci zdrowotne
                        </div>
                        <div class="recipe-benefits">
                            ${recipe.benefits}
                        </div>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)}; background: rgba(255, 193, 7, 0.1);">
                        <div class="recipe-section-title">
                            <i class="fas fa-yin-yang"></i>
                            W≈Ça≈õciwo≈õci TCM (Admin)
                        </div>
                        <div class="season-info-content">
                            <strong>Dzia≈Çanie na organizm:</strong><br>
                            ${recipe.tcmProperties}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentRecipeModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeRecipeModal() {
            if (window.currentRecipeModal) {
                window.currentRecipeModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentRecipeModal && document.body.contains(window.currentRecipeModal)) {
                        document.body.removeChild(window.currentRecipeModal);
                    }
                    window.currentRecipeModal = null;
                }, 300);
            }
        }

        function getElementColor(element) {
            const colors = {
                'Drewno': '#4CAF50',
                'Ogie≈Ñ': '#F44336',
                'Ziemia': '#FFC107',
                'Metal': '#9E9E9E',
                'Woda': '#2196F3'
            };
            return colors[element] || '#4CAF50';
        }

        function generateShoppingList() {
            const currentSeason = updateSeason();
            const recipes = getSeasonalRecipes(currentSeason.element);
            
            // Collect all ingredients from current season recipes
            const allIngredients = [];
            recipes.forEach(recipe => {
                allIngredients.push(...recipe.ingredients);
            });
            
            // Remove duplicates and create clean list
            const uniqueIngredients = [...new Set(allIngredients.map(ingredient => 
                ingredient.replace(/^\d+\s*(szklanki?|≈Çy≈ºki?|≈Çy≈ºeczki?|cm|g|ml|kg|sztuki?|litr|plaster|plasterki|zƒÖbki?)\s*/i, '')
                    .replace(/\s*\([^)]*\)/g, '')
                    .trim()
            ))];
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeShoppingListModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                    <button class="close-modal-btn" onclick="closeShoppingListModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                            üõí
                        </div>
                        <div>
                            <div class="season-modal-title">Lista Zakup√≥w Sezonowych</div>
                                                         <div class="season-modal-subtitle">${currentSeason.name} ‚Ä¢ Rok ${new Date().getFullYear()}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-shopping-basket"></i>
                            Sk≈Çadniki z przepis√≥w sezonowych
                        </div>
                        <ul class="season-info-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                            ${uniqueIngredients.map(ingredient => `
                                <li style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px;">
                                    ‚úÖ ${ingredient}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Porady zakupowe TCM
                        </div>
                        <div class="season-info-content">
                            ${getSeasonalShoppingTips(currentSeason.element)}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="action-btn" onclick="printShoppingList()" style="margin-right: 10px;">
                            üñ®Ô∏è Wydrukuj listƒô
                        </button>
                        <button class="action-btn" onclick="shareShoppingList()">
                            üì± Udostƒôpnij
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentShoppingModal = modal;
        }

        function getSeasonalShoppingTips(element) {
            const tips = {
                'Drewno': 'Wybieraj m≈Çode, ≈õwie≈ºe warzywa li≈õciaste. Unikaj przetworzonej ≈ºywno≈õci. Szukaj produkt√≥w bogatych w witaminƒô C i chlorofil.',
                'Ogie≈Ñ': 'Kupuj ch≈ÇodzƒÖce owoce i warzywa. Unikaj rozgrzewajƒÖcych przypraw. Wybieraj lekkie, ≈Çatwo strawne produkty.',
                'Ziemia': 'Skoncentruj siƒô na s≈Çodkich, od≈ºywczych produktach. Wybieraj ziarna i korzenie. Unikaj zimnych napoj√≥w.',
                'Metal': 'Kupuj bia≈Çe produkty i te bogate w sk≈Çadniki nawil≈ºajƒÖce. Wybieraj orzechy i nasiona. Unikaj suchej ≈ºywno≈õci.',
                'Woda': 'Skoncentruj siƒô na ciep≈Çych, od≈ºywczych produktach. Wybieraj ciemne ziarna i owoce morza. Unikaj zimnych pokarm√≥w.'
            };
            return tips[element] || tips['Ogie≈Ñ'];
        }

        function closeShoppingListModal() {
            if (window.currentShoppingModal) {
                window.currentShoppingModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentShoppingModal && document.body.contains(window.currentShoppingModal)) {
                        document.body.removeChild(window.currentShoppingModal);
                    }
                    window.currentShoppingModal = null;
                }, 300);
            }
        }

        function printShoppingList() {
            window.print();
            showNotification('üñ®Ô∏è Lista zakup√≥w przygotowana do druku!');
        }

        function shareShoppingList() {
            const currentYear = new Date().getFullYear();
            if (navigator.share) {
                navigator.share({
                    title: `Lista Zakup√≥w Sezonowych - SezonoweDobro ${currentYear}`,
                    text: 'Sprawd≈∫ mojƒÖ listƒô zakup√≥w wed≈Çug Tradycyjnej Medycyny Chi≈Ñskiej!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href);
                showNotification('üì± Link do aplikacji skopiowany do schowka!');
            }
        }

        // Dynamic Year Updates
        function updateCurrentYear() {
            const currentYear = new Date().getFullYear();
            
            // Update all year references
            const yearElements = document.querySelectorAll('.current-year');
            yearElements.forEach(element => {
                element.textContent = currentYear;
            });
            
            // Update taglines
            const taglines = document.querySelectorAll('.tagline');
            taglines.forEach(tagline => {
                tagline.textContent = `Tradycyjna Medycyna Chi≈Ñska dla Wsp√≥≈Çczesnego ≈ªycia ‚Ä¢ ${currentYear}`;
            });
            
            // Update welcome message
            setTimeout(() => {
                if (localStorage.getItem('isLoggedIn') === 'true') {
                    showNotification(`Witaj w Twojej podr√≥≈ºy do zdrowia w roku ${currentYear}! üåü`);
                }
            }, 1000);
            
            // Update admin stats
            updateAdminStats(currentYear);
            
            // Update shopping list modal subtitle
            const shoppingModalSubtitles = document.querySelectorAll('.shopping-modal-subtitle');
            shoppingModalSubtitles.forEach(subtitle => {
                const seasonName = subtitle.textContent.split(' ‚Ä¢ ')[0];
                subtitle.textContent = `${seasonName} ‚Ä¢ Rok ${currentYear}`;
            });
            
            return currentYear;
        }
        
                 function updateAdminStats(year) {
             // Update user stats for current year
             const userYearLabels = document.querySelectorAll('[data-year="users"]');
             userYearLabels.forEach(label => {
                 label.textContent = `U≈ºytkownicy ${year}`;
             });
             
             const recipeYearLabels = document.querySelectorAll('[data-year="recipes"]');
             recipeYearLabels.forEach(label => {
                 label.textContent = `Przepisy ${year}`;
             });
             
             const serverStatusElements = document.querySelectorAll('[data-year="server"]');
             serverStatusElements.forEach(element => {
                 element.textContent = `Status serwera: Online ‚Ä¢ ${year}`;
             });
             
             const activeUserElements = document.querySelectorAll('[data-year="active-users"]');
             activeUserElements.forEach(element => {
                 element.textContent = `Aktywni u≈ºytkownicy ${year}: 347`;
             });
         }

         // Herbs and Emotions Functions
         function showHerbsAndEmotions() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'herbs-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeHerbsModal();
             };
             
             const herbsData = getHerbsAndEmotionsData();
             
             modal.innerHTML = `
                 <div class="herbs-modal-content">
                     <button class="close-modal-btn" onclick="closeHerbsModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             üåø
                         </div>
                         <div>
                             <div class="season-modal-title">Zio≈Ça i Emocje w TCM</div>
                             <div class="season-modal-subtitle">Naturalne wsparcie emocjonalne ‚Ä¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${herbsData.map(category => `
                         <div class="herbs-category" onclick="toggleHerbsCategory(this)">
                             <div class="herbs-category-header">
                                 <div class="herbs-category-title">
                                     <div class="herbs-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.emotion} ‚Ä¢ Element ${category.element}
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down herbs-expand-icon"></i>
                             </div>
                             <div class="herbs-category-content">
                                 <div class="herbs-grid">
                                     ${category.herbs.map(herb => `
                                         <div class="herb-card" style="border-left-color: ${category.color};">
                                             <div class="herb-header">
                                                 <span class="herb-emoji">${herb.emoji}</span>
                                                 <span class="herb-name">${herb.name}</span>
                                             </div>
                                             <div class="herb-description">
                                                 ${herb.description}
                                             </div>
                                             <div class="herb-properties" style="border-left-color: ${category.color};">
                                                 <div class="herb-properties-title">W≈Ça≈õciwo≈õci TCM</div>
                                                 <div class="herb-properties-text">
                                                     <strong>Dzia≈Çanie:</strong> ${herb.action}<br>
                                                     <strong>Temperatura:</strong> ${herb.temperature}<br>
                                                     <strong>Smak:</strong> ${herb.taste}
                                                     ${userRole === 'admin' ? `<br><strong>Meridian:</strong> ${herb.meridian}<br><strong>Dawkowanie:</strong> ${herb.dosage}` : ''}
                                                 </div>
                                             </div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentHerbsModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleHerbsCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeHerbsModal() {
             if (window.currentHerbsModal) {
                 window.currentHerbsModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentHerbsModal && document.body.contains(window.currentHerbsModal)) {
                         document.body.removeChild(window.currentHerbsModal);
                     }
                     window.currentHerbsModal = null;
                 }, 300);
             }
         }

         // Face Yoga Functions
         function showFaceYoga() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'face-yoga-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeFaceYogaModal();
             };
             
             const yogaData = getFaceYogaData();
             
             modal.innerHTML = `
                 <div class="face-yoga-modal-content">
                     <button class="close-modal-btn" onclick="closeFaceYogaModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             üßò‚Äç‚ôÄÔ∏è
                         </div>
                         <div>
                             <div class="season-modal-title">Joga Twarzy</div>
                             <div class="season-modal-subtitle">Naturalne odm≈Çadzanie wed≈Çug TCM ‚Ä¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${yogaData.map(category => `
                         <div class="yoga-category" onclick="toggleYogaCategory(this)">
                             <div class="yoga-category-header">
                                 <div class="yoga-category-title">
                                     <div class="yoga-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} ‚Ä¢ ${category.exercises.length} ƒáwicze≈Ñ
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down yoga-expand-icon"></i>
                             </div>
                             <div class="yoga-category-content">
                                 <div class="yoga-exercises-grid">
                                     ${category.exercises.map(exercise => `
                                         <div class="yoga-exercise-card" style="border-left-color: ${category.color};">
                                             <div class="yoga-exercise-header">
                                                 <span class="yoga-exercise-emoji">${exercise.emoji}</span>
                                                 <span class="yoga-exercise-name">${exercise.name}</span>
                                             </div>
                                             <div class="yoga-exercise-description">
                                                 ${exercise.description}
                                             </div>
                                             <div class="yoga-exercise-steps" style="border-left-color: ${category.color};">
                                                 <div class="yoga-steps-title">Instrukcja krok po kroku</div>
                                                 <ul class="yoga-steps-list">
                                                     ${exercise.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="yoga-benefits" style="border-left-color: ${category.color};">
                                                 <div class="yoga-benefits-title">Korzy≈õci</div>
                                                 <div class="yoga-benefits-text">
                                                     ${exercise.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE ADMIN</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Meridian:</strong> ${exercise.meridian}<br>
                                                         <strong>Element TCM:</strong> ${exercise.element}<br>
                                                         <strong>Energia:</strong> ${exercise.energy}<br>
                                                         <strong>Przeciwwskazania:</strong> ${exercise.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="yoga-duration">‚è±Ô∏è ${exercise.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentFaceYogaModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleYogaCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeFaceYogaModal() {
             if (window.currentFaceYogaModal) {
                 window.currentFaceYogaModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentFaceYogaModal && document.body.contains(window.currentFaceYogaModal)) {
                         document.body.removeChild(window.currentFaceYogaModal);
                     }
                     window.currentFaceYogaModal = null;
                 }, 300);
             }
         }

         // Seasonal Energy Functions
         function updateSeasonalEnergyButton() {
             const currentSeason = updateSeason();
             const button = document.getElementById('seasonalEnergyButton');
             const icon = document.getElementById('seasonalEnergyIcon');
             const text = document.getElementById('seasonalEnergyText');
             
             if (!button || !icon || !text) return;
             
             const seasonalData = {
                 'Drewno': {
                     name: 'Wiosenna Energia',
                     icon: 'fas fa-leaf',
                     emoji: 'üå±',
                     color: '#4CAF50'
                 },
                 'Ogie≈Ñ': {
                     name: 'Letnia Energia', 
                     icon: 'fas fa-fire',
                     emoji: 'üî•',
                     color: '#F44336'
                 },
                 'Ziemia': {
                     name: 'Energia Ziemi',
                     icon: 'fas fa-mountain',
                     emoji: 'üåæ',
                     color: '#FFC107'
                 },
                 'Metal': {
                     name: 'Jesienna Energia',
                     icon: 'fas fa-wind',
                     emoji: 'üçÇ',
                     color: '#9E9E9E'
                 },
                 'Woda': {
                     name: 'Zimowa Energia',
                     icon: 'fas fa-snowflake',
                     emoji: '‚ùÑÔ∏è',
                     color: '#2196F3'
                 }
             };
             
             const seasonData = seasonalData[currentSeason.element] || seasonalData['Ogie≈Ñ'];
             
             // Update button appearance
             icon.className = `${seasonData.icon} feature-icon`;
             icon.style.color = seasonData.color;
             text.textContent = seasonData.name;
             
             // Add seasonal gradient background
             button.style.background = `linear-gradient(135deg, ${seasonData.color}15, ${seasonData.color}05)`;
             button.style.borderColor = `${seasonData.color}30`;
         }

         function showSeasonalEnergy() {
             const currentSeason = updateSeason();
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'seasonal-energy-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeSeasonalEnergyModal();
             };
             
             const energyData = getSeasonalEnergyData(currentSeason.element);
             
             modal.innerHTML = `
                 <div class="seasonal-energy-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                     <button class="close-modal-btn" onclick="closeSeasonalEnergyModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                             ${getSeasonalEmoji(currentSeason.element)}
                         </div>
                         <div>
                             <div class="season-modal-title">${getSeasonalName(currentSeason.element)}</div>
                             <div class="season-modal-subtitle">Praktyki energetyczne wed≈Çug TCM ‚Ä¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${energyData.map(category => `
                         <div class="energy-practice-category" onclick="toggleEnergyCategory(this)">
                             <div class="energy-practice-header">
                                 <div class="energy-practice-title">
                                     <div class="energy-practice-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} ‚Ä¢ ${category.practices.length} praktyk
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down energy-expand-icon"></i>
                             </div>
                             <div class="energy-practice-content">
                                 <div class="energy-practices-grid">
                                     ${category.practices.map(practice => `
                                         <div class="energy-practice-card" style="border-left-color: ${category.color};">
                                             <div class="energy-practice-card-header">
                                                 <span class="energy-practice-emoji">${practice.emoji}</span>
                                                 <span class="energy-practice-name">${practice.name}</span>
                                             </div>
                                             <div class="energy-practice-description">
                                                 ${practice.description}
                                             </div>
                                             <div class="energy-practice-steps" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-steps-title">Instrukcja wykonania</div>
                                                 <ul class="energy-practice-steps-list">
                                                     ${practice.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="energy-practice-benefits" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-benefits-title">Korzy≈õci energetyczne</div>
                                                 <div class="energy-practice-benefits-text">
                                                     ${practice.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE TCM (ADMIN)</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Element:</strong> ${practice.element}<br>
                                                         <strong>Typ energii:</strong> ${practice.energyType}<br>
                                                         <strong>Meridian:</strong> ${practice.meridian}<br>
                                                         <strong>Najlepszy czas:</strong> ${practice.bestTime}<br>
                                                         <strong>Przeciwwskazania:</strong> ${practice.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="energy-practice-duration" style="background: ${category.color}20;">‚è±Ô∏è ${practice.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentSeasonalEnergyModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleEnergyCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeSeasonalEnergyModal() {
             if (window.currentSeasonalEnergyModal) {
                 window.currentSeasonalEnergyModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentSeasonalEnergyModal && document.body.contains(window.currentSeasonalEnergyModal)) {
                         document.body.removeChild(window.currentSeasonalEnergyModal);
                     }
                     window.currentSeasonalEnergyModal = null;
                 }, 300);
             }
         }

         function getSeasonalName(element) {
             const names = {
                 'Drewno': 'Wiosenna Energia',
                 'Ogie≈Ñ': 'Letnia Energia',
                 'Ziemia': 'Energia Ziemi',
                 'Metal': 'Jesienna Energia',
                 'Woda': 'Zimowa Energia'
             };
             return names[element] || 'Letnia Energia';
         }

         function getSeasonalEmoji(element) {
             const emojis = {
                 'Drewno': 'üå±',
                 'Ogie≈Ñ': 'üî•',
                 'Ziemia': 'üåæ',
                 'Metal': 'üçÇ',
                 'Woda': '‚ùÑÔ∏è'
             };
             return emojis[element] || 'üî•';
         }

         function getSeasonalEnergyData(element) {
             const allData = {
                 'Drewno': [
                     {
                         name: 'Medytacje Wzrostu',
                         focus: 'Odnowa i nowe poczƒÖtki',
                         emoji: 'üßò‚Äç‚ôÄÔ∏è',
                         color: '#4CAF50',
                         practices: [
                             {
                                 name: 'Medytacja Kie≈Çkowania',
                                 emoji: 'üå±',
                                 description: 'Wizualizacja wzrostu nowej energii ≈ºyciowej, idealna na wiosnƒô.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ wygodnie twarzƒÖ na wsch√≥d (o wschodzie s≈Ço≈Ñca)',
                                     'Zamknij oczy i wyobra≈∫ sobie nasiono w swojej wƒÖtrobie',
                                     'Z ka≈ºdym wdechem nasiono nape≈Çnia siƒô zielonƒÖ energiƒÖ',
                                     'Na wydechu wyobra≈∫ sobie kie≈Çek przebijajƒÖcy siƒô przez ziemiƒô',
                                     'Poczuj jak energia wzrostu przep≈Çywa przez ca≈Çe cia≈Ço',
                                     'Wizualizuj siebie jako m≈Çode drzewko pe≈Çne ≈ºycia',
                                     'Zako≈Ñcz g≈Çƒôbokim oddechem i otw√≥rz oczy'
                                 ],
                                 benefits: 'Od≈õwie≈ºa energiƒô wƒÖtroby, wspiera detoksykacjƒô, pobudza kreatywno≈õƒá',
                                 element: 'Drewno',
                                 energyType: 'Yang rosnƒÖce',
                                 meridian: 'WƒÖtroba (LV), Pƒôcherzyk ≈º√≥≈Çciowy (GB)',
                                 bestTime: 'Wsch√≥d s≈Ço≈Ñca (5:00-7:00)',
                                 contraindications: 'Nadci≈õnienie, mania, silne emocje'
                             },
                             {
                                 name: 'Oddychanie Detoksykacyjne',
                                 emoji: 'üåø',
                                 description: 'Specjalna technika oddechowa oczyszczajƒÖca wƒÖtrobƒô z toksyn.',
                                 duration: '8-12 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ prosto, rƒôce na kolanach',
                                     'Wdechnij przez nos przez 4 sekundy',
                                     'Zatrzymaj oddech na 2 sekundy',
                                     'Wydechnij przez usta przez 6 sekund z d≈∫wiƒôkiem "Shu"',
                                     'Podczas wydechu wyobra≈∫ sobie zielony dym opuszczajƒÖcy wƒÖtrobƒô',
                                     'Powt√≥rz 12 razy (jeden pe≈Çny cykl)',
                                     'Zako≈Ñcz 3 naturalnymi oddechami'
                                 ],
                                 benefits: 'Oczyszcza wƒÖtrobƒô, redukuje gniew, poprawia elastyczno≈õƒá',
                                 element: 'Drewno',
                                 energyType: 'Yin oczyszczajƒÖce',
                                 meridian: 'WƒÖtroba (LV)',
                                 bestTime: 'Wczesny ranek, przed jedzeniem',
                                 contraindications: 'Zapalenie wƒÖtroby, ciƒÖ≈ºa, os≈Çabienie'
                                                           }
                          ]
                      },
                      {
                          name: 'ƒÜwiczenia Energetyczne',
                          focus: 'Aktywacja Qi wƒÖtroby',
                          emoji: 'üåø',
                          color: '#4CAF50',
                          practices: [
                              {
                                  name: 'Stretching Smoka',
                                  emoji: 'üêâ',
                                  description: 'Dynamiczne ruchy przywracajƒÖce elastyczno≈õƒá meridian√≥w.',
                                  duration: '10-15 minut',
                                  steps: [
                                      'Sta≈Ñ w pozycji szerokiej, rƒôce wzd≈Çu≈º cia≈Ça',
                                      'WyciƒÖgnij rƒôce w bok na wysoko≈õƒá ramion',
                                      'Skrƒôƒá tu≈Ç√≥w w lewo, wydychajƒÖc "Shu"',
                                      'Wr√≥ƒá do centrum, wdychajƒÖc g≈Çƒôboko',
                                      'Skrƒôƒá tu≈Ç√≥w w prawo, wydychajƒÖc "Shu"',
                                      'Powt√≥rz 8 razy w ka≈ºdƒÖ stronƒô',
                                      'Zako≈Ñcz trzema g≈Çƒôbokimi oddechami'
                                  ],
                                  benefits: 'Uwalnia napiƒôcie w wƒÖtrobie, poprawia krƒÖ≈ºenie Qi',
                                  element: 'Drewno',
                                  energyType: 'Yang mobilizujƒÖce',
                                  meridian: 'Pƒôcherzyk ≈º√≥≈Çciowy (GB)',
                                  bestTime: 'Rano po przebudzeniu',
                                  contraindications: 'Zawroty g≈Çowy, problemy z krƒôgos≈Çupem'
                              }
                          ]
                      }
                  ],
                  'Ogie≈Ñ': [
                     {
                         name: 'Medytacje Rado≈õci',
                         focus: 'Harmonia serca i umys≈Çu',
                         emoji: '‚ù§Ô∏è',
                         color: '#F44336',
                         practices: [
                             {
                                 name: 'Medytacja Serca Lotosu',
                                 emoji: 'ü™∑',
                                 description: 'UspokajajƒÖca praktyka ch≈ÇodzƒÖca nadmiernƒÖ energiƒô Yang.',
                                 duration: '15-20 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ w ch≈Çodnym, zacienionym miejscu',
                                     'Rƒôce z≈Ç√≥≈º w mudra lotosu na sercu',
                                     'Oddychaj powoli i g≈Çƒôboko',
                                     'Wyobra≈∫ sobie b≈Çƒôkitny lotos w swoim sercu',
                                     'Z ka≈ºdym oddechem lotos siƒô otwiera',
                                     'Poczuj ch≈ÇodzƒÖcƒÖ energiƒô rozlewajƒÖcƒÖ siƒô po ciele',
                                     'Pozosta≈Ñ w tym stanie spokoju przez 10 minut',
                                     'Powoli otw√≥rz oczy z u≈õmiechem'
                                 ],
                                 benefits: 'Ch≈Çodzi nadmiernƒÖ energiƒô, uspokaja emocje, przynosi rado≈õƒá',
                                 element: 'Ogie≈Ñ',
                                 energyType: 'Yin ch≈ÇodzƒÖce',
                                 meridian: 'Serce (HT), Jelito cienkie (SI)',
                                 bestTime: 'Po≈Çudnie (11:00-13:00) w cieniu',
                                 contraindications: 'Depresja, zimno w ciele, os≈Çabienie Yang'
                             },
                             {
                                 name: 'Oddychanie Ch≈ÇodzƒÖce',
                                 emoji: 'üåä',
                                 description: 'Technika Sheetali - ch≈ÇodzƒÖce oddychanie z jogi.',
                                 duration: '5-10 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ twarzƒÖ na p√≥≈Çnoc',
                                     'WyciƒÖgnij jƒôzyk jak rurkƒô',
                                     'Wdychaj powietrze przez zwiniƒôty jƒôzyk',
                                     'Poczuj ch≈ÇodzƒÖce wra≈ºenie w ustach',
                                     'Zamknij usta i wydechnij przez nos',
                                     'Wyobra≈∫ sobie ch≈ÇodzƒÖcƒÖ energiƒô w sercu',
                                     'Powt√≥rz 20-30 razy',
                                     'Zako≈Ñcz naturalnym oddychaniem'
                                 ],
                                 benefits: 'Och≈Çadza organizm, uspokaja Shen, redukuje stres cieplny oraz wzmacnia energiƒô Yin w sercu',
                                 element: 'Ogie≈Ñ',
                                 energyType: 'Yin nawil≈ºajƒÖce',
                                 meridian: 'Serce (HT), P≈Çuca (LU)',
                                 bestTime: 'GorƒÖce dni, po po≈Çudniu',
                                 contraindications: 'Przeziƒôbienie, s≈Çaba energia, zima'
                             }
                          ]
                      },
                      {
                          name: 'ƒÜwiczenia Ch≈ÇodzƒÖce',
                          focus: 'Och≈Çadzanie organizmu',
                          emoji: '‚ùÑÔ∏è',
                          color: '#2196F3',
                          practices: [
                              {
                                  name: 'Ruch ≈Åabƒôdzia w Wodzie',
                                  emoji: 'ü¶¢',
                                  description: 'P≈Çynne ruchy ≈ÇagodzƒÖce nadmiernƒÖ energiƒô Yang.',
                                  duration: '12-20 minut',
                                  steps: [
                                      'Sta≈Ñ ty≈Çem do s≈Ço≈Ñca w cieniu',
                                      'Rƒôce unie≈õ powoli nad g≈Çowƒô jak skrzyd≈Ça',
                                      'Pochyl siƒô do przodu z prostymi plecami',
                                      'Rƒôce opu≈õƒá w d√≥≈Ç jak ≈Çabƒôd≈∫ nurkujƒÖcy',
                                      'Powoli prostuj siƒô, unoszƒÖc rƒôce',
                                      'Oddychaj g≈Çƒôboko i spokojnie',
                                      'Powt√≥rz 10-15 razy bardzo powoli'
                                  ],
                                  benefits: 'Uspokaja Shen, och≈Çadza krew, r√≥wnowa≈ºy emocje',
                                  element: 'Ogie≈Ñ',
                                  energyType: 'Yin harmonizujƒÖce',
                                  meridian: 'Osierdzi–∫ (PC), Trzeci Ogrzewacz (TH)',
                                  bestTime: 'Wczesny wiecz√≥r w cieniu',
                                  contraindications: 'Zimno w ciele, depresja, s≈Çabo≈õƒá'
                              }
                          ]
                      },
                      {
                          name: 'Wizualizacje Serca',
                          focus: 'Harmonia emocjonalna',
                          emoji: 'üíñ',
                          color: '#E91E63',
                          practices: [
                              {
                                  name: 'Fontanna Szczƒô≈õcia',
                                  emoji: '‚õ≤',
                                  description: 'Wizualizacja ch≈Çodnej fontanny w sercu.',
                                  duration: '8-15 minut',
                                  steps: [
                                      'UsiƒÖd≈∫ wygodnie twarzƒÖ na p√≥≈Çnoc',
                                      'Rƒôce po≈Ç√≥≈º na sercu',
                                      'Wyobra≈∫ sobie ch≈ÇodnƒÖ fontannƒô w centrum piersi',
                                      'Fontanna rozpryskuje krystalicznie czystƒÖ wodƒô',
                                      'Woda ch≈Çodzi i uspokaja ca≈Çe serce',
                                      'Poczuj rado≈õƒá i spok√≥j p≈ÇynƒÖcy z fontanny',
                                      'Pozw√≥l wodzie obmyƒá wszystkie gorƒÖce emocje',
                                      'Pozosta≈Ñ w tym ch≈Çodnym, radosnym stanie'
                                  ],
                                  benefits: 'Och≈Çadza serce, przynosi rado≈õƒá, uspokaja umys≈Ç',
                                  element: 'Ogie≈Ñ',
                                  energyType: 'Yin nawil≈ºajƒÖce',
                                  meridian: 'Serce (HT)',
                                  bestTime: 'Po≈Çudnie, podczas najwiƒôkszego upa≈Çu',
                                  contraindications: 'S≈Çabe serce, zimno w piersiach, smutek'
                              }
                          ]
                      }
                  ],
                  'Ziemia': [
                     {
                         name: 'Medytacje StabilizujƒÖce',
                         focus: 'R√≥wnowaga i wewnƒôtrzny spok√≥j',
                         emoji: '‚öñÔ∏è',
                         color: '#FFC107',
                         practices: [
                             {
                                 name: 'Medytacja Korzeni',
                                 emoji: 'üå≥',
                                 description: 'Uziemienie energii i stabilizacja emocji.',
                                 duration: '12-18 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ na ziemi lub pod≈Çodze',
                                     'Wyobra≈∫ sobie korzenie wyrastajƒÖce z podstawy krƒôgos≈Çupa',
                                     'Korzenie siƒôgajƒÖ g≈Çƒôboko do centrum Ziemi',
                                     'Poczuj stabilno≈õƒá i uziemienie',
                                     'Oddychaj do brzucha, wzmacniajƒÖc ≈õledzionƒô',
                                     'Z ka≈ºdym oddechem stajesz siƒô bardziej stabilny',
                                     'Wizualizuj z≈ÇotƒÖ energiƒô w obszarze ≈ºo≈ÇƒÖdka',
                                     'Pozosta≈Ñ w tym uziemionym stanie'
                                 ],
                                 benefits: 'Stabilizuje emocje, wzmacnia trawienie, daje poczucie bezpiecze≈Ñstwa',
                                 element: 'Ziemia',
                                 energyType: 'Qi centrujƒÖce',
                                 meridian: '≈öledziona (SP), ≈ªo≈ÇƒÖdek (ST)',
                                 bestTime: 'P√≥≈∫ne popo≈Çudnie (15:00-17:00)',
                                 contraindications: 'Silne lƒôki, claustrofobia, mania'
                             }
                          ]
                      },
                      {
                          name: 'ƒÜwiczenia R√≥wnowagi',
                          focus: 'Stabilizacja centrum',
                          emoji: '‚öñÔ∏è',
                          color: '#FFC107',
                          practices: [
                              {
                                  name: 'Postawa G√≥ry',
                                  emoji: '‚õ∞Ô∏è',
                                  description: 'Statyczne pozycje wzmacniajƒÖce centrum cia≈Ça.',
                                  duration: '5-12 minut',
                                  steps: [
                                      'Sta≈Ñ w pozycji hip-width apart',
                                      'Wyobra≈∫ sobie korzenie wyrastajƒÖce ze st√≥p',
                                      'Korona g≈Çowy ciƒÖgnie w g√≥rƒô do nieba',
                                      'Oddychaj do brzucha, powiƒôkszajƒÖc go na wdechu',
                                      'Poczuj stabilno≈õƒá miƒôdzy niebem a ziemiƒÖ',
                                      'Pozosta≈Ñ nieruchomo jak g√≥ra',
                                      'Skoncentruj siƒô na centrum cia≈Ça',
                                      'Zako≈Ñcz trzema g≈Çƒôbokimi oddechami'
                                  ],
                                  benefits: 'Wzmacnia ≈õledzionƒô, poprawia r√≥wnowagƒô, stabilizuje emocje',
                                  element: 'Ziemia',
                                  energyType: 'Qi centrowujƒÖce',
                                  meridian: '≈öledziona (SP), ≈ªo≈ÇƒÖdek (ST)',
                                  bestTime: 'Przej≈õcia miƒôdzy sezonami',
                                  contraindications: 'Problemy z r√≥wnowagƒÖ, zawroty g≈Çowy'
                              }
                          ]
                      }
                  ],
                  'Metal': [
                     {
                         name: 'Medytacje OczyszczajƒÖce',
                         focus: 'Oddech i wewnƒôtrzna si≈Ça',
                         emoji: 'ü´Å',
                         color: '#9E9E9E',
                         practices: [
                             {
                                 name: 'Medytacja Bia≈Çego Tygrysa',
                                 emoji: 'üêÖ',
                                 description: 'Wzmacnia p≈Çuca i wewnƒôtrznƒÖ si≈Çƒô obronnƒÖ Wei Qi.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'UsiƒÖd≈∫ twarzƒÖ na zach√≥d',
                                     'Rƒôce u≈Ç√≥≈º na piersiach',
                                     'Oddychaj g≈Çƒôboko do p≈Çuc',
                                     'Wyobra≈∫ sobie bia≈Çego tygrysa w p≈Çucach',
                                     'Tygrys jest stra≈ºnikiem Twojej energii',
                                     'Z ka≈ºdym wdechem tygrys staje siƒô silniejszy',
                                     'Poczuj si≈Çƒô i ochronƒô w klatce piersiowej',
                                     'Na wydechu wypu≈õƒá wszystko co zbƒôdne'
                                 ],
                                 benefits: 'Wzmacnia odporno≈õƒá, oczyszcza p≈Çuca, buduje Wei Qi',
                                 element: 'Metal',
                                 energyType: 'Yang obronne',
                                 meridian: 'P≈Çuca (LU), Jelito grube (LI)',
                                 bestTime: 'Zach√≥d s≈Ço≈Ñca (17:00-19:00)',
                                 contraindications: 'Astma ostra, silne emocje, nadci≈õnienie'
                             }
                          ]
                      },
                      {
                          name: 'ƒÜwiczenia Oddechowe',
                          focus: 'Wzmocnienie p≈Çuc',
                          emoji: 'üå¨Ô∏è',
                          color: '#9E9E9E',
                          practices: [
                              {
                                  name: 'Oddychanie Jesiennego Wiatru',
                                  emoji: 'üçÉ',
                                  description: 'OczyszczajƒÖca technika oddechowa na jesie≈Ñ.',
                                  duration: '8-15 minut',
                                  steps: [
                                      'UsiƒÖd≈∫ twarzƒÖ na zach√≥d',
                                      'Rƒôce u≈Ç√≥≈º na dolnych ≈ºebrach',
                                      'Wdechnij g≈Çƒôboko, rozszerzajƒÖc ≈ºebra',
                                      'Wydechnij powoli z d≈∫wiƒôkiem "Si"',
                                      'Wyobra≈∫ sobie bia≈Çy dym opuszczajƒÖcy p≈Çuca',
                                      'Poczuj jak p≈Çuca siƒô oczyszczajƒÖ',
                                      'Powt√≥rz 18 razy (liczba Metal)',
                                      'Zako≈Ñcz naturalnym oddychaniem'
                                  ],
                                  benefits: 'Oczyszcza p≈Çuca, wzmacnia Wei Qi, poprawia odporno≈õƒá',
                                  element: 'Metal',
                                  energyType: 'Yang oczyszczajƒÖce',
                                  meridian: 'P≈Çuca (LU), Jelito grube (LI)',
                                  bestTime: 'Jesienne poranki',
                                  contraindications: 'Astma ciƒô≈ºka, silny kaszel, gorƒÖczka'
                              }
                          ]
                      }
                  ],
                  'Woda': [
                     {
                         name: 'Medytacje RegenerujƒÖce',
                         focus: 'Odnowa i g≈Çƒôboki odpoczynek',
                         emoji: 'üåô',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Medytacja Ciemnej Wody',
                                 emoji: 'üåä',
                                 description: 'G≈Çƒôboka regeneracja energii Yin i esencji Jing.',
                                 duration: '20-30 minut',
                                 steps: [
                                     'U≈Ç√≥≈º siƒô wygodnie w ciemnym pomieszczeniu',
                                     'Rƒôce po≈Ç√≥≈º na dolnej czƒô≈õci brzucha',
                                     'Oddychaj bardzo powoli i g≈Çƒôboko',
                                     'Wyobra≈∫ sobie czarnƒÖ wodƒô w nerkach',
                                     'Woda jest spokojna i g≈Çƒôboka jak ocean',
                                     'Poczuj jak energia gromadzi siƒô w nerkach',
                                     'Pozw√≥l cia≈Çu ca≈Çkowicie siƒô zrelaksowaƒá',
                                     'Pozosta≈Ñ w tym stanie g≈Çƒôbokiego spokoju'
                                 ],
                                 benefits: 'Odnawia esencjƒô Jing, wzmacnia nerki, regeneruje Yin',
                                 element: 'Woda',
                                 energyType: 'Yin esencjonalne',
                                 meridian: 'Nerki (KI), Pƒôcherz moczowy (BL)',
                                 bestTime: 'Wiecz√≥r (19:00-21:00)',
                                 contraindications: 'Depresja, nadmierna senno≈õƒá, brak motywacji'
                                                           }
                          ]
                      },
                      {
                          name: 'ƒÜwiczenia RegenerujƒÖce',
                          focus: 'Odnowa esencji ≈ºyciowej',
                          emoji: 'üîã',
                          color: '#2196F3',
                          practices: [
                              {
                                  name: 'Masa≈º Nerek',
                                  emoji: 'üëê',
                                  description: 'Gentle self-massage do wzmocnienia Jing.',
                                  duration: '10-20 minut',
                                  steps: [
                                      'UsiƒÖd≈∫ wygodnie, plecy proste',
                                      'Rozgrzej d≈Çonie pocierajƒÖc je o siebie',
                                      'Po≈Ç√≥≈º d≈Çonie na dolnƒÖ czƒô≈õƒá plec√≥w (nerki)',
                                      'Masuj okrƒô≈ºnymi ruchami 36 razy',
                                      'Poczuj ciep≈Ço przenikajƒÖce do nerek',
                                      'Oddychaj g≈Çƒôboko do brzucha',
                                      'Wizualizuj czarnƒÖ wodƒô nape≈ÇniajƒÖcƒÖ nerki',
                                      'Zako≈Ñcz, pozostawiajƒÖc d≈Çonie na nerkach'
                                  ],
                                  benefits: 'Wzmacnia esencjƒô Jing, regeneruje nerki, poprawia witalno≈õƒá',
                                  element: 'Woda',
                                  energyType: 'Yang aktywizujƒÖce',
                                  meridian: 'Nerki (KI)',
                                  bestTime: 'Wiecz√≥r przed snem',
                                  contraindications: 'Zapalenie nerek, gorƒÖczka, hiperttensja'
                              }
                          ]
                      },
                      {
                          name: 'Medytacje Nocne',
                          focus: 'G≈Çƒôboka regeneracja',
                          emoji: 'üåú',
                          color: '#1A237E',
                          practices: [
                              {
                                  name: 'Sen Nefrytu',
                                  emoji: 'üíé',
                                  description: 'Przygotowanie do regenerujƒÖcego snu.',
                                  duration: '15-30 minut',
                                  steps: [
                                      'Po≈Ç√≥≈º siƒô w ciemnym, cichym pokoju',
                                      'Rƒôce na dolnej czƒô≈õci brzucha (Dan Tian)',
                                      'Oddychaj bardzo powoli i cicho',
                                      'Wyobra≈∫ sobie czarny nefryty w nerkach',
                                      'Nefryty gromadzi energiƒô ≈ºyciowƒÖ',
                                      'Pozw√≥l cia≈Çu ca≈Çkowicie siƒô rozlu≈∫niƒá',
                                      'Poczuj jak energia zgromadzona w nerkach',
                                      'P≈Çynnie przejd≈∫ w sen lub g≈ÇƒôbokƒÖ relaksacjƒô'
                                  ],
                                  benefits: 'Restauruje Jing, przygotowuje do g≈Çƒôbokiego snu, odnawia ≈ºycie',
                                  element: 'Woda',
                                  energyType: 'Yin esencjonalne',
                                  meridian: 'Nerki (KI), Pƒôcherz (BL)',
                                  bestTime: 'Tu≈º przed snem (21:00-23:00)',
                                  contraindications: 'Bezsenno≈õƒá, lƒôki, nadmiernia stymulacja'
                              }
                          ]
                      }
                  ]
              };
              
              return allData[element] || allData['Ogie≈Ñ'];
          }

         function getFaceYogaData() {
             return [
                 {
                     name: 'ƒÜwiczenia na Oczy',
                     focus: 'Redukcja zmarszczek i work√≥w',
                     emoji: 'üëÅÔ∏è',
                     color: '#2196F3',
                     exercises: [
                         {
                             name: 'Mruganie Motylem',
                             emoji: 'ü¶ã',
                             description: 'Delikatne ƒáwiczenie poprawiajƒÖce krƒÖ≈ºenie wok√≥≈Ç oczu i redukujƒÖce napiƒôcie.',
                             duration: '2-3 minuty',
                             steps: [
                                 'UsiƒÖd≈∫ wygodnie z prostymi plecami',
                                 'Zamknij oczy delikatnie, bez napinania',
                                 'Powoli otw√≥rz oczy jak motyl rozpo≈õcierajƒÖcy skrzyd≈Ça',
                                 'Mrugaj bardzo powoli 10 razy',
                                 'Nastƒôpnie mrugaj szybko przez 10 sekund',
                                 'Zako≈Ñcz 3 g≈Çƒôbokimi, powolnymi mrugniƒôciami'
                             ],
                             benefits: 'Poprawia krƒÖ≈ºenie, redukuje zmarszczki wok√≥≈Ç oczu, ≈Çagodzi zmƒôczenie wzroku',
                             meridian: 'Pƒôcherzyk ≈º√≥≈Çciowy (GB), WƒÖtroba (LV)',
                             element: 'Drewno',
                             energy: 'Tonizuje Yin, wzmacnia Esencjƒô Nerek',
                             contraindications: '≈öwie≈ºe operacje oczu, zapalenie spoj√≥wek'
                         },
                         {
                             name: 'Masa≈º Punkt√≥w Energetycznych',
                             emoji: '‚òØÔ∏è',
                             description: 'Akupresura punkt√≥w wok√≥≈Ç oczu wed≈Çug tradycji TCM.',
                             duration: '3-5 minut',
                             steps: [
                                 'Znajd≈∫ punkt Yuyao (≈õrodek brwi)',
                                 'Delikatnie masuj okrƒô≈ºnymi ruchami przez 30 sekund',
                                 'Przejd≈∫ do punktu Sizhukong (koniec brwi)',
                                 'Masuj punkt Tongziliao (zewnƒôtrzny kƒÖcik oka)',
                                 'Zako≈Ñcz masa≈ºem punktu Jingming (wewnƒôtrzny kƒÖcik)',
                                 'Powt√≥rz ca≈ÇƒÖ sekwencjƒô 3 razy'
                             ],
                             benefits: 'Aktywuje meridian ≈º√≥≈Çciaoka, poprawia jasno≈õƒá wzroku, redukuje obrzƒôki',
                             meridian: 'Pƒôcherzyk ≈º√≥≈Çciowy (GB), Ma≈Çy Jelito (SI)',
                             element: 'Drewno/Ogie≈Ñ',
                             energy: 'Reguluje przep≈Çyw Qi, rozpraszra stagnacjƒô',
                             contraindications: 'Bardzo wra≈ºliwa sk√≥ra, niedawne zabiegi kosmetyczne'
                         }
                     ]
                 },
                 {
                     name: 'ƒÜwiczenia na Czo≈Ço',
                     focus: 'Wyg≈Çadzenie zmarszczek poziomych',
                     emoji: 'ü§î',
                     color: '#FFC107',
                     exercises: [
                         {
                             name: 'Lifting Czo≈Ça',
                             emoji: '‚¨ÜÔ∏è',
                             description: 'Naturalne wyg≈Çadzanie zmarszczek poziomych na czole.',
                             duration: '2-4 minuty',
                             steps: [
                                 'Po≈Ç√≥≈º palce wskazujƒÖce nad brwiami',
                                 'Delikatnie naci≈õnij sk√≥rƒô w d√≥≈Ç',
                                 'Jednocze≈õnie pr√≥buj podnie≈õƒá brwi do g√≥ry',
                                 'Utrzymaj napiƒôcie przez 5 sekund',
                                 'Zrelaksuj miƒô≈õnie przez 3 sekundy',
                                 'Powt√≥rz 10-15 razy'
                             ],
                             benefits: 'Wzmacnia miƒô≈õnie czo≈Ça, redukuje zmarszczki poziome, poprawia krƒÖ≈ºenie',
                             meridian: 'Pƒôcherzyk moczowy (BL), ≈ªo≈ÇƒÖdek (ST)',
                             element: 'Ziemia/Woda',
                             energy: 'Podnosi Yang Qi, wzmacnia ≈öledzionƒô',
                             contraindications: 'Botoks w obszarze czo≈Ça (ostatnie 6 miesiƒôcy)'
                         },
                         {
                             name: 'Masa≈º Czakry Trzeciego Oka',
                             emoji: 'üßò',
                             description: 'Stymulacja punktu Yintang dla relaksu i koncentracji.',
                             duration: '3-5 minut',
                             steps: [
                                 'Znajd≈∫ punkt miƒôdzy brwiami (Yintang)',
                                 'Po≈Ç√≥≈º kciuk na tym punkcie',
                                 'R√≥b delikatne okrƒô≈ºne ruchy przez 1 minutƒô',
                                 'Nastƒôpnie naci≈õnij i pu≈õƒá 10 razy',
                                 'Przesuwaj kciuk w g√≥rƒô do punktu Shenting',
                                 'Zako≈Ñcz delikatnym masa≈ºem ca≈Çego czo≈Ça'
                             ],
                             benefits: 'Uspokaja umys≈Ç, redukuje stres, wyg≈Çadza czo≈Ço, poprawia koncentracjƒô',
                             meridian: 'Vessel Governing (GV), Dodatkowy Yangming',
                             element: 'Ziemia',
                             energy: 'Uspokaja Shen, harmonizuje Qi',
                             contraindications: 'Nadci≈õnienie, migrena w fazie aktywnej'
                         }
                     ]
                 },
                 {
                     name: 'ƒÜwiczenia na Policzki',
                     focus: 'Ujƒôdrnienie i lifting naturalny',
                     emoji: 'üòä',
                     color: '#E91E63',
                     exercises: [
                         {
                             name: 'Balon w Policzkach',
                             emoji: 'üéà',
                             description: 'Wzmacnianie miƒô≈õni policzk√≥w i poprawianie owalu twarzy.',
                             duration: '3-5 minut',
                             steps: [
                                 'Nape≈Çnij powietrzem jeden policzek jak balon',
                                 'Utrzymaj przez 10 sekund',
                                 'Przerzuƒá powietrze do drugiego policzka',
                                 'Utrzymaj kolejne 10 sekund',
                                 'Przerzuƒá powietrze pod g√≥rnƒÖ wargƒô',
                                 'Na koniec pod dolnƒÖ wargƒô',
                                 'Powt√≥rz ca≈ÇƒÖ sekwencjƒô 5 razy'
                             ],
                             benefits: 'Ujƒôdrnia policzki, poprawia owal twarzy, wzmacnia miƒô≈õnie mimiczne',
                             meridian: '≈ªo≈ÇƒÖdek (ST), Jelito Grube (LI)',
                             element: 'Ziemia/Metal',
                             energy: 'Tonizuje Qi ≈öledziony, wzmacnia Yang',
                             contraindications: 'Problemy z szczƒôkƒÖ (TMJ), niedawne zabiegi dentystyczne'
                         },
                         {
                             name: 'U≈õmiech Buddy',
                             emoji: 'üòå',
                             description: 'Medytacyjne ƒáwiczenie ≈ÇƒÖczƒÖce relaks z wzmocnieniem miƒô≈õni.',
                             duration: '5-7 minut',
                             steps: [
                                 'UsiƒÖd≈∫ w pozycji medytacyjnej',
                                 'Zamknij oczy i oddychaj g≈Çƒôboko',
                                 'Narysuj lekki u≈õmiech na twarzy',
                                 'Poczuj jak energia p≈Çynie przez policzki',
                                 'Stopniowo poszerz u≈õmiech',
                                 'Utrzymaj przez 30 sekund',
                                 'Powoli powr√≥ƒá do pozycji neutralnej'
                             ],
                             benefits: 'Poprawia nastr√≥j, redukuje stres, naturalnie podnosi kƒÖciki ust',
                             meridian: 'Serce (HT), Jelito Cienkie (SI)',
                             element: 'Ogie≈Ñ',
                             energy: 'Raduje Shen, harmonizuje emocje',
                             contraindications: 'Depresja g≈Çƒôboka (wymaga ostro≈ºno≈õci)'
                         }
                     ]
                 },
                 {
                     name: 'ƒÜwiczenia na Szyjƒô',
                     focus: 'Redukcja podw√≥jnego podbr√≥dka',
                     emoji: 'ü¶¢',
                     color: '#9C27B0',
                     exercises: [
                         {
                             name: '≈Åabƒôd≈∫',
                             emoji: 'ü¶¢',
                             description: 'Eleganckie wyd≈Çu≈ºanie i wzmacnianie miƒô≈õni szyi.',
                             duration: '4-6 minut',
                             steps: [
                                 'UsiƒÖd≈∫ prosto z wyprostowanƒÖ szyjƒÖ',
                                 'Powoli wyciƒÖgnij szyjƒô do przodu jak ≈Çabƒôd≈∫',
                                 'Jednocze≈õnie unie≈õ podbr√≥dek',
                                 'Poczuj rozciƒÖgniƒôcie pod podbr√≥dkiem',
                                 'Utrzymaj pozycjƒô przez 5 sekund',
                                 'Powoli wr√≥ƒá do pozycji poczƒÖtkowej',
                                 'Powt√≥rz 12-15 razy'
                             ],
                             benefits: 'Redukuje podw√≥jny podbr√≥dek, wzmacnia miƒô≈õnie szyi, poprawia postawƒô',
                             meridian: 'Pƒôcherzyk ≈º√≥≈Çciowy (GB), Vessel Governing (GV)',
                             element: 'Drewno',
                             energy: 'Podnosi Yang, wzmacnia Wei Qi',
                             contraindications: 'Problemy z krƒôgos≈Çupem szyjnym, niedawne urazy'
                         },
                         {
                             name: 'Poca≈Çunek Nieba',
                             emoji: 'üòò',
                             description: 'ƒÜwiczenie wzmacniajƒÖce dolnƒÖ czƒô≈õƒá twarzy.',
                             duration: '3-4 minuty',
                             steps: [
                                 'UsiƒÖd≈∫ lub sta≈Ñ prosto',
                                 'Unie≈õ g≈Çowƒô delikatnie do g√≥ry',
                                 'WyciƒÖgnij usta jak do poca≈Çunku',
                                 'WyciƒÖgnij usta tak daleko jak mo≈ºesz',
                                 'Utrzymaj przez 5 sekund',
                                 'Zrelaksuj i powt√≥rz 10 razy',
                                 'Zako≈Ñcz delikatnym masa≈ºem szyi'
                             ],
                             benefits: 'Ujƒôdrnia szyjƒô, redukuje zwiotczenie sk√≥ry, poprawia elastyczno≈õƒá',
                             meridian: 'Vessel Conception (CV), Nerki (KI)',
                             element: 'Woda',
                             energy: 'Tonizuje Yin Nerek, wzmacnia Esencjƒô',
                             contraindications: 'Zawroty g≈Çowy, problemy z ci≈õnieniem'
                         }
                     ]
                 },
                 {
                     name: 'ƒÜwiczenia na Usta',
                     focus: 'Pe≈Çniejsze i m≈Çodsze usta',
                     emoji: 'üíã',
                     color: '#F44336',
                     exercises: [
                         {
                             name: 'Rybka',
                             emoji: 'üê†',
                             description: 'Naturalne powiƒôkszanie i ujƒôdrnianie ust.',
                             duration: '2-3 minuty',
                             steps: [
                                 'Zassij policzki do ≈õrodka jak ryba',
                                 'Jednocze≈õnie wyciƒÖgnij usta do przodu',
                                 'Utrzymaj pozycjƒô przez 5 sekund',
                                 'Nastƒôpnie otw√≥rz usta szeroko w "O"',
                                 'Utrzymaj przez 5 sekund',
                                 'Powr√≥ƒá do pozycji ryby',
                                 'Powt√≥rz ca≈ÇƒÖ sekwencjƒô 8-10 razy'
                             ],
                             benefits: 'Powiƒôksza usta, redukuje zmarszczki wok√≥≈Ç ust, wzmacnia miƒô≈õnie',
                             meridian: '≈ªo≈ÇƒÖdek (ST), ≈öledziona (SP)',
                             element: 'Ziemia',
                             energy: 'Wzmacnia Qi ≈öledziony, harmonizuje trawienie',
                             contraindications: 'Niedawne wype≈Çnienia ust, herpes w fazie aktywnej'
                         },
                         {
                             name: 'Mantra OM',
                             emoji: 'üïâÔ∏è',
                             description: 'Wibracyjne ƒáwiczenie ≈ÇƒÖczƒÖce d≈∫wiƒôk z ruchem.',
                             duration: '5-7 minut',
                             steps: [
                                 'UsiƒÖd≈∫ w pozycji medytacyjnej',
                                 'G≈Çƒôboko wdechnij przez nos',
                                 'Na wydechu ≈õpiewaj "OMMMMM"',
                                 'Poczuj wibracje w ustach i twarzy',
                                 'Powt√≥rz 21 razy',
                                 'Po ka≈ºdych 7 razach r√≥b kr√≥tkƒÖ przerwƒô',
                                 'Zako≈Ñcz ciszƒÖ i obserwacjƒÖ wra≈ºe≈Ñ'
                             ],
                             benefits: 'Relaksuje ca≈ÇƒÖ twarz, poprawia rezonans g≈Çosu, uspokaja umys≈Ç',
                             meridian: 'Vessel Governing (GV), Serce (HT)',
                             element: 'Ogie≈Ñ',
                             energy: 'Uspokaja Shen, harmonizuje wszystkie energie',
                             contraindications: 'Problemy z g≈Çosem, zapalenie krtani'
                         }
                     ]
                 }
             ];
         }

         function getHerbsAndEmotionsData() {
             return [
                 {
                     name: 'Z≈Ço≈õƒá i Frustracja',
                     emotion: 'Gniew',
                     element: 'Drewno',
                     emoji: 'üò§',
                     color: '#4CAF50',
                     herbs: [
                         {
                             name: 'Rumianek (Gan Ju)',
                             emoji: 'üåº',
                             description: '≈Åagodzi napiƒôcie nerwowe i uspokaja umys≈Ç. Idealny na wiecz√≥r po stresujƒÖcym dniu.',
                             action: 'Oczyszcza Ciep≈Ço WƒÖtroby, uspokaja Shen',
                             temperature: 'Ch≈Çodna',
                             taste: 'S≈Çodki, gorzki',
                             meridian: 'WƒÖtroba, Pƒôcherzyk ≈º√≥≈Çciowy',
                             dosage: '3-6g dziennie, herbata'
                         },
                         {
                             name: 'Melisa (Xiang Feng Cao)',
                             emoji: 'üåø',
                             description: 'Uspokaja nadpobudliwy system nerwowy i pomaga w kontroli emocji.',
                             action: 'Reguluje Qi WƒÖtroby, harmonizuje emocje',
                             temperature: 'Ch≈Çodna',
                             taste: 'S≈Çodki, lekko gorzki',
                             meridian: 'WƒÖtroba, Serce',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Mniszek Lekarski (Pu Gong Ying)',
                             emoji: 'üåª',
                             description: 'Oczyszcza wƒÖtrobƒô z toksyn emocjonalnych i fizycznych.',
                             action: 'Detoksykuje WƒÖtrobƒô, redukuje Ciep≈Ço',
                             temperature: 'Zimna',
                             taste: 'Gorzki, s≈Çodki',
                             meridian: 'WƒÖtroba, ≈ªo≈ÇƒÖdek',
                             dosage: '10-30g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Smutek i Depresja',
                     emotion: 'Melancholia',
                     element: 'Metal',
                     emoji: 'üò¢',
                     color: '#9E9E9E',
                     herbs: [
                         {
                             name: 'Dziurawiec (Guan Ye Lian Qiao)',
                             emoji: 'üåª',
                             description: 'Naturalny antydepresant, podnosi nastr√≥j i przywraca rado≈õƒá ≈ºycia.',
                             action: 'Podnosi Yang Qi, rozja≈õnia Shen',
                             temperature: 'Ciep≈Ça',
                             taste: 'Gorzki, s≈Çodki',
                             meridian: 'Serce, P≈Çuca',
                             dosage: '300-900mg ekstraktu dziennie'
                         },
                         {
                             name: 'Lawenda (Xun Yi Cao)',
                             emoji: 'üíú',
                             description: 'Uspokaja umys≈Ç, redukuje lƒôk i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, reguluje Qi',
                             temperature: 'Ch≈Çodna',
                             taste: 'Ostry, gorzki',
                             meridian: 'Serce, P≈Çuca',
                             dosage: '1-4g dziennie, olejek eteryczny'
                         },
                         {
                             name: 'Szafran (Fan Hong Hua)',
                             emoji: 'üü°',
                             description: 'Poprawia nastr√≥j, zwiƒôksza energiƒô ≈ºyciowƒÖ i wspiera pozytywne my≈õlenie.',
                             action: 'Aktywuje Krew, podnosi Shen',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki, lekko gorzki',
                             meridian: 'Serce, WƒÖtroba',
                             dosage: '1-3g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'Lƒôk i Niepok√≥j',
                     emotion: 'Strach',
                     element: 'Woda',
                     emoji: 'üò∞',
                     color: '#2196F3',
                     herbs: [
                         {
                             name: 'Waleriana (Jie Gu Mu)',
                             emoji: 'üå∏',
                             description: 'Silnie uspokajajƒÖce zio≈Ço, redukuje lƒôk i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, wzmacnia Yin',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki, ostry',
                             meridian: 'Serce, Nerki',
                             dosage: '300-600mg ekstraktu przed snem'
                         },
                         {
                             name: 'Pokrzywa (Xun Ma)',
                             emoji: 'üå±',
                             description: 'Wzmacnia nadnercza, poprawia odporno≈õƒá na stres.',
                             action: 'Tonizuje Yang Nerek, wzmacnia Qi',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki, lekko gorzki',
                             meridian: 'Nerki, WƒÖtroba',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Passiflora (Xi Fan Lian)',
                             emoji: 'üå∫',
                             description: '≈Åagodzi napiƒôcia nerwowe i redukuje poziom stresu.',
                             action: 'Uspokaja Shen, reguluje Qi Serca',
                             temperature: 'Ch≈Çodna',
                             taste: 'S≈Çodki, lekko gorzki',
                             meridian: 'Serce, WƒÖtroba',
                             dosage: '4-8g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'Nadpobudliwo≈õƒá i Mania',
                     emotion: 'Przesadna Rado≈õƒá',
                     element: 'Ogie≈Ñ',
                     emoji: 'ü§©',
                     color: '#F44336',
                     herbs: [
                         {
                             name: 'Chmiela (Pi Jiu Hua)',
                             emoji: 'üåø',
                             description: 'Uspokaja nadpobudliwo≈õƒá, pomaga w kontroli emocji.',
                             action: 'Ch≈Çodzi Ciep≈Ço Serca, uspokaja Shen',
                             temperature: 'Ch≈Çodna',
                             taste: 'Gorzki',
                             meridian: 'Serce, ≈ªo≈ÇƒÖdek',
                             dosage: '0.5-2g dziennie, napar'
                         },
                         {
                             name: 'Miƒôta (Bo He)',
                             emoji: 'üåø',
                             description: 'Och≈Çadza nadmiernƒÖ energiƒô Yang, przywraca r√≥wnowagƒô.',
                             action: 'Ch≈Çodzi Ciep≈Ço, reguluje Qi',
                             temperature: 'Ch≈Çodna',
                             taste: 'Ostry',
                             meridian: 'P≈Çuca, WƒÖtroba',
                             dosage: '1-3g dziennie, napar'
                         },
                         {
                             name: 'Lukrecja (Gan Cao)',
                             emoji: 'üçØ',
                             description: 'Harmonizuje wszystkie energie, ≈Çagodzi skrajne emocje.',
                             action: 'Harmonizuje wszystkie formu≈Çy, wzmacnia Qi',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki',
                             meridian: 'Wszystkie meridiany',
                             dosage: '2-12g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Obsesje i Nadmierne My≈õlenie',
                     emotion: 'Zamartwianie',
                     element: 'Ziemia',
                     emoji: 'ü§î',
                     color: '#FFC107',
                     herbs: [
                         {
                             name: 'R√≥≈ºa (Mei Gui Hua)',
                             emoji: 'üåπ',
                             description: 'Uwalnia zablokowane emocje, poprawia przep≈Çyw energii.',
                             action: 'Reguluje Qi, uspokaja Shen',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki, lekko gorzki',
                             meridian: 'WƒÖtroba, Serce',
                             dosage: '3-6g dziennie, napar'
                         },
                         {
                             name: 'Korzeni√≥wka (Bai Zhu)',
                             emoji: 'üåæ',
                             description: 'Wzmacnia ≈õledzionƒô, poprawia koncentracjƒô i pamiƒôƒá.',
                             action: 'Tonizuje Qi ≈öledziony, suszu Wilgoƒá',
                             temperature: 'Ciep≈Ça',
                             taste: 'S≈Çodki, gorzki',
                             meridian: '≈öledziona, ≈ªo≈ÇƒÖdek',
                             dosage: '6-12g dziennie, odwar'
                         },
                         {
                             name: 'Ginko (Yin Xing Ye)',
                             emoji: 'üçÉ',
                             description: 'Poprawia krƒÖ≈ºenie m√≥zgowe, wspiera jasno≈õƒá my≈õlenia.',
                             action: 'Aktywuje Krew, otwiera meridiany',
                             temperature: 'Neutralna',
                             taste: 'S≈Çodki, gorzki',
                             meridian: 'Serce, P≈Çuca',
                             dosage: '40-80mg ekstraktu dziennie'
                         }
                     ]
                 }
             ];
         }

        // AI Assistant Functions
        let isRecording = false;
        let recognition = null;

        // Initialize Speech Recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'pl-PL';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    sendMessage();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    stopRecording();
                    showNotification('B≈ÇƒÖd rozpoznawania mowy. Spr√≥buj ponownie.');
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        function toggleVoiceRecording() {
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (recognition) {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.add('voice-recording');
                voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                
                document.getElementById('aiStatus').innerHTML = 'üé§ S≈Çucham...';
                recognition.start();
            } else {
                showNotification('Rozpoznawanie mowy nie jest dostƒôpne w tej przeglƒÖdarce.');
            }
        }

        function stopRecording() {
            isRecording = false;
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('voice-recording');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            
            document.getElementById('aiStatus').innerHTML = 'ü§ñ Gotowy do pomocy';
            if (recognition) {
                recognition.stop();
            }
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message === '') return;
            
            // Check if user is admin - unlimited access
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'admin') {
                // Check AI usage limits for regular users
                if (!checkAIUsageLimit()) {
                    addMessageToChat(message, 'user');
                    userInput.value = '';
                    setTimeout(() => {
                        addMessageToChat('üö´ **OsiƒÖgnƒÖ≈Çe≈õ limit bezp≈Çatnych zapyta≈Ñ!**<br><br>Masz dostƒôp do 10 zapyta≈Ñ dziennie. Aby cieszyƒá siƒô nielimitowanym dostƒôpem do AI Asystenta, przejd≈∫ na plan Premium.<br><br><button onclick="showPremiumModal()" style="background: linear-gradient(135deg, #FFD700, #FFC107); border: none; padding: 10px 20px; border-radius: 10px; color: #000; font-weight: 600; cursor: pointer; margin-top: 10px;">üîì Odblokuj Premium</button>', 'ai');
                    }, 500);
                    return;
                }
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            userInput.value = '';
            
            // Increment AI usage for non-admin users
            if (userRole !== 'admin') {
                incrementAIUsage();
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process AI response
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAIResponse(message);
                addMessageToChat(response, 'ai');
                
                // Update usage display if premium modal is open
                updateAIUsageDisplay();
            }, 1500 + Math.random() * 1000);
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div style="color: #66BB6A; font-weight: 600; margin-bottom: 5px;">üë§ Ty:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">ü§ñ AI Asystent:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <span>ü§ñ AI my≈õli...</span>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const currentSeason = getCurrentSeason();
            
            // Detect intent
            if (message.includes('przepis') || message.includes('potrawa') || message.includes('jedzenie') || message.includes('gotowanie')) {
                return generateRecipeResponse(currentSeason);
            } else if (message.includes('ƒáwiczenie') || message.includes('trening') || message.includes('fitness') || message.includes('gimnastyka')) {
                return generateExerciseResponse(currentSeason);
            } else if (message.includes('lista') || message.includes('zakupy') || message.includes('sk≈Çadniki') || message.includes('kupiƒá')) {
                return generateShoppingListResponse(currentSeason);
            } else if (message.includes('sezon') || message.includes('pora roku')) {
                return generateSeasonResponse(currentSeason);
            } else if (message.includes('zdrowie') || message.includes('dolegliwo≈õci') || message.includes('b√≥l') || message.includes('energia')) {
                return generateHealthAdvice(currentSeason, message);
            } else {
                return generateGeneralResponse(currentSeason);
            }
        }

        function getCurrentSeason() {
            const month = new Date().getMonth(); // 0-11
            if (month >= 2 && month <= 4) return 'wiosna';
            if (month >= 5 && month <= 7) return 'lato'; 
            if (month === 8) return 'p√≥≈∫ne lato';
            if (month >= 9 && month <= 11) return 'jesie≈Ñ';
            return 'zima';
        }

        function generateRecipeResponse(season) {
            const recipes = {
                'wiosna': [
                    'Zupa z m≈Çodych pokrzyw - oczyszcza wƒÖtrobƒô i dodaje energii',
                    'Sa≈Çatka z roszponkƒÖ i kie≈Çkami - wspiera regeneracjƒô organizmu',
                    'Herbata z mniszka lekarskiego - detoksykuje i wzmacnia'
                ],
                'lato': [
                    'Gazpacho z og√≥rkiem - ch≈Çodzi organizm w upalne dni',
                    'Smoothie z arbuza i miƒôty - nawadnia i orze≈∫wia',
                    'Sa≈Çatka z pomidor√≥w i bazylii - wspiera pracƒô serca'
                ],
                'p√≥≈∫ne lato': [
                    'Zupa z kukurydzy i marchwi - wzmacnia ≈õledzionƒô',
                    'Zapiekanka z dyni i prosa - stabilizuje energiƒô',
                    'Herbata z korzeniem lukrecji - harmonizuje trawienie'
                ],
                'jesie≈Ñ': [
                    'Zupa dyniowa z imbirem - wzmacnia odporno≈õƒá',
                    'Kompot z jab≈Çek i cynamonu - wspiera trawienie',
                    'Gulasz z korzeniem lotosu - od≈ºywia i wzmacnia'
                ],
                'zima': [
                    'Ros√≥≈Ç z goji i imbirem - rozgrzewa i wzmacnia energiƒô',
                    'Pierogi z kapustƒÖ kiszonƒÖ - wspierajƒÖ trawienie',
                    'Herbata pu-erh z cytrynƒÖ - rozgrzewa i oczyszcza'
                ]
            };
            
            const seasonRecipes = recipes[season] || recipes['lato'];
            const randomRecipe = seasonRecipes[Math.floor(Math.random() * seasonRecipes.length)];
            
            // Add recipe to weekly progress
            addRecipeToWeekly(randomRecipe.split(' - ')[0]); // Extract recipe name before description
            
            return `üçΩÔ∏è **Przepis na ${season}:**<br><br>**${randomRecipe}**<br><br>Zgodnie z TCM, ${season} to czas, gdy organizm potrzebuje specjalnych sk≈Çadnik√≥w od≈ºywczych. Czy chcesz, ≈ºebym przygotowa≈Ç dla Ciebie listƒô zakup√≥w na ten przepis?`;
        }

        function generateExerciseResponse(season) {
            const exercises = {
                'wiosna': [
                    'Tai Chi w parku - harmonizuje energiƒô wƒÖtroby',
                    'Joga rozciƒÖgajƒÖca - aktywuje przep≈Çyw Qi',
                    'Spacery w naturze - ≈ÇƒÖczy z energiƒÖ wzrostu'
                ],
                'lato': [
                    'Qigong o ≈õwicie - uspokaja umys≈Ç w gorƒÖce dni',
                    'P≈Çywanie - ch≈Çodzi Shen (ducha)',
                    'Medytacja w cieniu - balansuje energiƒô serca'
                ],
                'p√≥≈∫ne lato': [
                    'Medytacja siedzƒÖca - wzmacnia ≈õledzionƒô',
                    '≈Åagodne spacery po posi≈Çku - wspiera trawienie',
                    'ƒÜwiczenia r√≥wnowagi - stabilizuje energiƒô ziemi'
                ],
                'jesie≈Ñ': [
                    'Oddychanie brzuchem - wzmacnia p≈Çuca',
                    'Powolne spacery - harmonizuje energiƒô metalu',
                    'Joga z naciskiem na p≈Çuca - przygotowuje na zimƒô'
                ],
                'zima': [
                    'Delikatne rozciƒÖganie - oszczƒôdza energiƒô nerek',
                    'Medytacja siedzƒÖca - kultywuje energiƒô wewnƒôtrznƒÖ',
                    'Qi Gong dla nerek - wzmacnia esencjƒô ≈ºyciowƒÖ'
                ]
            };
            
            const seasonExercises = exercises[season] || exercises['lato'];
            const randomExercise = seasonExercises[Math.floor(Math.random() * seasonExercises.length)];
            
            return `üßò **ƒÜwiczenie na ${season}:**<br><br>**${randomExercise}**<br><br>W medycynie chi≈Ñskiej ka≈ºda pora roku odpowiada innemu organowi. ${season} jest idealnƒÖ porƒÖ na te praktyki, kt√≥re harmonizujƒÖ Twoje cia≈Ço z naturalnymi cyklami.`;
        }

        function generateShoppingListResponse(season) {
            const shoppingLists = {
                'wiosna': ['m≈Çode pokrzywy', 'roszponka', 'kie≈Çki', 'mniszek lekarski', 'cytryna', 'imbir', 'szczypiorek'],
                'lato': ['og√≥rek', 'arbuz', 'miƒôta', 'pomidory', 'bazylia', 'sa≈Çata', 'melon'],
                'p√≥≈∫ne lato': ['kukurydza', 'marchew', 'dynia', 'proso', 'korze≈Ñ lukrecji', 's≈Çodkie ziemniaki', 'pszenica'],
                'jesie≈Ñ': ['dynia', 'imbir', 'jab≈Çka', 'cynamon', 'korze≈Ñ lotosu', 'marchew', 'broku≈Çy'],
                'zima': ['jagody goji', 'imbir', 'kapusta kiszona', 'herbata pu-erh', 'cytryna', 'czosnek', 'cebula']
            };
            
            const seasonIngredients = shoppingLists[season] || shoppingLists['lato'];
            
            let listHTML = `üõí **Lista zakup√≥w na ${season}:**<br><br>`;
            listHTML += '<div class="shopping-list">';
            listHTML += '<h4>üåø Sk≈Çadniki sezonowe TCM:</h4>';
            listHTML += '<ul>';
            
            seasonIngredients.forEach(ingredient => {
                listHTML += `<li>‚úÖ ${ingredient}</li>`;
            });
            
            listHTML += '</ul></div>';
            listHTML += '<br>Te sk≈Çadniki wspierajƒÖ Tw√≥j organizm zgodnie z zasadami medycyny chi≈Ñskiej dla obecnej pory roku.';
            
            return listHTML;
        }

        function generateSeasonResponse(season) {
            const seasonInfo = {
                'wiosna': 'Wiosna w TCM odpowiada elementowi Drewna i organowi wƒÖtroby. To czas wzrostu, odnowy i oczyszczania organizmu.',
                'lato': 'Lato w TCM odpowiada elementowi Ognia i organowi serca. To czas rado≈õci, aktywno≈õci i kultywowania ciep≈Ça wewnƒôtrznego.',
                'p√≥≈∫ne lato': 'P√≥≈∫ne lato w TCM odpowiada elementowi Ziemi i organom ≈õledziony i ≈ºo≈ÇƒÖdka. To czas r√≥wnowagi, stabilno≈õci i harmonii trawienia.',
                'jesie≈Ñ': 'Jesie≈Ñ w TCM odpowiada elementowi Metalu i organom p≈Çuc. To czas zbierania energii i przygotowywania na zimƒô.',
                'zima': 'Zima w TCM odpowiada elementowi Wody i organom nerek. To czas odpoczynku, kultywowania energii wewnƒôtrznej i wzmacniania esencji ≈ºyciowej.'
            };
            
            return `üåø **MƒÖdro≈õƒá TCM dla ${season}:**<br><br>${seasonInfo[season]}<br><br>Czy chcesz poznaƒá specjalne przepisy, ƒáwiczenia lub porady zdrowotne na tƒô porƒô roku?`;
        }

        function generateHealthAdvice(season, message) {
            const advice = {
                'wiosna': 'WiosnƒÖ wzmacniaj wƒÖtrobƒô zielonymi warzywami, unikaj nadmiernej z≈Ço≈õci i praktykuj ≈Çagodne rozciƒÖganie.',
                'lato': 'Latem chro≈Ñ serce przed przegrzaniem, pij du≈ºo p≈Çyn√≥w i praktykuj spokojnƒÖ medytacjƒô.',
                'p√≥≈∫ne lato': 'W p√≥≈∫ne lato wzmacniaj ≈õledzionƒô s≈Çodkimi pokarmami, unikaj przejadania siƒô i praktykuj umiarkowanie.',
                'jesie≈Ñ': 'JesieniƒÖ dbaj o p≈Çuca, jedz bia≈Çe pokarmy jak gruszki i rzodkiew, unikaj sucho≈õci.',
                'zima': 'ZimƒÖ wzmacniaj nerki ciep≈Çymi potrawami, oszczƒôdzaj energiƒô i praktykuj g≈Çƒôbokie oddychanie.'
            };
            
            return `üåø **Porada zdrowotna na ${season}:**<br><br>${advice[season]}<br><br>Pamiƒôtaj, ≈ºe w TCM profilaktyka jest najwa≈ºniejsza. Dostosowuj sw√≥j tryb ≈ºycia do naturalnych cykli przyrody.`;
        }

        function generateGeneralResponse(season) {
            return `ü§ñ Jestem Twoim asystentem TCM! Mogƒô pom√≥c Ci w:<br><br>‚Ä¢ üçΩÔ∏è **Przepisach sezonowych** - zdrowe potrawy na ${season}<br>‚Ä¢ üßò **ƒÜwiczeniach** - praktyki dostosowane do pory roku<br>‚Ä¢ üõí **Listach zakup√≥w** - sk≈Çadniki zgodne z TCM<br>‚Ä¢ üåø **Poradach zdrowotnych** - mƒÖdro≈õƒá tradycyjnej medycyny chi≈Ñskiej<br><br>Po prostu zapytaj: "Poka≈º mi przepisy na ${season}" lub "Jakie ƒáwiczenia na dzi≈õ?"`;
        }

        function quickAction(type) {
            const actions = {
                'przepisy': 'Poka≈º mi przepisy sezonowe',
                'cwiczenia': 'Jakie ƒáwiczenia polecasz na dzi≈õ?',
                'lista': 'Stw√≥rz listƒô zakup√≥w sezonowych',
                'porady': 'Daj mi poradƒô zdrowotnƒÖ na obecnƒÖ porƒô roku'
            };
            
            document.getElementById('userInput').value = actions[type];
            sendMessage();
        }

        // Automatic backup functionality
        function initializeAutoBackup() {
            // Check if auto backup is enabled (enabled by default)
            const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
            const autoBackupInterval = parseInt(localStorage.getItem('autoBackupInterval')) || 24; // hours
            
            if (autoBackupEnabled) {
                const lastAutoBackup = localStorage.getItem('lastAutoBackup');
                const now = new Date().getTime();
                
                if (!lastAutoBackup || (now - parseInt(lastAutoBackup)) > (autoBackupInterval * 60 * 60 * 1000)) {
                    // Perform automatic backup after 30 seconds
                    setTimeout(() => {
                        performAutoBackup();
                    }, 30000);
                }
                
                // Schedule periodic auto backups
                setInterval(() => {
                    const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
                    if (autoBackupEnabled) {
                        performAutoBackup();
                    }
                }, autoBackupInterval * 60 * 60 * 1000); // Convert hours to milliseconds
            }
        }

        function performAutoBackup() {
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "auto",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Store backup in localStorage as well
            localStorage.setItem('autoBackupData', JSON.stringify(backupData));
            localStorage.setItem('lastAutoBackup', new Date().getTime().toString());
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('INFO', 'BACKUP', 'Automatyczny backup zosta≈Ç wykonany', `Rozmiar: ${Math.round(JSON.stringify(backupData).length / 1024)} KB`);
            
            showNotification('üîÑ Automatyczny backup zosta≈Ç wykonany');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            updateSeason();
            updateRecipes();
            updateCurrentYear();
            updateSeasonalEnergyButton();
            loadWeeklyProgress(); // Initialize weekly progress tracking
            initializeAutoBackup(); // Initialize auto backup
            initializeLogging(); // Initialize logging system
            initializeOfflineMode(); // Initialize offline mode
            checkSettingsAccessError(); // Check if there was an error accessing settings
            
            // Update season, recipes, year and seasonal energy every hour to ensure accuracy
            setInterval(() => {
                updateSeason();
                updateRecipes();
                updateCurrentYear();
                updateSeasonalEnergyButton();
            }, 3600000); // 1 hour = 3600000ms
            
            // Add some random sparkles for delight
            setInterval(() => {
                if (Math.random() > 0.95) {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    createSparkle({ clientX: x, clientY: y });
                }
            }, 1000);
            
            // Welcome message will be updated by updateCurrentYear function
        });

        // Admin notification sender
        function sendNotificationToUsers() {
            // Create modal with form instead of using prompt()
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.15);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    backdrop-filter: blur(20px);
                    color: white;
                ">
                    <h2 style="margin: 0 0 20px 0; color: white;">üì¢ Wy≈õlij Powiadomienie</h2>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Tytu≈Ç:</label>
                        <input type="text" id="notifTitle" value="Wa≈ºna informacja" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            box-sizing: border-box;
                        ">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Tre≈õƒá:</label>
                        <textarea id="notifMessage" style="
                            width: 100%;
                            height: 80px;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            resize: none;
                            box-sizing: border-box;
                        ">Witamy w naszej aplikacji wellness!</textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px;">Odbiorcy:</label>
                        <select id="notifTarget" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                        ">
                            <option value="0">Wszyscy u≈ºytkownicy (347)</option>
                            <option value="1">Aktywni u≈ºytkownicy (68)</option>
                            <option value="2">Premium u≈ºytkownicy (23)</option>
                            <option value="3">Nowi u≈ºytkownicy (12)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="sendNotificationNow()" style="
                            flex: 1;
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px;
                            cursor: pointer;
                            font-weight: bold;
                        ">üì§ Wy≈õlij</button>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: rgba(255,255,255,0.2);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px 20px;
                            cursor: pointer;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => e.target === modal && modal.remove();
        }
        
        function sendNotificationNow() {
            const title = document.getElementById('notifTitle').value;
            const message = document.getElementById('notifMessage').value;
            const targetIndex = document.getElementById('notifTarget').value;
            
            if (!title || !message) {
                showNotification('‚ùå Wype≈Çnij wszystkie pola', 'error');
                return;
            }
            
            const targets = ['Wszyscy u≈ºytkownicy (347)', 'Aktywni u≈ºytkownicy (68)', 'Premium u≈ºytkownicy (23)', 'Nowi u≈ºytkownicy (12)'];
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
            
            // Simulate sending
            showNotification('üì§ Wysy≈Çanie powiadomienia...', 'info');
            
            setTimeout(() => {
                const notification = {
                    id: Date.now(),
                    title: title,
                    message: message,
                    target: targets[targetIndex],
                    timestamp: new Date().toLocaleString(),
                    status: 'sent'
                };
                
                // Save to localStorage
                const sentNotifications = JSON.parse(localStorage.getItem('sentNotifications') || '[]');
                sentNotifications.unshift(notification);
                localStorage.setItem('sentNotifications', JSON.stringify(sentNotifications.slice(0, 50)));
                
                showNotification('‚úÖ Powiadomienie wys≈Çane do: ' + targets[targetIndex], 'success');
            }, 2000);
        }

        // Export user data
        function exportUserData() {
            showNotification('üìä Przygotowywanie eksportu danych...', 'info');
            
            setTimeout(() => {
                const userData = [
                    { id: 1, name: 'Anna Kowalska', email: 'anna@example.com', status: 'active', joinDate: '2024-01-15', lastLogin: '2024-12-20' },
                    { id: 2, name: 'Piotr Nowak', email: 'piotr@example.com', status: 'active', joinDate: '2024-02-20', lastLogin: '2024-12-19' },
                    { id: 3, name: 'Maria Wi≈õniewska', email: 'maria@example.com', status: 'active', joinDate: '2024-03-10', lastLogin: '2024-12-18' },
                    { id: 4, name: 'Tomasz Admin', email: 'admin@example.com', status: 'admin', joinDate: '2024-01-01', lastLogin: '2024-12-20' },
                    { id: 5, name: 'Karolina Spam', email: 'spam@example.com', status: 'blocked', joinDate: '2024-11-15', lastLogin: '2024-11-20' }
                ];

                const content = JSON.stringify(userData, null, 2);
                const blob = new Blob([content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'users_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('‚úÖ Dane u≈ºytkownik√≥w zosta≈Çy wyeksportowane!', 'success');
            }, 1500);
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideUp {
                from {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize profiles when page loads
        window.addEventListener('load', function() {
            loadSavedProfilePictures();
            loadHealthMetrics();
            
            // Initialize offline mode indicators
            updateOfflineStatus();
            
            // Auto-load backup display
            updateBackupDisplay();
            
            // Start daily fluctuations simulation
            setInterval(simulateDailyFluctuations, 60000 * 60); // Every hour
        });

        // Also run initialization when DOM is ready (for faster loading)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadSavedProfilePictures();
                loadHealthMetrics();
            });
        } else {
            loadSavedProfilePictures();
            loadHealthMetrics();
        }

        // ====== PREMIUM FUNCTIONS ======

        // Initialize Stripe
        const stripe = Stripe('pk_test_51234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890'); // Demo key - replace with real
        
        // Initialize Premium system on page load
        initializePremiumSystem();

        function initializePremiumSystem() {
            // Initialize daily AI usage tracking
            const today = new Date().toDateString();
            const lastResetDate = localStorage.getItem('lastAIReset');
            
            if (lastResetDate !== today) {
                // Reset daily usage at midnight
                localStorage.setItem('dailyAIUsage', '0');
                localStorage.setItem('lastAIReset', today);
            }
            
            // Check if user has premium
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                // User has premium - no limits
                return;
            }
            
            // Update AI usage display if premium modal is open
            updateAIUsageDisplay();
        }

        function checkAIUsageLimit() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return true; // Premium users have unlimited access
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const dailyLimit = 10; // Free users get 10 queries per day
            
            return dailyUsage < dailyLimit;
        }

        function incrementAIUsage() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return; // Premium users don't have usage tracked
            }
            
            const currentUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            localStorage.setItem('dailyAIUsage', (currentUsage + 1).toString());
            
            // Add to system logs
            addSystemLog('INFO', 'AI', 'AI Query u≈ºywane', `Dzienne u≈ºycie: ${currentUsage + 1}/10`);
        }

        function updateAIUsageDisplay() {
            const remainingElement = document.getElementById('remainingQueries');
            if (!remainingElement) return;
            
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                remainingElement.textContent = '‚àû Nielimitowane';
                remainingElement.style.color = '#FFD700';
                return;
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const remaining = Math.max(0, 10 - dailyUsage);
            
            remainingElement.textContent = `${remaining} / 10`;
            
            if (remaining === 0) {
                remainingElement.style.color = '#F44336';
            } else if (remaining <= 3) {
                remainingElement.style.color = '#FF9800';
            } else {
                remainingElement.style.color = '#4CAF50';
            }
        }

        function showPremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.style.display = 'flex';
                updateAIUsageDisplay();
                
                // Add premium modal animation
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeIn 0.3s ease';
                
                // Add golden particle effect
                createPremiumParticles();
            }
        }

        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeOut 0.3s ease';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        function createPremiumParticles() {
            const particles = ['üëë', '‚ú®', 'üíé', 'üåü', 'üí∞'];
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.cssText = `
                        position: fixed;
                        font-size: 20px;
                        pointer-events: none;
                        z-index: 10001;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${Math.random() * window.innerHeight}px;
                        animation: premiumFloat 3s ease-out forwards;
                    `;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        async function initializeStripePayment() {
            const subscribeBtn = document.getElementById('subscribeBtn');
            
            // Show loading state
            subscribeBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i>Przetwarzanie...';
            subscribeBtn.disabled = true;
            
            try {
                // Simulate payment processing (replace with real Stripe implementation)
                await simulateStripePayment();
                
                // Success - activate premium
                localStorage.setItem('premiumStatus', 'active');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                
                // Show success message
                showPremiumSuccessModal();
                
                // Update UI
                updatePremiumUI();
                
                // Close premium modal
                closePremiumModal();
                
                // Add to system logs
                addSystemLog('SUCCESS', 'PREMIUM', 'Premium subskrypcja aktywowana', 'U≈ºytkownik przeszed≈Ç na plan Premium');
                
                // Show notification
                showNotification('üéâ Premium zosta≈Ço aktywowane! Ciesz siƒô nielimitowanym dostƒôpem do AI!');
                
            } catch (error) {
                // Handle payment error
                showNotification('‚ùå B≈ÇƒÖd p≈Çatno≈õci. Spr√≥buj ponownie.', 'error');
                addSystemLog('ERROR', 'PREMIUM', 'B≈ÇƒÖd p≈Çatno≈õci Premium', error.message);
            } finally {
                // Reset button
                subscribeBtn.innerHTML = '<i class="fas fa-crown" style="margin-right: 10px;"></i>Aktywuj Premium';
                subscribeBtn.disabled = false;
            }
        }

        async function simulateStripePayment() {
            // Simulate network delay and payment processing
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Simulate 95% success rate
            if (Math.random() < 0.05) {
                throw new Error('Karta zosta≈Ça odrzucona');
            }
            
            return {
                id: 'pi_' + Math.random().toString(36).substr(2, 9),
                status: 'succeeded',
                amount: 2999, // 29.99 PLN in grosze
                currency: 'pln'
            };
        }

        function showPremiumSuccessModal() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10002;
                animation: fadeIn 0.3s ease;
            `;
            
            successModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.3));
                    border: 2px solid rgba(255, 215, 0, 0.7);
                    border-radius: 20px;
                    backdrop-filter: blur(20px);
                    padding: 40px;
                    text-align: center;
                    max-width: 400px;
                    margin: 20px;
                    animation: bounceIn 0.5s ease;
                ">
                    <div style="font-size: 60px; margin-bottom: 20px;">üéâüëë</div>
                    <h3 style="color: #FFD700; margin-bottom: 15px; font-size: 24px;">
                        Gratulacje!
                    </h3>
                    <p style="color: white; margin-bottom: 20px; line-height: 1.6;">
                        Twoja subskrypcja Premium zosta≈Ça aktywowana!<br><br>
                        <strong>Teraz masz dostƒôp do:</strong><br>
                        ‚ú® Nielimitowanych zapyta≈Ñ AI<br>
                        üöÄ Priorytetowych odpowiedzi<br>
                        üåü Zaawansowanych analiz TCM
                    </p>
                    <button onclick="this.closest('div').remove()" style="
                        background: linear-gradient(135deg, #FFD700, #FFC107);
                        border: none;
                        padding: 12px 30px;
                        border-radius: 10px;
                        color: #000;
                        font-weight: 700;
                        cursor: pointer;
                        font-size: 16px;
                    ">
                        Rozpocznij korzystanie!
                    </button>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    successModal.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        if (successModal.parentNode) {
                            successModal.parentNode.removeChild(successModal);
                        }
                    }, 300);
                }
            }, 5000);
        }

        function updatePremiumUI() {
            // Update premium button to show status instead of purchase
            const premiumButtons = document.querySelectorAll('[onclick="showPremiumModal()"]');
            premiumButtons.forEach(btn => {
                const textElement = btn.querySelector('.feature-text');
                if (textElement) {
                    textElement.textContent = 'Premium ‚úì';
                    btn.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2))';
                    btn.style.border = '1px solid rgba(255, 215, 0, 0.5)';
                }
            });
            
            // Update AI usage display
            updateAIUsageDisplay();
        }

        // Check premium status on page load
        function checkPremiumStatus() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                updatePremiumUI();
            }
        }

        // Add premium floating animation CSS
        const premiumStyle = document.createElement('style');
        premiumStyle.textContent = `
            @keyframes premiumFloat {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: translateY(-50px) rotate(180deg);
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }
            
            @keyframes bounceIn {
                0% {
                    transform: scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(premiumStyle);

        // Initialize premium status on page load
        setTimeout(checkPremiumStatus, 500);
    </script>
</body>
</html> 