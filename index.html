<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <title>SezonoweDobro - Aplikacja TCM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Elements */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
            font-size: 24px;
        }

        .floating-element:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            top: 60%;
            right: 10%;
            animation-delay: -7s;
        }

        .floating-element:nth-child(3) {
            top: 40%;
            left: 30%;
            animation-delay: -14s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        /* Liquid Glass Container */
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* Header */
        .header {
            padding: 50px 20px 20px;
            text-align: center;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(56, 142, 60, 0.2));
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784, #A5D6A7, #C8E6C9);
            animation: seasonalGlow 4s ease-in-out infinite;
        }

        @keyframes seasonalGlow {
            0%, 100% { opacity: 0.8; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tagline {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Season Indicator */
        .current-season {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .season-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            padding: 0 20px;
            background: rgba(76, 175, 80, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            background: none;
            font-size: 14px;
        }

        .nav-tab.active {
            color: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            border-radius: 2px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { width: 0; }
            to { width: 30px; }
        }

        /* Content Area */
        .content {
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            color: white;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

        .card-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .card-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 2px;
        }

        .card-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-item:hover {
            transform: scale(1.05);
            background: rgba(76, 175, 80, 0.35);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
            color: #4CAF50;
        }

        .feature-text {
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        /* Season Progress */
        .season-progress {
            margin: 20px 0;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784);
            border-radius: 4px;
            width: 65%;
            animation: progressGlow 2s ease-in-out infinite alternate;
        }

        @keyframes progressGlow {
            0% { box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); }
            100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.8), 0 0 30px rgba(76, 175, 80, 0.6); }
        }

        .progress-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
        }

        /* Recipe Cards */
        .recipe-card {
            display: flex;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recipe-card:hover {
            transform: translateX(5px);
            background: rgba(76, 175, 80, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .recipe-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .recipe-info {
            flex: 1;
            padding: 15px;
        }

        .recipe-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recipe-meta {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 414px;
            width: 100%;
            background: rgba(45, 90, 45, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 12px;
            position: relative;
        }

        .bottom-nav-item.active {
            color: white;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 12px;
        }

        .bottom-nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        /* AI Assistant Styles */
        .ai-message, .user-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            animation: fadeInUp 0.3s ease;
        }

        .ai-message {
            background: rgba(76, 175, 80, 0.15);
            border-left: 3px solid #4CAF50;
        }

        .user-message {
            background: rgba(102, 187, 106, 0.15);
            border-right: 3px solid #66BB6A;
            text-align: right;
        }

        .quick-action-btn {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            padding: 6px 12px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: normal;
        }

        .quick-action-btn:hover {
            background: rgba(76, 175, 80, 0.4);
            transform: translateY(-2px);
        }

        .voice-recording {
            background: linear-gradient(135deg, #f44336, #ff5722) !important;
            animation: pulse 1s infinite;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4CAF50;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #4CAF50;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .shopping-list {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        .shopping-list h4 {
            color: #4CAF50;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .shopping-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .shopping-list li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(76, 175, 80, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .shopping-list li:last-child {
            border-bottom: none;
        }

        /* Season Element Hover Effects */
        .season-element {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .season-element:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .season-element:active {
            transform: scale(1.02);
        }

        /* Season Details Modal */
        .season-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .season-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .season-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .season-modal-icon {
            font-size: 48px;
            margin-right: 20px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .season-modal-title {
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        .season-modal-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 5px;
        }

        .season-info-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .season-info-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .season-info-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .season-info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .season-info-list li {
            padding: 5px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .close-modal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Recipe Modal Styles */
        .recipe-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .recipe-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .recipe-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .recipe-modal-icon {
            font-size: 60px;
            margin-right: 20px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .recipe-modal-title {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recipe-modal-meta {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .recipe-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .recipe-section-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipe-ingredients-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .recipe-ingredients-list li {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .recipe-instructions {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }

        .recipe-instructions ol {
            padding-left: 20px;
        }

        .recipe-instructions li {
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .recipe-benefits {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(102, 187, 106, 0.1));
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .recipe-card.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-card.clickable:hover {
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Herbs and Emotions Modal Styles */
        .herbs-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .herbs-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .herbs-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .herbs-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .herbs-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .herbs-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .herbs-category-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .herbs-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .herbs-category.expanded .herbs-expand-icon {
            transform: rotate(180deg);
        }

        .herbs-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .herbs-category.expanded .herbs-category-content {
            max-height: none;
        }

        .herbs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .herb-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .herb-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .herb-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .herb-emoji {
            font-size: 24px;
        }

        .herb-name {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .herb-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .herb-properties {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .herb-properties-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .herb-properties-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Face Yoga Modal Styles */
        .face-yoga-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .face-yoga-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .yoga-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .yoga-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .yoga-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .yoga-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-category-icon {
            font-size: 28px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .yoga-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .yoga-category.expanded .yoga-expand-icon {
            transform: rotate(180deg);
        }

        .yoga-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .yoga-category.expanded .yoga-category-content {
            max-height: none;
        }

        .yoga-exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .yoga-exercise-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .yoga-exercise-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .yoga-exercise-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .yoga-exercise-emoji {
            font-size: 32px;
        }

        .yoga-exercise-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-exercise-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .yoga-exercise-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #4CAF50;
            margin-bottom: 15px;
        }

        .yoga-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .yoga-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .yoga-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .yoga-steps-list li:before {
            content: "â–¶";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-size: 10px;
        }

        .yoga-benefits {
            background: rgba(76, 175, 80, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }

        .yoga-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .yoga-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .yoga-duration {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Seasonal Energy Modal Styles */
        .seasonal-energy-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .seasonal-energy-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 850px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .energy-practice-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .energy-practice-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .energy-practice-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .energy-practice-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .energy-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .energy-practice-category.expanded .energy-expand-icon {
            transform: rotate(180deg);
        }

        .energy-practice-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .energy-practice-category.expanded .energy-practice-content {
            max-height: none;
        }

        .energy-practices-grid {
            padding: 20px;
        }

        .energy-practice-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .energy-practice-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .energy-practice-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .energy-practice-emoji {
            font-size: 28px;
        }

        .energy-practice-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .energy-practice-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid currentColor;
            margin-bottom: 15px;
        }

        .energy-practice-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .energy-practice-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .energy-practice-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .energy-practice-steps-list li:before {
            content: "ðŸŒŸ";
            position: absolute;
            left: 0;
            font-size: 12px;
        }

        .energy-practice-benefits {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .energy-practice-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .energy-practice-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
        }

        .energy-practice-duration {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Wellness Metrics */
        .wellness-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .metric-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #4CAF50;
            display: block;
            transition: all 0.3s ease;
        }

        .metric-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
            
            .content {
                padding: 15px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .wellness-metrics {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .header {
                padding: 40px 15px 20px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .tagline {
                font-size: 12px;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 12px 0;
            }
            
            /* Modal improvements for mobile */
            .modal {
                padding: 10px !important;
            }
            
            .modal > div {
                max-width: 95% !important;
                margin: 10px auto !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            /* Touch improvements */
            .action-btn, .nav-tab, .glass-card {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            .action-btn {
                min-height: 44px; /* iOS minimum touch target */
                font-size: 16px;
            }
            
            /* Scrollable content on small screens */
            .wellness-metrics, .feature-grid {
                max-height: 60vh;
                overflow-y: auto;
            }
            
            /* Fix text truncation on mobile */
            .herb-properties-text, .yoga-benefits-text {
                white-space: normal;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .herb-card, .yoga-exercise-card {
                min-height: auto;
                height: auto;
            }
            
            .herb-properties, .yoga-exercise-steps, .yoga-benefits {
                min-height: auto;
            }
            
            /* Modal content improvements */
            .herbs-modal-content, .face-yoga-modal-content, .seasonal-energy-modal-content {
                padding: 15px;
                max-height: 95vh;
            }
        }

        /* Extra small screens (older phones) */
        @media (max-width: 360px) {
            .app-container {
                max-width: 100%;
            }
            
            .content {
                padding: 10px;
            }
            
            .header {
                padding: 35px 10px 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .tagline {
                font-size: 11px;
            }
            
            .wellness-metrics {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .glass-card {
                padding: 12px;
                margin: 8px 0;
            }
            
            .nav-tab {
                font-size: 11px;
                padding: 10px 0;
            }
            
            .metric-label {
                font-size: 10px;
            }
            
            .current-season {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            /* Additional text truncation fixes for extra small screens */
            .herbs-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .yoga-exercises-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .herb-properties-text, .yoga-benefits-text {
                font-size: 12px;
                line-height: 1.5;
            }
            
            .herb-card, .yoga-exercise-card {
                padding: 12px;
            }
        }

        /* Large phones and small tablets */
        @media (min-width: 481px) and (max-width: 768px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 20px;
            }
            
            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .wellness-metrics {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Landscape orientation on phones */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 20px 15px 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .tagline {
                font-size: 11px;
                margin-bottom: 10px;
            }
            
            .current-season {
                font-size: 10px;
                padding: 4px 8px;
            }
            
            .nav-tab {
                padding: 8px 0;
                font-size: 12px;
            }
        }

        /* iOS Safari fixes */
        @supports (-webkit-touch-callout: none) {
            .app-container {
                background: #2d5a2d !important;
            }
            .glass-card {
                background: rgba(76, 175, 80, 0.3) !important;
            }
            .header {
                background: rgba(76, 175, 80, 0.2) !important;
            }
        }

        /* Global text truncation prevention */
        .glass-card, .herb-card, .yoga-exercise-card, .energy-practice-card {
            height: auto;
            min-height: auto;
            overflow: visible;
        }

        .herb-properties, .yoga-exercise-steps, .yoga-benefits, .energy-practice-details {
            height: auto;
            min-height: auto;
            overflow: visible;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Login Screen Styles */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(76, 175, 80, 0.1);
            color: white;
            font-size: 16px; /* Prevents zoom on iOS */
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .register-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .register-btn:hover {
            color: white;
        }

        /* Logout Animation */
        .logout-animation {
            animation: logoutFade 0.5s ease-out forwards;
        }

        @keyframes logoutFade {
            0% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.95);
            }
        }

        .login-animation {
            animation: loginFade 0.5s ease-out forwards;
        }

        @keyframes loginFade {
            0% { 
                opacity: 0; 
                transform: scale(0.95);
            }
            100% { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #F44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        /* Special Effects */
        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkle 1.5s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="floating-element">ðŸŒ¸</div>
        <div class="floating-element">ðŸƒ</div>
        <div class="floating-element">â„ï¸</div>
    </div>

    <div class="app-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen" style="display: none;">
            <div class="login-container">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h1 class="logo">SezonoweDobro</h1>
                    <p class="tagline">Tradycyjna Medycyna ChiÅ„ska dla WspÃ³Å‚czesnego Å»ycia â€¢ 2025</p>
                </div>
                
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">Zaloguj siÄ™</div>
                            <div class="card-subtitle">Witaj ponownie</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form id="loginForm" onsubmit="login(event)">
                            <div class="input-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email" required 
                                       placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="password">HasÅ‚o:</label>
                                <input type="password" id="password" name="password" required 
                                       placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zaloguj siÄ™
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <p style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                ðŸ” Tylko autoryzowani uÅ¼ytkownicy
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showRegister()">
                                Nie masz konta? Zarejestruj siÄ™
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="glass-card" style="display: none; margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <div class="card-title">ZaÅ‚Ã³Å¼ konto</div>
                            <div class="card-subtitle">DoÅ‚Ä…cz do nas</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form onsubmit="register(event)">
                            <div class="input-group">
                                <label for="regName">ImiÄ™:</label>
                                <input type="text" id="regName" name="name" required placeholder="Twoje imiÄ™">
                            </div>
                            
                            <div class="input-group">
                                <label for="regEmail">Email:</label>
                                <input type="email" id="regEmail" name="email" required placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="regPassword">HasÅ‚o:</label>
                                <input type="password" id="regPassword" name="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zarejestruj siÄ™
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showLogin()">
                                Masz juÅ¼ konto? Zaloguj siÄ™
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp">
            <!-- Header -->
            <header class="header">
                <h1 class="logo">SezonoweDobro</h1>
                <p class="tagline">Tradycyjna Medycyna ChiÅ„ska dla WspÃ³Å‚czesnego Å»ycia â€¢ 2025</p>
                <div class="current-season">
                    <i class="fas fa-fire season-icon"></i>
                    <span id="currentSeasonText">Sezon Ognia (Lato)</span>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab(event, 'home')">
                <i class="fas fa-home"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'calendar')">
                <i class="fas fa-calendar"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'wellness')">
                <i class="fas fa-heart"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'profile')">
                <i class="fas fa-user"></i>
            </button>
            <button class="nav-tab admin-tab" onclick="switchTab(event, 'admin')" style="display: none;">
                <i class="fas fa-cog"></i>
            </button>
        </nav>

        <!-- Content Area -->
        <main class="content">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-yin-yang"></i>
                        </div>
                        <div>
                                                    <div class="card-title" id="currentSeasonTitle">Sezon Ognia (Lato)</div>
                        <div class="card-subtitle season-description">RadoÅ›Ä‡, aktywnoÅ›Ä‡ i energia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <p id="seasonDescription">Dzisiejsza energia jest wyrÃ³wnana z elementem Ognia. Skup siÄ™ na radoÅ›ci, aktywnoÅ›ci i kultywowaniu ciepÅ‚a wewnÄ™trznego.</p>
                        
                        <div class="season-progress">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="progress-text">PostÄ™p Sezonu Ognia: 85%</div>
                        </div>
                    </div>
                </div>

                <div class="wellness-metrics">
                    <div class="metric-item">
                        <span class="metric-value" id="qiLevel">85</span>
                        <div class="metric-label">Poziom Qi</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="balanceLevel">92</span>
                        <div class="metric-label">RÃ³wnowaga</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="energyLevel">78</span>
                        <div class="metric-label">Energia</div>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-item" onclick="showSeasonalEnergy()" id="seasonalEnergyButton">
                        <i class="fas fa-fire feature-icon" id="seasonalEnergyIcon"></i>
                        <div class="feature-text" id="seasonalEnergyText">Letnia Energia</div>
                    </div>
                    <div class="feature-item" onclick="showHerbsAndEmotions()">
                        <i class="fas fa-seedling feature-icon"></i>
                        <div class="feature-text">ZioÅ‚a i Emocje</div>
                    </div>
                    <div class="feature-item" onclick="showFaceYoga()">
                        <i class="fas fa-smile feature-icon"></i>
                        <div class="feature-text">Joga Twarzy</div>
                    </div>
                    <div class="feature-item" onclick="startElementTest()">
                        <i class="fas fa-search feature-icon"></i>
                        <div class="feature-text">Odkryj swÃ³j Å¼ywioÅ‚</div>
                    </div>
                </div>

                <button class="action-btn" style="width: 100%;" onclick="showNotification('Rozpoczynamy TwojÄ… podrÃ³Å¼ dobrostanu!')">
                    Rozpocznij Dzisiejsze Praktyki
                </button>
                
                <!-- Hidden debug buttons for testing (only visible in development) -->
                <button class="action-btn" style="width: 100%; margin-top: 10px; background: rgba(255,193,7,0.2); border: 1px solid rgba(255,193,7,0.5); font-size: 12px;" onclick="resetHealthMetrics()">
                    ðŸ”„ Reset wskaÅºnikÃ³w (test)
                </button>
                <button class="action-btn" style="width: 100%; margin-top: 5px; background: rgba(33,150,243,0.2); border: 1px solid rgba(33,150,243,0.5); font-size: 12px;" onclick="resetWeeklyProgress(); showNotification('ðŸ“Š Tygodniowy postÄ™p zostaÅ‚ zresetowany!');">
                    ðŸ“Š Reset tygodniowego postÄ™pu
                </button>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Kalendarz PiÄ™ciu PÃ³r Roku</div>
                            <div class="card-subtitle">Tradycyjne Cykle TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item season-element" onclick="showSeasonDetails('Drewno')" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1)); cursor: pointer;">
                                <i class="fas fa-seedling feature-icon" style="color: #4CAF50;"></i>
                                <div class="feature-text">Drewno<br><small>Wiosna</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('OgieÅ„')" style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.1)); cursor: pointer;">
                                <i class="fas fa-fire feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">OgieÅ„<br><small>Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Ziemia')" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.1)); cursor: pointer;">
                                <i class="fas fa-mountain feature-icon" style="color: #FFC107;"></i>
                                <div class="feature-text">Ziemia<br><small>PÃ³Åºne Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Metal')" style="background: linear-gradient(135deg, rgba(158, 158, 158, 0.3), rgba(158, 158, 158, 0.1)); cursor: pointer;">
                                <i class="fas fa-wind feature-icon" style="color: #9E9E9E;"></i>
                                <div class="feature-text">Metal<br><small>JesieÅ„</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Woda')" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.3), rgba(33, 150, 243, 0.1)); cursor: pointer;">
                                <i class="fas fa-snowflake feature-icon" style="color: #2196F3;"></i>
                                <div class="feature-text">Woda<br><small>Zima</small></div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: white; margin-bottom: 10px;">Dzisiejsze Zalecenia</h4>
                            <ul id="dailyRecommendations" style="color: rgba(255,255,255,0.9); line-height: 1.8; list-style: none;">
                                <li>â˜€ï¸ Unikaj przegrzewania w gorÄ…ce dni</li>
                                <li>ðŸ§˜ Praktykuj spokojnÄ… medytacjÄ™</li>
                                <li>ðŸ‰ Jedz chÅ‚odzÄ…ce owoce jak arbuz</li>
                                <li>ðŸŠ PÅ‚ywaj lub rÃ³b Ä‡wiczenia w cieniu</li>
                                <li>ðŸŒ™ Åšpij wczeÅ›nie by uniknÄ…Ä‡ ciepÅ‚a</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipes Tab -->
            <div id="recipes" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div>
                            <div class="card-title">Sezonowe Przepisy</div>
                            <div class="card-subtitle" id="recipesSubtitle">Ulubione Sezonu Ognia</div>
                        </div>
                    </div>
                </div>

                <div id="recipesContainer">
                    <!-- Dynamic recipes will be loaded here -->
                </div>

                <button class="action-btn" style="width: 100%; margin-top: 20px;" onclick="generateShoppingList()">
                    ðŸ“ Wygeneruj ListÄ™ ZakupÃ³w Sezonowych
                </button>
            </div>

            <!-- Wellness Tab -->
            <div id="wellness" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div>
                            <div class="card-title">Praktyki Zdrowotne</div>
                            <div class="card-subtitle">UmysÅ‚, CiaÅ‚o i Duch</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="showWellnessPractice('akupresura')">
                                <i class="fas fa-spa feature-icon"></i>
                                <div class="feature-text">Akupresura</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('qigong')">
                                <i class="fas fa-dumbbell feature-icon"></i>
                                <div class="feature-text">Qigong</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('medytacja')">
                                <i class="fas fa-brain feature-icon"></i>
                                <div class="feature-text">Medytacja</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('oddychanie')">
                                <i class="fas fa-lungs feature-icon"></i>
                                <div class="feature-text">Oddychanie</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <div class="card-title">Tygodniowy PostÄ™p</div>
                            <div class="card-subtitle">Twoja podrÃ³Å¼ do zdrowia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="wellness-metrics">
                            <div class="metric-item">
                                <span id="weeklyPracticeDays" class="metric-value">0</span>
                                <div class="metric-label">Dni Praktyki</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyMinutes" class="metric-value">0</span>
                                <div class="metric-label">Minuty</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyRecipes" class="metric-value">0</span>
                                <div class="metric-label">Przepisy WyprÃ³bowane</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant Tab -->
            <div id="ai-assistant" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="card-title">AI Asystent TCM</div>
                            <div class="card-subtitle">Ekspert Medycyny ChiÅ„skiej</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div id="aiStatus" style="color: #4CAF50; font-size: 14px;">
                                ðŸ¤– Gotowy do pomocy
                            </div>
                            <button 
                                onclick="testFullAIWorkflow()"
                                style="
                                    background: linear-gradient(135deg, #2196F3, #03A9F4);
                                    border: none;
                                    border-radius: 12px;
                                    padding: 10px 20px;
                                    color: white;
                                    font-size: 14px;
                                    cursor: pointer;
                                    margin-top: 10px;
                                    transition: all 0.3s ease;
                                "
                                title="Przetestuj poÅ‚Ä…czenie z AI Railway"
                            >
                                ðŸ”§ Testuj poÅ‚Ä…czenie AI
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="glass-card" style="min-height: 400px;">
                    <div class="card-content">
                        <div id="chatMessages" style="
                            height: 300px; 
                            overflow-y: auto; 
                            border: 1px solid rgba(255,255,255,0.2); 
                            border-radius: 12px; 
                            padding: 15px; 
                            margin-bottom: 15px;
                            background: rgba(0,0,0,0.1);
                        ">
                            <div class="ai-message">
                                <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">ðŸ¤– AI Asystent:</div>
                                <div style="color: rgba(255,255,255,0.9);">
                                    Witaj! Jestem Twoim ekspertem w dziedzinie Tradycyjnej Medycyny ChiÅ„skiej. 
                                    MogÄ™ pomÃ³c Ci w:
                                    <br>â€¢ ðŸ½ï¸ Przepisach sezonowych
                                    <br>â€¢ ðŸ§˜ Ä†wiczeniach wedÅ‚ug sezonu
                                    <br>â€¢ ðŸ›’ Listach zakupÃ³w
                                    <br>â€¢ ðŸŒ¿ Poradach zdrowotnych TCM
                                    <br><br>Zapytaj mnie o cokolwiek!
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div style="flex: 1;">
                                <textarea 
                                    id="userInput" 
                                    placeholder="Zapytaj o przepisy, Ä‡wiczenia, porady TCM..."
                                    style="
                                        width: 100%;
                                        min-height: 60px;
                                        max-height: 120px;
                                        padding: 12px;
                                        border: 1px solid rgba(255,255,255,0.3);
                                        border-radius: 12px;
                                        background: rgba(76, 175, 80, 0.1);
                                        color: white;
                                        font-size: 14px;
                                        resize: vertical;
                                        font-family: inherit;
                                        box-sizing: border-box;
                                    "
                                    onkeypress="handleEnterKey(event)"
                                ></textarea>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button 
                                    id="voiceBtn" 
                                    onclick="toggleVoiceRecording()"
                                    style="
                                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="Nagrywanie gÅ‚osowe"
                                >
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button 
                                    onclick="sendMessage()"
                                    style="
                                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="WyÅ›lij wiadomoÅ›Ä‡"
                                >
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="margin-top: 15px;">
                            <div style="color: white; font-size: 12px; margin-bottom: 8px;">Szybkie akcje:</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="quick-action-btn" onclick="quickAction('przepisy')">
                                    ðŸ½ï¸ Przepisy sezonowe
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('cwiczenia')">
                                    ðŸ§˜ Ä†wiczenia
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('lista')">
                                    ðŸ›’ Lista zakupÃ³w
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('porady')">
                                    ðŸŒ¿ Porady TCM
                                </button>
                                <button class="quick-action-btn" onclick="testFullAIWorkflow()" style="background: linear-gradient(135deg, #2196F3, #03A9F4);">
                                    ðŸ”§ Test AI
                                </button>
                            </div>
                        </div>

                        <!-- Test Button -->
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <div style="color: white; font-size: 12px; margin-bottom: 8px;">Diagnostyka:</div>
                            <button 
                                onclick="testFullAIWorkflow()"
                                style="
                                    background: linear-gradient(135deg, #2196F3, #03A9F4);
                                    border: none;
                                    border-radius: 8px;
                                    padding: 8px 16px;
                                    color: white;
                                    font-size: 12px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                "
                                title="Przetestuj poÅ‚Ä…czenie z AI Railway"
                            >
                                ðŸ”§ Testuj poÅ‚Ä…czenie AI
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">TwÃ³j Profil</div>
                            <div class="card-subtitle">Konstytucja TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="user-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #4CAF50, #66BB6A); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('user')">
                                    ðŸ‘¤
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(76, 175, 80, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('user')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="user-display-name" style="color: white; margin-bottom: 5px;">Eksplorator Zdrowia</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">ZrÃ³wnowaÅ¼ona Konstytucja</p>
                        </div>
                        
                        <div class="feature-grid">
                            <div class="feature-item" onclick="editUserProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="showPremiumModal()">
                                <i class="fas fa-crown feature-icon" style="color: #FFD700;"></i>
                                <div class="feature-text">Premium</div>
                            </div>
                            <div class="feature-item" onclick="testNotifications()">
                                <i class="fas fa-bell feature-icon"></i>
                                <div class="feature-text">Powiadomienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-download feature-icon" id="offline-icon"></i>
                                <div class="feature-text" id="offline-text">Tryb Offline</div>
                            </div>
                            <div class="feature-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">Wyloguj</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Panel Administratora</div>
                            <div class="card-subtitle">ZarzÄ…dzanie aplikacjÄ…</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="admin-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #FF6B35, #F7931E); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('admin')">
                                    ðŸ‘‘
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(255, 107, 53, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('admin')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="admin-display-name" style="color: white; margin-bottom: 5px;">Administrator</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">PeÅ‚ne uprawnienia systemu</p>
                        </div>
                        
                        <div class="feature-grid" style="margin-bottom: 20px;">
                            <div class="feature-item" onclick="editAdminProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-profile-offline-icon"></i>
                                <div class="feature-text" id="admin-profile-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div>
                            <div class="card-title">NarzÄ™dzia Systemowe</div>
                            <div class="card-subtitle">Konfiguracja i monitoring</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="testAPIConnection()">
                                <i class="fas fa-server feature-icon" style="color: #4CAF50;"></i>
                                <div class="feature-text">Test Railway</div>
                            </div>
                            <div class="feature-item" onclick="performBackup()">
                                <i class="fas fa-database feature-icon"></i>
                                <div class="feature-text">Backup</div>
                            </div>
                            <div class="feature-item" onclick="showSystemLogs()">
                                <i class="fas fa-file-alt feature-icon"></i>
                                <div class="feature-text">Logi</div>
                            </div>
                            <div class="feature-item" onclick="showRestoreModal()">
                                <i class="fas fa-upload feature-icon"></i>
                                <div class="feature-text">PrzywrÃ³Ä‡</div>
                            </div>
                            <div class="feature-item" onclick="showSystemSettings()">
                                <i class="fas fa-cogs feature-icon"></i>
                                <div class="feature-text">Ustawienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-offline-icon"></i>
                                <div class="feature-text" id="admin-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="bottom-nav-item active" onclick="switchBottomTab(event, 'home')">
                <i class="fas fa-home"></i>
                <span>GÅ‚Ã³wna</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'calendar')">
                <i class="fas fa-calendar-alt"></i>
                <span>Kalendarz</span>
                <div class="notification-badge">3</div>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
                <span>Przepisy</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'wellness')">
                <i class="fas fa-spa"></i>
                <span>Zdrowie</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
                <span>AI Asystent</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'profile')">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
            <div class="bottom-nav-item admin-nav" onclick="switchBottomTab(event, 'admin')" style="display: none;">
                <i class="fas fa-shield-alt"></i>
                <span>Admin</span>
            </div>
        </nav>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div id="profileEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 400px; margin: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-edit" style="margin-right: 10px; color: #4CAF50;"></i>
                    Edytuj Profil
                </h3>
                <button onclick="closeProfileEditModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-user" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nazwa uÅ¼ytkownika
                </label>
                <input type="text" id="editDisplayName" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="WprowadÅº nowÄ… nazwÄ™">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-envelope" style="margin-right: 8px; color: #4CAF50;"></i>
                    Email / Login
                </label>
                <input type="email" id="editEmail" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="WprowadÅº nowy email">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-lock" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nowe hasÅ‚o (opcjonalnie)
                </label>
                <input type="password" id="editPassword" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="WprowadÅº nowe hasÅ‚o">
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button onclick="closeProfileEditModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Anuluj
                </button>
                <button onclick="saveProfileChanges()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-save" style="margin-right: 8px;"></i>
                    Zapisz
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile picture upload -->
    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">

    <!-- Wellness Practice Modal -->
    <div id="wellnessPracticeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 600px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 id="practiceTitle" style="color: white; margin: 0; font-size: 22px;">
                    <i id="practiceIcon" class="fas fa-spa" style="margin-right: 10px; color: #4CAF50;"></i>
                    Praktyka Zdrowotna
                </h3>
                <button onclick="closeWellnessPractice()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="practiceContent">
                <!-- Practice content will be dynamically loaded here -->
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="startPracticeSession()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-play" style="margin-right: 8px;"></i>
                    Rozpocznij PraktykÄ™
                </button>
                <button onclick="closeWellnessPractice()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Zamknij
                </button>
            </div>
        </div>
    </div>

    <!-- Element Test Modal -->
    <div id="elementTestModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-search" style="margin-right: 10px; color: #4CAF50;"></i>
                    Odkryj swÃ³j Å¼ywioÅ‚ TCM
                </h3>
                <button onclick="closeElementTest()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="testContent">
                <!-- Test questions will be dynamically loaded here -->
            </div>
            
            <div id="testResult" style="display: none;">
                <!-- Test results will be shown here -->
            </div>
            
            <div id="testNavigation" style="display: flex; gap: 15px; margin-top: 25px;">
                <button id="prevBtn" onclick="previousQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease; display: none;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
                    Poprzednie
                </button>
                <button id="nextBtn" onclick="nextQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    NastÄ™pne
                    <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2)); border: 2px solid rgba(255, 215, 0, 0.5); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: #FFD700; margin: 0; font-size: 22px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">
                    <i class="fas fa-crown" style="margin-right: 10px; color: #FFD700;"></i>
                    Premium AI Asystent
                </h3>
                <button onclick="closePremiumModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 15px;">ðŸ¤–ðŸ‘‘</div>
                <h4 style="color: white; margin-bottom: 10px;">Status AI Asystenta</h4>
                <div id="aiUsageStatus" style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: #FFD700; font-weight: 600; margin-bottom: 5px;">PozostaÅ‚e zapytania bezpÅ‚atne:</div>
                    <div id="remainingQueries" style="font-size: 24px; color: white; font-weight: 700;">10 / 10</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 12px; margin-top: 5px;">Reset codziennie o pÃ³Å‚nocy</div>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: #FFD700; margin-bottom: 15px;">
                    <i class="fas fa-star" style="margin-right: 8px;"></i>
                    Premium Plan - 29.99 PLN/miesiÄ…c
                </h4>
                <ul style="color: white; list-style: none; padding: 0;">
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Nielimitowane zapytania AI</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Priorytetowe odpowiedzi</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Zaawansowane analizy TCM</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Personalne plany Å¼ywieniowe</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>24/7 dostÄ™p bez limitÃ³w</li>
                </ul>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
                <button id="subscribeBtn" onclick="initializeStripePayment()" style="width: 100%; padding: 15px; border-radius: 15px; border: none; background: linear-gradient(135deg, #FFD700, #FFC107); color: #000; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 215, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i class="fas fa-crown" style="margin-right: 10px;"></i>
                    Aktywuj Premium
                </button>
            </div>

            <div style="text-align: center;">
                <p style="color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 0;">
                    <i class="fas fa-shield-alt" style="margin-right: 5px;"></i>
                    Bezpieczne pÅ‚atnoÅ›ci przez Stripe â€¢ Anuluj w dowolnym momencie
                </p>
            </div>
        </div>
    </div>

    <script>
        // === API CONFIGURATION ===
        const API_CONFIG = {
            BASE_URL: 'https://sezonowe-dobro-production.up.railway.app/api',
            ENDPOINTS: {
                HEALTH: '/health',
                LOGIN: '/auth/login',
                REGISTER: '/auth/register',
                AI_QUERY: '/ai/query',
                STRIPE_CHECKOUT: '/payments/create-checkout',
                SUBSCRIPTION_STATUS: '/payments/subscription-status'
            }
        };

        // === API HELPER FUNCTIONS ===
        async function apiCall(endpoint, options = {}) {
            const url = API_CONFIG.BASE_URL + endpoint;
            const token = localStorage.getItem('authToken');
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` }),
                    ...options.headers
                },
                ...options
            };
            
            try {
                const response = await fetch(url, config);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Call failed:', error);
                throw error;
            }
        }

        // === AUTHENTICATION FUNCTIONS ===
        async function realLogin(email, password) {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.LOGIN, {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                // Store token and user data
                localStorage.setItem('authToken', response.token);
                localStorage.setItem('userName', response.user.email);
                localStorage.setItem('userRole', response.user.role);
                
                return response;
            } catch (error) {
                throw new Error('Logowanie nie powiodÅ‚o siÄ™: ' + error.message);
            }
        }

        // === AI INTEGRATION ===
        async function getRealAIResponse(message) {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.AI_QUERY, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        message: message,
                        context: {
                            season: getCurrentSeason(),
                            userRole: localStorage.getItem('userRole') || 'user'
                        }
                    })
                });
                
                return response.response || 'Przepraszam, nie mogÄ™ teraz odpowiedzieÄ‡.';
                
            } catch (error) {
                // If OpenAI not configured, inform user
                if (error.message.includes('OPENAI_NOT_CONFIGURED')) {
                    console.log('ðŸš§ OpenAI nie skonfigurowany - uÅ¼ywam lokalnych odpowiedzi');
                    throw new Error('OpenAI API nie skonfigurowane');
                } else {
                    console.error('AI API Error:', error);
                    throw error;
                }
            }
        }

        // === TEST API CONNECTION ===
        async function testAPIConnection() {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.HEALTH);
                console.log('âœ… API Railway poÅ‚Ä…czone:', response);
                showNotification('âœ… PoÅ‚Ä…czono z serwerem Railway!');
                return true;
            } catch (error) {
                console.error('âŒ API Railway bÅ‚Ä…d:', error);
                showNotification('âŒ BÅ‚Ä…d poÅ‚Ä…czenia z serwerem', 'error');
                return false;
            }
        }

        // === TEST FULL AI WORKFLOW ===
        async function testFullAIWorkflow() {
            try {
                // Test 1: Health check
                console.log('ðŸ” Test 1: Health check...');
                const healthResponse = await apiCall(API_CONFIG.ENDPOINTS.HEALTH);
                console.log('âœ… Health response:', healthResponse);
                
                // Test 2: Login
                console.log('ðŸ” Test 2: Login test...');
                const loginResponse = await apiCall(API_CONFIG.ENDPOINTS.LOGIN, {
                    method: 'POST',
                    body: JSON.stringify({
                        email: 'admin@sezonoweDobro.pl',
                        password: 'Wellness2024!F6C4094CC3919E7C@'
                    })
                });
                console.log('âœ… Login response:', loginResponse);
                
                // Test 3: Store token temporarily
                const originalToken = localStorage.getItem('authToken');
                localStorage.setItem('authToken', loginResponse.token);
                
                // Test 4: AI Query
                console.log('ðŸ” Test 3: AI Query...');
                const aiResponse = await apiCall(API_CONFIG.ENDPOINTS.AI_QUERY, {
                    method: 'POST',
                    body: JSON.stringify({
                        message: 'PokaÅ¼ mi przepisy na lato',
                        context: {
                            season: 'lato',
                            userRole: 'admin'
                        }
                    })
                });
                console.log('âœ… AI Response:', aiResponse);
                
                // Restore original token
                if (originalToken) {
                    localStorage.setItem('authToken', originalToken);
                } else {
                    localStorage.removeItem('authToken');
                }
                
                showNotification('âœ… Wszystkie testy przeszÅ‚y! AI powinno teraz dziaÅ‚aÄ‡.');
                return true;
                
            } catch (error) {
                console.error('âŒ Test error:', error);
                showNotification('âŒ Test failed: ' + error.message, 'error');
                return false;
            }
        }

        // Tab Switching
        function switchTab(evt, tabName) {
            var i, tabcontent, navtabs;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        function switchBottomTab(evt, tabName) {
            var i, tabcontent, navtabs, bottomNavItems;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }

            // Remove active class from all bottom nav items
            bottomNavItems = document.getElementsByClassName("bottom-nav-item");
            for (i = 0; i < bottomNavItems.length; i++) {
                bottomNavItems[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Find corresponding top nav tab and activate it
            const topNavTabs = document.querySelectorAll('.nav-tab');
            topNavTabs.forEach((tab, index) => {
                if (index === Array.from(bottomNavItems).indexOf(evt.currentTarget)) {
                    tab.classList.add('active');
                }
            });
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        // Sparkle Effect
        function createSparkle(event) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.innerHTML = 'âœ¨';
            sparkle.style.left = event.clientX + 'px';
            sparkle.style.top = event.clientY + 'px';
            sparkle.style.position = 'fixed';
            sparkle.style.fontSize = '20px';
            sparkle.style.zIndex = '9999';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                document.body.removeChild(sparkle);
            }, 1500);
        }

        // Real-time Notification System
        function testNotifications() {
            showNotificationCenter();
        }
        
        function showNotificationCenter() {
            const modal = document.createElement('div');
            modal.id = 'notificationCenter';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const userName = localStorage.getItem('userName') || 'UÅ¼ytkownik';
            const userRole = localStorage.getItem('userRole') || 'user';
            const todayNotifications = generateTodayNotifications();
            
            modal.innerHTML = `
                <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="color: white; margin: 0; font-size: 22px;">
                            <i class="fas fa-bell" style="margin-right: 10px; color: #4CAF50;"></i>
                            Centrum PowiadomieÅ„
                        </h3>
                        <button onclick="closeNotificationCenter()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="background: rgba(76, 175, 80, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                            <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">ðŸ‘‹ Witaj, ${userName}!</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 14px;">
                                Rola: ${userRole === 'admin' ? 'ðŸ‘‘ Administrator' : 'ðŸ‘¤ UÅ¼ytkownik'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">
                            ðŸ“… Dzisiejsze powiadomienia
                        </h4>
                        <div id="todayNotifications">
                            ${todayNotifications.map(notif => `
                                <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 12px; margin-bottom: 10px; border-left: 3px solid ${notif.color};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <span style="color: ${notif.color}; font-weight: 600;">${notif.icon} ${notif.type}</span>
                                        <span style="color: rgba(255,255,255,0.6); font-size: 12px;">${notif.time}</span>
                                    </div>
                                    <div style="color: rgba(255,255,255,0.9); font-size: 14px;">${notif.message}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">
                            âš™ï¸ Ustawienia powiadomieÅ„
                        </h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: white;">ðŸ“± Powiadomienia push</span>
                            <button onclick="toggleNotificationSetting('push')" id="pushToggle" style="background: #4CAF50; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">ON</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: white;">ðŸ”” DÅºwiÄ™ki</span>
                            <button onclick="toggleNotificationSetting('sound')" id="soundToggle" style="background: #4CAF50; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">ON</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                            <span style="color: white;">ðŸ“§ Email</span>
                            <button onclick="toggleNotificationSetting('email')" id="emailToggle" style="background: #9E9E9E; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">OFF</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="sendTestNotification()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-weight: 600; cursor: pointer;">
                            ðŸ§ª Test powiadomienia
                        </button>
                        <button onclick="requestNotificationPermission()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; cursor: pointer;">
                            ðŸ”“ WÅ‚Ä…cz uprawnienia
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Log notification center access
            addSystemLog('INFO', 'SYSTEM', 'Otwarto centrum powiadomieÅ„', `UÅ¼ytkownik: ${userName}`);
        }
        
        function generateTodayNotifications() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
            const userRole = localStorage.getItem('userRole') || 'user';
            
            const baseNotifications = [
                {
                    type: 'Zdrowie',
                    icon: 'ðŸ’Š',
                    message: 'Czas na poranny napÃ³j z ciepÅ‚Ä… wodÄ… i cytrynÄ…!',
                    time: '07:00',
                    color: '#4CAF50'
                },
                {
                    type: 'Praktyka',
                    icon: 'ðŸ§˜',
                    message: 'Zalecana poranna medytacja - 15 minut spokoju',
                    time: '08:00',
                    color: '#2196F3'
                },
                {
                    type: 'AI Asystent',
                    icon: 'ðŸ¤–',
                    message: 'PozostaÅ‚e zapytania dzisiaj: ' + (10 - parseInt(localStorage.getItem('dailyAIUsage') || '0')),
                    time: timeString,
                    color: '#FF9800'
                }
            ];
            
            if (userRole === 'admin') {
                baseNotifications.push({
                    type: 'Admin',
                    icon: 'ðŸ‘‘',
                    message: 'Backup systemu wykonany automatycznie',
                    time: '06:00',
                    color: '#F44336'
                });
            }
            
            return baseNotifications;
        }
        
        function closeNotificationCenter() {
            const modal = document.getElementById('notificationCenter');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }
        
        function toggleNotificationSetting(type) {
            const button = document.getElementById(type + 'Toggle');
            const isOn = button.textContent === 'ON';
            
            if (isOn) {
                button.textContent = 'OFF';
                button.style.background = '#9E9E9E';
            } else {
                button.textContent = 'ON';
                button.style.background = '#4CAF50';
            }
            
            // Save setting to localStorage
            localStorage.setItem('notification_' + type, !isOn);
            showNotification(`${type} powiadomienia: ${!isOn ? 'wÅ‚Ä…czone' : 'wyÅ‚Ä…czone'}`);
        }
        
        function sendTestNotification() {
            showNotification('ðŸ§ª To jest testowe powiadomienie!');
            
            // Try browser notification if permission granted
            if (Notification.permission === 'granted') {
                new Notification('SezonoweDobro', {
                    body: 'Test powiadomienia przeglÄ…darki',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234CAF50"/></svg>'
                });
            }
        }
        
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        showNotification('âœ… Uprawnienia do powiadomieÅ„ przyznane!');
                    } else {
                        showNotification('âŒ Uprawnienia do powiadomieÅ„ odrzucone');
                    }
                });
            } else {
                showNotification('âŒ PrzeglÄ…darka nie obsÅ‚uguje powiadomieÅ„');
            }
        }

        // Notification System
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(76, 175, 80, 0.9);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 14px;
                font-weight: 600;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Dynamic Season Updates
        function updateSeason() {
            const seasons = [
                { 
                    name: 'Sezon Drewna (Wiosna)', 
                    icon: 'ðŸŒ±', 
                    element: 'Drewno',
                    color: '#4CAF50',
                    description: 'Wzrost, odnowa i oczyszczanie',
                    progress: 'PostÄ™p Sezonu Drewna'
                },
                { 
                    name: 'Sezon Ognia (Lato)', 
                    icon: 'ðŸ”¥', 
                    element: 'OgieÅ„',
                    color: '#FF5722',
                    description: 'RadoÅ›Ä‡, aktywnoÅ›Ä‡ i energia',
                    progress: 'PostÄ™p Sezonu Ognia'
                },
                { 
                    name: 'Sezon Ziemi (PÃ³Åºne Lato)', 
                    icon: 'ðŸŒ¾', 
                    element: 'Ziemia',
                    color: '#8D6E63',
                    description: 'RÃ³wnowaga i stabilnoÅ›Ä‡',
                    progress: 'PostÄ™p Sezonu Ziemi'
                },
                { 
                    name: 'Sezon Metalu (JesieÅ„)', 
                    icon: 'ðŸ‚', 
                    element: 'Metal',
                    color: '#9E9E9E',
                    description: 'Refleksja i przygotowanie',
                    progress: 'PostÄ™p Sezonu Metalu'
                },
                { 
                    name: 'Sezon Wody (Zima)', 
                    icon: 'â„ï¸', 
                    element: 'Woda',
                    color: '#2196F3',
                    description: 'Odpoczynek i regeneracja',
                    progress: 'PostÄ™p Sezonu Wody'
                }
            ];
            
            const currentDate = new Date();
            const month = currentDate.getMonth(); // 0-11
            const day = currentDate.getDate();
            let seasonIndex = 0;
            let seasonProgress = 0;
            
            // DokÅ‚adne daty sezonÃ³w TCM
            if (month >= 2 && month <= 4) { // Marzec-Maj (Wiosna)
                seasonIndex = 0;
                seasonProgress = calculateSeasonProgress(month, day, 2, 4); // Mar-May
            } else if (month >= 5 && month <= 7) { // Czerwiec-SierpieÅ„ (Lato)  
                seasonIndex = 1;
                seasonProgress = calculateSeasonProgress(month, day, 5, 7); // Jun-Aug
            } else if (month === 8) { // WrzesieÅ„ (PÃ³Åºne Lato)
                seasonIndex = 2;
                seasonProgress = Math.round((day / 30) * 100);
            } else if (month >= 9 && month <= 11) { // PaÅºdziernik-GrudzieÅ„ (JesieÅ„)
                seasonIndex = 3;
                seasonProgress = calculateSeasonProgress(month, day, 9, 11); // Oct-Dec
            } else { // StyczeÅ„-Luty (Zima)
                seasonIndex = 4;
                if (month <= 1) {
                    seasonProgress = Math.round(((month * 31 + day) / 59) * 100);
                } else {
                    seasonProgress = 100;
                }
            }
            
            const currentSeason = seasons[seasonIndex];
            
            // Update season display
            const seasonTextElement = document.getElementById('currentSeasonText');
            const seasonTitleElement = document.getElementById('currentSeasonTitle');
            const seasonIconElements = document.querySelectorAll('.season-icon');
            const seasonDescElement = document.querySelector('.season-description');
            const seasonDescriptionElement = document.getElementById('seasonDescription');
            const recipesSubtitleElement = document.getElementById('recipesSubtitle');
            const progressTextElement = document.querySelector('.progress-text');
            const progressFillElement = document.querySelector('.progress-fill');
            
            if (seasonTextElement) seasonTextElement.textContent = currentSeason.name;
            if (seasonTitleElement) seasonTitleElement.textContent = currentSeason.name;
            if (seasonDescElement) seasonDescElement.textContent = currentSeason.description;
            if (recipesSubtitleElement) recipesSubtitleElement.textContent = `Ulubione ${currentSeason.name}`;
            if (progressTextElement) progressTextElement.textContent = `${currentSeason.progress}: ${seasonProgress}%`;
            if (progressFillElement) progressFillElement.style.width = `${seasonProgress}%`;
            
            // Update all season icons
            seasonIconElements.forEach(icon => {
                icon.className = getSeasonIconClass(currentSeason.element);
                icon.textContent = currentSeason.icon;
            });
            
            // Update season description paragraph
            if (seasonDescriptionElement) {
                const elementDescriptions = {
                    'Drewno': 'Dzisiejsza energia jest wyrÃ³wnana z elementem Drewna. Skup siÄ™ na wzroÅ›cie, elastycznoÅ›ci i nowych poczÄ…tkach.',
                    'OgieÅ„': 'Dzisiejsza energia jest wyrÃ³wnana z elementem Ognia. Skup siÄ™ na radoÅ›ci, aktywnoÅ›ci i kultywowaniu ciepÅ‚a wewnÄ™trznego.',
                    'Ziemia': 'Dzisiejsza energia jest wyrÃ³wnana z elementem Ziemi. Skup siÄ™ na rÃ³wnowadze, stabilnoÅ›ci i odÅ¼ywianiu.',
                    'Metal': 'Dzisiejsza energia jest wyrÃ³wnana z elementem Metalu. Skup siÄ™ na refleksji, przygotowaniu i wewnÄ™trznej sile.',
                    'Woda': 'Dzisiejsza energia jest wyrÃ³wnana z elementem Wody. Skup siÄ™ na odpoczynku, regeneracji i kultywowaniu energii wewnÄ™trznej.'
                };
                seasonDescriptionElement.textContent = elementDescriptions[currentSeason.element];
            }
            
            // Update season button
            const seasonButton = document.querySelector('.season-btn');
            if (seasonButton) {
                seasonButton.innerHTML = `
                    <span class="season-icon">${currentSeason.icon}</span>
                    ${currentSeason.name}
                `;
            }
            
            // Update daily recommendations
            const dailyRecommendationsElement = document.getElementById('dailyRecommendations');
            if (dailyRecommendationsElement) {
                const seasonalRecommendations = {
                    'Drewno': [
                        'ðŸŒ… Wstawaj o wschodzie sÅ‚oÅ„ca (6:30)',
                        'ðŸ§˜ Poranne Ä‡wiczenia oddechowe',
                        'ðŸ¥¬ Jedz zielone warzywa liÅ›ciaste',
                        'ðŸš¶ RÃ³b Å‚agodne spacery w naturze',
                        'ðŸŒ™ Åšpij przed 23:00'
                    ],
                    'OgieÅ„': [
                        'â˜€ï¸ Unikaj przegrzewania w gorÄ…ce dni',
                        'ðŸ§˜ Praktykuj spokojnÄ… medytacjÄ™',
                        'ðŸ‰ Jedz chÅ‚odzÄ…ce owoce jak arbuz',
                        'ðŸŠ PÅ‚ywaj lub rÃ³b Ä‡wiczenia w cieniu',
                        'ðŸŒ™ Åšpij wczeÅ›nie by uniknÄ…Ä‡ ciepÅ‚a'
                    ],
                    'Ziemia': [
                        'âš–ï¸ Jedz regularne, zrÃ³wnowaÅ¼one posiÅ‚ki',
                        'ðŸ§˜ Praktykuj medytacjÄ™ uwaÅ¼noÅ›ci',
                        'ðŸŒ½ Jedz sÅ‚odkie i odÅ¼ywcze pokarmy',
                        'ðŸš¶ RÃ³b spokojne spacery po posiÅ‚ku',
                        'ðŸ˜Œ Kultywuj spokÃ³j i rÃ³wnowagÄ™'
                    ],
                    'Metal': [
                        'ðŸƒ Oddychaj gÅ‚Ä™boko Å›wieÅ¼ym powietrzem',
                        'ðŸ§˜ Praktykuj Ä‡wiczenia oddechowe',
                        'ðŸ Jedz biaÅ‚e pokarmy jak gruszki',
                        'ðŸ“– PoÅ›wiÄ™Ä‡ czas na refleksjÄ™',
                        'ðŸŒ™ KÅ‚adÅº siÄ™ spaÄ‡ wczeÅ›niej'
                    ],
                    'Woda': [
                        'ðŸ”¥ Jedz ciepÅ‚e, odÅ¼ywcze potrawy',
                        'ðŸ§˜ Praktykuj gÅ‚Ä™bokÄ… medytacjÄ™',
                        'ðŸ«˜ Dodaj do diety czarne ziarna',
                        'ðŸ  OszczÄ™dzaj energiÄ™, zostaÅ„ w domu',
                        'ðŸ’¤ Åšpij wiÄ™cej, nawet do 9 godzin'
                    ]
                };
                
                const recommendations = seasonalRecommendations[currentSeason.element] || seasonalRecommendations['OgieÅ„'];
                dailyRecommendationsElement.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            }
            
            return currentSeason;
        }
        
        function calculateSeasonProgress(currentMonth, currentDay, startMonth, endMonth) {
            const totalDays = (endMonth - startMonth + 1) * 30; // PrzybliÅ¼enie
            const currentDays = (currentMonth - startMonth) * 30 + currentDay;
            return Math.min(Math.round((currentDays / totalDays) * 100), 100);
        }
        
        function getSeasonIconClass(element) {
            const iconClasses = {
                'Drewno': 'fas fa-leaf',
                'OgieÅ„': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return iconClasses[element] || 'fas fa-leaf';
        }

        // Authentication System
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userName = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (isLoggedIn) {
                showMainApp();
                updateUserName(userName);
                
                if (userRole === 'admin') {
                    showAdminFeatures();
                } else {
                    hideAdminFeatures();
                }
            } else {
                showLoginScreen();
            }
        }

        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Show loading
            const submitBtn = document.querySelector('#loginForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logowanie...';
            submitBtn.disabled = true;
            
            try {
                // Try real API login first
                const response = await realLogin(email, password);
                
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userName', response.user.email);
                localStorage.setItem('userEmail', response.user.email);
                localStorage.setItem('userRole', response.user.role);
                
                addSystemLog('SUCCESS', 'AUTH', 'Zalogowano przez Railway API', `Email: ${email}, Role: ${response.user.role}`);
                showNotification(`âœ… Zalogowano przez Railway! ${response.user.role === 'admin' ? 'ðŸ‘‘' : 'ðŸŽ‰'}`);
                
                setTimeout(() => {
                    showMainApp();
                    updateUserName(response.user.email);
                    if (response.user.role === 'admin') {
                        showAdminFeatures();
                    } else {
                        hideAdminFeatures();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Railway login failed:', error);
                
                // Only Railway API authentication - no demo fallback
                addSystemLog('WARNING', 'AUTH', 'Nieudana prÃ³ba logowania', `Email: ${email}, Error: ${error.message}`);
                showNotification('âŒ BÅ‚Ä…d poÅ‚Ä…czenia z serwerem lub nieprawidÅ‚owe dane', 'error');
            } finally {
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function register(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            // Simple registration simulation
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userName', name);
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userRole', 'user');
            
            addSystemLog('SUCCESS', 'AUTH', 'Nowe konto zostaÅ‚o utworzone', `UÅ¼ytkownik: ${name}, Email: ${email}`);
            showNotification('Konto zostaÅ‚o utworzone! ðŸŽ‰');
            
            setTimeout(() => {
                showMainApp();
                updateUserName(name);
                hideAdminFeatures();
            }, 1000);
        }

        // Real-time Health Metrics System
        let healthMetrics = {
            qi: 85,
            balance: 92,
            energy: 78
        };

        // Load saved metrics or set defaults
        function loadHealthMetrics() {
            const saved = localStorage.getItem('healthMetrics');
            if (saved) {
                healthMetrics = { ...healthMetrics, ...JSON.parse(saved) };
            }
            updateMetricDisplays();
        }

        // Save metrics to localStorage
        function saveHealthMetrics() {
            localStorage.setItem('healthMetrics', JSON.stringify(healthMetrics));
        }

        // Update metric displays in real-time
        function updateMetricDisplays() {
            document.getElementById('qiLevel').textContent = Math.round(healthMetrics.qi);
            document.getElementById('balanceLevel').textContent = Math.round(healthMetrics.balance);
            document.getElementById('energyLevel').textContent = Math.round(healthMetrics.energy);
            
            // Add visual effects for changes
            animateMetricChange('qiLevel');
            animateMetricChange('balanceLevel');
            animateMetricChange('energyLevel');
        }

        // Animate metric changes
        function animateMetricChange(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                element.style.fontWeight = 'bold';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = '';
                    element.style.fontWeight = '';
                }, 600);
            }
        }

        // Increase metrics based on activities
        function increaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi + qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance + balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy + energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('SUCCESS', 'USER', `Wzrost wskaÅºnikÃ³w zdrowia: ${reason}`, 
                    `Qi: ${oldQi}â†’${Math.round(healthMetrics.qi)}, RÃ³wnowaga: ${oldBalance}â†’${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}â†’${Math.round(healthMetrics.energy)}`);
                
                showNotification(`ðŸ“ˆ Wzrost zdrowia! ${reason}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Decrease metrics (stress, fatigue, etc.)
        function decreaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply negative changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi - qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance - balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy - energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('WARNING', 'USER', `Spadek wskaÅºnikÃ³w zdrowia: ${reason}`, 
                    `Qi: ${oldQi}â†’${Math.round(healthMetrics.qi)}, RÃ³wnowaga: ${oldBalance}â†’${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}â†’${Math.round(healthMetrics.energy)}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Daily natural fluctuations (simulate realistic changes)
        function simulateDailyFluctuations() {
            const currentHour = new Date().getHours();
            
            // Morning boost (6-10 AM)
            if (currentHour >= 6 && currentHour <= 10) {
                increaseMetrics(1, 0, 2, 'Poranny zastrzyk energii');
            }
            // Afternoon dip (13-15)
            else if (currentHour >= 13 && currentHour <= 15) {
                decreaseMetrics(0, 0, 1, 'PopoÅ‚udniowe zmÄ™czenie');
            }
            // Evening rebalance (18-20)
            else if (currentHour >= 18 && currentHour <= 20) {
                increaseMetrics(0, 1, 0, 'Wieczorna rÃ³wnowaga');
            }
            // Night energy drop (22-24)
            else if (currentHour >= 22) {
                decreaseMetrics(0, 0, 2, 'Naturalne zmÄ™czenie');
            }
        }

        // Reset metrics (for testing or new day)
        function resetHealthMetrics() {
            healthMetrics = { qi: 85, balance: 92, energy: 78 };
            saveHealthMetrics();
            updateMetricDisplays();
            addSystemLog('INFO', 'SYSTEM', 'WskaÅºniki zdrowia zostaÅ‚y zresetowane');
            showNotification('ðŸ”„ WskaÅºniki zdrowia zostaÅ‚y zresetowane!');
        }

        // Weekly Progress Functions
        let weeklyProgress = {
            practiceDays: 0,
            totalMinutes: 0,
            recipesUsed: 0,
            lastPracticeDate: null,
            practicesThisWeek: [],
            recipesThisWeek: [],
            weekStart: getWeekStart()
        };

        function getWeekStart() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Monday start
            const monday = new Date(now.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function loadWeeklyProgress() {
            const saved = localStorage.getItem('weeklyProgress');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Check if it's a new week
                const currentWeekStart = getWeekStart();
                const savedWeekStart = new Date(data.weekStart);
                
                if (currentWeekStart.getTime() !== savedWeekStart.getTime()) {
                    // New week - reset progress
                    resetWeeklyProgress();
                } else {
                    // Same week - load saved data
                    weeklyProgress = {
                        ...data,
                        weekStart: currentWeekStart,
                        practicesThisWeek: data.practicesThisWeek || [],
                        recipesThisWeek: data.recipesThisWeek || []
                    };
                }
            } else {
                // First time - initialize
                resetWeeklyProgress();
            }
            
            updateWeeklyDisplay();
        }

        function resetWeeklyProgress() {
            weeklyProgress = {
                practiceDays: 0,
                totalMinutes: 0,
                recipesUsed: 0,
                lastPracticeDate: null,
                practicesThisWeek: [],
                recipesThisWeek: [],
                weekStart: getWeekStart()
            };
            saveWeeklyProgress();
        }

        function saveWeeklyProgress() {
            localStorage.setItem('weeklyProgress', JSON.stringify(weeklyProgress));
        }

        function updateWeeklyDisplay() {
            document.getElementById('weeklyPracticeDays').textContent = weeklyProgress.practiceDays;
            document.getElementById('weeklyMinutes').textContent = weeklyProgress.totalMinutes;
            document.getElementById('weeklyRecipes').textContent = weeklyProgress.recipesUsed;
            
            // Add animation effect
            animateMetricUpdate('weeklyPracticeDays');
            animateMetricUpdate('weeklyMinutes');
            animateMetricUpdate('weeklyRecipes');
        }

        function animateMetricUpdate(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = 'white';
                }, 300);
            }
        }

        function addPracticeToWeekly(practiceTitle, durationMinutes) {
            const today = new Date().toDateString();
            
            // Check if we already practiced today
            if (!weeklyProgress.practicesThisWeek.includes(today)) {
                weeklyProgress.practiceDays++;
                weeklyProgress.practicesThisWeek.push(today);
            }
            
            weeklyProgress.totalMinutes += durationMinutes;
            weeklyProgress.lastPracticeDate = today;
            
            saveWeeklyProgress();
            updateWeeklyDisplay();
            
            // Log the activity
            addSystemLog('SUCCESS', 'WEEKLY', `Dodano praktykÄ™ do tygodniowego postÄ™pu`, `${practiceTitle} - ${durationMinutes} min`);
        }

        function addRecipeToWeekly(recipeName) {
            if (!weeklyProgress.recipesThisWeek.includes(recipeName)) {
                weeklyProgress.recipesUsed++;
                weeklyProgress.recipesThisWeek.push(recipeName);
                
                saveWeeklyProgress();
                updateWeeklyDisplay();
                
                // Log the activity
                addSystemLog('SUCCESS', 'WEEKLY', `Dodano przepis do tygodniowego postÄ™pu`, recipeName);
                
                showNotification(`ðŸ“Š +1 Przepis do tygodniowego postÄ™pu!`);
            }
        }

        function getWeeklyStats() {
            return {
                practiceDays: weeklyProgress.practiceDays,
                totalMinutes: weeklyProgress.totalMinutes,
                recipesUsed: weeklyProgress.recipesUsed,
                averageMinutesPerDay: weeklyProgress.practiceDays > 0 ? Math.round(weeklyProgress.totalMinutes / weeklyProgress.practiceDays) : 0,
                weekProgress: Math.round((weeklyProgress.practiceDays / 7) * 100)
            };
        }

        // Wellness Practice Functions
        let currentPractice = '';
        
        const practiceData = {
            akupresura: {
                title: 'Akupresura TCM',
                icon: 'fas fa-spa',
                description: 'Akupresura to staroÅ¼ytna technika ucisku okreÅ›lonych punktÃ³w na ciele w celu przywrÃ³cenia rÃ³wnowagi energetycznej.',
                benefits: [
                    'ðŸŽ¯ Zmniejsza napiÄ™cie i stres',
                    'ðŸ’† Åagodzi bÃ³le gÅ‚owy i migrenÄ™',
                    'âš¡ ZwiÄ™ksza przepÅ‚yw energii Qi',
                    'ðŸ˜Œ Poprawia samopoczucie',
                    'ðŸ›¡ï¸ Wzmacnia odpornoÅ›Ä‡'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie',
                        description: 'ZnajdÅº spokojne miejsce. Umyj rÄ™ce i rozgrzej dÅ‚onie tarcie nimi o siebie.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Punkt Yintang (Trzecie Oko)',
                        description: 'UmieÅ›Ä‡ kciuk miÄ™dzy brwiami. Delikatnie uciskaj przez 30 sekund, oddychajÄ…c spokojnie.',
                        duration: '30 sek'
                    },
                    {
                        step: 3,
                        title: 'Punkt Baihui (Czubek GÅ‚owy)',
                        description: 'ZnajdÅº punkt na Å›rodku czubka gÅ‚owy. Uciskaj delikatnie palcem wskazujÄ…cym.',
                        duration: '30 sek'
                    },
                    {
                        step: 4,
                        title: 'Punkty Taiyang (Skronie)',
                        description: 'UmieÅ›Ä‡ oba kciuki na skroniach. Masuj okrÄ™Å¼nymi ruchami w kierunku zgodnym z ruchem wskazÃ³wek zegara.',
                        duration: '1 min'
                    },
                    {
                        step: 5,
                        title: 'Punkt Hegu (DÅ‚oÅ„)',
                        description: 'ZnajdÅº punkt miÄ™dzy kciukiem a palcem wskazujÄ…cym. Uciskaj przez 30 sekund na kaÅ¼dej dÅ‚oni.',
                        duration: '1 min'
                    }
                ],
                totalDuration: '5 minut'
            },
            qigong: {
                title: 'Qigong - Ruch Energii',
                icon: 'fas fa-dumbbell',
                description: 'Qigong Å‚Ä…czy powolne ruchy, oddychanie i medytacjÄ™ w celu harmonizacji przepÅ‚ywu energii Qi.',
                benefits: [
                    'ðŸŒŠ Harmonizuje przepÅ‚yw energii Qi',
                    'ðŸ§˜ Uspokaja umysÅ‚ i ciaÅ‚o',
                    'ðŸ’ª Wzmacnia miÄ™Å›nie i elastycznoÅ›Ä‡',
                    'ðŸ« Poprawia funkcje ukÅ‚adu oddechowego',
                    'âš–ï¸ Przywraca rÃ³wnowagÄ™ energetycznÄ…'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa Podstawowa',
                        description: 'StaÅ„ prosto, stopy na szerokoÅ›Ä‡ ramion. Kolana lekko ugiÄ™te, ramiona swobodnie opuszczone.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Podnoszenie Nieba',
                        description: 'Powoli podnieÅ› rÄ™ce nad gÅ‚owÄ™, wdychajÄ…c. OpuÅ›Ä‡ rÄ™ce, wydychajÄ…c. WyobraÅº sobie, Å¼e trzymasz energiÄ™.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Obejmowanie Drzewa',
                        description: 'Ramiona okrÄ…gle przed sobÄ…, jakbyÅ› obejmowaÅ‚ duÅ¼e drzewo. Oddychaj spokojnie przez 2 minuty.',
                        duration: '2 min'
                    },
                    {
                        step: 4,
                        title: 'KoÅ‚ysanie Qi',
                        description: 'Delikatnie koÅ‚ysz siÄ™ z boku na bok, pozwalajÄ…c energii swobodnie pÅ‚ynÄ…Ä‡ przez ciaÅ‚o.',
                        duration: '2 min'
                    },
                    {
                        step: 5,
                        title: 'ZakoÅ„czenie',
                        description: 'PoÅ‚Ã³Å¼ dÅ‚onie na brzuchu. ZrÃ³b 3 gÅ‚Ä™bokie oddechy, koncentrujÄ…c siÄ™ na centrum energii.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '10 minut'
            },
            medytacja: {
                title: 'Medytacja TCM',
                icon: 'fas fa-brain',
                description: 'Medytacja wedÅ‚ug tradycji chiÅ„skiej koncentruje siÄ™ na uspokojeniu umysÅ‚u i harmonizacji energii.',
                benefits: [
                    'ðŸ§  Uspokaja umysÅ‚ i myÅ›li',
                    'â¤ï¸ ObniÅ¼a ciÅ›nienie krwi',
                    'ðŸ˜Œ Redukuje stres i niepokÃ³j',
                    'ðŸ”„ Przywraca rÃ³wnowagÄ™ Yin-Yang',
                    'âœ¨ ZwiÄ™ksza Å›wiadomoÅ›Ä‡'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie Miejsca',
                        description: 'ZnajdÅº ciche miejsce. UsiÄ…dÅº wygodnie z prostymi plecami, nogi skrzyÅ¼owane lub na krzeÅ›le.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Skupienie na Oddechu',
                        description: 'Zamknij oczy. Skup siÄ™ na naturalnym rytmie oddechu. Nie zmieniaj go, tylko obserwuj.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Medytacja Dantian',
                        description: 'Skieruj uwagÄ™ na punkt 5cm poniÅ¼ej pÄ™pka. To centrum energii. Oddychaj do tego punktu.',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'UÅ›miech WewnÄ™trzny',
                        description: 'WyÅ›lij ciepÅ‚y uÅ›miech do swojego serca, nastÄ™pnie do wszystkich organÃ³w. Poczuj wdziÄ™cznoÅ›Ä‡.',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'PowrÃ³t do ÅšwiadomoÅ›ci',
                        description: 'Powoli porusz palcami i stopami. OtwÃ³rz oczy i przez chwilÄ™ pozostaÅ„ w ciszy.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '15 minut'
            },
            oddychanie: {
                title: 'Oddychanie Terapeutyczne',
                icon: 'fas fa-lungs',
                description: 'Kontrolowane oddychanie wedÅ‚ug TCM oczyszcza energiÄ™ i wzmacnia Å¼yciowÄ… siÅ‚Ä™.',
                benefits: [
                    'ðŸ« Wzmacnia pÅ‚uca i ukÅ‚ad oddechowy',
                    'âš¡ ZwiÄ™ksza poziom energii Å¼yciowej',
                    'ðŸ§˜ Uspokaja system nerwowy',
                    'ðŸ”„ Oczyszcza toksyny z organizmu',
                    'ðŸ’¤ Poprawia jakoÅ›Ä‡ snu'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa i Przygotowanie',
                        description: 'UsiÄ…dÅº wygodnie z prostymi plecami. Jedna rÄ™ka na piersi, druga na brzuchu.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Oddech Brzuszny',
                        description: 'Wdech przez nos - brzuch podnosi siÄ™, klatka piersiowa nieruchoma. Wydech przez usta - brzuch opada.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Rytm 4-7-8',
                        description: 'Wdech przez nos (4 sekundy), zatrzymaj oddech (7 sekund), wydech przez usta (8 sekund).',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'OczyszczajÄ…cy Oddech',
                        description: 'GÅ‚Ä™boki wdech przez nos, zatrzymaj na 3 sekundy, silny wydech przez usta ze Å›wistem "Ahhhh".',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'Harmonizacja',
                        description: 'PowrÃ³t do naturalnego rytmu oddechu. Poczuj jak energia krÄ…Å¼y swobodnie po ciele.',
                        duration: '3 min'
                    }
                ],
                totalDuration: '15 minut'
            }
        };

        function showWellnessPractice(practiceType) {
            // SprawdÅº czy DOM jest gotowy
            if (document.readyState !== 'complete') {
                setTimeout(() => showWellnessPractice(practiceType), 100);
                return;
            }
            
            currentPractice = practiceType;
            const practice = practiceData[practiceType];
            
            if (!practice) {
                showNotification('âŒ BÅ‚Ä…d: Nie znaleziono danych praktyki');
                return;
            }
            
            // Poczekaj chwilÄ™ przed szukaniem elementÃ³w (fix dla timing issues)
            setTimeout(() => {
                const modal = document.getElementById('wellnessPracticeModal');
                const title = document.getElementById('practiceTitle');
                const icon = document.getElementById('practiceIcon');
                const content = document.getElementById('practiceContent');
                
                if (!modal) {
                    showNotification('âŒ BÅ‚Ä…d: Modal nie zostaÅ‚ znaleziony');
                    return;
                }
                
                if (!title || !icon || !content) {
                    // Fallback: sprÃ³buj znaleÅºÄ‡ elementy bezpoÅ›rednio w modalu
                    const titleInModal = modal.querySelector('#practiceTitle') || modal.querySelector('h3');
                    const iconInModal = modal.querySelector('#practiceIcon') || modal.querySelector('i');
                    const contentInModal = modal.querySelector('#practiceContent') || modal.querySelector('div[id*="Content"]');
                    
                    if (!titleInModal || !iconInModal || !contentInModal) {
                        showNotification('âŒ BÅ‚Ä…d modalu. SprÃ³buj odÅ›wieÅ¼yÄ‡ stronÄ™ (F5)');
                        return;
                    }
                    
                    showWellnessPracticeModal(practice, modal, titleInModal, iconInModal, contentInModal);
                } else {
                    showWellnessPracticeModal(practice, modal, title, icon, content);
                }
            }, 50);
        }
        
        function showWellnessPracticeModal(practice, modal, title, icon, content) {
            
            // Update title and icon
            title.innerHTML = `<i class="${practice.icon}" style="margin-right: 10px; color: #4CAF50;"></i>${practice.title}`;
            if (icon.tagName === 'I') {
                icon.className = practice.icon;
            }
            
            // Generate content
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="color: rgba(255,255,255,0.9); font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                        ${practice.description}
                    </p>
                    
                    <div style="background: rgba(76, 175, 80, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                            âœ¨ KorzyÅ›ci:
                        </h4>
                        <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                            ${practice.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: #4CAF50; margin: 0; font-size: 16px;">
                                ðŸ“‹ Instrukcje krok po kroku:
                            </h4>
                            <div style="background: rgba(76, 175, 80, 0.3); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                â±ï¸ ${practice.totalDuration}
                            </div>
                        </div>
                        
                        ${practice.instructions.map((instruction, index) => `
                            <div style="border-left: 3px solid #4CAF50; padding-left: 15px; margin-bottom: 15px; position: relative;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h5 style="color: white; margin: 0; font-size: 14px;">
                                        <span style="background: #4CAF50; color: white; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 12px;">${instruction.step}</span>
                                        ${instruction.title}
                                    </h5>
                                    <span style="background: rgba(255,255,255,0.2); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">
                                        ${instruction.duration}
                                    </span>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 13px; line-height: 1.5; margin: 0;">
                                    ${instruction.description}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 15px;">
                        <div style="color: #FFC107; font-size: 14px; font-weight: 600; margin-bottom: 8px;">
                            ðŸ’¡ WskazÃ³wka:
                        </div>
                        <p style="color: rgba(255,255,255,0.9); font-size: 13px; line-height: 1.5; margin: 0;">
                            Praktykuj regularnie, najlepiej codziennie o tej samej porze. SÅ‚uchaj swojego ciaÅ‚a i nie wymuszaj ruchÃ³w. KaÅ¼da praktyka to krok ku lepszemu zdrowiu!
                        </p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Log practice view
            addSystemLog('INFO', 'USER', `WyÅ›wietlono praktykÄ™ zdrowotnÄ…: ${practice.title}`);
        }

        function closeWellnessPractice() {
            const modal = document.getElementById('wellnessPracticeModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function startPracticeSession() {
            const practice = practiceData[currentPractice];
            
            // Increase health metrics for starting practice
            increaseMetrics(2, 3, 1, `RozpoczÄ™cie praktyki: ${practice.title}`);
            
            // Add to weekly progress immediately (start tracking)
            const durationMinutes = parseDuration(practice.totalDuration) / (60 * 1000); // Convert to minutes
            addPracticeToWeekly(practice.title, durationMinutes);
            
            // Log practice start
            addSystemLog('SUCCESS', 'USER', `RozpoczÄ™to sesjÄ™ praktyki: ${practice.title}`, `Czas trwania: ${practice.totalDuration}`);
            
            showNotification(`ðŸ§˜ RozpoczÄ™to praktykÄ™: ${practice.title}! Powodzenia!`);
            closeWellnessPractice();
            
            // Set timer for practice completion
            const duration = parseDuration(practice.totalDuration);
            setTimeout(() => {
                completePracticeSession(practice.title);
            }, duration);
        }

        function completePracticeSession(practiceTitle) {
            // Additional health boost for completing practice
            increaseMetrics(3, 5, 4, `UkoÅ„czenie praktyki: ${practiceTitle}`);
            
            // Log practice completion
            addSystemLog('SUCCESS', 'USER', `UkoÅ„czono praktykÄ™ zdrowotnÄ…: ${practiceTitle}`);
            
            showNotification(`âœ¨ Gratulacje! UkoÅ„czyÅ‚eÅ› praktykÄ™: ${practiceTitle}`);
        }

        function parseDuration(durationStr) {
            // Convert duration string like "15 minut" to milliseconds
            const minutes = parseInt(durationStr.match(/\d+/)[0]);
            return minutes * 60 * 1000; // Convert to milliseconds
        }

        // Element Test Functions
        let currentQuestion = 0;
        let testAnswers = [];
        
        const elementQuestions = [
            {
                question: "Jak czujesz siÄ™ pod wzglÄ™dem temperatury ciaÅ‚a?",
                icon: "fas fa-thermometer-half",
                answers: [
                    { text: "CzÄ™sto jest mi zimno, marznÄ… mi rÄ™ce i stopy", element: "Woda", points: 3 },
                    { text: "Czasami jest mi zimno, lubiÄ™ ciepÅ‚e napoje", element: "Metal", points: 2 },
                    { text: "CzujÄ™ siÄ™ komfortowo w wiÄ™kszoÅ›ci temperatur", element: "Ziemia", points: 1 },
                    { text: "CzÄ™sto jest mi ciepÅ‚o, lubiÄ™ chÅ‚odne miejsca", element: "OgieÅ„", points: 2 },
                    { text: "Szybko siÄ™ rozgrzewam, czÄ™sto mam gorÄ…ce dÅ‚onie", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jak wyglÄ…da Twoja energia w ciÄ…gu dnia?",
                icon: "fas fa-battery-half",
                answers: [
                    { text: "Rano jestem powolny/a, najlepiej czujÄ™ siÄ™ wieczorem", element: "Woda", points: 3 },
                    { text: "PotrzebujÄ™ czasu na rozruch, ale potem jestem wydajny/a", element: "Metal", points: 2 },
                    { text: "Moja energia jest stabilna przez caÅ‚y dzieÅ„", element: "Ziemia", points: 3 },
                    { text: "Jestem bardzo energiczny/a rano i w poÅ‚udnie", element: "OgieÅ„", points: 3 },
                    { text: "Mam duÅ¼o energii rano, potem szybko siÄ™ mÄ™czÄ™", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak reagujesz na stres?",
                icon: "fas fa-brain",
                answers: [
                    { text: "WycofujÄ™ siÄ™, potrzebujÄ™ spokoju i samotnoÅ›ci", element: "Woda", points: 3 },
                    { text: "StajÄ™ siÄ™ smutny/a i pesymistyczny/a", element: "Metal", points: 3 },
                    { text: "PrzejmujÄ™ siÄ™ nadmiernie wszystkim", element: "Ziemia", points: 3 },
                    { text: "StajÄ™ siÄ™ podenerwowany/a i mÃ³wiÄ™ za duÅ¼o", element: "OgieÅ„", points: 3 },
                    { text: "DenerwujÄ™ siÄ™ i mogÄ™ wybuchnÄ…Ä‡ gniewem", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jakie masz preferencje Å¼ywieniowe?",
                icon: "fas fa-utensils",
                answers: [
                    { text: "LubiÄ™ ciepÅ‚e, gotowane potrawy i zupy", element: "Woda", points: 2 },
                    { text: "PreferujÄ™ proste, lekko pikantne jedzenie", element: "Metal", points: 2 },
                    { text: "LubiÄ™ sÅ‚odkie smaki i regularne posiÅ‚ki", element: "Ziemia", points: 3 },
                    { text: "Uwielbiam rÃ³Å¼norodnoÅ›Ä‡ smakÃ³w, czÄ™sto pomijam posiÅ‚ki", element: "OgieÅ„", points: 2 },
                    { text: "LubiÄ™ kwaÅ›ne smaki i Å›wieÅ¼e produkty", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jaki jest TwÃ³j sen?",
                icon: "fas fa-bed",
                answers: [
                    { text: "ÅšpiÄ™ duÅ¼o, ale czÄ™sto jestem zmÄ™czony/a", element: "Woda", points: 3 },
                    { text: "BudzÄ™ siÄ™ wczeÅ›nie rano, ale czasami mam problemy z zasypianiem", element: "Metal", points: 2 },
                    { text: "ÅšpiÄ™ regularnie 7-8 godzin, rzadko mam problemy", element: "Ziemia", points: 3 },
                    { text: "ÅšpiÄ™ maÅ‚o, ale czujÄ™ siÄ™ wypoczÄ™ty/a", element: "OgieÅ„", points: 2 },
                    { text: "Sen bywa niespokojny, czÄ™sto siÄ™ budzÄ™", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak wyglÄ…dajÄ… Twoje emocje?",
                icon: "fas fa-heart",
                answers: [
                    { text: "Jestem spokojny/a, ale czasami odczuwam lÄ™k", element: "Woda", points: 3 },
                    { text: "PotrafiÄ™ byÄ‡ melancholijny/a, czasami smutny/a", element: "Metal", points: 3 },
                    { text: "Jestem zrÃ³wnowaÅ¼ony/a, ale czasami siÄ™ martwiÄ™", element: "Ziemia", points: 3 },
                    { text: "Jestem radosny/a i towarzyski/a, ale czasami nadpobudliwy/a", element: "OgieÅ„", points: 3 },
                    { text: "Jestem energiczny/a, ale czasami wybuchowy/a", element: "Drewno", points: 3 }
                ]
            }
        ];

        function startElementTest() {
            currentQuestion = 0;
            testAnswers = [];
            
            const modal = document.getElementById('elementTestModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            showQuestion();
            
            // Log test start
            addSystemLog('INFO', 'USER', 'RozpoczÄ™to test Å¼ywioÅ‚u TCM');
        }

        function closeElementTest() {
            const modal = document.getElementById('elementTestModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function showQuestion() {
            const testContent = document.getElementById('testContent');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const testResult = document.getElementById('testResult');
            
            testResult.style.display = 'none';
            testContent.style.display = 'block';
            
            if (currentQuestion < elementQuestions.length) {
                const question = elementQuestions[currentQuestion];
                
                testContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="background: rgba(76, 175, 80, 0.2); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="${question.icon}" style="font-size: 24px; color: #4CAF50;"></i>
                        </div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 5px;">
                            Pytanie ${currentQuestion + 1} z ${elementQuestions.length}
                        </div>
                        <h4 style="color: white; margin: 0; font-size: 18px; line-height: 1.4;">
                            ${question.question}
                        </h4>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${question.answers.map((answer, index) => `
                            <label style="
                                display: flex;
                                align-items: center;
                                padding: 15px;
                                border: 1px solid rgba(255,255,255,0.3);
                                border-radius: 12px;
                                background: rgba(255,255,255,0.05);
                                cursor: pointer;
                                transition: all 0.3s ease;
                                position: relative;
                            " onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                <input type="radio" name="answer" value="${index}" style="margin-right: 12px; transform: scale(1.2);">
                                <span style="color: white; font-size: 14px; line-height: 1.4; flex: 1;">${answer.text}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                
                // Show/hide navigation buttons
                prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
                nextBtn.textContent = currentQuestion === elementQuestions.length - 1 ? 'PokaÅ¼ wyniki' : 'NastÄ™pne';
                nextBtn.innerHTML = currentQuestion === elementQuestions.length - 1 ? 
                    '<i class="fas fa-trophy" style="margin-right: 8px;"></i>PokaÅ¼ wyniki' :
                    'NastÄ™pne<i class="fas fa-arrow-right" style="margin-left: 8px;"></i>';
                
            } else {
                showTestResults();
            }
        }

        function nextQuestion() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedAnswer) {
                showNotification('âŒ ProszÄ™ wybraÄ‡ odpowiedÅº!');
                return;
            }
            
            const answerIndex = parseInt(selectedAnswer.value);
            const answer = elementQuestions[currentQuestion].answers[answerIndex];
            
            testAnswers.push({
                question: currentQuestion,
                answer: answer
            });
            
            currentQuestion++;
            
            if (currentQuestion < elementQuestions.length) {
                showQuestion();
            } else {
                showTestResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                testAnswers.pop(); // Remove last answer
                showQuestion();
            }
        }

        function showTestResults() {
            const testContent = document.getElementById('testContent');
            const testResult = document.getElementById('testResult');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            
            testContent.style.display = 'none';
            testResult.style.display = 'block';
            nextBtn.style.display = 'none';
            prevBtn.style.display = 'none';
            
            // Calculate element scores
            const scores = {
                'Drewno': 0,
                'OgieÅ„': 0,
                'Ziemia': 0,
                'Metal': 0,
                'Woda': 0
            };
            
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            
            // Find dominant element
            const dominantElement = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            const elementData = getElementDetails(dominantElement);
            
            testResult.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="background: ${elementData.gradient}; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <div style="font-size: 32px;">${elementData.icon}</div>
                    </div>
                    <h3 style="color: white; margin: 0 0 10px 0; font-size: 24px;">
                        TwÃ³j dominujÄ…cy Å¼ywioÅ‚: ${dominantElement}
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); font-size: 16px; margin: 0;">
                        ${elementData.description}
                    </p>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        ðŸŽ¯ Zalecenia dla Ciebie:
                    </h4>
                    <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                        ${elementData.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        ðŸ“Š Twoje wyniki:
                    </h4>
                    ${Object.entries(scores).map(([element, score]) => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: rgba(255,255,255,0.9);">${element}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 100px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${(score / Math.max(...Object.values(scores))) * 100}%; height: 100%; background: ${element === dominantElement ? '#4CAF50' : 'rgba(255,255,255,0.4)'}; transition: width 0.3s ease;"></div>
                                </div>
                                <span style="color: white; font-weight: 600; min-width: 20px;">${score}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button onclick="restartTest()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                        <i class="fas fa-redo" style="margin-right: 8px;"></i>
                        PowtÃ³rz test
                    </button>
                    <button onclick="saveTestResults('${dominantElement}')" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-save" style="margin-right: 8px;"></i>
                        Zapisz wyniki
                    </button>
                </div>
            `;
            
            // Log test completion
            addSystemLog('SUCCESS', 'USER', 'UkoÅ„czono test Å¼ywioÅ‚u TCM', `DominujÄ…cy Å¼ywioÅ‚: ${dominantElement}`);
        }

        function getElementDetails(element) {
            const details = {
                'Drewno': {
                    icon: 'ðŸŒ±',
                    gradient: 'linear-gradient(135deg, #4CAF50, #66BB6A)',
                    description: 'JesteÅ› peÅ‚en/a energii i ambicji. Twoja konstytucja jest elastyczna i dynamiczna jak mÅ‚ode drzewo.',
                    recommendations: [
                        'ðŸŒ¿ Jedz zielone warzywa liÅ›ciaste i kieÅ‚ki',
                        'ðŸ§˜ Praktykuj Ä‡wiczenia rozciÄ…gajÄ…ce i joga',
                        'ðŸ˜Œ ZarzÄ…dzaj stresem i gniewem przez medytacjÄ™',
                        'ðŸŒ… Wstawaj wczeÅ›nie rano (5:00-7:00)',
                        'ðŸ‹ Dodaj kwaÅ›ne smaki do diety (cytryna, ocet)'
                    ]
                },
                'OgieÅ„': {
                    icon: 'ðŸ”¥',
                    gradient: 'linear-gradient(135deg, #F44336, #FF5722)',
                    description: 'JesteÅ› radosny/a i towarzyski/a. Twoja energia emanuje ciepÅ‚em i komunikatywnoÅ›ciÄ….',
                    recommendations: [
                        'ðŸ‰ Jedz chÅ‚odzÄ…ce owoce (arbuz, melon)',
                        'ðŸŠ Unikaj nadmiernego wysiÅ‚ku w upaÅ‚',
                        'ðŸ§˜ Praktykuj uspokajajÄ…cÄ… medytacjÄ™',
                        'â˜€ï¸ Najlepszy czas aktywnoÅ›ci: 11:00-13:00',
                        'ðŸƒ Pij zielone i biaÅ‚e herbaty'
                    ]
                },
                'Ziemia': {
                    icon: 'ðŸŒ¾',
                    gradient: 'linear-gradient(135deg, #FFC107, #FF9800)',
                    description: 'JesteÅ› stabilny/a i zrÃ³wnowaÅ¼ony/a. Twoja konstytucja jest fundamentem dla innych.',
                    recommendations: [
                        'ðŸ¥• Jedz sÅ‚odkie warzywa (marchew, dynia)',
                        'ðŸš WÅ‚Ä…cz ziarna zbÃ³Å¼ do diety',
                        'âš–ï¸ Jedz regularne posiÅ‚ki o staÅ‚ych porach',
                        'ðŸ§˜ Praktykuj medytacjÄ™ siedzÄ…cÄ…',
                        'ðŸ¯ Umiarkowanie w sÅ‚odkich smakach'
                    ]
                },
                'Metal': {
                    icon: 'ðŸ‚',
                    gradient: 'linear-gradient(135deg, #9E9E9E, #607D8B)',
                    description: 'JesteÅ› precyzyjny/a i refleksyjny/a. Twoja konstytucja ceni porzÄ…dek i strukturÄ™.',
                    recommendations: [
                        'ðŸ Jedz biaÅ‚e produkty (gruszki, rzodkiew)',
                        'ðŸ« Praktykuj Ä‡wiczenia oddechowe',
                        'ðŸŒ… Najlepszy czas aktywnoÅ›ci: 5:00-7:00 rano',
                        'ðŸŒ¶ï¸ Dodaj Å‚agodnie ostre smaki',
                        'ðŸ’§ Unikaj suchoÅ›ci - nawilÅ¼aj powietrze'
                    ]
                },
                'Woda': {
                    icon: 'â„ï¸',
                    gradient: 'linear-gradient(135deg, #2196F3, #03A9F4)',
                    description: 'JesteÅ› spokojny/a i mÄ…dry/a. Twoja konstytucja jest gÅ‚Ä™boka jak spokojne wody.',
                    recommendations: [
                        'ðŸ¥² Jedz ciepÅ‚e, gotowane potrawy',
                        'â˜• Pij ciepÅ‚e napoje i herbaty',
                        'ðŸ›ï¸ Dbaj o odpowiedni sen (8-9 godzin)',
                        'ðŸŒ™ Najlepszy czas aktywnoÅ›ci: wieczorem',
                        'ðŸ§‚ Dodaj sÅ‚one smaki w umiarkowanych iloÅ›ciach'
                    ]
                }
            };
            
            return details[element];
        }

        function restartTest() {
            startElementTest();
        }

        function saveTestResults(dominantElement) {
            const testResult = {
                date: new Date().toISOString(),
                dominantElement: dominantElement,
                allScores: {},
                answers: testAnswers
            };
            
            // Calculate scores for saving
            const scores = { 'Drewno': 0, 'OgieÅ„': 0, 'Ziemia': 0, 'Metal': 0, 'Woda': 0 };
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            testResult.allScores = scores;
            
            // Save to localStorage
            const savedResults = JSON.parse(localStorage.getItem('elementTestResults') || '[]');
            savedResults.unshift(testResult);
            localStorage.setItem('elementTestResults', JSON.stringify(savedResults.slice(0, 10))); // Keep last 10 results
            
            // Save current dominant element
            localStorage.setItem('userDominantElement', dominantElement);
            
            // Log the save
            addSystemLog('SUCCESS', 'USER', 'Zapisano wyniki testu Å¼ywioÅ‚u', `Å»ywioÅ‚: ${dominantElement}`);
            
            // Increase health metrics for completing the test
            increaseMetrics(3, 5, 2, 'UkoÅ„czenie testu Å¼ywioÅ‚u TCM');
            
            showNotification('âœ… Wyniki testu zostaÅ‚y zapisane!');
            closeElementTest();
        }

        // Profile Edit Functions
        let currentEditingProfile = 'user'; // 'user' or 'admin'

        function editUserProfile() {
            currentEditingProfile = 'user';
            openProfileEditModal();
        }

        function editAdminProfile() {
            currentEditingProfile = 'admin';
            openProfileEditModal();
        }

        function openProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            // Load current values
            if (currentEditingProfile === 'user') {
                nameInput.value = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
                emailInput.value = localStorage.getItem('userEmail') || '';
            } else {
                nameInput.value = localStorage.getItem('adminName') || 'Administrator';
                emailInput.value = localStorage.getItem('adminEmail') || '';
            }
            
            passwordInput.value = '';
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Focus on first input
            setTimeout(() => nameInput.focus(), 100);
        }

        function closeProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function saveProfileChanges() {
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            const newName = nameInput.value.trim();
            const newEmail = emailInput.value.trim();
            const newPassword = passwordInput.value.trim();

            // Validate inputs
            if (!newName) {
                showNotification('âŒ Nazwa uÅ¼ytkownika nie moÅ¼e byÄ‡ pusta!');
                return;
            }

            if (newEmail && !isValidEmail(newEmail)) {
                showNotification('âŒ WprowadÅº poprawny adres email!');
                return;
            }

            // Save changes based on profile type
            if (currentEditingProfile === 'user') {
                // Update user profile
                localStorage.setItem('userName', newName);
                if (newEmail) localStorage.setItem('userEmail', newEmail);
                if (newPassword) localStorage.setItem('userPassword', newPassword);

                // Update UI immediately
                document.getElementById('user-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'USER', 'Profil uÅ¼ytkownika zostaÅ‚ zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('âœ… Profil uÅ¼ytkownika zostaÅ‚ zaktualizowany!');
            } else {
                // Update admin profile
                localStorage.setItem('adminName', newName);
                if (newEmail) localStorage.setItem('adminEmail', newEmail);
                if (newPassword) localStorage.setItem('adminPassword', newPassword);

                // Update UI immediately
                document.getElementById('admin-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'SYSTEM', 'Profil administratora zostaÅ‚ zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('âœ… Profil administratora zostaÅ‚ zaktualizowany!');
            }

            closeProfileEditModal();
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Profile Picture Functions
        function changeProfilePicture(profileType) {
            currentEditingProfile = profileType;
            const fileInput = document.getElementById('profilePictureInput');
            
            // Reset the input to ensure onChange fires even if same file is selected
            fileInput.value = '';
            fileInput.click();
        }

        // Initialize profile picture upload handler
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('profilePictureInput');
            
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showNotification('âŒ ProszÄ™ wybraÄ‡ plik obrazu!');
                        return;
                    }
                    
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('âŒ Plik jest za duÅ¼y! Maksymalny rozmiar to 5MB.');
                        return;
                    }
                    
                    // Read file as base64
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        
                        // Save and update profile picture
                        if (currentEditingProfile === 'user') {
                            localStorage.setItem('userProfilePicture', imageData);
                            updateProfilePictureDisplay('user-profile-picture', imageData);
                            addSystemLog('INFO', 'USER', 'ZdjÄ™cie profilowe uÅ¼ytkownika zostaÅ‚o zmienione');
                            showNotification('âœ… ZdjÄ™cie profilowe zostaÅ‚o zaktualizowane!');
                        } else {
                            localStorage.setItem('adminProfilePicture', imageData);
                            updateProfilePictureDisplay('admin-profile-picture', imageData);
                            addSystemLog('INFO', 'SYSTEM', 'ZdjÄ™cie profilowe administratora zostaÅ‚o zmienione');
                            showNotification('âœ… ZdjÄ™cie profilowe administratora zostaÅ‚o zaktualizowane!');
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        });

        function updateProfilePictureDisplay(elementId, imageData) {
            const profilePictureElement = document.getElementById(elementId);
            if (profilePictureElement && imageData) {
                profilePictureElement.style.backgroundImage = `url(${imageData})`;
                profilePictureElement.style.backgroundSize = 'cover';
                profilePictureElement.style.backgroundPosition = 'center';
                profilePictureElement.innerHTML = ''; // Remove emoji/icon
            }
        }

        // Load saved profile pictures on page load
        function loadSavedProfilePictures() {
            const userPicture = localStorage.getItem('userProfilePicture');
            const adminPicture = localStorage.getItem('adminProfilePicture');
            
            if (userPicture) {
                updateProfilePictureDisplay('user-profile-picture', userPicture);
            }
            
            if (adminPicture) {
                updateProfilePictureDisplay('admin-profile-picture', adminPicture);
            }
            
            // Load saved names
            const userName = localStorage.getItem('userName');
            const adminName = localStorage.getItem('adminName');
            
            if (userName && document.getElementById('user-display-name')) {
                document.getElementById('user-display-name').textContent = userName;
            }
            
            if (adminName && document.getElementById('admin-display-name')) {
                document.getElementById('admin-display-name').textContent = adminName;
            }
        }

        function logout() {
            if (confirm('Czy na pewno chcesz siÄ™ wylogowaÄ‡?')) {
                const userName = localStorage.getItem('userName');
                const userEmail = localStorage.getItem('userEmail');
                
                addSystemLog('INFO', 'AUTH', 'UÅ¼ytkownik siÄ™ wylogowaÅ‚', `UÅ¼ytkownik: ${userName}, Email: ${userEmail}`);
                
                const mainApp = document.getElementById('mainApp');
                mainApp.classList.add('logout-animation');
                
                setTimeout(() => {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('userEmail');
                    
                    showLoginScreen();
                    showNotification('ZostaÅ‚eÅ› wylogowany');
                }, 500);
            }
        }

        function showMainApp() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            mainApp.classList.remove('logout-animation');
            mainApp.classList.add('login-animation');
        }

        function showLoginScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            mainApp.style.display = 'none';
            loginScreen.style.display = 'block';
            loginScreen.classList.add('login-animation');
        }

        function showRegister() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            registerForm.classList.add('login-animation');
        }

        function showLogin() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            loginForm.classList.add('login-animation');
        }

        function updateUserName(name) {
            const userNameElement = document.getElementById('user-display-name');
            if (userNameElement) {
                userNameElement.textContent = name;
            }
            
            // Also update localStorage
            localStorage.setItem('userName', name);
        }

        // Admin Functions
        function showAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'block';
            });
        }

        function hideAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'none';
            });
        }

        // Backup functionality
        function performBackup() {
            // Check if in offline mode
            if (offlineMode && !isOnline) {
                performOfflineBackup();
                return;
            }
            
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Create downloadable backup file
            const backupJson = JSON.stringify(backupData, null, 2);
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Backup_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Update last backup time in localStorage
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('SUCCESS', 'BACKUP', 'Backup zostaÅ‚ utworzony i pobrany', `Rozmiar backup: ${Math.round(backupJson.length / 1024)} KB`);
            
            // Show success notification
            showNotification('ðŸ’¾ Backup zostaÅ‚ utworzony i pobrany pomyÅ›lnie!');
            
            // Increase health metrics for responsible data management
            increaseMetrics(1, 2, 0, 'Odpowiedzialne zarzÄ…dzanie danymi');
            
            // Update backup time display if settings modal is open
            updateBackupDisplay();
        }

        function updateBackupDisplay() {
            const lastBackup = localStorage.getItem('lastBackupTime');
            if (lastBackup) {
                const backupTime = new Date(lastBackup);
                const now = new Date();
                const diffMinutes = Math.floor((now - backupTime) / (1000 * 60));
                
                let timeAgo = '';
                if (diffMinutes < 1) {
                    timeAgo = 'teraz';
                } else if (diffMinutes < 60) {
                    timeAgo = `${diffMinutes} min. temu`;
                } else if (diffMinutes < 1440) {
                    const hours = Math.floor(diffMinutes / 60);
                    timeAgo = `${hours} godz. temu`;
                } else {
                    const days = Math.floor(diffMinutes / 1440);
                    timeAgo = `${days} dni temu`;
                }

                // Update backup display in settings modal if exists
                const backupDisplay = document.querySelector('[data-backup-time]');
                if (backupDisplay) {
                    backupDisplay.textContent = `ðŸ”„ Ostatni backup: ${timeAgo}`;
                }
            }
        }

        // Restore functionality
        function showRestoreModal() {
            const restoreModal = document.createElement('div');
            restoreModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            restoreModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <h3 style="color: white; margin-bottom: 20px;">ðŸ“ PrzywrÃ³Ä‡ Backup</h3>
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
                        <p>Wybierz plik backup do przywrÃ³cenia:</p>
                    </div>
                    <input type="file" id="backupFileInput" accept=".json" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.3);
                        border-radius: 8px;
                        padding: 10px;
                        color: white;
                        width: 100%;
                        margin-bottom: 20px;
                    ">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="performRestore()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">PrzywrÃ³Ä‡</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(restoreModal);
            window.currentModal = restoreModal;
        }

        function performRestore() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('âŒ Wybierz plik backup do przywrÃ³cenia!');
                return;
            }

            if (!file.name.endsWith('.json')) {
                showNotification('âŒ NieprawidÅ‚owy format pliku! Wybierz plik .json');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup structure
                    if (!backupData.data || !backupData.timestamp) {
                        throw new Error('NieprawidÅ‚owa struktura pliku backup');
                    }

                    // Restore user profile data
                    if (backupData.data.userProfile) {
                        const profile = backupData.data.userProfile;
                        if (profile.userRole) localStorage.setItem('userRole', profile.userRole);
                        if (profile.preferences) localStorage.setItem('userPreferences', profile.preferences);
                        if (profile.settings) localStorage.setItem('appSettings', profile.settings);
                    }

                    // Restore session data
                    if (backupData.data.sessionData) {
                        const session = backupData.data.sessionData;
                        if (session.lastVisit) localStorage.setItem('lastVisit', session.lastVisit);
                        if (session.sessionCount) localStorage.setItem('sessionCount', session.sessionCount);
                        if (session.totalUsageTime) localStorage.setItem('totalUsageTime', session.totalUsageTime);
                    }

                    // Restore app data
                    if (backupData.data.appData) {
                        const appData = backupData.data.appData;
                        if (appData.favoriteRecipes) localStorage.setItem('favoriteRecipes', appData.favoriteRecipes);
                        if (appData.healthMetrics) localStorage.setItem('healthMetrics', appData.healthMetrics);
                        if (appData.reminders) localStorage.setItem('reminders', appData.reminders);
                        if (appData.notes) localStorage.setItem('userNotes', appData.notes);
                    }

                    // Restore wellness data
                    if (backupData.data.wellness) {
                        const wellness = backupData.data.wellness;
                        if (wellness.currentSeason) localStorage.setItem('currentSeason', wellness.currentSeason);
                        if (wellness.seasonProgress) localStorage.setItem('seasonProgress', wellness.seasonProgress);
                        if (wellness.dailyTips) localStorage.setItem('dailyTips', wellness.dailyTips);
                    }

                    // Set restore timestamp
                    localStorage.setItem('lastRestoreTime', new Date().toISOString());
                    localStorage.setItem('restoredFromBackup', backupData.timestamp);

                    // Add to system logs
                    addSystemLog('SUCCESS', 'BACKUP', 'Backup zostaÅ‚ przywrÃ³cony pomyÅ›lnie', `PrzywrÃ³cono dane z: ${backupData.timestamp}`);

                    closeModal();
                    showNotification('âœ… Backup zostaÅ‚ przywrÃ³cony pomyÅ›lnie!');
                    
                    // Refresh page to apply restored data
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);

                } catch (error) {
                    addSystemLog('ERROR', 'BACKUP', 'BÅ‚Ä…d podczas przywracania backup', error.message);
                    showNotification('âŒ BÅ‚Ä…d podczas przywracania backup: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        // System Logs functionality
        function initializeLogging() {
            // Initialize logging if not already done
            if (!localStorage.getItem('systemLogs')) {
                const initialLogs = [
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        level: 'INFO',
                        category: 'SYSTEM',
                        message: 'Aplikacja SezonoweDobro zostaÅ‚a uruchomiona',
                        details: 'Inicjalizacja systemu zakoÅ„czona pomyÅ›lnie'
                    }
                ];
                localStorage.setItem('systemLogs', JSON.stringify(initialLogs));
            }
        }

        function addSystemLog(level, category, message, details = '') {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const newLog = {
                id: logs.length + 1,
                timestamp: new Date().toISOString(),
                level: level.toUpperCase(),
                category: category.toUpperCase(),
                message: message,
                details: details
            };
            
            logs.unshift(newLog); // Add to beginning
            
            // Keep only last 100 logs
            if (logs.length > 100) {
                logs.splice(100);
            }
            
            localStorage.setItem('systemLogs', JSON.stringify(logs));
        }

        function showSystemLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            const logsModal = document.createElement('div');
            logsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            logsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 800px;
                    width: 100%;
                    max-height: 80vh;
                    backdrop-filter: blur(20px);
                    display: flex;
                    flex-direction: column;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: white; margin: 0;">ðŸ“„ Logi Systemowe</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="logLevelFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie poziomy</option>
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                                <option value="SUCCESS">SUCCESS</option>
                            </select>
                            <select id="logCategoryFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie kategorie</option>
                                <option value="SYSTEM">SYSTEM</option>
                                <option value="USER">USER</option>
                                <option value="BACKUP">BACKUP</option>
                                <option value="AUTH">AUTH</option>
                                <option value="API">API</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="logsContainer" style="
                        flex: 1;
                        overflow-y: auto;
                        background: rgba(0, 0, 0, 0.3);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 20px;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    ">
                        ${generateLogsHTML(logs)}
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportLogs()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">ðŸ“ Eksportuj</button>
                        <button onclick="clearLogs()" style="
                            background: linear-gradient(135deg, #f44336, #ff5722);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">ðŸ—‘ï¸ WyczyÅ›Ä‡</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(logsModal);
            window.currentModal = logsModal;
            
            // Add event listener for clicking outside
            logsModal.onclick = (e) => {
                if (e.target === logsModal) closeModal();
            };
        }

        function generateLogsHTML(logs) {
            if (logs.length === 0) {
                return '<div style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">Brak logÃ³w do wyÅ›wietlenia</div>';
            }
            
            return logs.map(log => {
                const levelColor = getLevelColor(log.level);
                const formattedTime = new Date(log.timestamp).toLocaleString('pl-PL');
                
                return `
                    <div style="
                        background: rgba(255, 255, 255, 0.05);
                        border-left: 4px solid ${levelColor};
                        margin-bottom: 10px;
                        padding: 12px;
                        border-radius: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="
                                    background: ${levelColor};
                                    color: white;
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                    font-weight: 600;
                                ">${log.level}</span>
                                <span style="
                                    background: rgba(255, 255, 255, 0.1);
                                    color: rgba(255, 255, 255, 0.8);
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                ">${log.category}</span>
                            </div>
                            <span style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">${formattedTime}</span>
                        </div>
                        <div style="color: white; font-weight: 500; margin-bottom: 5px;">${log.message}</div>
                        ${log.details ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 13px;">${log.details}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getLevelColor(level) {
            const colors = {
                'INFO': '#2196F3',
                'SUCCESS': '#4CAF50',
                'WARNING': '#FF9800',
                'ERROR': '#f44336'
            };
            return colors[level] || '#607D8B';
        }

        function filterLogs() {
            const levelFilter = document.getElementById('logLevelFilter').value;
            const categoryFilter = document.getElementById('logCategoryFilter').value;
            const allLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            let filteredLogs = allLogs;
            
            if (levelFilter) {
                filteredLogs = filteredLogs.filter(log => log.level === levelFilter);
            }
            
            if (categoryFilter) {
                filteredLogs = filteredLogs.filter(log => log.category === categoryFilter);
            }
            
            const container = document.getElementById('logsContainer');
            if (container) {
                container.innerHTML = generateLogsHTML(filteredLogs);
            }
        }

        function exportLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const exportData = {
                exported: new Date().toISOString(),
                version: "1.0.0",
                totalLogs: logs.length,
                logs: logs
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Logi_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addSystemLog('INFO', 'SYSTEM', 'Logi zostaÅ‚y wyeksportowane', `Wyeksportowano ${logs.length} wpisÃ³w`);
            showNotification('ðŸ“ Logi zostaÅ‚y wyeksportowane pomyÅ›lnie!');
        }

        function clearLogs() {
            if (confirm('Czy na pewno chcesz wyczyÅ›ciÄ‡ wszystkie logi? Ta operacja jest nieodwracalna.')) {
                localStorage.removeItem('systemLogs');
                addSystemLog('WARNING', 'SYSTEM', 'Logi systemowe zostaÅ‚y wyczyszczone', 'Wszystkie poprzednie logi zostaÅ‚y usuniÄ™te');
                
                const container = document.getElementById('logsContainer');
                if (container) {
                    const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
                    container.innerHTML = generateLogsHTML(logs);
                }
                
                showNotification('ðŸ—‘ï¸ Logi zostaÅ‚y wyczyszczone');
            }
        }

        // Offline Mode functionality
        let isOnline = navigator.onLine;
        let offlineMode = false;

        function initializeOfflineMode() {
            // Check if offline mode is enabled from previous session
            offlineMode = localStorage.getItem('offlineMode') === 'true';
            updateOfflineStatus();
            
            // Listen for network status changes
            window.addEventListener('online', () => {
                isOnline = true;
                updateNetworkStatus();
                if (!offlineMode) {
                    syncOfflineData();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateNetworkStatus();
                if (!offlineMode) {
                    showNotification('âš ï¸ Brak poÅ‚Ä…czenia internetowego. PrzeÅ‚Ä…czanie na tryb offline...');
                    setTimeout(() => enableOfflineMode(true), 2000);
                }
            });
            
            // Initial network status check
            updateNetworkStatus();
        }

        function toggleOfflineMode() {
            if (offlineMode) {
                disableOfflineMode();
            } else {
                enableOfflineMode();
            }
        }

        function enableOfflineMode(automatic = false) {
            offlineMode = true;
            localStorage.setItem('offlineMode', 'true');
            
            if (!automatic) {
                addSystemLog('INFO', 'SYSTEM', 'Tryb offline zostaÅ‚ wÅ‚Ä…czony rÄ™cznie', 'UÅ¼ytkownik przeÅ‚Ä…czyÅ‚ aplikacjÄ™ w tryb offline');
            } else {
                addSystemLog('WARNING', 'SYSTEM', 'Tryb offline zostaÅ‚ wÅ‚Ä…czony automatycznie', 'Brak poÅ‚Ä…czenia internetowego');
            }
            
            updateOfflineStatus();
            showOfflineModal();
            
            // Cache essential data
            cacheOfflineData();
        }

        function disableOfflineMode() {
            offlineMode = false;
            localStorage.setItem('offlineMode', 'false');
            
            addSystemLog('INFO', 'SYSTEM', 'Tryb offline zostaÅ‚ wyÅ‚Ä…czony', 'PowrÃ³t do trybu online');
            updateOfflineStatus();
            
            if (isOnline) {
                syncOfflineData();
                showNotification('ðŸŒ PowrÃ³t do trybu online. Synchronizacja danych...');
            } else {
                showNotification('âš ï¸ Tryb offline wyÅ‚Ä…czony, ale brak poÅ‚Ä…czenia internetowego');
            }
        }

        function updateOfflineStatus() {
            const offlineIcon = document.getElementById('offline-icon');
            const offlineText = document.getElementById('offline-text');
            const adminOfflineIcon = document.getElementById('admin-offline-icon');
            const adminOfflineText = document.getElementById('admin-offline-text');
            
            if (offlineMode) {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-wifi-slash feature-icon';
                    offlineIcon.style.color = '#f44336';
                }
                if (offlineText) {
                    offlineText.textContent = 'Online';
                    offlineText.style.color = '#f44336';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi feature-icon';
                    adminOfflineIcon.style.color = '#4CAF50';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Online';
                    adminOfflineText.style.color = '#4CAF50';
                }
            } else {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-download feature-icon';
                    offlineIcon.style.color = '';
                }
                if (offlineText) {
                    offlineText.textContent = 'Tryb Offline';
                    offlineText.style.color = '';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi-slash feature-icon';
                    adminOfflineIcon.style.color = '';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Tryb Offline';
                    adminOfflineText.style.color = '';
                }
            }
        }

        function updateNetworkStatus() {
            // Add network status indicator to header
            let networkIndicator = document.getElementById('network-status');
            if (!networkIndicator) {
                networkIndicator = document.createElement('div');
                networkIndicator.id = 'network-status';
                networkIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 20px;
                    padding: 5px 10px;
                    border-radius: 15px;
                    font-size: 12px;
                    font-weight: 600;
                    z-index: 9999;
                    transition: all 0.3s ease;
                `;
                document.body.appendChild(networkIndicator);
            }
            
            if (offlineMode) {
                networkIndicator.style.background = 'rgba(255, 193, 7, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = 'ðŸ“± Offline';
            } else if (isOnline) {
                networkIndicator.style.background = 'rgba(76, 175, 80, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = 'ðŸŒ Online';
            } else {
                networkIndicator.style.background = 'rgba(244, 67, 54, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = 'âš ï¸ Brak sieci';
            }
        }

        function showOfflineModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">ðŸ“±</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Tryb Offline Aktywny</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Aplikacja dziaÅ‚a teraz w trybie offline.</p>
                        <br>
                        <p><strong>DostÄ™pne funkcje:</strong></p>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li>â€¢ PrzeglÄ…danie przepisÃ³w</li>
                            <li>â€¢ Kalendarz sezonowy</li>
                            <li>â€¢ Notatki osobiste</li>
                            <li>â€¢ Zapisane dane</li>
                        </ul>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Dane bÄ™dÄ… zsynchronizowane po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <button onclick="closeModal()" style="
                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 12px 24px;
                        cursor: pointer;
                        font-weight: 600;
                    ">Rozumiem</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            
            // Auto close after 10 seconds
            setTimeout(() => {
                if (window.currentModal === modal) {
                    closeModal();
                }
            }, 10000);
        }

        function cacheOfflineData() {
            const offlineCache = {
                timestamp: new Date().toISOString(),
                userData: {
                    profile: {
                        userName: localStorage.getItem('userName'),
                        userEmail: localStorage.getItem('userEmail'),
                        userRole: localStorage.getItem('userRole')
                    },
                    preferences: localStorage.getItem('userPreferences') || '{}',
                    settings: localStorage.getItem('appSettings') || '{}',
                    favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                    healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                    notes: localStorage.getItem('userNotes') || '[]'
                },
                appState: {
                    currentSeason: localStorage.getItem('currentSeason') || '',
                    seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                    lastVisit: localStorage.getItem('lastVisit') || ''
                }
            };
            
            localStorage.setItem('offlineCache', JSON.stringify(offlineCache));
            addSystemLog('INFO', 'SYSTEM', 'Dane zostaÅ‚y zapisane w cache offline', `Rozmiar cache: ${Math.round(JSON.stringify(offlineCache).length / 1024)} KB`);
        }

        function syncOfflineData() {
            const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
            
            if (offlineChanges.length > 0) {
                showNotification('ðŸ”„ Synchronizacja danych offline...');
                
                // Simulate sync process
                setTimeout(() => {
                    // Process offline changes
                    offlineChanges.forEach(change => {
                        addSystemLog('INFO', 'SYSTEM', 'Zsynchronizowano zmiany offline', `Typ: ${change.type}, Czas: ${change.timestamp}`);
                    });
                    
                    // Clear offline changes
                    localStorage.removeItem('offlineChanges');
                    
                    showNotification('âœ… Synchronizacja zakoÅ„czona pomyÅ›lnie!');
                    addSystemLog('SUCCESS', 'SYSTEM', 'Synchronizacja danych offline zakoÅ„czona', `Zsynchronizowano ${offlineChanges.length} zmian`);
                }, 2000);
            }
        }

        function performOfflineBackup() {
            const offlineBackupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "offline",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        userName: localStorage.getItem('userName') || '',
                        userEmail: localStorage.getItem('userEmail') || '',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    },
                    systemData: {
                        logs: localStorage.getItem('systemLogs') || '[]',
                        offlineChanges: localStorage.getItem('offlineChanges') || '[]'
                    }
                }
            };

            // Store offline backup
            localStorage.setItem('offlineBackup', JSON.stringify(offlineBackupData));
            localStorage.setItem('lastOfflineBackup', new Date().toISOString());
            
            // Show offline backup modal
            showOfflineBackupModal(offlineBackupData);
            
            addSystemLog('SUCCESS', 'BACKUP', 'Backup offline zostaÅ‚ utworzony', `Rozmiar: ${Math.round(JSON.stringify(offlineBackupData).length / 1024)} KB`);
            addOfflineChange('backup', { timestamp: new Date().toISOString(), size: JSON.stringify(offlineBackupData).length });
        }

        function showOfflineBackupModal(backupData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            const backupSize = Math.round(JSON.stringify(backupData).length / 1024);
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">ðŸ’¾</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Backup Offline Utworzony</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Backup zostaÅ‚ zapisany lokalnie w trybie offline.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>ðŸ“Š SzczegÃ³Å‚y backup:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;">â€¢ Rozmiar: ${backupSize} KB</p>
                            <p style="font-size: 13px; margin: 5px 0;">â€¢ Typ: Offline</p>
                            <p style="font-size: 13px; margin: 5px 0;">â€¢ Czas: ${new Date().toLocaleString('pl-PL')}</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Backup bÄ™dzie dostÄ™pny do pobrania po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportOfflineBackup()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">ðŸ“ Zapisz Lokalnie</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        function exportOfflineBackup() {
            const offlineBackup = localStorage.getItem('offlineBackup');
            if (offlineBackup) {
                const blob = new Blob([offlineBackup], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                const currentDate = new Date().toISOString().split('T')[0];
                a.href = url;
                a.download = `SezonoweDobro_Offline_Backup_${currentDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('ðŸ’¾ Offline backup zostaÅ‚ pobrany!');
                addSystemLog('SUCCESS', 'BACKUP', 'Offline backup zostaÅ‚ wyeksportowany', 'Plik zapisany lokalnie');
                closeModal();
            }
        }

        function addOfflineChange(type, data) {
            if (offlineMode) {
                const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
                offlineChanges.push({
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    type: type,
                    data: data
                });
                localStorage.setItem('offlineChanges', JSON.stringify(offlineChanges));
            }
        }

        function checkSettingsAccessError() {
            const settingsAccessError = localStorage.getItem('settingsAccessError');
            if (settingsAccessError) {
                showNotification('âŒ ' + settingsAccessError);
                addSystemLog('WARNING', 'AUTH', 'Nieuprawiony dostÄ™p do ustawieÅ„ zostaÅ‚ zablokowany', settingsAccessError);
                localStorage.removeItem('settingsAccessError');
            }
        }

        function showAdminNotification(feature) {
            showNotification(`ðŸ”§ ${feature} - funkcja w rozwoju`);
        }

        function showSystemSettings() {
            // Check if user is admin
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (userRole !== 'admin') {
                showNotification('âŒ DostÄ™p do ustawieÅ„ tylko dla administratorÃ³w!');
                addSystemLog('WARNING', 'AUTH', 'PrÃ³ba dostÄ™pu do ustawieÅ„ bez uprawnieÅ„ administratora', `Rola uÅ¼ytkownika: ${userRole}`);
                return;
            }
            
            // Log access to settings
            addSystemLog('INFO', 'SYSTEM', 'Administrator wszedÅ‚ do ustawieÅ„ systemu', 'Otwarto panel ustawieÅ„');
            
            // Open settings.html in new tab/window
            try {
                const settingsWindow = window.open('settings.html', '_blank', 'width=800,height=900,scrollbars=yes,resizable=yes');
                
                if (settingsWindow) {
                    showNotification('âš™ï¸ Otwieranie panelu ustawieÅ„ administratora...');
                    
                    // Focus the new window
                    settingsWindow.focus();
                    
                    // Add event listener to detect when settings window is closed
                    const checkClosed = setInterval(() => {
                        if (settingsWindow.closed) {
                            showNotification('âœ… Panel ustawieÅ„ zostaÅ‚ zamkniÄ™ty');
                            addSystemLog('INFO', 'SYSTEM', 'Panel ustawieÅ„ zostaÅ‚ zamkniÄ™ty', 'PowrÃ³t do gÅ‚Ã³wnej aplikacji');
                            clearInterval(checkClosed);
                        }
                    }, 1000);
                } else {
                    // Fallback if popup was blocked
                    showAdminSettingsModal();
                }
            } catch (error) {
                addSystemLog('ERROR', 'SYSTEM', 'BÅ‚Ä…d podczas otwierania ustawieÅ„', error.message);
                showAdminSettingsModal();
            }
        }

        function showAdminSettingsModal() {
            const settingsModal = document.createElement('div');
            settingsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            settingsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">âš™ï¸</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Panel UstawieÅ„ Administratora</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Panel ustawieÅ„ otwiera siÄ™ w nowym oknie.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>ðŸ“Š Status systemu:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="server">â€¢ Serwer: Online â€¢ 2025</p>
                            <p style="font-size: 13px; margin: 5px 0;">â€¢ UÅ¼ycie dysku: 32%</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-backup-time>â€¢ Ostatni backup: brak</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="active-users">â€¢ Aktywni uÅ¼ytkownicy 2025: 347</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            JeÅ›li okno siÄ™ nie otworzyÅ‚o, sprawdÅº blokadÄ™ popup w przeglÄ…darce.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="openSettingsManually()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">ðŸ”— OtwÃ³rz Ustawienia</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(settingsModal);
            window.currentModal = settingsModal;
            
            // Update backup display immediately
            updateBackupDisplay();
        }

        function openSettingsManually() {
            // Close current modal first
            closeModal();
            
            // Open settings page
            window.location.href = 'settings.html';
        }

        function closeModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }

        // Season Details Modal Functions
        function showSeasonDetails(element) {
            const seasonData = getSeasonData(element);
            const userRole = localStorage.getItem('userRole') || 'user';
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeSeasonModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${seasonData.color};">
                    <button class="close-modal-btn" onclick="closeSeasonModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${seasonData.color};">
                            ${seasonData.icon}
                        </div>
                        <div>
                            <div class="season-modal-title">${seasonData.name}</div>
                            <div class="season-modal-subtitle">${seasonData.period} â€¢ Element ${seasonData.element}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Opis Elementu
                        </div>
                        <div class="season-info-content">
                            ${seasonData.description}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-heart"></i>
                            PowiÄ…zane Organy
                        </div>
                        <div class="season-info-content">
                            <strong>GÅ‚Ã³wny organ:</strong> ${seasonData.mainOrgan}<br>
                            <strong>Organ pomocniczy:</strong> ${seasonData.secondaryOrgan}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-utensils"></i>
                            Zalecane Pokarmy
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.foods.map(food => `<li>â€¢ ${food}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-dumbbell"></i>
                            Zalecane Ä†wiczenia
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.exercises.map(exercise => `<li>â€¢ ${exercise}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Czego UnikaÄ‡
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.avoid.map(item => `<li>â€¢ ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="season-info-section" style="border-left-color: ${seasonData.color}; background: rgba(255, 193, 7, 0.1);">
                        <div class="season-info-title">
                            <i class="fas fa-crown"></i>
                            Informacje dla Administratora
                        </div>
                        <div class="season-info-content">
                            <strong>Energia:</strong> ${seasonData.adminInfo.energy}<br>
                            <strong>Kierunek:</strong> ${seasonData.adminInfo.direction}<br>
                            <strong>Pora dnia:</strong> ${seasonData.adminInfo.timeOfDay}<br>
                            <strong>Emocja:</strong> ${seasonData.adminInfo.emotion}<br>
                            <strong>Smak:</strong> ${seasonData.adminInfo.taste}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentSeasonModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeSeasonModal() {
            if (window.currentSeasonModal) {
                window.currentSeasonModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentSeasonModal && document.body.contains(window.currentSeasonModal)) {
                        document.body.removeChild(window.currentSeasonModal);
                    }
                    window.currentSeasonModal = null;
                }, 300);
            }
        }

        function getSeasonData(element) {
            const seasonData = {
                'Drewno': {
                    name: 'Element Drewna',
                    period: 'Wiosna (Marzec - Maj)',
                    element: 'Drewno ðŸŒ±',
                    icon: 'ðŸŒ±',
                    color: '#4CAF50',
                    description: 'Element Drewna reprezentuje wzrost, elastycznoÅ›Ä‡ i nowe poczÄ…tki. To czas odnowy, oczyszczania organizmu i planowania przyszÅ‚oÅ›ci. Energia roÅ›nie w gÃ³rÄ™ jak mÅ‚ode pÄ™dy.',
                    mainOrgan: 'WÄ…troba (Gan)',
                    secondaryOrgan: 'PÄ™cherzyk Å¼Ã³Å‚ciowy (Dan)',
                    foods: [
                        'Zielone warzywa liÅ›ciaste (szpinak, rukola)',
                        'MÅ‚ode kieÅ‚ki i pÄ™dy',
                        'Cytryna i limonka',
                        'Zielona herbata',
                        'Pokrzywy i mniszek lekarski'
                    ],
                    exercises: [
                        'Tai Chi w parku',
                        'Joga rozciÄ…gajÄ…ca',
                        'Spacery w naturze',
                        'Ä†wiczenia elastycznoÅ›ci',
                        'Oddychanie brzuchem'
                    ],
                    avoid: [
                        'Nadmierna zÅ‚oÅ›Ä‡ i frustracja',
                        'Przejadanie siÄ™',
                        'Alkohol i uÅ¼ywki',
                        'SiedzÄ…cy tryb Å¼ycia',
                        'Stres i napiÄ™cie'
                    ],
                    adminInfo: {
                        energy: 'Yang rosnÄ…ce',
                        direction: 'WschÃ³d',
                        timeOfDay: 'Wczesny ranek (5:00-7:00)',
                        emotion: 'Gniew (kontrolowany)',
                        taste: 'KwaÅ›ny'
                    }
                },
                'OgieÅ„': {
                    name: 'Element Ognia',
                    period: 'Lato (Czerwiec - SierpieÅ„)',
                    element: 'OgieÅ„ ðŸ”¥',
                    icon: 'ðŸ”¥',
                    color: '#F44336',
                    description: 'Element Ognia reprezentuje radoÅ›Ä‡, komunikacjÄ™ i ekspansjÄ™. To czas maksymalnej aktywnoÅ›ci Yang, ciepÅ‚a i spoÅ‚ecznych interakcji. Energia emanuje na zewnÄ…trz.',
                    mainOrgan: 'Serce (Xin)',
                    secondaryOrgan: 'Jelito cienkie (Xiao Chang)',
                    foods: [
                        'ChÅ‚odzÄ…ce owoce (arbuz, melon)',
                        'Pomidory i ogÃ³rki',
                        'MiÄ™ta i bazylia',
                        'Zielona herbata i herbaty chÅ‚odzÄ…ce',
                        'Lekkie zupy i gazpacho'
                    ],
                    exercises: [
                        'Qigong o Å›wicie',
                        'PÅ‚ywanie',
                        'Medytacja w cieniu',
                        'Joga chÅ‚odzÄ…ca (Yin)',
                        'Spacery w chÅ‚odniejszych porach'
                    ],
                    avoid: [
                        'Przegrzewanie organizmu',
                        'Intensywny wysiÅ‚ek w upaÅ‚',
                        'Pikantne i rozgrzewajÄ…ce potrawy',
                        'Nadmierne emocje',
                        'DÅ‚ugie nasÅ‚onecznienie'
                    ],
                    adminInfo: {
                        energy: 'Yang maksymalne',
                        direction: 'PoÅ‚udnie',
                        timeOfDay: 'PoÅ‚udnie (11:00-13:00)',
                        emotion: 'RadoÅ›Ä‡',
                        taste: 'Gorzki'
                    }
                },
                'Ziemia': {
                    name: 'Element Ziemi',
                    period: 'PÃ³Åºne Lato (WrzesieÅ„)',
                    element: 'Ziemia ðŸŒ¾',
                    icon: 'ðŸŒ¾',
                    color: '#FFC107',
                    description: 'Element Ziemi reprezentuje stabilnoÅ›Ä‡, rÃ³wnowagÄ™ i odÅ¼ywianie. To czas zbiorÃ³w, refleksji i przygotowania do jesieni. Energia koncentruje siÄ™ w centrum.',
                    mainOrgan: 'Åšledziona (Pi)',
                    secondaryOrgan: 'Å»oÅ‚Ä…dek (Wei)',
                    foods: [
                        'SÅ‚odkie warzywa (marchew, dynia)',
                        'Ziarna zbÃ³Å¼ (proso, ryÅ¼)',
                        'SÅ‚odkie owoce (daty, morele)',
                        'KorzeÅ„ lukrecji',
                        'Å»Ã³Å‚te i pomaraÅ„czowe produkty'
                    ],
                    exercises: [
                        'Medytacja siedzÄ…ca',
                        'Åagodne spacery po posiÅ‚ku',
                        'Ä†wiczenia rÃ³wnowagi',
                        'Tai Chi w centrum',
                        'Joga stabilizujÄ…ca'
                    ],
                    avoid: [
                        'Przejadanie siÄ™',
                        'Zimne napoje z jedzeniem',
                        'Obsesyjne myÅ›lenie',
                        'Nieregularne posiÅ‚ki',
                        'Nadmierne martwieniu'
                    ],
                    adminInfo: {
                        energy: 'Yin-Yang zrÃ³wnowaÅ¼one',
                        direction: 'Centrum',
                        timeOfDay: 'CaÅ‚odobowo (szczegÃ³lnie przejÅ›cia)',
                        emotion: 'Troska (zrÃ³wnowaÅ¼ona)',
                        taste: 'SÅ‚odki'
                    }
                },
                'Metal': {
                    name: 'Element Metalu',
                    period: 'JesieÅ„ (PaÅºdziernik - GrudzieÅ„)',
                    element: 'Metal âš¡',
                    icon: 'ðŸ‚',
                    color: '#9E9E9E',
                    description: 'Element Metalu reprezentuje precyzjÄ™, refleksjÄ™ i wewnÄ™trznÄ… siÅ‚Ä™. To czas zbierania doÅ›wiadczeÅ„, oczyszczania i przygotowania na zimÄ™. Energia siÄ™ zagÄ™szcza.',
                    mainOrgan: 'PÅ‚uca (Fei)',
                    secondaryOrgan: 'Jelito grube (Da Chang)',
                    foods: [
                        'BiaÅ‚e produkty (gruszki, rzodkiew)',
                        'Orzchy i nasiona',
                        'KorzeÅ„ lotosu',
                        'BiaÅ‚y ryÅ¼ i proso',
                        'Herbata biaÅ‚a i oolong'
                    ],
                    exercises: [
                        'GÅ‚Ä™bokie oddychanie',
                        'Qigong dla pÅ‚uc',
                        'Powolne spacery',
                        'Joga z naciskiem na oddech',
                        'Medytacja oddechowa'
                    ],
                    avoid: [
                        'SuchoÅ›Ä‡ powietrza',
                        'Nadmierny smutek',
                        'Intensywny wysiÅ‚ek',
                        'Zimne napoje',
                        'Zaniedbywanie higieny'
                    ],
                    adminInfo: {
                        energy: 'Yang malejÄ…ce',
                        direction: 'ZachÃ³d',
                        timeOfDay: 'Wczesny wieczÃ³r (17:00-19:00)',
                        emotion: 'Smutek (przemijajÄ…cy)',
                        taste: 'Ostry'
                    }
                },
                'Woda': {
                    name: 'Element Wody',
                    period: 'Zima (StyczeÅ„ - Luty)',
                    element: 'Woda â„ï¸',
                    icon: 'â„ï¸',
                    color: '#2196F3',
                    description: 'Element Wody reprezentuje gÅ‚Ä™biÄ™, mÄ…droÅ›Ä‡ i potencjaÅ‚. To czas maksymalnego Yin, odpoczynku i kultywowania energii wewnÄ™trznej. Energia gromadzi siÄ™ w gÅ‚Ä™bi.',
                    mainOrgan: 'Nerki (Shen)',
                    secondaryOrgan: 'PÄ™cherz moczowy (Pang Guang)',
                    foods: [
                        'Ciemne produkty (czarne ziarna, goji)',
                        'Kostne buliony i zupy',
                        'Orzechy wÅ‚oskie i nasiona',
                        'CiepÅ‚e napoje z imbirem',
                        'Morskie algi i owoce morza'
                    ],
                    exercises: [
                        'Delikatne rozciÄ…ganie',
                        'Medytacja gÅ‚Ä™boka',
                        'Qigong dla nerek',
                        'Joga restoratywna',
                        'Spacery kontemplacyjne'
                    ],
                    avoid: [
                        'Wyczerpanie energii',
                        'Nadmierny lÄ™k',
                        'Zimne otoczenie',
                        'Intensywne Ä‡wiczenia',
                        'BezsennoÅ›Ä‡'
                    ],
                    adminInfo: {
                        energy: 'Yin maksymalne',
                        direction: 'PÃ³Å‚noc',
                        timeOfDay: 'Noc (23:00-1:00)',
                        emotion: 'LÄ™k (kontrolowany)',
                        taste: 'SÅ‚ony'
                    }
                }
            };
            
            return seasonData[element] || seasonData['OgieÅ„'];
        }

        // Dynamic Recipes Functions
        function updateRecipes() {
            const currentSeason = updateSeason();
            const recipesContainer = document.getElementById('recipesContainer');
            
            if (!recipesContainer) return;
            
            const seasonalRecipes = getSeasonalRecipes(currentSeason.element);
            
            recipesContainer.innerHTML = seasonalRecipes.map((recipe, index) => `
                <div class="recipe-card clickable" onclick="showRecipeDetails('${currentSeason.element}', ${index})">
                    <div class="recipe-image">
                        ${recipe.emoji}
                    </div>
                    <div class="recipe-info">
                        <div class="recipe-title">${recipe.name}</div>
                        <div class="recipe-meta">
                            <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                            <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                            <span><i class="${getElementIcon(currentSeason.element)}"></i> ${currentSeason.element}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getSeasonalRecipes(element) {
            const recipes = {
                'Drewno': [
                    {
                        name: 'Wiosenna SaÅ‚atka Detoks',
                        emoji: 'ðŸ¥—',
                        time: '15 min',
                        temperature: 'ChÅ‚odzÄ…ca',
                        ingredients: [
                            '2 szklanki mÅ‚odych liÅ›ci szpinaku',
                            '1 szklanka roszponki',
                            '1/2 szklanki kieÅ‚kÃ³w rzodkiewki',
                            '1 ogÃ³rek',
                            '2 Å‚yÅ¼ki nasion sÅ‚onecznika',
                            '1 cytryna (sok)',
                            '2 Å‚yÅ¼ki oliwy z oliwek',
                            'ÅšwieÅ¼a miÄ™ta do dekoracji'
                        ],
                        instructions: [
                            'DokÅ‚adnie umyj wszystkie zielone warzywa w zimnej wodzie.',
                            'PokrÃ³j ogÃ³rek w cienkie plasterki.',
                            'W duÅ¼ej misce poÅ‚Ä…cz szpinak, roszponkÄ™ i kieÅ‚ki.',
                            'Przygotuj dresing: wymieszaj sok z cytryny z oliwÄ….',
                            'Polej saÅ‚atkÄ™ dressingiem i delikatnie wymieszaj.',
                            'Posyp nasionami sÅ‚onecznika i udekoruj miÄ™tÄ….',
                            'Podawaj natychmiast, najlepiej o poranku.'
                        ],
                                                 benefits: `Ta saÅ‚atka oczyszcza wÄ…trobÄ™, dostarcza witaminy C i wspiera naturalne procesy detoksykacji organizmu wiosnÄ… ${new Date().getFullYear()}.`,
                        tcmProperties: 'ChÅ‚odzi CiepÅ‚o WÄ…troby, wzmacnia Qi Å›ledziony, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Mniszka Lekarskiego',
                        emoji: 'ðŸµ',
                        time: '10 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '2 Å‚yÅ¼eczki suszonych liÅ›ci mniszka',
                            '1 szklanka wody',
                            '1 plasterek cytryny',
                            '1 Å‚yÅ¼eczka miodu (opcjonalnie)',
                            'ÅšwieÅ¼e liÅ›cie miÄ™ty'
                        ],
                        instructions: [
                            'Zagotuj wodÄ™ w czajniku.',
                            'WÅ‚Ã³Å¼ suszone liÅ›cie mniszka do zaparzacza.',
                            'Zalej wrzÄ…tkiem i pozostaw pod przykryciem na 7-8 minut.',
                            'PrzecedÅº herbatÄ™ przez sitko.',
                            'Dodaj plasterek cytryny i miÃ³d wedÅ‚ug smaku.',
                            'Udekoruj listkami miÄ™ty.',
                            'Pij rano na czczo dla najlepszego efektu.'
                        ],
                        benefits: 'Wspiera funkcje wÄ…troby, oczyszcza organizm z toksyn i pobudza trawienie po zimie.',
                        tcmProperties: 'Oczyszcza CiepÅ‚o-WilgoÄ‡, wzmacnia Qi wÄ…troby, reguluje przepÅ‚yw Qi'
                    },
                    {
                        name: 'Zielona Owsianka EnergetyzujÄ…ca',
                        emoji: 'ðŸ¥£',
                        time: '25 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '1 szklanka pÅ‚atkÃ³w owsianych',
                            '2 szklanki mleka roÅ›linnego',
                            '1 Å‚yÅ¼ka proszku z chlorelli',
                            '1 banan',
                            '2 Å‚yÅ¼ki orzechÃ³w wÅ‚oskich',
                            '1 Å‚yÅ¼ka miodu',
                            'Nasiona chia (1 Å‚yÅ¼ka)',
                            'ÅšwieÅ¼e jagody (do dekoracji)'
                        ],
                        instructions: [
                            'W garnku zagotuj mleko roÅ›linne.',
                            'Dodaj pÅ‚atki owsiane i gotuj na maÅ‚ym ogniu 15 minut.',
                            'Wmieszaj proszek z chlorelli (nadaje zielony kolor).',
                            'PokrÃ³j banana w plasterki.',
                            'PrzeÅ‚Ã³Å¼ owsiankÄ™ do miski, udekoruj bananem.',
                            'Posyp orzechami, nasionami chia i jagodami.',
                            'Skrop miodem i podawaj ciepÅ‚Ä….'
                        ],
                        benefits: 'Dostarcza energii na caÅ‚y dzieÅ„, wzmacnia wÄ…trobÄ™ i wspiera wzrost nowych komÃ³rek.',
                        tcmProperties: 'OdÅ¼ywia Krew wÄ…troby, wzmacnia Qi Å›ledziony, harmonizuje Shen'
                    }
                ],
                'OgieÅ„': [
                    {
                        name: 'Gazpacho Andaluzyjskie',
                        emoji: 'ðŸ…',
                        time: '20 min + chÅ‚odzenie',
                        temperature: 'ChÅ‚odzÄ…ca',
                        ingredients: [
                            '6 duÅ¼ych pomidorÃ³w',
                            '1 ogÃ³rek',
                            '1 czerwona papryka',
                            '1/2 czerwonej cebuli',
                            '3 zÄ…bki czosnku',
                            '4 Å‚yÅ¼ki oliwy z oliwek extra virgin',
                            '2 Å‚yÅ¼ki octu sherry',
                            'SÃ³l morska do smaku',
                            'ÅšwieÅ¼a bazylia do dekoracji'
                        ],
                        instructions: [
                            'SparÅ¼ pomidory, obierz ze skÃ³ry i usuÅ„ nasiona.',
                            'Obierz ogÃ³rek i pokrÃ³j w grube kawaÅ‚ki.',
                            'PaprykÄ™ oczyÅ›Ä‡ z nasion i pokrÃ³j.',
                            'Wszystkie warzywa wrzuÄ‡ do blendera.',
                            'Dodaj oliwÄ™, ocet i przyprawy.',
                            'Miksuj do uzyskania gÅ‚adkiej konsystencji.',
                            'Wstaw do lodÃ³wki na minimum 2 godziny.',
                            'Podawaj ozdobione bazyliÄ….'
                        ],
                                                 benefits: `OchÅ‚adza organizm w upalne letnie dni ${new Date().getFullYear()}, dostarcza licopenu i witamin.`,
                        tcmProperties: 'Oczyszcza CiepÅ‚o serca, nawadnia pÅ‚yny ustrojowe, uspokaja Shen'
                    },
                    {
                        name: 'Smoothie z Arbuza i MiÄ™ty',
                        emoji: 'ðŸ‰',
                        time: '5 min',
                        temperature: 'ChÅ‚odzÄ…ca',
                        ingredients: [
                            '3 szklanki pokrojonego arbuza',
                            '10 listkÃ³w Å›wieÅ¼ej miÄ™ty',
                            '1 limonka (sok)',
                            '1 Å‚yÅ¼ka miodu',
                            '1/2 szklanki wody kokosowej',
                            'LÃ³d do podania',
                            'Plastry limonki do dekoracji'
                        ],
                        instructions: [
                            'UsuÅ„ pestki z arbuza i pokrÃ³j miÄ…Å¼sz.',
                            'Do blendera wrzuÄ‡ arbuz i listki miÄ™ty.',
                            'Dodaj sok z limonki i miÃ³d.',
                            'Wlej wodÄ™ kokosowÄ….',
                            'Miksuj przez 30 sekund do gÅ‚adkoÅ›ci.',
                            'Przelej do szklanek z lodem.',
                            'Udekoruj plastrem limonki i miÄ™tÄ….'
                        ],
                        benefits: 'Intensywnie nawadnia, chÅ‚odzi i wspiera pracÄ™ serca w gorÄ…ce dni.',
                        tcmProperties: 'ChÅ‚odzi CiepÅ‚o serca, uzupeÅ‚nia Yin, wzmacnia funkcje nerek'
                    },
                    {
                        name: 'SaÅ‚atka Grecka z BazyliÄ…',
                        emoji: 'ðŸ¥’',
                        time: '15 min',
                        temperature: 'ChÅ‚odzÄ…ca',
                        ingredients: [
                            '3 duÅ¼e pomidory',
                            '2 ogÃ³rki',
                            '1 czerwona cebula',
                            '200g sera feta',
                            '1/2 szklanki oliwek Kalamata',
                            '4 Å‚yÅ¼ki oliwy z oliwek',
                            '2 Å‚yÅ¼ki octu balsamicznego',
                            'ÅšwieÅ¼a bazylia',
                            'Oregano suszone'
                        ],
                        instructions: [
                            'PokrÃ³j pomidory w Ã³semki.',
                            'OgÃ³rki pokrÃ³j w pÃ³Å‚plasterki.',
                            'CebulÄ™ pokrÃ³j w cienkie plasterki.',
                            'FetÄ™ pokrusz na wiÄ™ksze kawaÅ‚ki.',
                            'PoÅ‚Ä…cz wszystkie warzywa w misce.',
                            'Przygotuj dresing z oliwy i octu.',
                            'Polej saÅ‚atkÄ™, wymieszaj delikatnie.',
                            'Posyp Å›wieÅ¼Ä… bazyliÄ… i oregano.'
                        ],
                        benefits: 'Wspiera zdrowie serca, dostarcza zdrowych tÅ‚uszczy i elektrolitÃ³w.',
                        tcmProperties: 'OdÅ¼ywia Yin serca, chÅ‚odzi CiepÅ‚o, harmonizuje emocje'
                    }
                ],
                'Ziemia': [
                    {
                        name: 'Zupa z Dyni i Marchwi',
                        emoji: 'ðŸ²',
                        time: '45 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '500g dyni Hokkaido',
                            '3 duÅ¼e marchwie',
                            '1 cebula',
                            '2 cm Å›wieÅ¼ego imbiru',
                            '1 litr bulionu warzywnego',
                            '200ml mleka kokosowego',
                            '2 Å‚yÅ¼ki oliwy z oliwek',
                            'Nasiona dyni do dekoracji',
                            'SÃ³l i pieprz do smaku'
                        ],
                        instructions: [
                            'Obierz dyniÄ™ i marchew, pokrÃ³j w kostki.',
                            'CebulÄ™ pokrÃ³j drobno, imbir zetrzyj.',
                            'Rozgrzej oliwÄ™ w garnku, zeszklij cebulÄ™.',
                            'Dodaj imbir, dyniÄ™ i marchew.',
                            'Zalej bulionem i gotuj 30 minut.',
                            'Zmiksuj na gÅ‚adko blenderem.',
                            'Dodaj mleko kokosowe, dopraw.',
                            'Podawaj z praÅ¼onymi nasionami dyni.'
                        ],
                        benefits: 'Wzmacnia Å›ledzionÄ™, poprawia trawienie i dostarcza beta-karotenu.',
                        tcmProperties: 'Wzmacnia Qi Å›ledziony, odÅ¼ywia Krew, harmonizuje Åšrodkowy Ogrzewacz'
                    },
                    {
                        name: 'Zapiekanka z Prosa i SÅ‚odkich ZiemniakÃ³w',
                        emoji: 'ðŸ ',
                        time: '60 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '1 szklanka prosa',
                            '2 sÅ‚odkie ziemniaki',
                            '1 cebula',
                            '2 szklanki bulionu',
                            '100g sera koziego',
                            '2 Å‚yÅ¼ki masÅ‚a',
                            'Tymianek Å›wieÅ¼y',
                            'SÃ³l i pieprz',
                            'Oliwa do smarowania'
                        ],
                        instructions: [
                            'Ugotuj proso w bulionie (20 min).',
                            'SÅ‚odkie ziemniaki obierz i pokrÃ³j w plasterki.',
                            'CebulÄ™ pokrÃ³j w pÃ³Å‚ksiÄ™Å¼yce.',
                            'Naczynie Å¼aroodporne posmaruj oliwÄ….',
                            'UÅ‚Ã³Å¼ warstwami: proso, ziemniaki, cebulÄ™.',
                            'Rozkrusz ser kozi na wierzchu.',
                            'Dodaj masÅ‚o w kawaÅ‚kach i tymianek.',
                            'Piecz 35 minut w 180Â°C.'
                        ],
                        benefits: 'Stabilizuje poziom cukru, wzmacnia Å›ledzionÄ™ i daje dÅ‚ugotrwaÅ‚Ä… energiÄ™.',
                        tcmProperties: 'Tonizuje Qi Å›ledziony, wzmacnia Yang nerek, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Korzeniem Lukrecji',
                        emoji: 'ðŸ«–',
                        time: '15 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '1 Å‚yÅ¼eczka korzenia lukrecji (suszonego)',
                            '1 szklanka wody',
                            '1 plasterek Å›wieÅ¼ego imbiru',
                            '1 Å‚yÅ¼eczka miodu',
                            'Cynamon w proszku (szczypta)',
                            'Plaster pomaraÅ„czy'
                        ],
                        instructions: [
                            'KorzeÅ„ lukrecji zalej wrzÄ…tkiem.',
                            'Dodaj plasterek imbiru.',
                            'Gotuj na maÅ‚ym ogniu 10 minut.',
                            'PrzecedÅº przez sitko.',
                            'Dodaj miÃ³d i cynamon.',
                            'Udekoruj plastrem pomaraÅ„czy.',
                            'Pij ciepÅ‚Ä…, najlepiej po posiÅ‚ku.'
                        ],
                        benefits: 'Harmonizuje trawienie, Å‚agodzi stres i wzmacnia nadnercza.',
                        tcmProperties: 'Harmonizuje wszystkie formuÅ‚y, wzmacnia Qi Å›ledziony, odÅ¼ywia Yin'
                    }
                ],
                'Metal': [
                    {
                        name: 'Zupa Gruszkowa z Orzechami',
                        emoji: 'ðŸ',
                        time: '35 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '4 dojrzaÅ‚e gruszki',
                            '1/2 szklanki orzechÃ³w wÅ‚oskich',
                            '1 litr bulionu warzywnego',
                            '1 cebula',
                            '2 Å‚yÅ¼ki masÅ‚a',
                            '1/4 szklanki Å›mietany 18%',
                            'Tymianek Å›wieÅ¼y',
                            'SÃ³l i biaÅ‚y pieprz',
                            'Oliwa do skropienia'
                        ],
                        instructions: [
                            'Gruszki obierz i pokrÃ³j w Ä‡wiartki.',
                            'CebulÄ™ pokrÃ³j drobno.',
                            'Na maÅ›le zeszklij cebulÄ™.',
                            'Dodaj gruszki i duÅ› 10 minut.',
                            'Zalej bulionem, gotuj 20 minut.',
                            'Zmiksuj z orzechami na gÅ‚adko.',
                            'Dodaj Å›mietanÄ™, dopraw.',
                            'Podawaj z tymiankiem i oliwÄ….'
                        ],
                                                 benefits: `NawilÅ¼a pÅ‚uca, Å‚agodzi kaszel i wzmacnia system oddechowy jesieniÄ… ${new Date().getFullYear()}.`,
                        tcmProperties: 'OdÅ¼ywia Yin pÅ‚uc, oczyszcza CiepÅ‚o, Å‚agodzi suchoÅ›Ä‡'
                    },
                    {
                        name: 'RyÅ¼ z Korzeniem Lotosu',
                        emoji: 'ðŸš',
                        time: '40 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '1 szklanka biaÅ‚ego ryÅ¼u',
                            '100g Å›wieÅ¼ego korzenia lotosu',
                            '2 szklanki bulionu drobiowego',
                            '2 Å‚yÅ¼ki oleju sezamowego',
                            '1 Å‚yÅ¼ka sosu sojowego',
                            'Zielona cebulka',
                            'Nasiona sezamu',
                            'BiaÅ‚y pieprz'
                        ],
                        instructions: [
                            'KorzeÅ„ lotosu obierz i pokrÃ³j w plasterki.',
                            'RyÅ¼ przepÅ‚ucz do czystej wody.',
                            'W garnku rozgrzej olej sezamowy.',
                            'PodsmaÅ¼ korzeÅ„ lotosu 5 minut.',
                            'Dodaj ryÅ¼, mieszaj 2 minuty.',
                            'Zalej bulionem, gotuj pod przykryciem 25 min.',
                            'Dopraw sosem sojowym i pieprzem.',
                            'Posyp cebulkÄ… i sezamem.'
                        ],
                        benefits: 'Wzmacnia pÅ‚uca, wspiera trawienie i poprawia krÄ…Å¼enie.',
                        tcmProperties: 'Tonizuje Qi pÅ‚uc, wzmacnia Å›ledzionÄ™, harmonizuje Qi'
                    },
                    {
                        name: 'Herbata BiaÅ‚a z ChryzantemÄ…',
                        emoji: 'ðŸŒ¼',
                        time: '8 min',
                        temperature: 'CiepÅ‚a',
                        ingredients: [
                            '1 Å‚yÅ¼eczka biaÅ‚ej herbaty',
                            '5-6 suszonych kwiatÃ³w chryzantemy',
                            '1 szklanka wody (80Â°C)',
                            '1 plasterek gruszki',
                            'MiÃ³d do smaku',
                            'Kilka listkÃ³w miÄ™ty'
                        ],
                        instructions: [
                            'WodÄ™ podgrzej do 80Â°C (nie gotuj!).',
                            'W czajniczku poÅ‚Ä…cz herbatÄ™ z chryzantemÄ….',
                            'Zalej ciepÅ‚Ä… wodÄ….',
                            'Zaparzaj 5-6 minut.',
                            'PrzecedÅº do filiÅ¼anki.',
                            'Dodaj plasterek gruszki i miÃ³d.',
                            'Udekoruj miÄ™tÄ…, pij powoli.'
                        ],
                        benefits: 'Oczyszcza pÅ‚uca, uspokaja umysÅ‚ i wspiera jasnoÅ›Ä‡ myÅ›lenia.',
                        tcmProperties: 'Oczyszcza CiepÅ‚o z pÅ‚uc, uspokaja Shen, rozjaÅ›nia oczy'
                    }
                ],
                'Woda': [
                    {
                        name: 'RosÃ³Å‚ z Goji i Imbirem',
                        emoji: 'ðŸœ',
                        time: '90 min',
                        temperature: 'GorÄ…ca',
                        ingredients: [
                            '1 kg koÅ›ci woÅ‚owych',
                            '2 Å‚yÅ¼ki jagÃ³d goji',
                            '5 cm Å›wieÅ¼ego imbiru',
                            '2 marchwie',
                            '1 seler naciowy',
                            '1 cebula',
                            '2 liÅ›cie laurowe',
                            'Pietruszka Å›wieÅ¼a',
                            'SÃ³l morska'
                        ],
                        instructions: [
                            'KoÅ›ci opÅ‚ucz i wÅ‚Ã³Å¼ do garnka.',
                            'Zalej zimnÄ… wodÄ…, doprowadÅº do wrzenia.',
                            'Zdejmij pianÄ™, dodaj pokrojone warzywa.',
                            'Dodaj imbir i liÅ›cie laurowe.',
                            'Gotuj na maÅ‚ym ogniu 90 minut.',
                            'Na 15 minut przed koÅ„cem dodaj goji.',
                            'PrzecedÅº rosÃ³Å‚ przez sitko.',
                            'Podawaj z pietruszkÄ™ i solÄ….'
                        ],
                                                 benefits: `Wzmacnia nerki, dostarcza kolagenu i rozgrzewa organizm zimÄ… ${new Date().getFullYear()}.`,
                        tcmProperties: 'Tonizuje Yang nerek, wzmacnia esencjÄ™ Jing, odÅ¼ywia szpik kostny'
                    },
                    {
                        name: 'Pierogi z KapustÄ… KiszonÄ…',
                        emoji: 'ðŸ¥Ÿ',
                        time: '120 min',
                        temperature: 'GorÄ…ca',
                        ingredients: [
                            '500g mÄ…ki pszennej',
                            '250ml ciepÅ‚ej wody',
                            '1 jajko',
                            '400g kapusty kiszonej',
                            '200g kieÅ‚basy',
                            '1 cebula',
                            '2 Å‚yÅ¼ki masÅ‚a',
                            'Kminek',
                            'Pieprz czarny'
                        ],
                        instructions: [
                            'Z mÄ…ki, wody i jajka wyrÃ³b ciasto.',
                            'Pozostaw pod Å›ciereczkÄ… na 30 minut.',
                            'KapustÄ™ odsÄ…cz i drobno posiekaj.',
                            'KieÅ‚basÄ™ i cebulÄ™ pokrÃ³j w kostki.',
                            'PodsmaÅ¼ cebulÄ™, dodaj kieÅ‚basÄ™ i kapustÄ™.',
                            'DuÅ› 15 minut, dopraw.',
                            'RozwaÅ‚kuj ciasto, wytnij koÅ‚a.',
                            'NaÅ‚Ã³Å¼ nadzienie, zlepi i ugotuj.'
                        ],
                        benefits: 'Wspiera trawienie, dostarcza probiotykÃ³w i rozgrzewa Qi nerek.',
                        tcmProperties: 'Wzmacnia Yang Å›ledziony, tonizuje Qi nerek, reguluje trawienie'
                    },
                    {
                        name: 'Herbata Pu-erh z CytrynÄ…',
                        emoji: 'ðŸ‹',
                        time: '12 min',
                        temperature: 'GorÄ…ca',
                        ingredients: [
                            '1 Å‚yÅ¼eczka herbaty pu-erh',
                            '1 szklanka wody',
                            '2 plasterki cytryny',
                            '1 cm Å›wieÅ¼ego imbiru',
                            '1 Å‚yÅ¼eczka miodu',
                            'Cynamon w lasce',
                            'GoÅºdziki (2 sztuki)'
                        ],
                        instructions: [
                            'HerbatÄ™ pu-erh przepÅ‚ucz ciepÅ‚Ä… wodÄ….',
                            'Zagotuj wodÄ™ z imbirem i przyprawami.',
                            'Zalej herbatÄ™, zaparzaj 8 minut.',
                            'PrzecedÅº przez sitko.',
                            'Dodaj plasterki cytryny i miÃ³d.',
                            'Mieszaj delikatnie.',
                            'Pij gorÄ…cÄ…, najlepiej wieczorem.'
                        ],
                        benefits: 'Wspiera trawienie tÅ‚uszczy, oczyszcza organizm i rozgrzewa wnÄ™trznoÅ›ci.',
                        tcmProperties: 'Reguluje Qi Å›ledziony, rozpuszcza WilgoÄ‡, wzmacnia Yang'
                    }
                ]
            };
            
            return recipes[element] || recipes['OgieÅ„'];
        }

        function getElementIcon(element) {
            const icons = {
                'Drewno': 'fas fa-leaf',
                'OgieÅ„': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return icons[element] || 'fas fa-utensils';
        }

        function showRecipeDetails(element, recipeIndex) {
            const recipes = getSeasonalRecipes(element);
            const recipe = recipes[recipeIndex];
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (!recipe) return;
            
            const modal = document.createElement('div');
            modal.className = 'recipe-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeRecipeModal();
            };
            
            modal.innerHTML = `
                <div class="recipe-modal-content" style="border-color: ${getElementColor(element)};">
                    <button class="close-modal-btn" onclick="closeRecipeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="recipe-modal-header">
                        <div class="recipe-modal-icon">
                            ${recipe.emoji}
                        </div>
                        <div style="flex: 1;">
                            <div class="recipe-modal-title">${recipe.name}</div>
                            <div class="recipe-modal-meta">
                                <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                                <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                                <span><i class="${getElementIcon(element)}"></i> Element ${element}</span>
                                <span><i class="fas fa-calendar"></i> Sezon ${new Date().getFullYear()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-shopping-cart"></i>
                            SkÅ‚adniki
                        </div>
                        <ul class="recipe-ingredients-list">
                            ${recipe.ingredients.map(ingredient => `<li>â€¢ ${ingredient}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-list-ol"></i>
                            SposÃ³b przygotowania
                        </div>
                        <div class="recipe-instructions">
                            <ol>
                                ${recipe.instructions.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-heart"></i>
                            KorzyÅ›ci zdrowotne
                        </div>
                        <div class="recipe-benefits">
                            ${recipe.benefits}
                        </div>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)}; background: rgba(255, 193, 7, 0.1);">
                        <div class="recipe-section-title">
                            <i class="fas fa-yin-yang"></i>
                            WÅ‚aÅ›ciwoÅ›ci TCM (Admin)
                        </div>
                        <div class="season-info-content">
                            <strong>DziaÅ‚anie na organizm:</strong><br>
                            ${recipe.tcmProperties}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentRecipeModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeRecipeModal() {
            if (window.currentRecipeModal) {
                window.currentRecipeModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentRecipeModal && document.body.contains(window.currentRecipeModal)) {
                        document.body.removeChild(window.currentRecipeModal);
                    }
                    window.currentRecipeModal = null;
                }, 300);
            }
        }

        function getElementColor(element) {
            const colors = {
                'Drewno': '#4CAF50',
                'OgieÅ„': '#F44336',
                'Ziemia': '#FFC107',
                'Metal': '#9E9E9E',
                'Woda': '#2196F3'
            };
            return colors[element] || '#4CAF50';
        }

        function generateShoppingList() {
            const currentSeason = updateSeason();
            const recipes = getSeasonalRecipes(currentSeason.element);
            
            // Collect all ingredients from current season recipes
            const allIngredients = [];
            recipes.forEach(recipe => {
                allIngredients.push(...recipe.ingredients);
            });
            
            // Remove duplicates and create clean list
            const uniqueIngredients = [...new Set(allIngredients.map(ingredient => 
                ingredient.replace(/^\d+\s*(szklanki?|Å‚yÅ¼ki?|Å‚yÅ¼eczki?|cm|g|ml|kg|sztuki?|litr|plaster|plasterki|zÄ…bki?)\s*/i, '')
                    .replace(/\s*\([^)]*\)/g, '')
                    .trim()
            ))];
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeShoppingListModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                    <button class="close-modal-btn" onclick="closeShoppingListModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                            ðŸ›’
                        </div>
                        <div>
                            <div class="season-modal-title">Lista ZakupÃ³w Sezonowych</div>
                                                         <div class="season-modal-subtitle">${currentSeason.name} â€¢ Rok ${new Date().getFullYear()}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-shopping-basket"></i>
                            SkÅ‚adniki z przepisÃ³w sezonowych
                        </div>
                        <ul class="season-info-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                            ${uniqueIngredients.map(ingredient => `
                                <li style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px;">
                                    âœ… ${ingredient}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Porady zakupowe TCM
                        </div>
                        <div class="season-info-content">
                            ${getSeasonalShoppingTips(currentSeason.element)}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="action-btn" onclick="printShoppingList()" style="margin-right: 10px;">
                            ðŸ–¨ï¸ Wydrukuj listÄ™
                        </button>
                        <button class="action-btn" onclick="shareShoppingList()">
                            ðŸ“± UdostÄ™pnij
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentShoppingModal = modal;
        }

        function getSeasonalShoppingTips(element) {
            const tips = {
                'Drewno': 'Wybieraj mÅ‚ode, Å›wieÅ¼e warzywa liÅ›ciaste. Unikaj przetworzonej Å¼ywnoÅ›ci. Szukaj produktÃ³w bogatych w witaminÄ™ C i chlorofil.',
                'OgieÅ„': 'Kupuj chÅ‚odzÄ…ce owoce i warzywa. Unikaj rozgrzewajÄ…cych przypraw. Wybieraj lekkie, Å‚atwo strawne produkty.',
                'Ziemia': 'Skoncentruj siÄ™ na sÅ‚odkich, odÅ¼ywczych produktach. Wybieraj ziarna i korzenie. Unikaj zimnych napojÃ³w.',
                'Metal': 'Kupuj biaÅ‚e produkty i te bogate w skÅ‚adniki nawilÅ¼ajÄ…ce. Wybieraj orzechy i nasiona. Unikaj suchej Å¼ywnoÅ›ci.',
                'Woda': 'Skoncentruj siÄ™ na ciepÅ‚ych, odÅ¼ywczych produktach. Wybieraj ciemne ziarna i owoce morza. Unikaj zimnych pokarmÃ³w.'
            };
            return tips[element] || tips['OgieÅ„'];
        }

        function closeShoppingListModal() {
            if (window.currentShoppingModal) {
                window.currentShoppingModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentShoppingModal && document.body.contains(window.currentShoppingModal)) {
                        document.body.removeChild(window.currentShoppingModal);
                    }
                    window.currentShoppingModal = null;
                }, 300);
            }
        }

        function printShoppingList() {
            window.print();
            showNotification('ðŸ–¨ï¸ Lista zakupÃ³w przygotowana do druku!');
        }

        function shareShoppingList() {
            const currentYear = new Date().getFullYear();
            if (navigator.share) {
                navigator.share({
                    title: `Lista ZakupÃ³w Sezonowych - SezonoweDobro ${currentYear}`,
                    text: 'SprawdÅº mojÄ… listÄ™ zakupÃ³w wedÅ‚ug Tradycyjnej Medycyny ChiÅ„skiej!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href);
                showNotification('ðŸ“± Link do aplikacji skopiowany do schowka!');
            }
        }

        // Dynamic Year Updates
        function updateCurrentYear() {
            const currentYear = new Date().getFullYear();
            
            // Update all year references
            const yearElements = document.querySelectorAll('.current-year');
            yearElements.forEach(element => {
                element.textContent = currentYear;
            });
            
            // Update taglines
            const taglines = document.querySelectorAll('.tagline');
            taglines.forEach(tagline => {
                tagline.textContent = `Tradycyjna Medycyna ChiÅ„ska dla WspÃ³Å‚czesnego Å»ycia â€¢ ${currentYear}`;
            });
            
            // Update welcome message
            setTimeout(() => {
                if (localStorage.getItem('isLoggedIn') === 'true') {
                    showNotification(`Witaj w Twojej podrÃ³Å¼y do zdrowia w roku ${currentYear}! ðŸŒŸ`);
                }
            }, 1000);
            
            // Update admin stats
            updateAdminStats(currentYear);
            
            // Update shopping list modal subtitle
            const shoppingModalSubtitles = document.querySelectorAll('.shopping-modal-subtitle');
            shoppingModalSubtitles.forEach(subtitle => {
                const seasonName = subtitle.textContent.split(' â€¢ ')[0];
                subtitle.textContent = `${seasonName} â€¢ Rok ${currentYear}`;
            });
            
            return currentYear;
        }
        
                 function updateAdminStats(year) {
             // Update user stats for current year
             const userYearLabels = document.querySelectorAll('[data-year="users"]');
             userYearLabels.forEach(label => {
                 label.textContent = `UÅ¼ytkownicy ${year}`;
             });
             
             const recipeYearLabels = document.querySelectorAll('[data-year="recipes"]');
             recipeYearLabels.forEach(label => {
                 label.textContent = `Przepisy ${year}`;
             });
             
             const serverStatusElements = document.querySelectorAll('[data-year="server"]');
             serverStatusElements.forEach(element => {
                 element.textContent = `Status serwera: Online â€¢ ${year}`;
             });
             
             const activeUserElements = document.querySelectorAll('[data-year="active-users"]');
             activeUserElements.forEach(element => {
                 element.textContent = `Aktywni uÅ¼ytkownicy ${year}: 347`;
             });
         }

         // Herbs and Emotions Functions
         function showHerbsAndEmotions() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'herbs-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeHerbsModal();
             };
             
             const herbsData = getHerbsAndEmotionsData();
             
             modal.innerHTML = `
                 <div class="herbs-modal-content">
                     <button class="close-modal-btn" onclick="closeHerbsModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             ðŸŒ¿
                         </div>
                         <div>
                             <div class="season-modal-title">ZioÅ‚a i Emocje w TCM</div>
                             <div class="season-modal-subtitle">Naturalne wsparcie emocjonalne â€¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${herbsData.map(category => `
                         <div class="herbs-category" onclick="toggleHerbsCategory(this)">
                             <div class="herbs-category-header">
                                 <div class="herbs-category-title">
                                     <div class="herbs-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.emotion} â€¢ Element ${category.element}
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down herbs-expand-icon"></i>
                             </div>
                             <div class="herbs-category-content">
                                 <div class="herbs-grid">
                                     ${category.herbs.map(herb => `
                                         <div class="herb-card" style="border-left-color: ${category.color};">
                                             <div class="herb-header">
                                                 <span class="herb-emoji">${herb.emoji}</span>
                                                 <span class="herb-name">${herb.name}</span>
                                             </div>
                                             <div class="herb-description">
                                                 ${herb.description}
                                             </div>
                                             <div class="herb-properties" style="border-left-color: ${category.color};">
                                                 <div class="herb-properties-title">WÅ‚aÅ›ciwoÅ›ci TCM</div>
                                                 <div class="herb-properties-text">
                                                     <strong>DziaÅ‚anie:</strong> ${herb.action}<br>
                                                     <strong>Temperatura:</strong> ${herb.temperature}<br>
                                                     <strong>Smak:</strong> ${herb.taste}
                                                     ${userRole === 'admin' ? `<br><strong>Meridian:</strong> ${herb.meridian}<br><strong>Dawkowanie:</strong> ${herb.dosage}` : ''}
                                                 </div>
                                             </div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentHerbsModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleHerbsCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeHerbsModal() {
             if (window.currentHerbsModal) {
                 window.currentHerbsModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentHerbsModal && document.body.contains(window.currentHerbsModal)) {
                         document.body.removeChild(window.currentHerbsModal);
                     }
                     window.currentHerbsModal = null;
                 }, 300);
             }
         }

         // Face Yoga Functions
         function showFaceYoga() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'face-yoga-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeFaceYogaModal();
             };
             
             const yogaData = getFaceYogaData();
             
             modal.innerHTML = `
                 <div class="face-yoga-modal-content">
                     <button class="close-modal-btn" onclick="closeFaceYogaModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             ðŸ§˜â€â™€ï¸
                         </div>
                         <div>
                             <div class="season-modal-title">Joga Twarzy</div>
                             <div class="season-modal-subtitle">Naturalne odmÅ‚adzanie wedÅ‚ug TCM â€¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${yogaData.map(category => `
                         <div class="yoga-category" onclick="toggleYogaCategory(this)">
                             <div class="yoga-category-header">
                                 <div class="yoga-category-title">
                                     <div class="yoga-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} â€¢ ${category.exercises.length} Ä‡wiczeÅ„
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down yoga-expand-icon"></i>
                             </div>
                             <div class="yoga-category-content">
                                 <div class="yoga-exercises-grid">
                                     ${category.exercises.map(exercise => `
                                         <div class="yoga-exercise-card" style="border-left-color: ${category.color};">
                                             <div class="yoga-exercise-header">
                                                 <span class="yoga-exercise-emoji">${exercise.emoji}</span>
                                                 <span class="yoga-exercise-name">${exercise.name}</span>
                                             </div>
                                             <div class="yoga-exercise-description">
                                                 ${exercise.description}
                                             </div>
                                             <div class="yoga-exercise-steps" style="border-left-color: ${category.color};">
                                                 <div class="yoga-steps-title">Instrukcja krok po kroku</div>
                                                 <ul class="yoga-steps-list">
                                                     ${exercise.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="yoga-benefits" style="border-left-color: ${category.color};">
                                                 <div class="yoga-benefits-title">KorzyÅ›ci</div>
                                                 <div class="yoga-benefits-text">
                                                     ${exercise.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE ADMIN</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Meridian:</strong> ${exercise.meridian}<br>
                                                         <strong>Element TCM:</strong> ${exercise.element}<br>
                                                         <strong>Energia:</strong> ${exercise.energy}<br>
                                                         <strong>Przeciwwskazania:</strong> ${exercise.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="yoga-duration">â±ï¸ ${exercise.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentFaceYogaModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleYogaCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeFaceYogaModal() {
             if (window.currentFaceYogaModal) {
                 window.currentFaceYogaModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentFaceYogaModal && document.body.contains(window.currentFaceYogaModal)) {
                         document.body.removeChild(window.currentFaceYogaModal);
                     }
                     window.currentFaceYogaModal = null;
                 }, 300);
             }
         }

         // Seasonal Energy Functions
         function updateSeasonalEnergyButton() {
             const currentSeason = updateSeason();
             const button = document.getElementById('seasonalEnergyButton');
             const icon = document.getElementById('seasonalEnergyIcon');
             const text = document.getElementById('seasonalEnergyText');
             
             if (!button || !icon || !text) return;
             
             const seasonalData = {
                 'Drewno': {
                     name: 'Wiosenna Energia',
                     icon: 'fas fa-leaf',
                     emoji: 'ðŸŒ±',
                     color: '#4CAF50'
                 },
                 'OgieÅ„': {
                     name: 'Letnia Energia', 
                     icon: 'fas fa-fire',
                     emoji: 'ðŸ”¥',
                     color: '#F44336'
                 },
                 'Ziemia': {
                     name: 'Energia Ziemi',
                     icon: 'fas fa-mountain',
                     emoji: 'ðŸŒ¾',
                     color: '#FFC107'
                 },
                 'Metal': {
                     name: 'Jesienna Energia',
                     icon: 'fas fa-wind',
                     emoji: 'ðŸ‚',
                     color: '#9E9E9E'
                 },
                 'Woda': {
                     name: 'Zimowa Energia',
                     icon: 'fas fa-snowflake',
                     emoji: 'â„ï¸',
                     color: '#2196F3'
                 }
             };
             
             const seasonData = seasonalData[currentSeason.element] || seasonalData['OgieÅ„'];
             
             // Update button appearance
             icon.className = `${seasonData.icon} feature-icon`;
             icon.style.color = seasonData.color;
             text.textContent = seasonData.name;
             
             // Add seasonal gradient background
             button.style.background = `linear-gradient(135deg, ${seasonData.color}15, ${seasonData.color}05)`;
             button.style.borderColor = `${seasonData.color}30`;
         }

         function showSeasonalEnergy() {
             const currentSeason = updateSeason();
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'seasonal-energy-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeSeasonalEnergyModal();
             };
             
             const energyData = getSeasonalEnergyData(currentSeason.element);
             
             modal.innerHTML = `
                 <div class="seasonal-energy-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                     <button class="close-modal-btn" onclick="closeSeasonalEnergyModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                             ${getSeasonalEmoji(currentSeason.element)}
                         </div>
                         <div>
                             <div class="season-modal-title">${getSeasonalName(currentSeason.element)}</div>
                             <div class="season-modal-subtitle">Praktyki energetyczne wedÅ‚ug TCM â€¢ ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${energyData.map(category => `
                         <div class="energy-practice-category" onclick="toggleEnergyCategory(this)">
                             <div class="energy-practice-header">
                                 <div class="energy-practice-title">
                                     <div class="energy-practice-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} â€¢ ${category.practices.length} praktyk
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down energy-expand-icon"></i>
                             </div>
                             <div class="energy-practice-content">
                                 <div class="energy-practices-grid">
                                     ${category.practices.map(practice => `
                                         <div class="energy-practice-card" style="border-left-color: ${category.color};">
                                             <div class="energy-practice-card-header">
                                                 <span class="energy-practice-emoji">${practice.emoji}</span>
                                                 <span class="energy-practice-name">${practice.name}</span>
                                             </div>
                                             <div class="energy-practice-description">
                                                 ${practice.description}
                                             </div>
                                             <div class="energy-practice-steps" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-steps-title">Instrukcja wykonania</div>
                                                 <ul class="energy-practice-steps-list">
                                                     ${practice.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="energy-practice-benefits" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-benefits-title">KorzyÅ›ci energetyczne</div>
                                                 <div class="energy-practice-benefits-text">
                                                     ${practice.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE TCM (ADMIN)</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Element:</strong> ${practice.element}<br>
                                                         <strong>Typ energii:</strong> ${practice.energyType}<br>
                                                         <strong>Meridian:</strong> ${practice.meridian}<br>
                                                         <strong>Najlepszy czas:</strong> ${practice.bestTime}<br>
                                                         <strong>Przeciwwskazania:</strong> ${practice.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="energy-practice-duration" style="background: ${category.color}20;">â±ï¸ ${practice.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentSeasonalEnergyModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleEnergyCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeSeasonalEnergyModal() {
             if (window.currentSeasonalEnergyModal) {
                 window.currentSeasonalEnergyModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentSeasonalEnergyModal && document.body.contains(window.currentSeasonalEnergyModal)) {
                         document.body.removeChild(window.currentSeasonalEnergyModal);
                     }
                     window.currentSeasonalEnergyModal = null;
                 }, 300);
             }
         }

         function getSeasonalName(element) {
             const names = {
                 'Drewno': 'Wiosenna Energia',
                 'OgieÅ„': 'Letnia Energia',
                 'Ziemia': 'Energia Ziemi',
                 'Metal': 'Jesienna Energia',
                 'Woda': 'Zimowa Energia'
             };
             return names[element] || 'Letnia Energia';
         }

         function getSeasonalEmoji(element) {
             const emojis = {
                 'Drewno': 'ðŸŒ±',
                 'OgieÅ„': 'ðŸ”¥',
                 'Ziemia': 'ðŸŒ¾',
                 'Metal': 'ðŸ‚',
                 'Woda': 'â„ï¸'
             };
             return emojis[element] || 'ðŸ”¥';
         }

         function getSeasonalEnergyData(element) {
             const allData = {
                 'Drewno': [
                     {
                         name: 'Medytacje Wzrostu',
                         focus: 'Odnowa i nowe poczÄ…tki',
                         emoji: 'ðŸ§˜â€â™€ï¸',
                         color: '#4CAF50',
                         practices: [
                             {
                                 name: 'Medytacja KieÅ‚kowania',
                                 emoji: 'ðŸŒ±',
                                 description: 'Wizualizacja wzrostu nowej energii Å¼yciowej, idealna na wiosnÄ™.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'UsiÄ…dÅº wygodnie twarzÄ… na wschÃ³d (o wschodzie sÅ‚oÅ„ca)',
                                     'Zamknij oczy i wyobraÅº sobie nasiono w swojej wÄ…trobie',
                                     'Z kaÅ¼dym wdechem nasiono napeÅ‚nia siÄ™ zielonÄ… energiÄ…',
                                     'Na wydechu wyobraÅº sobie kieÅ‚ek przebijajÄ…cy siÄ™ przez ziemiÄ™',
                                     'Poczuj jak energia wzrostu przepÅ‚ywa przez caÅ‚e ciaÅ‚o',
                                     'Wizualizuj siebie jako mÅ‚ode drzewko peÅ‚ne Å¼ycia',
                                     'ZakoÅ„cz gÅ‚Ä™bokim oddechem i otwÃ³rz oczy'
                                 ],
                                 benefits: 'OdÅ›wieÅ¼a energiÄ™ wÄ…troby, wspiera detoksykacjÄ™, pobudza kreatywnoÅ›Ä‡',
                                 element: 'Drewno',
                                 energyType: 'Yang rosnÄ…ce',
                                 meridian: 'WÄ…troba (LV), PÄ™cherzyk Å¼Ã³Å‚ciowy (GB)',
                                 bestTime: 'WschÃ³d sÅ‚oÅ„ca (5:00-7:00)',
                                 contraindications: 'NadciÅ›nienie, mania, silne emocje'
                             },
                             {
                                 name: 'Oddychanie Detoksykacyjne',
                                 emoji: 'ðŸŒ¿',
                                 description: 'Specjalna technika oddechowa oczyszczajÄ…ca wÄ…trobÄ™ z toksyn.',
                                 duration: '8-12 minut',
                                 steps: [
                                     'UsiÄ…dÅº prosto, rÄ™ce na kolanach',
                                     'Wdechnij przez nos przez 4 sekundy',
                                     'Zatrzymaj oddech na 2 sekundy',
                                     'Wydechnij przez usta przez 6 sekund z dÅºwiÄ™kiem "Shu"',
                                     'Podczas wydechu wyobraÅº sobie zielony dym opuszczajÄ…cy wÄ…trobÄ™',
                                     'PowtÃ³rz 12 razy (jeden peÅ‚ny cykl)',
                                     'ZakoÅ„cz 3 naturalnymi oddechami'
                                 ],
                                 benefits: 'Oczyszcza wÄ…trobÄ™, redukuje gniew, poprawia elastycznoÅ›Ä‡',
                                 element: 'Drewno',
                                 energyType: 'Yin oczyszczajÄ…ce',
                                 meridian: 'WÄ…troba (LV)',
                                 bestTime: 'Wczesny ranek, przed jedzeniem',
                                 contraindications: 'Zapalenie wÄ…troby, ciÄ…Å¼a, osÅ‚abienie'
                             }
                         ]
                     },
                     {
                         name: 'Ä†wiczenia Energetyczne',
                         focus: 'Aktywacja Qi wÄ…troby',
                         emoji: 'ðŸŒ¿',
                         color: '#4CAF50',
                         practices: [
                             {
                                 name: 'Stretching Smoka',
                                 emoji: 'ðŸ‰',
                                 description: 'Dynamiczne ruchy przywracajÄ…ce elastycznoÅ›Ä‡ meridianÃ³w.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'StaÅ„ w pozycji szerokiej, rÄ™ce wzdÅ‚uÅ¼ ciaÅ‚a',
                                     'WyciÄ…gnij rÄ™ce w bok na wysokoÅ›Ä‡ ramion',
                                     'SkrÄ™Ä‡ tuÅ‚Ã³w w lewo, wydychajÄ…c "Shu"',
                                     'WrÃ³Ä‡ do centrum, wdychajÄ…c gÅ‚Ä™boko',
                                     'SkrÄ™Ä‡ tuÅ‚Ã³w w prawo, wydychajÄ…c "Shu"',
                                     'PowtÃ³rz 8 razy w kaÅ¼dÄ… stronÄ™',
                                     'ZakoÅ„cz trzema gÅ‚Ä™bokimi oddechami'
                                 ],
                                 benefits: 'Uwalnia napiÄ™cie w wÄ…trobie, poprawia krÄ…Å¼enie Qi',
                                 element: 'Drewno',
                                 energyType: 'Yang mobilizujÄ…ce',
                                 meridian: 'PÄ™cherzyk Å¼Ã³Å‚ciowy (GB)',
                                 bestTime: 'Rano po przebudzeniu',
                                 contraindications: 'Zawroty gÅ‚owy, problemy z krÄ™gosÅ‚upem'
                             }
                         ]
                     }
                 ],
                 'OgieÅ„': [
                     {
                         name: 'Medytacje RadoÅ›ci',
                         focus: 'Harmonia serca i umysÅ‚u',
                         emoji: 'â¤ï¸',
                         color: '#F44336',
                         practices: [
                             {
                                 name: 'Medytacja Serca Lotosu',
                                 emoji: 'ðŸª·',
                                 description: 'UspokajajÄ…ca praktyka chÅ‚odzÄ…ca nadmiernÄ… energiÄ™ Yang.',
                                 duration: '15-20 minut',
                                 steps: [
                                     'UsiÄ…dÅº w chÅ‚odnym, zacienionym miejscu',
                                     'RÄ™ce zÅ‚Ã³Å¼ w mudra lotosu na sercu',
                                     'Oddychaj powoli i gÅ‚Ä™boko',
                                     'WyobraÅº sobie bÅ‚Ä™kitny lotos w swoim sercu',
                                     'Z kaÅ¼dym oddechem lotos siÄ™ otwiera',
                                     'Poczuj chÅ‚odzÄ…cÄ… energiÄ™ rozlewajÄ…cÄ… siÄ™ po ciele',
                                     'PozostaÅ„ w tym stanie spokoju przez 10 minut',
                                     'Powoli otwÃ³rz oczy z uÅ›miechem'
                                 ],
                                 benefits: 'ChÅ‚odzi nadmiernÄ… energiÄ™, uspokaja emocje, przynosi radoÅ›Ä‡',
                                 element: 'OgieÅ„',
                                 energyType: 'Yin chÅ‚odzÄ…ce',
                                 meridian: 'Serce (HT), Jelito cienkie (SI)',
                                 bestTime: 'PoÅ‚udnie (11:00-13:00) w cieniu',
                                 contraindications: 'Depresja, zimno w ciele, osÅ‚abienie Yang'
                             },
                             {
                                 name: 'Oddychanie ChÅ‚odzÄ…ce',
                                 emoji: 'ðŸŒŠ',
                                 description: 'Technika Sheetali - chÅ‚odzÄ…ce oddychanie z jogi.',
                                 duration: '5-10 minut',
                                 steps: [
                                     'UsiÄ…dÅº twarzÄ… na pÃ³Å‚noc',
                                     'WyciÄ…gnij jÄ™zyk jak rurkÄ™',
                                     'Wdychaj powietrze przez zwiniÄ™ty jÄ™zyk',
                                     'Poczuj chÅ‚odzÄ…ce wraÅ¼enie w ustach',
                                     'Zamknij usta i wydechnij przez nos',
                                     'WyobraÅº sobie chÅ‚odzÄ…cÄ… energiÄ™ w sercu',
                                     'PowtÃ³rz 20-30 razy',
                                     'ZakoÅ„cz naturalnym oddychaniem'
                                 ],
                                 benefits: 'OchÅ‚adza organizm, uspokaja Shen, redukuje stres cieplny oraz wzmacnia energiÄ™ Yin w sercu',
                                 element: 'OgieÅ„',
                                 energyType: 'Yin nawilÅ¼ajÄ…ce',
                                 meridian: 'Serce (HT), PÅ‚uca (LU)',
                                 bestTime: 'GorÄ…ce dni, po poÅ‚udniu',
                                 contraindications: 'PrzeziÄ™bienie, sÅ‚aba energia, zima'
                             }
                         ]
                     },
                     {
                         name: 'Ä†wiczenia ChÅ‚odzÄ…ce',
                         focus: 'OchÅ‚adzanie organizmu',
                         emoji: 'â„ï¸',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Ruch ÅabÄ™dzia w Wodzie',
                                 emoji: 'ðŸ¦¢',
                                 description: 'PÅ‚ynne ruchy Å‚agodzÄ…ce nadmiernÄ… energiÄ™ Yang.',
                                 duration: '12-20 minut',
                                 steps: [
                                     'StaÅ„ tyÅ‚em do sÅ‚oÅ„ca w cieniu',
                                     'RÄ™ce unieÅ› powoli nad gÅ‚owÄ™ jak skrzydÅ‚a',
                                     'Pochyl siÄ™ do przodu z prostymi plecami',
                                     'RÄ™ce opuÅ›Ä‡ w dÃ³Å‚ jak Å‚abÄ™dÅº nurkujÄ…cy',
                                     'Powoli prostuj siÄ™, unoszÄ…c rÄ™ce',
                                     'Oddychaj gÅ‚Ä™boko i spokojnie',
                                     'PowtÃ³rz 10-15 razy bardzo powoli'
                                 ],
                                 benefits: 'Uspokaja Shen, ochÅ‚adza krew, rÃ³wnowaÅ¼y emocje',
                                 element: 'OgieÅ„',
                                 energyType: 'Yin harmonizujÄ…ce',
                                 meridian: 'OsierdziÐº (PC), Trzeci Ogrzewacz (TH)',
                                 bestTime: 'Wczesny wieczÃ³r w cieniu',
                                 contraindications: 'Zimno w ciele, depresja, sÅ‚aboÅ›Ä‡'
                             }
                         ]
                     },
                     {
                         name: 'Wizualizacje Serca',
                         focus: 'Harmonia emocjonalna',
                         emoji: 'ðŸ’–',
                         color: '#E91E63',
                         practices: [
                             {
                                 name: 'Fontanna SzczÄ™Å›cia',
                                 emoji: 'â›²',
                                 description: 'Wizualizacja chÅ‚odnej fontanny w sercu.',
                                 duration: '8-15 minut',
                                 steps: [
                                     'UsiÄ…dÅº wygodnie twarzÄ… na pÃ³Å‚noc',
                                     'RÄ™ce poÅ‚Ã³Å¼ na sercu',
                                     'WyobraÅº sobie chÅ‚odnÄ… fontannÄ™ w centrum piersi',
                                     'Fontanna rozpryskuje krystalicznie czystÄ… wodÄ™',
                                     'Woda chÅ‚odzi i uspokaja caÅ‚e serce',
                                     'Poczuj radoÅ›Ä‡ i spokÃ³j pÅ‚ynÄ…cy z fontanny',
                                     'PozwÃ³l wodzie obmyÄ‡ wszystkie gorÄ…ce emocje',
                                     'PozostaÅ„ w tym chÅ‚odnym, radosnym stanie'
                                 ],
                                 benefits: 'OchÅ‚adza serce, przynosi radoÅ›Ä‡, uspokaja umysÅ‚',
                                 element: 'OgieÅ„',
                                 energyType: 'Yin nawilÅ¼ajÄ…ce',
                                 meridian: 'Serce (HT)',
                                 bestTime: 'PoÅ‚udnie, podczas najwiÄ™kszego upaÅ‚u',
                                 contraindications: 'SÅ‚abe serce, zimno w piersiach, smutek'
                             }
                         ]
                     }
                 ],
                 'Ziemia': [
                     {
                         name: 'Medytacje StabilizujÄ…ce',
                         focus: 'RÃ³wnowaga i wewnÄ™trzny spokÃ³j',
                         emoji: 'âš–ï¸',
                         color: '#FFC107',
                         practices: [
                             {
                                 name: 'Medytacja Korzeni',
                                 emoji: 'ðŸŒ³',
                                 description: 'Uziemienie energii i stabilizacja emocji.',
                                 duration: '12-18 minut',
                                 steps: [
                                     'UsiÄ…dÅº na ziemi lub podÅ‚odze',
                                     'WyobraÅº sobie korzenie wyrastajÄ…ce z podstawy krÄ™gosÅ‚upa',
                                     'Korzenie siÄ™gajÄ… gÅ‚Ä™boko do centrum Ziemi',
                                     'Poczuj stabilnoÅ›Ä‡ i uziemienie',
                                     'Oddychaj do brzucha, wzmacniajÄ…c Å›ledzionÄ™',
                                     'Z kaÅ¼dym oddechem stajesz siÄ™ bardziej stabilny',
                                     'Wizualizuj zÅ‚otÄ… energiÄ™ w obszarze Å¼oÅ‚Ä…dka',
                                     'PozostaÅ„ w tym uziemionym stanie'
                                 ],
                                 benefits: 'Stabilizuje emocje, wzmacnia trawienie, daje poczucie bezpieczeÅ„stwa',
                                 element: 'Ziemia',
                                 energyType: 'Qi centrujÄ…ce',
                                 meridian: 'Åšledziona (SP), Å»oÅ‚Ä…dek (ST)',
                                 bestTime: 'PÃ³Åºne popoÅ‚udnie (15:00-17:00)',
                                 contraindications: 'Silne lÄ™ki, claustrofobia, mania'
                             }
                         ]
                     },
                     {
                         name: 'Ä†wiczenia RÃ³wnowagi',
                         focus: 'Stabilizacja centrum',
                         emoji: 'âš–ï¸',
                         color: '#FFC107',
                         practices: [
                             {
                                 name: 'Postawa GÃ³ry',
                                 emoji: 'â›°ï¸',
                                 description: 'Statyczne pozycje wzmacniajÄ…ce centrum ciaÅ‚a.',
                                 duration: '5-12 minut',
                                 steps: [
                                     'StaÅ„ w pozycji hip-width apart',
                                     'WyobraÅº sobie korzenie wyrastajÄ…ce ze stÃ³p',
                                     'Korona gÅ‚owy ciÄ…gnie w gÃ³rÄ™ do nieba',
                                     'Oddychaj do brzucha, powiÄ™kszajÄ…c go na wdechu',
                                     'Poczuj stabilnoÅ›Ä‡ miÄ™dzy niebem a ziemiÄ…',
                                     'PozostaÅ„ nieruchomo jak gÃ³ra',
                                     'Skoncentruj siÄ™ na centrum ciaÅ‚a',
                                     'ZakoÅ„cz trzema gÅ‚Ä™bokimi oddechami'
                                 ],
                                 benefits: 'Wzmacnia Å›ledzionÄ™, poprawia rÃ³wnowagÄ™, stabilizuje emocje',
                                 element: 'Ziemia',
                                 energyType: 'Qi centrowujÄ…ce',
                                 meridian: 'Åšledziona (SP), Å»oÅ‚Ä…dek (ST)',
                                 bestTime: 'PrzejÅ›cia miÄ™dzy sezonami',
                                 contraindications: 'Problemy z rÃ³wnowagÄ…, zawroty gÅ‚owy'
                             }
                         ]
                     }
                 ],
                 'Metal': [
                     {
                         name: 'Medytacje OczyszczajÄ…ce',
                         focus: 'Oddech i wewnÄ™trzna siÅ‚a',
                         emoji: 'ðŸ«',
                         color: '#9E9E9E',
                         practices: [
                             {
                                 name: 'Medytacja BiaÅ‚ego Tygrysa',
                                 emoji: 'ðŸ…',
                                 description: 'Wzmacnia pÅ‚uca i wewnÄ™trznÄ… siÅ‚Ä™ obronnÄ… Wei Qi.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'UsiÄ…dÅº twarzÄ… na zachÃ³d',
                                     'RÄ™ce uÅ‚Ã³Å¼ na piersiach',
                                     'Oddychaj gÅ‚Ä™boko do pÅ‚uc',
                                     'WyobraÅº sobie biaÅ‚ego tygrysa w pÅ‚ucach',
                                     'Tygrys jest straÅ¼nikiem Twojej energii',
                                     'Z kaÅ¼dym wdechem tygrys staje siÄ™ silniejszy',
                                     'Poczuj siÅ‚Ä™ i ochronÄ™ w klatce piersiowej',
                                     'Na wydechu wypuÅ›Ä‡ wszystko co zbÄ™dne'
                                 ],
                                 benefits: 'Wzmacnia odpornoÅ›Ä‡, oczyszcza pÅ‚uca, buduje Wei Qi',
                                 element: 'Metal',
                                 energyType: 'Yang obronne',
                                 meridian: 'PÅ‚uca (LU), Jelito grube (LI)',
                                 bestTime: 'ZachÃ³d sÅ‚oÅ„ca (17:00-19:00)',
                                 contraindications: 'Astma ostra, silne emocje, nadciÅ›nienie'
                             }
                         ]
                     },
                     {
                         name: 'Ä†wiczenia Oddechowe',
                         focus: 'Wzmocnienie pÅ‚uc',
                         emoji: 'ðŸŒ¬ï¸',
                         color: '#9E9E9E',
                         practices: [
                             {
                                 name: 'Oddychanie Jesiennego Wiatru',
                                 emoji: 'ðŸƒ',
                                 description: 'OczyszczajÄ…ca technika oddechowa na jesieÅ„.',
                                 duration: '8-15 minut',
                                 steps: [
                                     'UsiÄ…dÅº twarzÄ… na zachÃ³d',
                                     'RÄ™ce uÅ‚Ã³Å¼ na dolnych Å¼ebrach',
                                     'Wdechnij gÅ‚Ä™boko, rozszerzajÄ…c Å¼ebra',
                                     'Wydechnij powoli z dÅºwiÄ™kiem "Si"',
                                     'WyobraÅº sobie biaÅ‚y dym opuszczajÄ…cy pÅ‚uca',
                                     'Poczuj jak pÅ‚uca siÄ™ oczyszczajÄ…',
                                     'PowtÃ³rz 18 razy (liczba Metal)',
                                     'ZakoÅ„cz naturalnym oddychaniem'
                                 ],
                                 benefits: 'Oczyszcza pÅ‚uca, wzmacnia Wei Qi, poprawia odpornoÅ›Ä‡',
                                 element: 'Metal',
                                 energyType: 'Yang oczyszczajÄ…ce',
                                 meridian: 'PÅ‚uca (LU), Jelito grube (LI)',
                                 bestTime: 'Jesienne poranki',
                                 contraindications: 'Astma ciÄ™Å¼ka, silny kaszel, gorÄ…czka'
                             }
                         ]
                     }
                 ],
                 'Woda': [
                     {
                         name: 'Medytacje RegenerujÄ…ce',
                         focus: 'Odnowa i gÅ‚Ä™boki odpoczynek',
                         emoji: 'ðŸŒ™',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Medytacja Ciemnej Wody',
                                 emoji: 'ðŸŒŠ',
                                 description: 'GÅ‚Ä™boka regeneracja energii Yin i esencji Jing.',
                                 duration: '20-30 minut',
                                 steps: [
                                     'UÅ‚Ã³Å¼ siÄ™ wygodnie w ciemnym pomieszczeniu',
                                     'RÄ™ce poÅ‚Ã³Å¼ na dolnej czÄ™Å›ci brzucha',
                                     'Oddychaj bardzo powoli i gÅ‚Ä™boko',
                                     'WyobraÅº sobie czarnÄ… wodÄ™ w nerkach',
                                     'Woda jest spokojna i gÅ‚Ä™boka jak ocean',
                                     'Poczuj jak energia gromadzi siÄ™ w nerkach',
                                     'PozwÃ³l ciaÅ‚u caÅ‚kowicie siÄ™ zrelaksowaÄ‡',
                                     'PozostaÅ„ w tym stanie gÅ‚Ä™bokiego spokoju'
                                 ],
                                 benefits: 'Odnawia esencjÄ™ Jing, wzmacnia nerki, regeneruje Yin',
                                 element: 'Woda',
                                 energyType: 'Yin esencjonalne',
                                 meridian: 'Nerki (KI), PÄ™cherz moczowy (BL)',
                                 bestTime: 'WieczÃ³r (19:00-21:00)',
                                 contraindications: 'Depresja, nadmierna sennoÅ›Ä‡, brak motywacji'
                             }
                         ]
                     },
                     {
                         name: 'Ä†wiczenia RegenerujÄ…ce',
                         focus: 'Odnowa esencji Å¼yciowej',
                         emoji: 'ðŸ”‹',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'MasaÅ¼ Nerek',
                                 emoji: 'ðŸ‘',
                                 description: 'Gentle self-massage do wzmocnienia Jing.',
                                 duration: '10-20 minut',
                                 steps: [
                                     'UsiÄ…dÅº wygodnie, plecy proste',
                                     'Rozgrzej dÅ‚onie pocierajÄ…c je o siebie',
                                     'PoÅ‚Ã³Å¼ dÅ‚onie na dolnej czÄ™Å›ci plecÃ³w (nerki)',
                                     'Masuj okrÄ™Å¼nymi ruchami 36 razy',
                                     'Poczuj ciepÅ‚o przenikajÄ…ce do nerek',
                                     'Oddychaj gÅ‚Ä™boko do brzucha',
                                     'Wizualizuj czarnÄ… wodÄ™ napeÅ‚niajÄ…cÄ… nerki',
                                     'ZakoÅ„cz, pozostawiajÄ…c dÅ‚onie na nerkach'
                                 ],
                                 benefits: 'Wzmacnia esencjÄ™ Jing, regeneruje nerki, poprawia witalnoÅ›Ä‡',
                                 element: 'Woda',
                                 energyType: 'Yang aktywizujÄ…ce',
                                 meridian: 'Nerki (KI)',
                                 bestTime: 'WieczÃ³r przed snem',
                                 contraindications: 'Zapalenie nerek, gorÄ…czka, hiperttensja'
                             }
                         ]
                     },
                     {
                         name: 'Medytacje Nocne',
                         focus: 'GÅ‚Ä™boka regeneracja',
                         emoji: 'ðŸŒœ',
                         color: '#1A237E',
                         practices: [
                             {
                                 name: 'Sen Nefrytu',
                                 emoji: 'ðŸ’Ž',
                                 description: 'Przygotowanie do regenerujÄ…cego snu.',
                                 duration: '15-30 minut',
                                 steps: [
                                     'PoÅ‚Ã³Å¼ siÄ™ w ciemnym, cichym pokoju',
                                     'RÄ™ce na dolnej czÄ™Å›ci brzucha (Dan Tian)',
                                     'Oddychaj bardzo powoli i cicho',
                                     'WyobraÅº sobie czarny nefryty w nerkach',
                                     'Nefryty gromadzi energiÄ™ Å¼yciowÄ…',
                                     'PozwÃ³l ciaÅ‚u caÅ‚kowicie siÄ™ rozluÅºniÄ‡',
                                     'Poczuj jak energia zgromadzona w nerkach',
                                     'PÅ‚ynnie przejdÅº w sen lub gÅ‚Ä™bokÄ… relaksacjÄ™'
                                 ],
                                 benefits: 'Restauruje Jing, przygotowuje do gÅ‚Ä™bokiego snu, odnawia Å¼ycie',
                                 element: 'Woda',
                                 energyType: 'Yin esencjonalne',
                                 meridian: 'Nerki (KI), PÄ™cherz (BL)',
                                 bestTime: 'TuÅ¼ przed snem (21:00-23:00)',
                                 contraindications: 'BezsennoÅ›Ä‡, lÄ™ki, nadmiernia stymulacja'
                             }
                         ]
                     }
                 ]
             };
             
             return allData[element] || allData['OgieÅ„'];
         }

         function getFaceYogaData() {
             return [
                 {
                     name: 'Ä†wiczenia na Oczy',
                     focus: 'Redukcja zmarszczek i workÃ³w',
                     emoji: 'ðŸ‘ï¸',
                     color: '#2196F3',
                     exercises: [
                         {
                             name: 'Mruganie Motylem',
                             emoji: 'ðŸ¦‹',
                             description: 'Delikatne Ä‡wiczenie poprawiajÄ…ce krÄ…Å¼enie wokÃ³Å‚ oczu i redukujÄ…ce napiÄ™cie.',
                             duration: '2-3 minuty',
                             steps: [
                                 'UsiÄ…dÅº wygodnie z prostymi plecami',
                                 'Zamknij oczy delikatnie, bez napinania',
                                 'Powoli otwÃ³rz oczy jak motyl rozpoÅ›cierajÄ…cy skrzydÅ‚a',
                                 'Mrugaj bardzo powoli 10 razy',
                                 'NastÄ™pnie mrugaj szybko przez 10 sekund',
                                 'ZakoÅ„cz 3 gÅ‚Ä™bokimi, powolnymi mrugniÄ™ciami'
                             ],
                             benefits: 'Poprawia krÄ…Å¼enie, redukuje zmarszczki wokÃ³Å‚ oczu, Å‚agodzi zmÄ™czenie wzroku',
                             meridian: 'PÄ™cherzyk Å¼Ã³Å‚ciowy (GB), WÄ…troba (LV)',
                             element: 'Drewno',
                             energy: 'Tonizuje Yin, wzmacnia EsencjÄ™ Nerek',
                             contraindications: 'ÅšwieÅ¼e operacje oczu, zapalenie spojÃ³wek'
                         },
                         {
                             name: 'MasaÅ¼ PunktÃ³w Energetycznych',
                             emoji: 'â˜¯ï¸',
                             description: 'Akupresura punktÃ³w wokÃ³Å‚ oczu wedÅ‚ug tradycji TCM.',
                             duration: '3-5 minut',
                             steps: [
                                 'ZnajdÅº punkt Yuyao (Å›rodek brwi)',
                                 'Delikatnie masuj okrÄ™Å¼nymi ruchami przez 30 sekund',
                                 'PrzejdÅº do punktu Sizhukong (koniec brwi)',
                                 'Masuj punkt Tongziliao (zewnÄ™trzny kÄ…cik oka)',
                                 'ZakoÅ„cz masaÅ¼em punktu Jingming (wewnÄ™trzny kÄ…cik)',
                                 'PowtÃ³rz caÅ‚Ä… sekwencjÄ™ 3 razy'
                             ],
                             benefits: 'Aktywuje meridian Å¼Ã³Å‚ciaoka, poprawia jasnoÅ›Ä‡ wzroku, redukuje obrzÄ™ki',
                             meridian: 'PÄ™cherzyk Å¼Ã³Å‚ciowy (GB), MaÅ‚y Jelito (SI)',
                             element: 'Drewno/OgieÅ„',
                             energy: 'Reguluje przepÅ‚yw Qi, rozpraszra stagnacjÄ™',
                             contraindications: 'Bardzo wraÅ¼liwa skÃ³ra, niedawne zabiegi kosmetyczne'
                         }
                     ]
                 },
                 {
                     name: 'Ä†wiczenia na CzoÅ‚o',
                     focus: 'WygÅ‚adzenie zmarszczek poziomych',
                     emoji: 'ðŸ¤”',
                     color: '#FFC107',
                     exercises: [
                         {
                             name: 'Lifting CzoÅ‚a',
                             emoji: 'â¬†ï¸',
                             description: 'Naturalne wygÅ‚adzanie zmarszczek poziomych na czole.',
                             duration: '2-4 minuty',
                             steps: [
                                 'PoÅ‚Ã³Å¼ palce wskazujÄ…ce nad brwiami',
                                 'Delikatnie naciÅ›nij skÃ³rÄ™ w dÃ³Å‚',
                                 'JednoczeÅ›nie prÃ³buj podnieÅ›Ä‡ brwi do gÃ³ry',
                                 'Utrzymaj napiÄ™cie przez 5 sekund',
                                 'Zrelaksuj miÄ™Å›nie przez 3 sekundy',
                                 'PowtÃ³rz 10-15 razy'
                             ],
                             benefits: 'Wzmacnia miÄ™Å›nie czoÅ‚a, redukuje zmarszczki poziome, poprawia krÄ…Å¼enie',
                             meridian: 'PÄ™cherzyk moczowy (BL), Å»oÅ‚Ä…dek (ST)',
                             element: 'Ziemia/Woda',
                             energy: 'Podnosi Yang Qi, wzmacnia ÅšledzionÄ™',
                             contraindications: 'Botoks w obszarze czoÅ‚a (ostatnie 6 miesiÄ™cy)'
                         },
                         {
                             name: 'MasaÅ¼ Czakry Trzeciego Oka',
                             emoji: 'ðŸ§˜',
                             description: 'Stymulacja punktu Yintang dla relaksu i koncentracji.',
                             duration: '3-5 minut',
                             steps: [
                                 'ZnajdÅº punkt miÄ™dzy brwiami (Yintang)',
                                 'PoÅ‚Ã³Å¼ kciuk na tym punkcie',
                                 'RÃ³b delikatne okrÄ™Å¼ne ruchy przez 1 minutÄ™',
                                 'NastÄ™pnie naciÅ›nij i puÅ›Ä‡ 10 razy',
                                 'Przesuwaj kciuk w gÃ³rÄ™ do punktu Shenting',
                                 'ZakoÅ„cz delikatnym masaÅ¼em caÅ‚ego czoÅ‚a'
                             ],
                             benefits: 'Uspokaja umysÅ‚, redukuje stres, wygÅ‚adza czoÅ‚o, poprawia koncentracjÄ™',
                             meridian: 'Vessel Governing (GV), Dodatkowy Yangming',
                             element: 'Ziemia',
                             energy: 'Uspokaja Shen, harmonizuje Qi',
                             contraindications: 'NadciÅ›nienie, migrena w fazie aktywnej'
                         }
                     ]
                 },
                 {
                     name: 'Ä†wiczenia na Policzki',
                     focus: 'UjÄ™drnienie i lifting naturalny',
                     emoji: 'ðŸ˜Š',
                     color: '#E91E63',
                     exercises: [
                         {
                             name: 'Balon w Policzkach',
                             emoji: 'ðŸŽˆ',
                             description: 'Wzmacnianie miÄ™Å›ni policzkÃ³w i poprawianie owalu twarzy.',
                             duration: '3-5 minut',
                             steps: [
                                 'NapeÅ‚nij powietrzem jeden policzek jak balon',
                                 'Utrzymaj przez 10 sekund',
                                 'PrzerzuÄ‡ powietrze do drugiego policzka',
                                 'Utrzymaj kolejne 10 sekund',
                                 'PrzerzuÄ‡ powietrze pod gÃ³rnÄ… wargÄ™',
                                 'Na koniec pod dolnÄ… wargÄ™',
                                 'PowtÃ³rz caÅ‚Ä… sekwencjÄ™ 5 razy'
                             ],
                             benefits: 'UjÄ™drnia policzki, poprawia owal twarzy, wzmacnia miÄ™Å›nie mimiczne',
                             meridian: 'Å»oÅ‚Ä…dek (ST), Jelito Grube (LI)',
                             element: 'Ziemia/Metal',
                             energy: 'Tonizuje Qi Åšledziony, wzmacnia Yang',
                             contraindications: 'Problemy z szczÄ™kÄ… (TMJ), niedawne zabiegi dentystyczne'
                         },
                         {
                             name: 'UÅ›miech Buddy',
                             emoji: 'ðŸ˜Œ',
                             description: 'Medytacyjne Ä‡wiczenie Å‚Ä…czÄ…ce relaks z wzmocnieniem miÄ™Å›ni.',
                             duration: '5-7 minut',
                             steps: [
                                 'UsiÄ…dÅº w pozycji medytacyjnej',
                                 'Zamknij oczy i oddychaj gÅ‚Ä™boko',
                                 'Narysuj lekki uÅ›miech na twarzy',
                                 'Poczuj jak energia pÅ‚ynie przez policzki',
                                 'Stopniowo poszerz uÅ›miech',
                                 'Utrzymaj przez 30 sekund',
                                 'Powoli powrÃ³Ä‡ do pozycji neutralnej'
                             ],
                             benefits: 'Poprawia nastrÃ³j, redukuje stres, naturalnie podnosi kÄ…ciki ust',
                             meridian: 'Serce (HT), Jelito Cienkie (SI)',
                             element: 'OgieÅ„',
                             energy: 'Raduje Shen, harmonizuje emocje',
                             contraindications: 'Depresja gÅ‚Ä™boka (wymaga ostroÅ¼noÅ›ci)'
                         }
                     ]
                 },
                 {
                     name: 'Ä†wiczenia na SzyjÄ™',
                     focus: 'Redukcja podwÃ³jnego podbrÃ³dka',
                     emoji: 'ðŸ¦¢',
                     color: '#9C27B0',
                     exercises: [
                         {
                             name: 'ÅabÄ™dÅº',
                             emoji: 'ðŸ¦¢',
                             description: 'Eleganckie wydÅ‚uÅ¼anie i wzmacnianie miÄ™Å›ni szyi.',
                             duration: '4-6 minut',
                             steps: [
                                 'UsiÄ…dÅº prosto z wyprostowanÄ… szyjÄ…',
                                 'Powoli wyciÄ…gnij szyjÄ™ do przodu jak Å‚abÄ™dÅº',
                                 'JednoczeÅ›nie unieÅ› podbrÃ³dek',
                                 'Poczuj rozciÄ…gniÄ™cie pod podbrÃ³dkiem',
                                 'Utrzymaj pozycjÄ™ przez 5 sekund',
                                 'Powoli wrÃ³Ä‡ do pozycji poczÄ…tkowej',
                                 'PowtÃ³rz 12-15 razy'
                             ],
                             benefits: 'Redukuje podwÃ³jny podbrÃ³dek, wzmacnia miÄ™Å›nie szyi, poprawia postawÄ™',
                             meridian: 'PÄ™cherzyk Å¼Ã³Å‚ciowy (GB), Vessel Governing (GV)',
                             element: 'Drewno',
                             energy: 'Podnosi Yang, wzmacnia Wei Qi',
                             contraindications: 'Problemy z krÄ™gosÅ‚upem szyjnym, niedawne urazy'
                         },
                         {
                             name: 'PocaÅ‚unek Nieba',
                             emoji: 'ðŸ˜˜',
                             description: 'Ä†wiczenie wzmacniajÄ…ce dolnÄ… czÄ™Å›Ä‡ twarzy.',
                             duration: '3-4 minuty',
                             steps: [
                                 'UsiÄ…dÅº lub staÅ„ prosto',
                                 'UnieÅ› gÅ‚owÄ™ delikatnie do gÃ³ry',
                                 'WyciÄ…gnij usta jak do pocaÅ‚unku',
                                 'WyciÄ…gnij usta tak daleko jak moÅ¼esz',
                                 'Utrzymaj przez 5 sekund',
                                 'Zrelaksuj i powtÃ³rz 10 razy',
                                 'ZakoÅ„cz delikatnym masaÅ¼em szyi'
                             ],
                             benefits: 'UjÄ™drnia szyjÄ™, redukuje zwiotczenie skÃ³ry, poprawia elastycznoÅ›Ä‡',
                             meridian: 'Vessel Conception (CV), Nerki (KI)',
                             element: 'Woda',
                             energy: 'Tonizuje Yin Nerek, wzmacnia EsencjÄ™',
                             contraindications: 'Zawroty gÅ‚owy, problemy z ciÅ›nieniem'
                         }
                     ]
                 },
                 {
                     name: 'Ä†wiczenia na Usta',
                     focus: 'PeÅ‚niejsze i mÅ‚odsze usta',
                     emoji: 'ðŸ’‹',
                     color: '#F44336',
                     exercises: [
                         {
                             name: 'Rybka',
                             emoji: 'ðŸ ',
                             description: 'Naturalne powiÄ™kszanie i ujÄ™drnianie ust.',
                             duration: '2-3 minuty',
                             steps: [
                                 'Zassij policzki do Å›rodka jak ryba',
                                 'JednoczeÅ›nie wyciÄ…gnij usta do przodu',
                                 'Utrzymaj pozycjÄ™ przez 5 sekund',
                                 'NastÄ™pnie otwÃ³rz usta szeroko w "O"',
                                 'Utrzymaj przez 5 sekund',
                                 'PowrÃ³Ä‡ do pozycji ryby',
                                 'PowtÃ³rz caÅ‚Ä… sekwencjÄ™ 8-10 razy'
                             ],
                             benefits: 'PowiÄ™ksza usta, redukuje zmarszczki wokÃ³Å‚ ust, wzmacnia miÄ™Å›nie',
                             meridian: 'Å»oÅ‚Ä…dek (ST), Åšledziona (SP)',
                             element: 'Ziemia',
                             energy: 'Wzmacnia Qi Åšledziony, harmonizuje trawienie',
                             contraindications: 'Niedawne wypeÅ‚nienia ust, herpes w fazie aktywnej'
                         },
                         {
                             name: 'Mantra OM',
                             emoji: 'ðŸ•‰ï¸',
                             description: 'Wibracyjne Ä‡wiczenie Å‚Ä…czÄ…ce dÅºwiÄ™k z ruchem.',
                             duration: '5-7 minut',
                             steps: [
                                 'UsiÄ…dÅº w pozycji medytacyjnej',
                                 'GÅ‚Ä™boko wdechnij przez nos',
                                 'Na wydechu Å›piewaj "OMMMMM"',
                                 'Poczuj wibracje w ustach i twarzy',
                                 'PowtÃ³rz 21 razy',
                                 'Po kaÅ¼dych 7 razach rÃ³b krÃ³tkÄ… przerwÄ™',
                                 'ZakoÅ„cz ciszÄ… i obserwacjÄ… wraÅ¼eÅ„'
                             ],
                             benefits: 'Relaksuje caÅ‚Ä… twarz, poprawia rezonans gÅ‚osu, uspokaja umysÅ‚',
                             meridian: 'Vessel Governing (GV), Serce (HT)',
                             element: 'OgieÅ„',
                             energy: 'Uspokaja Shen, harmonizuje wszystkie energie',
                             contraindications: 'Problemy z gÅ‚osem, zapalenie krtani'
                         }
                     ]
                 }
             ];
         }

         function getHerbsAndEmotionsData() {
             return [
                 {
                     name: 'ZÅ‚oÅ›Ä‡ i Frustracja',
                     emotion: 'Gniew',
                     element: 'Drewno',
                     emoji: 'ðŸ˜¤',
                     color: '#4CAF50',
                     herbs: [
                         {
                             name: 'Rumianek (Gan Ju)',
                             emoji: 'ðŸŒ¼',
                             description: 'Åagodzi napiÄ™cie nerwowe i uspokaja umysÅ‚. Idealny na wieczÃ³r po stresujÄ…cym dniu.',
                             action: 'Oczyszcza CiepÅ‚o WÄ…troby, uspokaja Shen',
                             temperature: 'ChÅ‚odna',
                             taste: 'SÅ‚odki, gorzki',
                             meridian: 'WÄ…troba, PÄ™cherzyk Å¼Ã³Å‚ciowy',
                             dosage: '3-6g dziennie, herbata'
                         },
                         {
                             name: 'Melisa (Xiang Feng Cao)',
                             emoji: 'ðŸŒ¿',
                             description: 'Uspokaja nadpobudliwy system nerwowy i pomaga w kontroli emocji.',
                             action: 'Reguluje Qi WÄ…troby, harmonizuje emocje',
                             temperature: 'ChÅ‚odna',
                             taste: 'SÅ‚odki, lekko gorzki',
                             meridian: 'WÄ…troba, Serce',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Mniszek Lekarski (Pu Gong Ying)',
                             emoji: 'ðŸŒ»',
                             description: 'Oczyszcza wÄ…trobÄ™ z toksyn emocjonalnych i fizycznych.',
                             action: 'Detoksykuje WÄ…trobÄ™, redukuje CiepÅ‚o',
                             temperature: 'Zimna',
                             taste: 'Gorzki, sÅ‚odki',
                             meridian: 'WÄ…troba, Å»oÅ‚Ä…dek',
                             dosage: '10-30g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Smutek i Depresja',
                     emotion: 'Melancholia',
                     element: 'Metal',
                     emoji: 'ðŸ˜¢',
                     color: '#9E9E9E',
                     herbs: [
                         {
                             name: 'Dziurawiec (Guan Ye Lian Qiao)',
                             emoji: 'ðŸŒ»',
                             description: 'Naturalny antydepresant, podnosi nastrÃ³j i przywraca radoÅ›Ä‡ Å¼ycia.',
                             action: 'Podnosi Yang Qi, rozjaÅ›nia Shen',
                             temperature: 'CiepÅ‚a',
                             taste: 'Gorzki, sÅ‚odki',
                             meridian: 'Serce, PÅ‚uca',
                             dosage: '300-900mg ekstraktu dziennie'
                         },
                         {
                             name: 'Lawenda (Xun Yi Cao)',
                             emoji: 'ðŸ’œ',
                             description: 'Uspokaja umysÅ‚, redukuje lÄ™k i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, reguluje Qi',
                             temperature: 'ChÅ‚odna',
                             taste: 'Ostry, gorzki',
                             meridian: 'Serce, PÅ‚uca',
                             dosage: '1-4g dziennie, olejek eteryczny'
                         },
                         {
                             name: 'Szafran (Fan Hong Hua)',
                             emoji: 'ðŸŸ¡',
                             description: 'Poprawia nastrÃ³j, zwiÄ™ksza energiÄ™ Å¼yciowÄ… i wspiera pozytywne myÅ›lenie.',
                             action: 'Aktywuje Krew, podnosi Shen',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki, lekko gorzki',
                             meridian: 'Serce, WÄ…troba',
                             dosage: '1-3g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'LÄ™k i NiepokÃ³j',
                     emotion: 'Strach',
                     element: 'Woda',
                     emoji: 'ðŸ˜°',
                     color: '#2196F3',
                     herbs: [
                         {
                             name: 'Waleriana (Jie Gu Mu)',
                             emoji: 'ðŸŒ¸',
                             description: 'Silnie uspokajajÄ…ce zioÅ‚o, redukuje lÄ™k i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, wzmacnia Yin',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki, ostry',
                             meridian: 'Serce, Nerki',
                             dosage: '300-600mg ekstraktu przed snem'
                         },
                         {
                             name: 'Pokrzywa (Xun Ma)',
                             emoji: 'ðŸŒ±',
                             description: 'Wzmacnia nadnercza, poprawia odpornoÅ›Ä‡ na stres.',
                             action: 'Tonizuje Yang Nerek, wzmacnia Qi',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki, lekko gorzki',
                             meridian: 'Nerki, WÄ…troba',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Passiflora (Xi Fan Lian)',
                             emoji: 'ðŸŒº',
                             description: 'Åagodzi napiÄ™cia nerwowe i redukuje poziom stresu.',
                             action: 'Uspokaja Shen, reguluje Qi Serca',
                             temperature: 'ChÅ‚odna',
                             taste: 'SÅ‚odki, lekko gorzki',
                             meridian: 'Serce, WÄ…troba',
                             dosage: '4-8g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'NadpobudliwoÅ›Ä‡ i Mania',
                     emotion: 'Przesadna RadoÅ›Ä‡',
                     element: 'OgieÅ„',
                     emoji: 'ðŸ¤©',
                     color: '#F44336',
                     herbs: [
                         {
                             name: 'Chmiela (Pi Jiu Hua)',
                             emoji: 'ðŸŒ¿',
                             description: 'Uspokaja nadpobudliwoÅ›Ä‡, pomaga w kontroli emocji.',
                             action: 'ChÅ‚odzi CiepÅ‚o Serca, uspokaja Shen',
                             temperature: 'ChÅ‚odna',
                             taste: 'Gorzki',
                             meridian: 'Serce, Å»oÅ‚Ä…dek',
                             dosage: '0.5-2g dziennie, napar'
                         },
                         {
                             name: 'MiÄ™ta (Bo He)',
                             emoji: 'ðŸŒ¿',
                             description: 'OchÅ‚adza nadmiernÄ… energiÄ™ Yang, przywraca rÃ³wnowagÄ™.',
                             action: 'ChÅ‚odzi CiepÅ‚o, reguluje Qi',
                             temperature: 'ChÅ‚odna',
                             taste: 'Ostry',
                             meridian: 'PÅ‚uca, WÄ…troba',
                             dosage: '1-3g dziennie, napar'
                         },
                         {
                             name: 'Lukrecja (Gan Cao)',
                             emoji: 'ðŸ¯',
                             description: 'Harmonizuje wszystkie energie, Å‚agodzi skrajne emocje.',
                             action: 'Harmonizuje wszystkie formuÅ‚y, wzmacnia Qi',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki',
                             meridian: 'Wszystkie meridiany',
                             dosage: '2-12g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Obsesje i Nadmierne MyÅ›lenie',
                     emotion: 'Zamartwianie',
                     element: 'Ziemia',
                     emoji: 'ðŸ¤”',
                     color: '#FFC107',
                     herbs: [
                         {
                             name: 'RÃ³Å¼a (Mei Gui Hua)',
                             emoji: 'ðŸŒ¹',
                             description: 'Uwalnia zablokowane emocje, poprawia przepÅ‚yw energii.',
                             action: 'Reguluje Qi, uspokaja Shen',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki, lekko gorzki',
                             meridian: 'WÄ…troba, Serce',
                             dosage: '3-6g dziennie, napar'
                         },
                         {
                             name: 'KorzeniÃ³wka (Bai Zhu)',
                             emoji: 'ðŸŒ¾',
                             description: 'Wzmacnia Å›ledzionÄ™, poprawia koncentracjÄ™ i pamiÄ™Ä‡.',
                             action: 'Tonizuje Qi Åšledziony, suszu WilgoÄ‡',
                             temperature: 'CiepÅ‚a',
                             taste: 'SÅ‚odki, gorzki',
                             meridian: 'Åšledziona, Å»oÅ‚Ä…dek',
                             dosage: '6-12g dziennie, odwar'
                         },
                         {
                             name: 'Ginko (Yin Xing Ye)',
                             emoji: 'ðŸƒ',
                             description: 'Poprawia krÄ…Å¼enie mÃ³zgowe, wspiera jasnoÅ›Ä‡ myÅ›lenia.',
                             action: 'Aktywuje Krew, otwiera meridiany',
                             temperature: 'Neutralna',
                             taste: 'SÅ‚odki, gorzki',
                             meridian: 'Serce, PÅ‚uca',
                             dosage: '40-80mg ekstraktu dziennie'
                         }
                     ]
                 }
             ];
         }

        // AI Assistant Functions
        let isRecording = false;
        let recognition = null;

        // Initialize Speech Recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'pl-PL';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    sendMessage();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    stopRecording();
                    showNotification('BÅ‚Ä…d rozpoznawania mowy. SprÃ³buj ponownie.');
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        function toggleVoiceRecording() {
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (recognition) {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.add('voice-recording');
                voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                
                document.getElementById('aiStatus').innerHTML = 'ðŸŽ¤ SÅ‚ucham...';
                recognition.start();
            } else {
                showNotification('Rozpoznawanie mowy nie jest dostÄ™pne w tej przeglÄ…darce.');
            }
        }

        function stopRecording() {
            isRecording = false;
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('voice-recording');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            
            document.getElementById('aiStatus').innerHTML = 'ðŸ¤– Gotowy do pomocy';
            if (recognition) {
                recognition.stop();
            }
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message === '') return;
            
            // Check if user is admin - unlimited access
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'admin') {
                // Check AI usage limits for regular users
                if (!checkAIUsageLimit()) {
                    addMessageToChat(message, 'user');
                    userInput.value = '';
                    setTimeout(() => {
                        addMessageToChat('ðŸš« **OsiÄ…gnÄ…Å‚eÅ› limit bezpÅ‚atnych zapytaÅ„!**<br><br>Masz dostÄ™p do 10 zapytaÅ„ dziennie. Aby cieszyÄ‡ siÄ™ nielimitowanym dostÄ™pem do AI Asystenta, przejdÅº na plan Premium.<br><br><button onclick="showPremiumModal()" style="background: linear-gradient(135deg, #FFD700, #FFC107); border: none; padding: 10px 20px; border-radius: 10px; color: #000; font-weight: 600; cursor: pointer; margin-top: 10px;">ðŸ”“ Odblokuj Premium</button>', 'ai');
                    }, 500);
                    return;
                }
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            userInput.value = '';
            
            // Increment AI usage for non-admin users
            if (userRole !== 'admin') {
                incrementAIUsage();
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process AI response with Railway API
            setTimeout(async () => {
                hideTypingIndicator();
                try {
                    const response = await getRealAIResponse(message);
                    addMessageToChat(response, 'ai');
                } catch (error) {
                    console.error('AI Error:', error);
                    // Fallback to local response if API fails
                    const fallbackResponse = generateAIResponse(message);
                    addMessageToChat(fallbackResponse + '<br><br><small>â„¹ï¸ OdpowiedÅº z lokalnej bazy (API niedostÄ™pne)</small>', 'ai');
                }
                
                // Update usage display if premium modal is open
                updateAIUsageDisplay();
            }, 800);
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div style="color: #66BB6A; font-weight: 600; margin-bottom: 5px;">ðŸ‘¤ Ty:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">ðŸ¤– AI Asystent:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <span>ðŸ¤– AI myÅ›li...</span>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const currentSeason = getCurrentSeason();
            
            // Detect intent
            if (message.includes('przepis') || message.includes('potrawa') || message.includes('jedzenie') || message.includes('gotowanie')) {
                return generateRecipeResponse(currentSeason);
            } else if (message.includes('Ä‡wiczenie') || message.includes('trening') || message.includes('fitness') || message.includes('gimnastyka')) {
                return generateExerciseResponse(currentSeason);
            } else if (message.includes('lista') || message.includes('zakupy') || message.includes('skÅ‚adniki') || message.includes('kupiÄ‡')) {
                return generateShoppingListResponse(currentSeason);
            } else if (message.includes('sezon') || message.includes('pora roku')) {
                return generateSeasonResponse(currentSeason);
            } else if (message.includes('zdrowie') || message.includes('dolegliwoÅ›ci') || message.includes('bÃ³l') || message.includes('energia')) {
                return generateHealthAdvice(currentSeason, message);
            } else {
                return generateGeneralResponse(currentSeason);
            }
        }

        function getCurrentSeason() {
            const month = new Date().getMonth(); // 0-11
            if (month >= 2 && month <= 4) return 'wiosna';
            if (month >= 5 && month <= 7) return 'lato'; 
            if (month === 8) return 'pÃ³Åºne lato';
            if (month >= 9 && month <= 11) return 'jesieÅ„';
            return 'zima';
        }

        function generateRecipeResponse(season) {
            const recipes = {
                'wiosna': [
                    'Zupa z mÅ‚odych pokrzyw - oczyszcza wÄ…trobÄ™ i dodaje energii',
                    'SaÅ‚atka z roszponkÄ… i kieÅ‚kami - wspiera regeneracjÄ™ organizmu',
                    'Herbata z mniszka lekarskiego - detoksykuje i wzmacnia'
                ],
                'lato': [
                    'Gazpacho z ogÃ³rkiem - chÅ‚odzi organizm w upalne dni',
                    'Smoothie z arbuza i miÄ™ty - nawadnia i orzeÅºwia',
                    'SaÅ‚atka z pomidorÃ³w i bazylii - wspiera pracÄ™ serca'
                ],
                'pÃ³Åºne lato': [
                    'Zupa z kukurydzy i marchwi - wzmacnia Å›ledzionÄ™',
                    'Zapiekanka z dyni i prosa - stabilizuje energiÄ™',
                    'Herbata z korzeniem lukrecji - harmonizuje trawienie'
                ],
                'jesieÅ„': [
                    'Zupa dyniowa z imbirem - wzmacnia odpornoÅ›Ä‡',
                    'Kompot z jabÅ‚ek i cynamonu - wspiera trawienie',
                    'Gulasz z korzeniem lotosu - odÅ¼ywia i wzmacnia'
                ],
                'zima': [
                    'RosÃ³Å‚ z goji i imbirem - rozgrzewa i wzmacnia energiÄ™',
                    'Pierogi z kapustÄ… kiszonÄ… - wspierajÄ… trawienie',
                    'Herbata pu-erh z cytrynÄ… - rozgrzewa i oczyszcza'
                ]
            };
            
            const seasonRecipes = recipes[season] || recipes['lato'];
            const randomRecipe = seasonRecipes[Math.floor(Math.random() * seasonRecipes.length)];
            
            // Add recipe to weekly progress
            addRecipeToWeekly(randomRecipe.split(' - ')[0]); // Extract recipe name before description
            
            return `ðŸ½ï¸ **Przepis na ${season}:**<br><br>**${randomRecipe}**<br><br>Zgodnie z TCM, ${season} to czas, gdy organizm potrzebuje specjalnych skÅ‚adnikÃ³w odÅ¼ywczych. Czy chcesz, Å¼ebym przygotowaÅ‚ dla Ciebie listÄ™ zakupÃ³w na ten przepis?`;
        }

        function generateExerciseResponse(season) {
            const exercises = {
                'wiosna': [
                    'Tai Chi w parku - harmonizuje energiÄ™ wÄ…troby',
                    'Joga rozciÄ…gajÄ…ca - aktywuje przepÅ‚yw Qi',
                    'Spacery w naturze - Å‚Ä…czy z energiÄ… wzrostu'
                ],
                'lato': [
                    'Qigong o Å›wicie - uspokaja umysÅ‚ w gorÄ…ce dni',
                    'PÅ‚ywanie - chÅ‚odzi Shen (ducha)',
                    'Medytacja w cieniu - balansuje energiÄ™ serca'
                ],
                'pÃ³Åºne lato': [
                    'Medytacja siedzÄ…ca - wzmacnia Å›ledzionÄ™',
                    'Åagodne spacery po posiÅ‚ku - wspiera trawienie',
                    'Ä†wiczenia rÃ³wnowagi - stabilizuje energiÄ™ ziemi'
                ],
                'jesieÅ„': [
                    'Oddychanie brzuchem - wzmacnia pÅ‚uca',
                    'Powolne spacery - harmonizuje energiÄ™ metalu',
                    'Joga z naciskiem na pÅ‚uca - przygotowuje na zimÄ™'
                ],
                'zima': [
                    'Delikatne rozciÄ…ganie - oszczÄ™dza energiÄ™ nerek',
                    'Medytacja siedzÄ…ca - kultywuje energiÄ™ wewnÄ™trznÄ…',
                    'Qi Gong dla nerek - wzmacnia esencjÄ™ Å¼yciowÄ…'
                ]
            };
            
            const seasonExercises = exercises[season] || exercises['lato'];
            const randomExercise = seasonExercises[Math.floor(Math.random() * seasonExercises.length)];
            
            return `ðŸ§˜ **Ä†wiczenie na ${season}:**<br><br>**${randomExercise}**<br><br>W medycynie chiÅ„skiej kaÅ¼da pora roku odpowiada innemu organowi. ${season} jest idealnÄ… porÄ… na te praktyki, ktÃ³re harmonizujÄ… Twoje ciaÅ‚o z naturalnymi cyklami.`;
        }

        function generateShoppingListResponse(season) {
            const shoppingLists = {
                'wiosna': ['mÅ‚ode pokrzywy', 'roszponka', 'kieÅ‚ki', 'mniszek lekarski', 'cytryna', 'imbir', 'szczypiorek'],
                'lato': ['ogÃ³rek', 'arbuz', 'miÄ™ta', 'pomidory', 'bazylia', 'saÅ‚ata', 'melon'],
                'pÃ³Åºne lato': ['kukurydza', 'marchew', 'dynia', 'proso', 'korzeÅ„ lukrecji', 'sÅ‚odkie ziemniaki', 'pszenica'],
                'jesieÅ„': ['dynia', 'imbir', 'jabÅ‚ka', 'cynamon', 'korzeÅ„ lotosu', 'marchew', 'brokuÅ‚y'],
                'zima': ['jagody goji', 'imbir', 'kapusta kiszona', 'herbata pu-erh', 'cytryna', 'czosnek', 'cebula']
            };
            
            const seasonIngredients = shoppingLists[season] || shoppingLists['lato'];
            
            let listHTML = `ðŸ›’ **Lista zakupÃ³w na ${season}:**<br><br>`;
            listHTML += '<div class="shopping-list">';
            listHTML += '<h4>ðŸŒ¿ SkÅ‚adniki sezonowe TCM:</h4>';
            listHTML += '<ul>';
            
            seasonIngredients.forEach(ingredient => {
                listHTML += `<li>âœ… ${ingredient}</li>`;
            });
            
            listHTML += '</ul></div>';
            listHTML += '<br>Te skÅ‚adniki wspierajÄ… TwÃ³j organizm zgodnie z zasadami medycyny chiÅ„skiej dla obecnej pory roku.';
            
            return listHTML;
        }

        function generateSeasonResponse(season) {
            const seasonInfo = {
                'wiosna': 'Wiosna w TCM odpowiada elementowi Drewna i organowi wÄ…troby. To czas wzrostu, odnowy i oczyszczania organizmu.',
                'lato': 'Lato w TCM odpowiada elementowi Ognia i organowi serca. To czas radoÅ›ci, aktywnoÅ›ci i kultywowania ciepÅ‚a wewnÄ™trznego.',
                'pÃ³Åºne lato': 'PÃ³Åºne lato w TCM odpowiada elementowi Ziemi i organom Å›ledziony i Å¼oÅ‚Ä…dka. To czas rÃ³wnowagi, stabilnoÅ›ci i harmonii trawienia.',
                'jesieÅ„': 'JesieÅ„ w TCM odpowiada elementowi Metalu i organom pÅ‚uc. To czas zbierania energii i przygotowywania na zimÄ™.',
                'zima': 'Zima w TCM odpowiada elementowi Wody i organom nerek. To czas odpoczynku, kultywowania energii wewnÄ™trznej i wzmacniania esencji Å¼yciowej.'
            };
            
            return `ðŸŒ¿ **MÄ…droÅ›Ä‡ TCM dla ${season}:**<br><br>${seasonInfo[season]}<br><br>Czy chcesz poznaÄ‡ specjalne przepisy, Ä‡wiczenia lub porady zdrowotne na tÄ™ porÄ™ roku?`;
        }

        function generateHealthAdvice(season, message) {
            const advice = {
                'wiosna': 'WiosnÄ… wzmacniaj wÄ…trobÄ™ zielonymi warzywami, unikaj nadmiernej zÅ‚oÅ›ci i praktykuj Å‚agodne rozciÄ…ganie.',
                'lato': 'Latem chroÅ„ serce przed przegrzaniem, pij duÅ¼o pÅ‚ynÃ³w i praktykuj spokojnÄ… medytacjÄ™.',
                'pÃ³Åºne lato': 'W pÃ³Åºne lato wzmacniaj Å›ledzionÄ™ sÅ‚odkimi pokarmami, unikaj przejadania siÄ™ i praktykuj umiarkowanie.',
                'jesieÅ„': 'JesieniÄ… dbaj o pÅ‚uca, jedz biaÅ‚e pokarmy jak gruszki i rzodkiew, unikaj suchoÅ›ci.',
                'zima': 'ZimÄ… wzmacniaj nerki ciepÅ‚ymi potrawami, oszczÄ™dzaj energiÄ™ i praktykuj gÅ‚Ä™bokie oddychanie.'
            };
            
            return `ðŸŒ¿ **Porada zdrowotna na ${season}:**<br><br>${advice[season]}<br><br>PamiÄ™taj, Å¼e w TCM profilaktyka jest najwaÅ¼niejsza. Dostosowuj swÃ³j tryb Å¼ycia do naturalnych cykli przyrody.`;
        }

        function generateGeneralResponse(season) {
            return `ðŸ¤– Jestem Twoim asystentem TCM! MogÄ™ pomÃ³c Ci w:<br><br>â€¢ ðŸ½ï¸ **Przepisach sezonowych** - zdrowe potrawy na ${season}<br>â€¢ ðŸ§˜ **Ä†wiczeniach** - praktyki dostosowane do pory roku<br>â€¢ ðŸ›’ **Listach zakupÃ³w** - skÅ‚adniki zgodne z TCM<br>â€¢ ðŸŒ¿ **Poradach zdrowotnych** - mÄ…droÅ›Ä‡ tradycyjnej medycyny chiÅ„skiej<br><br>Po prostu zapytaj: "PokaÅ¼ mi przepisy na ${season}" lub "Jakie Ä‡wiczenia na dziÅ›?"`;
        }

        function quickAction(type) {
            const actions = {
                'przepisy': 'PokaÅ¼ mi przepisy sezonowe',
                'cwiczenia': 'Jakie Ä‡wiczenia polecasz na dziÅ›?',
                'lista': 'StwÃ³rz listÄ™ zakupÃ³w sezonowych',
                'porady': 'Daj mi poradÄ™ zdrowotnÄ… na obecnÄ… porÄ™ roku'
            };
            
            document.getElementById('userInput').value = actions[type];
            sendMessage();
        }

        // Automatic backup functionality
        function initializeAutoBackup() {
            // Check if auto backup is enabled (enabled by default)
            const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
            const autoBackupInterval = parseInt(localStorage.getItem('autoBackupInterval')) || 24; // hours
            
            if (autoBackupEnabled) {
                const lastAutoBackup = localStorage.getItem('lastAutoBackup');
                const now = new Date().getTime();
                
                if (!lastAutoBackup || (now - parseInt(lastAutoBackup)) > (autoBackupInterval * 60 * 60 * 1000)) {
                    // Perform automatic backup after 30 seconds
                    setTimeout(() => {
                        performAutoBackup();
                    }, 30000);
                }
                
                // Schedule periodic auto backups
                setInterval(() => {
                    const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
                    if (autoBackupEnabled) {
                        performAutoBackup();
                    }
                }, autoBackupInterval * 60 * 60 * 1000); // Convert hours to milliseconds
            }
        }

        function performAutoBackup() {
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "auto",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Store backup in localStorage as well
            localStorage.setItem('autoBackupData', JSON.stringify(backupData));
            localStorage.setItem('lastAutoBackup', new Date().getTime().toString());
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('INFO', 'BACKUP', 'Automatyczny backup zostaÅ‚ wykonany', `Rozmiar: ${Math.round(JSON.stringify(backupData).length / 1024)} KB`);
            
            showNotification('ðŸ”„ Automatyczny backup zostaÅ‚ wykonany');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            updateSeason();
            updateRecipes();
            updateCurrentYear();
            updateSeasonalEnergyButton();
            loadWeeklyProgress(); // Initialize weekly progress tracking
            initializeAutoBackup(); // Initialize auto backup
            initializeLogging(); // Initialize logging system
            initializeOfflineMode(); // Initialize offline mode
            checkSettingsAccessError(); // Check if there was an error accessing settings
            
            // Update season, recipes, year and seasonal energy every hour to ensure accuracy
            setInterval(() => {
                updateSeason();
                updateRecipes();
                updateCurrentYear();
                updateSeasonalEnergyButton();
            }, 3600000); // 1 hour = 3600000ms
            
            // Add some random sparkles for delight
            setInterval(() => {
                if (Math.random() > 0.95) {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    createSparkle({ clientX: x, clientY: y });
                }
            }, 1000);
            
            // Welcome message will be updated by updateCurrentYear function
        });

        // Admin notification sender
        function sendNotificationToUsers() {
            // Create modal with form instead of using prompt()
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.15);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    backdrop-filter: blur(20px);
                    color: white;
                ">
                    <h2 style="margin: 0 0 20px 0; color: white;">ðŸ“¢ WyÅ›lij Powiadomienie</h2>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">TytuÅ‚:</label>
                        <input type="text" id="notifTitle" value="WaÅ¼na informacja" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            box-sizing: border-box;
                        ">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">TreÅ›Ä‡:</label>
                        <textarea id="notifMessage" style="
                            width: 100%;
                            height: 80px;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            resize: none;
                            box-sizing: border-box;
                        ">Witamy w naszej aplikacji wellness!</textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px;">Odbiorcy:</label>
                        <select id="notifTarget" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                        ">
                            <option value="0">Wszyscy uÅ¼ytkownicy (347)</option>
                            <option value="1">Aktywni uÅ¼ytkownicy (68)</option>
                            <option value="2">Premium uÅ¼ytkownicy (23)</option>
                            <option value="3">Nowi uÅ¼ytkownicy (12)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="sendNotificationNow()" style="
                            flex: 1;
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px;
                            cursor: pointer;
                            font-weight: bold;
                        ">ðŸ“¤ WyÅ›lij</button>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: rgba(255,255,255,0.2);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px 20px;
                            cursor: pointer;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => e.target === modal && modal.remove();
        }
        
        function sendNotificationNow() {
            const title = document.getElementById('notifTitle').value;
            const message = document.getElementById('notifMessage').value;
            const targetIndex = document.getElementById('notifTarget').value;
            
            if (!title || !message) {
                showNotification('âŒ WypeÅ‚nij wszystkie pola', 'error');
                return;
            }
            
            const targets = ['Wszyscy uÅ¼ytkownicy (347)', 'Aktywni uÅ¼ytkownicy (68)', 'Premium uÅ¼ytkownicy (23)', 'Nowi uÅ¼ytkownicy (12)'];
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
            
            // Simulate sending
            showNotification('ðŸ“¤ WysyÅ‚anie powiadomienia...', 'info');
            
            setTimeout(() => {
                const notification = {
                    id: Date.now(),
                    title: title,
                    message: message,
                    target: targets[targetIndex],
                    timestamp: new Date().toLocaleString(),
                    status: 'sent'
                };
                
                // Save to localStorage
                const sentNotifications = JSON.parse(localStorage.getItem('sentNotifications') || '[]');
                sentNotifications.unshift(notification);
                localStorage.setItem('sentNotifications', JSON.stringify(sentNotifications.slice(0, 50)));
                
                showNotification('âœ… Powiadomienie wysÅ‚ane do: ' + targets[targetIndex], 'success');
            }, 2000);
        }

        // Export user data
        function exportUserData() {
            showNotification('ðŸ“Š Przygotowywanie eksportu danych...', 'info');
            
            setTimeout(() => {
                const userData = [
                    { id: 1, name: 'Anna Kowalska', email: 'anna@example.com', status: 'active', joinDate: '2024-01-15', lastLogin: '2024-12-20' },
                    { id: 2, name: 'Piotr Nowak', email: 'piotr@example.com', status: 'active', joinDate: '2024-02-20', lastLogin: '2024-12-19' },
                    { id: 3, name: 'Maria WiÅ›niewska', email: 'maria@example.com', status: 'active', joinDate: '2024-03-10', lastLogin: '2024-12-18' },
                    { id: 4, name: 'Tomasz Admin', email: 'admin@example.com', status: 'admin', joinDate: '2024-01-01', lastLogin: '2024-12-20' },
                    { id: 5, name: 'Karolina Spam', email: 'spam@example.com', status: 'blocked', joinDate: '2024-11-15', lastLogin: '2024-11-20' }
                ];

                const content = JSON.stringify(userData, null, 2);
                const blob = new Blob([content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'users_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('âœ… Dane uÅ¼ytkownikÃ³w zostaÅ‚y wyeksportowane!', 'success');
            }, 1500);
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideUp {
                from {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('âœ… ServiceWorker registered: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('âŒ ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Initialize profiles when page loads
        window.addEventListener('load', function() {
            loadSavedProfilePictures();
            loadHealthMetrics();
            
            // Initialize offline mode indicators
            updateOfflineStatus();
            
            // Auto-load backup display
            updateBackupDisplay();
            
            // Start daily fluctuations simulation
            setInterval(simulateDailyFluctuations, 60000 * 60); // Every hour
        });

        // Also run initialization when DOM is ready (for faster loading)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadSavedProfilePictures();
                loadHealthMetrics();
            });
        } else {
            loadSavedProfilePictures();
            loadHealthMetrics();
        }

        // ====== PREMIUM FUNCTIONS ======

        // Initialize Stripe
        const stripe = Stripe('pk_test_51234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890'); // Demo key - replace with real
        
        // Initialize Premium system on page load
        initializePremiumSystem();

        function initializePremiumSystem() {
            // Initialize daily AI usage tracking
            const today = new Date().toDateString();
            const lastResetDate = localStorage.getItem('lastAIReset');
            
            if (lastResetDate !== today) {
                // Reset daily usage at midnight
                localStorage.setItem('dailyAIUsage', '0');
                localStorage.setItem('lastAIReset', today);
            }
            
            // Check if user has premium
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                // User has premium - no limits
                return;
            }
            
            // Update AI usage display if premium modal is open
            updateAIUsageDisplay();
        }

        function checkAIUsageLimit() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return true; // Premium users have unlimited access
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const dailyLimit = 10; // Free users get 10 queries per day
            
            return dailyUsage < dailyLimit;
        }

        function incrementAIUsage() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return; // Premium users don't have usage tracked
            }
            
            const currentUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            localStorage.setItem('dailyAIUsage', (currentUsage + 1).toString());
            
            // Add to system logs
            addSystemLog('INFO', 'AI', 'AI Query uÅ¼ywane', `Dzienne uÅ¼ycie: ${currentUsage + 1}/10`);
        }

        function updateAIUsageDisplay() {
            const remainingElement = document.getElementById('remainingQueries');
            if (!remainingElement) return;
            
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                remainingElement.textContent = 'âˆž Nielimitowane';
                remainingElement.style.color = '#FFD700';
                return;
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const remaining = Math.max(0, 10 - dailyUsage);
            
            remainingElement.textContent = `${remaining} / 10`;
            
            if (remaining === 0) {
                remainingElement.style.color = '#F44336';
            } else if (remaining <= 3) {
                remainingElement.style.color = '#FF9800';
            } else {
                remainingElement.style.color = '#4CAF50';
            }
        }

        function showPremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.style.display = 'flex';
                updateAIUsageDisplay();
                
                // Add premium modal animation
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeIn 0.3s ease';
                
                // Add golden particle effect
                createPremiumParticles();
            }
        }

        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeOut 0.3s ease';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        function createPremiumParticles() {
            const particles = ['ðŸ‘‘', 'âœ¨', 'ðŸ’Ž', 'ðŸŒŸ', 'ðŸ’°'];
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.cssText = `
                        position: fixed;
                        font-size: 20px;
                        pointer-events: none;
                        z-index: 10001;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${Math.random() * window.innerHeight}px;
                        animation: premiumFloat 3s ease-out forwards;
                    `;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        async function initializeStripePayment() {
            const subscribeBtn = document.getElementById('subscribeBtn');
            
            // Show loading state
            subscribeBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i>Przetwarzanie...';
            subscribeBtn.disabled = true;
            
            try {
                // Real Stripe payment integration with Railway API
                const paymentResult = await realStripePayment();
                
                // If redirected to Stripe, stop here
                if (paymentResult.status === 'redirected') {
                    return;
                }
                
                // Success - activate premium
                localStorage.setItem('premiumStatus', 'active');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                
                // Show success message
                showPremiumSuccessModal();
                
                // Update UI
                updatePremiumUI();
                
                // Close premium modal
                closePremiumModal();
                
                // Add to system logs
                addSystemLog('SUCCESS', 'PREMIUM', 'Premium subskrypcja aktywowana', 'UÅ¼ytkownik przeszedÅ‚ na plan Premium');
                
                // Show notification
                showNotification('ðŸŽ‰ Premium zostaÅ‚o aktywowane! Ciesz siÄ™ nielimitowanym dostÄ™pem do AI!');
                
            } catch (error) {
                // Handle payment error
                showNotification('âŒ BÅ‚Ä…d pÅ‚atnoÅ›ci. SprÃ³buj ponownie.', 'error');
                addSystemLog('ERROR', 'PREMIUM', 'BÅ‚Ä…d pÅ‚atnoÅ›ci Premium', error.message);
            } finally {
                // Reset button
                subscribeBtn.innerHTML = '<i class="fas fa-crown" style="margin-right: 10px;"></i>Aktywuj Premium';
                subscribeBtn.disabled = false;
            }
        }

        async function realStripePayment() {
            try {
                // Call Railway API to create Stripe checkout session
                const response = await apiCall(API_CONFIG.ENDPOINTS.STRIPE_CHECKOUT, {
                    method: 'POST',
                    body: JSON.stringify({
                        priceId: 'price_monthly' // This would be your real Stripe price ID
                    })
                });
                
                // Redirect to Stripe checkout
                if (response.url) {
                    window.location.href = response.url;
                    return { status: 'redirected', url: response.url };
                } else {
                    throw new Error('Nie otrzymano URL pÅ‚atnoÅ›ci');
                }
                
            } catch (error) {
                // If Stripe not configured, fall back to demo mode
                if (error.message.includes('STRIPE_NOT_CONFIGURED')) {
                    console.log('ðŸš§ Stripe nie skonfigurowany - tryb demo');
                    showNotification('ðŸš§ Tryb demo - Stripe nie skonfigurowany');
                    
                    // Simulate successful payment in demo mode
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return {
                        id: 'demo_' + Math.random().toString(36).substr(2, 9),
                        status: 'succeeded',
                        amount: 2999,
                        currency: 'pln',
                        demo: true
                    };
                } else {
                    throw error;
                }
            }
        }

        function showPremiumSuccessModal() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10002;
                animation: fadeIn 0.3s ease;
            `;
            
            successModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.3));
                    border: 2px solid rgba(255, 215, 0, 0.7);
                    border-radius: 20px;
                    backdrop-filter: blur(20px);
                    padding: 40px;
                    text-align: center;
                    max-width: 400px;
                    margin: 20px;
                    animation: bounceIn 0.5s ease;
                ">
                    <div style="font-size: 60px; margin-bottom: 20px;">ðŸŽ‰ðŸ‘‘</div>
                    <h3 style="color: #FFD700; margin-bottom: 15px; font-size: 24px;">
                        Gratulacje!
                    </h3>
                    <p style="color: white; margin-bottom: 20px; line-height: 1.6;">
                        Twoja subskrypcja Premium zostaÅ‚a aktywowana!<br><br>
                        <strong>Teraz masz dostÄ™p do:</strong><br>
                        âœ¨ Nielimitowanych zapytaÅ„ AI<br>
                        ðŸš€ Priorytetowych odpowiedzi<br>
                        ðŸŒŸ Zaawansowanych analiz TCM
                    </p>
                    <button onclick="this.closest('div').remove()" style="
                        background: linear-gradient(135deg, #FFD700, #FFC107);
                        border: none;
                        padding: 12px 30px;
                        border-radius: 10px;
                        color: #000;
                        font-weight: 700;
                        cursor: pointer;
                        font-size: 16px;
                    ">
                        Rozpocznij korzystanie!
                    </button>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    successModal.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        if (successModal.parentNode) {
                            successModal.parentNode.removeChild(successModal);
                        }
                    }, 300);
                }
            }, 5000);
        }

        function updatePremiumUI() {
            // Update premium button to show status instead of purchase
            const premiumButtons = document.querySelectorAll('[onclick="showPremiumModal()"]');
            premiumButtons.forEach(btn => {
                const textElement = btn.querySelector('.feature-text');
                if (textElement) {
                    textElement.textContent = 'Premium âœ“';
                    btn.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2))';
                    btn.style.border = '1px solid rgba(255, 215, 0, 0.5)';
                }
            });
            
            // Update AI usage display
            updateAIUsageDisplay();
        }

        // Check premium status on page load
        function checkPremiumStatus() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                updatePremiumUI();
            }
        }

        // Add premium floating animation CSS
        const premiumStyle = document.createElement('style');
        premiumStyle.textContent = `
            @keyframes premiumFloat {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: translateY(-50px) rotate(180deg);
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }
            
            @keyframes bounceIn {
                0% {
                    transform: scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(premiumStyle);

        // === RAILWAY INTEGRATION INITIALIZATION ===
        async function initializeRailwayIntegration() {
            console.log('ðŸš€ Inicjalizacja integracji Railway...');
            
            // Test API connection
            const apiConnected = await testAPIConnection();
            
            // Show integration status
            if (apiConnected) {
                showNotification('ðŸŽ‰ Railway API poÅ‚Ä…czone! Wszystkie funkcje dostÄ™pne.', 'success');
                console.log('âœ… Integracja Railway: AKTYWNA');
            } else {
                showNotification('âš ï¸ Railway API niedostÄ™pne - tryb demo aktywny', 'warning');
                console.log('âš ï¸ Integracja Railway: TRYB DEMO');
            }
            
            // Log integration status
            addSystemLog('INFO', 'SYSTEM', 'Inicjalizacja aplikacji', 
                `Railway API: ${apiConnected ? 'PoÅ‚Ä…czone' : 'Tryb demo'}`);
        }

        // Initialize premium status and Railway integration on page load
        setTimeout(() => {
            checkPremiumStatus();
            initializeRailwayIntegration();
        }, 500);
    </script>
</body>
</html> 