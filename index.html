<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <title>SezonoweDobro - Aplikacja TCM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Elements */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite linear;
            font-size: 24px;
        }

        .floating-element:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            top: 60%;
            right: 10%;
            animation-delay: -7s;
        }

        .floating-element:nth-child(3) {
            top: 40%;
            left: 30%;
            animation-delay: -14s;
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        /* Liquid Glass Container */
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #2d5a2d 0%, #1a4d1a 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
        }

        /* Header */
        .header {
            padding: 50px 20px 20px;
            text-align: center;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(56, 142, 60, 0.2));
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784, #A5D6A7, #C8E6C9);
            animation: seasonalGlow 4s ease-in-out infinite;
        }

        @keyframes seasonalGlow {
            0%, 100% { opacity: 0.8; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tagline {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Season Indicator */
        .current-season {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .season-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            padding: 0 20px;
            background: rgba(76, 175, 80, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            background: none;
            font-size: 14px;
        }

        .nav-tab.active {
            color: white;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            border-radius: 2px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { width: 0; }
            to { width: 30px; }
        }

        /* Content Area */
        .content {
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            color: white;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

        .card-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .card-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 2px;
        }

        .card-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .feature-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feature-item:hover {
            transform: scale(1.05);
            background: rgba(76, 175, 80, 0.35);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
            color: #4CAF50;
        }

        .feature-text {
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        /* Season Progress */
        .season-progress {
            margin: 20px 0;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784);
            border-radius: 4px;
            width: 65%;
            animation: progressGlow 2s ease-in-out infinite alternate;
        }

        @keyframes progressGlow {
            0% { box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); }
            100% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.8), 0 0 30px rgba(76, 175, 80, 0.6); }
        }

        .progress-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            margin-top: 8px;
            text-align: center;
        }

        /* Recipe Cards */
        .recipe-card {
            display: flex;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .recipe-card:hover {
            transform: translateX(5px);
            background: rgba(76, 175, 80, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .recipe-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .recipe-info {
            flex: 1;
            padding: 15px;
        }

        .recipe-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recipe-meta {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 414px;
            width: 100%;
            background: rgba(45, 90, 45, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 12px;
            position: relative;
        }

        .bottom-nav-item.active {
            color: white;
            background: rgba(76, 175, 80, 0.4);
            border-radius: 12px;
        }

        .bottom-nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        /* AI Assistant Styles */
        .ai-message, .user-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 12px;
            animation: fadeInUp 0.3s ease;
        }

        .ai-message {
            background: rgba(76, 175, 80, 0.15);
            border-left: 3px solid #4CAF50;
        }

        .user-message {
            background: rgba(102, 187, 106, 0.15);
            border-right: 3px solid #66BB6A;
            text-align: right;
        }

        .quick-action-btn {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            border-radius: 20px;
            padding: 6px 12px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: normal;
        }

        .quick-action-btn:hover {
            background: rgba(76, 175, 80, 0.4);
            transform: translateY(-2px);
        }

        .voice-recording {
            background: linear-gradient(135deg, #f44336, #ff5722) !important;
            animation: pulse 1s infinite;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4CAF50;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #4CAF50;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .shopping-list {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        .shopping-list h4 {
            color: #4CAF50;
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .shopping-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .shopping-list li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(76, 175, 80, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .shopping-list li:last-child {
            border-bottom: none;
        }

        /* Season Element Hover Effects */
        .season-element {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .season-element:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .season-element:active {
            transform: scale(1.02);
        }

        /* Season Details Modal */
        .season-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .season-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .season-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .season-modal-icon {
            font-size: 48px;
            margin-right: 20px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .season-modal-title {
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        .season-modal-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 5px;
        }

        .season-info-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .season-info-title {
            color: white;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .season-info-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .season-info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .season-info-list li {
            padding: 5px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .close-modal-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .close-modal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Recipe Modal Styles */
        .recipe-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .recipe-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .recipe-modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .recipe-modal-icon {
            font-size: 60px;
            margin-right: 20px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .recipe-modal-title {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recipe-modal-meta {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .recipe-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 3px solid currentColor;
        }

        .recipe-section-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipe-ingredients-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }

        .recipe-ingredients-list li {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .recipe-instructions {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }

        .recipe-instructions ol {
            padding-left: 20px;
        }

        .recipe-instructions li {
            margin-bottom: 10px;
            padding: 5px 0;
        }

        .recipe-benefits {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(102, 187, 106, 0.1));
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .recipe-card.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-card.clickable:hover {
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Herbs and Emotions Modal Styles */
        .herbs-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .herbs-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .herbs-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .herbs-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .herbs-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .herbs-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .herbs-category-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .herbs-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .herbs-category.expanded .herbs-expand-icon {
            transform: rotate(180deg);
        }

        .herbs-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .herbs-category.expanded .herbs-category-content {
            max-height: none;
        }

        .herbs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .herb-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .herb-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .herb-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .herb-emoji {
            font-size: 24px;
        }

        .herb-name {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .herb-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .herb-properties {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .herb-properties-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .herb-properties-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Face Yoga Modal Styles */
        .face-yoga-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .face-yoga-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .yoga-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .yoga-category-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .yoga-category-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .yoga-category-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-category-icon {
            font-size: 28px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .yoga-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .yoga-category.expanded .yoga-expand-icon {
            transform: rotate(180deg);
        }

        .yoga-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .yoga-category.expanded .yoga-category-content {
            max-height: none;
        }

        .yoga-exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .yoga-exercise-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .yoga-exercise-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .yoga-exercise-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .yoga-exercise-emoji {
            font-size: 32px;
        }

        .yoga-exercise-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .yoga-exercise-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .yoga-exercise-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #4CAF50;
            margin-bottom: 15px;
        }

        .yoga-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .yoga-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .yoga-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .yoga-steps-list li:before {
            content: "▶";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-size: 10px;
        }

        .yoga-benefits {
            background: rgba(76, 175, 80, 0.1);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }

        .yoga-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .yoga-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .yoga-duration {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Seasonal Energy Modal Styles */
        .seasonal-energy-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .seasonal-energy-modal-content {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 850px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .energy-practice-category {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .energy-practice-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .energy-practice-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .energy-practice-title {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .energy-expand-icon {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            transition: transform 0.3s ease;
        }

        .energy-practice-category.expanded .energy-expand-icon {
            transform: rotate(180deg);
        }

        .energy-practice-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .energy-practice-category.expanded .energy-practice-content {
            max-height: none;
        }

        .energy-practices-grid {
            padding: 20px;
        }

        .energy-practice-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .energy-practice-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .energy-practice-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .energy-practice-emoji {
            font-size: 28px;
        }

        .energy-practice-name {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .energy-practice-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .energy-practice-steps {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid currentColor;
            margin-bottom: 15px;
        }

        .energy-practice-steps-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .energy-practice-steps-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .energy-practice-steps-list li {
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .energy-practice-steps-list li:before {
            content: "🌟";
            position: absolute;
            left: 0;
            font-size: 12px;
        }

        .energy-practice-benefits {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid currentColor;
        }

        .energy-practice-benefits-title {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .energy-practice-benefits-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
        }

        .energy-practice-duration {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Wellness Metrics */
        .wellness-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .metric-item {
            background: rgba(76, 175, 80, 0.25);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #4CAF50;
            display: block;
            transition: all 0.3s ease;
        }

        .metric-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 4px;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
            
            .content {
                padding: 15px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .wellness-metrics {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .header {
                padding: 40px 15px 20px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .tagline {
                font-size: 12px;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 12px 0;
            }
            
            /* Modal improvements for mobile */
            .modal {
                padding: 10px !important;
            }
            
            .modal > div {
                max-width: 95% !important;
                margin: 10px auto !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }
            
            /* Touch improvements */
            .action-btn, .nav-tab, .glass-card {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            .action-btn {
                min-height: 44px; /* iOS minimum touch target */
                font-size: 16px;
            }
            
            /* Scrollable content on small screens */
            .wellness-metrics, .feature-grid {
                max-height: 60vh;
                overflow-y: auto;
            }
            
            /* Fix text truncation on mobile */
            .herb-properties-text, .yoga-benefits-text {
                white-space: normal;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .herb-card, .yoga-exercise-card {
                min-height: auto;
                height: auto;
            }
            
            .herb-properties, .yoga-exercise-steps, .yoga-benefits {
                min-height: auto;
            }
            
            /* Modal content improvements */
            .herbs-modal-content, .face-yoga-modal-content, .seasonal-energy-modal-content {
                padding: 15px;
                max-height: 95vh;
            }
        }

        /* Extra small screens (older phones) */
        @media (max-width: 360px) {
            .app-container {
                max-width: 100%;
            }
            
            .content {
                padding: 10px;
            }
            
            .header {
                padding: 35px 10px 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .tagline {
                font-size: 11px;
            }
            
            .wellness-metrics {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .glass-card {
                padding: 12px;
                margin: 8px 0;
            }
            
            .nav-tab {
                font-size: 11px;
                padding: 10px 0;
            }
            
            .metric-label {
                font-size: 10px;
            }
            
            .current-season {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            /* Additional text truncation fixes for extra small screens */
            .herbs-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .yoga-exercises-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 10px;
            }
            
            .herb-properties-text, .yoga-benefits-text {
                font-size: 12px;
                line-height: 1.5;
            }
            
            .herb-card, .yoga-exercise-card {
                padding: 12px;
            }
        }

        /* Large phones and small tablets */
        @media (min-width: 481px) and (max-width: 768px) {
            .app-container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 20px;
            }
            
            .feature-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .wellness-metrics {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Landscape orientation on phones */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 20px 15px 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .tagline {
                font-size: 11px;
                margin-bottom: 10px;
            }
            
            .current-season {
                font-size: 10px;
                padding: 4px 8px;
            }
            
            .nav-tab {
                padding: 8px 0;
                font-size: 12px;
            }
        }

        /* iOS Safari fixes */
        @supports (-webkit-touch-callout: none) {
            .app-container {
                background: #2d5a2d !important;
            }
            .glass-card {
                background: rgba(76, 175, 80, 0.3) !important;
            }
            .header {
                background: rgba(76, 175, 80, 0.2) !important;
            }
        }

        /* Global text truncation prevention */
        .glass-card, .herb-card, .yoga-exercise-card, .energy-practice-card {
            height: auto;
            min-height: auto;
            overflow: visible;
        }

        .herb-properties, .yoga-exercise-steps, .yoga-benefits, .energy-practice-details {
            height: auto;
            min-height: auto;
            overflow: visible;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Login Screen Styles */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(76, 175, 80, 0.1);
            color: white;
            font-size: 16px; /* Prevents zoom on iOS */
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .register-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.3s ease;
        }

        .register-btn:hover {
            color: white;
        }

        /* Logout Animation */
        .logout-animation {
            animation: logoutFade 0.5s ease-out forwards;
        }

        @keyframes logoutFade {
            0% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.95);
            }
        }

        .login-animation {
            animation: loginFade 0.5s ease-out forwards;
        }

        @keyframes loginFade {
            0% { 
                opacity: 0; 
                transform: scale(0.95);
            }
            100% { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #F44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        /* Special Effects */
        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkle 1.5s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
    <!-- Stripe JavaScript SDK -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="floating-element">🌸</div>
        <div class="floating-element">🍃</div>
        <div class="floating-element">❄️</div>
    </div>

    <div class="app-container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen" style="display: none;">
            <div class="login-container">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h1 class="logo">SezonoweDobro</h1>
                    <p class="tagline">Tradycyjna Medycyna Chińska dla Współczesnego Życia • 2025</p>
                </div>
                
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">Zaloguj się</div>
                            <div class="card-subtitle">Witaj ponownie</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form id="loginForm" onsubmit="login(event)">
                            <div class="input-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email" required 
                                       placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="password">Hasło:</label>
                                <input type="password" id="password" name="password" required 
                                       placeholder="••••••••">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zaloguj się
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <p style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                🔐 Tylko autoryzowani użytkownicy
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showRegister()">
                                Nie masz konta? Zarejestruj się
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" class="glass-card" style="display: none; margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <div class="card-title">Załóż konto</div>
                            <div class="card-subtitle">Dołącz do nas</div>
                        </div>
                    </div>
                    
                    <div class="card-content">
                        <form onsubmit="register(event)">
                            <div class="input-group">
                                <label for="regName">Imię:</label>
                                <input type="text" id="regName" name="name" required placeholder="Twoje imię">
                            </div>
                            
                            <div class="input-group">
                                <label for="regEmail">Email:</label>
                                <input type="email" id="regEmail" name="email" required placeholder="twoj@email.com">
                            </div>
                            
                            <div class="input-group">
                                <label for="regPassword">Hasło:</label>
                                <input type="password" id="regPassword" name="password" required placeholder="••••••••">
                            </div>
                            
                            <button type="submit" class="action-btn" style="width: 100%; margin-top: 20px;">
                                Zarejestruj się
                            </button>
                        </form>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="register-btn" onclick="showLogin()">
                                Masz już konto? Zaloguj się
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp">
            <!-- Header -->
            <header class="header">
                <h1 class="logo">SezonoweDobro</h1>
                <p class="tagline">Tradycyjna Medycyna Chińska dla Współczesnego Życia • 2025</p>
                <div class="current-season">
                    <i class="fas fa-fire season-icon"></i>
                    <span id="currentSeasonText">Sezon Ognia (Lato)</span>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab(event, 'home')">
                <i class="fas fa-home"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'calendar')">
                <i class="fas fa-calendar"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'wellness')">
                <i class="fas fa-heart"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
            </button>
            <button class="nav-tab" onclick="switchTab(event, 'profile')">
                <i class="fas fa-user"></i>
            </button>
            <button class="nav-tab admin-tab" onclick="switchTab(event, 'admin')" style="display: none;">
                <i class="fas fa-cog"></i>
            </button>
        </nav>

        <!-- Content Area -->
        <main class="content">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-yin-yang"></i>
                        </div>
                        <div>
                                                    <div class="card-title" id="currentSeasonTitle">Sezon Ognia (Lato)</div>
                        <div class="card-subtitle season-description">Radość, aktywność i energia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <p id="seasonDescription">Dzisiejsza energia jest wyrównana z elementem Ognia. Skup się na radości, aktywności i kultywowaniu ciepła wewnętrznego.</p>
                        
                        <div class="season-progress">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="progress-text">Postęp Sezonu Ognia: 85%</div>
                        </div>
                    </div>
                </div>

                <div class="wellness-metrics">
                    <div class="metric-item">
                        <span class="metric-value" id="qiLevel">85</span>
                        <div class="metric-label">Poziom Qi</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="balanceLevel">92</span>
                        <div class="metric-label">Równowaga</div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-value" id="energyLevel">78</span>
                        <div class="metric-label">Energia</div>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-item" onclick="showSeasonalEnergy()" id="seasonalEnergyButton">
                        <i class="fas fa-fire feature-icon" id="seasonalEnergyIcon"></i>
                        <div class="feature-text" id="seasonalEnergyText">Letnia Energia</div>
                    </div>
                    <div class="feature-item" onclick="showHerbsAndEmotions()">
                        <i class="fas fa-seedling feature-icon"></i>
                        <div class="feature-text">Zioła i Emocje</div>
                    </div>
                    <div class="feature-item" onclick="showFaceYoga()">
                        <i class="fas fa-smile feature-icon"></i>
                        <div class="feature-text">Joga Twarzy</div>
                    </div>
                    <div class="feature-item" onclick="startElementTest()">
                        <i class="fas fa-search feature-icon"></i>
                        <div class="feature-text">Odkryj swój żywioł</div>
                    </div>
                </div>

                <button class="action-btn" style="width: 100%;" onclick="showNotification('Rozpoczynamy Twoją podróż dobrostanu!')">
                    Rozpocznij Dzisiejsze Praktyki
                </button>
                
                <!-- Hidden debug buttons for testing (only visible in development) -->
                <button class="action-btn" style="width: 100%; margin-top: 10px; background: rgba(255,193,7,0.2); border: 1px solid rgba(255,193,7,0.5); font-size: 12px;" onclick="resetHealthMetrics()">
                    🔄 Reset wskaźników (test)
                </button>
                <button class="action-btn" style="width: 100%; margin-top: 5px; background: rgba(33,150,243,0.2); border: 1px solid rgba(33,150,243,0.5); font-size: 12px;" onclick="resetWeeklyProgress(); showNotification('📊 Tygodniowy postęp został zresetowany!');">
                    📊 Reset tygodniowego postępu
                </button>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Kalendarz Pięciu Pór Roku</div>
                            <div class="card-subtitle">Tradycyjne Cykle TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item season-element" onclick="showSeasonDetails('Drewno')" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1)); cursor: pointer;">
                                <i class="fas fa-seedling feature-icon" style="color: #4CAF50;"></i>
                                <div class="feature-text">Drewno<br><small>Wiosna</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Ogień')" style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.1)); cursor: pointer;">
                                <i class="fas fa-fire feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">Ogień<br><small>Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Ziemia')" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.3), rgba(255, 193, 7, 0.1)); cursor: pointer;">
                                <i class="fas fa-mountain feature-icon" style="color: #FFC107;"></i>
                                <div class="feature-text">Ziemia<br><small>Późne Lato</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Metal')" style="background: linear-gradient(135deg, rgba(158, 158, 158, 0.3), rgba(158, 158, 158, 0.1)); cursor: pointer;">
                                <i class="fas fa-wind feature-icon" style="color: #9E9E9E;"></i>
                                <div class="feature-text">Metal<br><small>Jesień</small></div>
                            </div>
                            <div class="feature-item season-element" onclick="showSeasonDetails('Woda')" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.3), rgba(33, 150, 243, 0.1)); cursor: pointer;">
                                <i class="fas fa-snowflake feature-icon" style="color: #2196F3;"></i>
                                <div class="feature-text">Woda<br><small>Zima</small></div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="color: white; margin-bottom: 10px;">Dzisiejsze Zalecenia</h4>
                            <ul id="dailyRecommendations" style="color: rgba(255,255,255,0.9); line-height: 1.8; list-style: none;">
                                <li>☀️ Unikaj przegrzewania w gorące dni</li>
                                <li>🧘 Praktykuj spokojną medytację</li>
                                <li>🍉 Jedz chłodzące owoce jak arbuz</li>
                                <li>🏊 Pływaj lub rób ćwiczenia w cieniu</li>
                                <li>🌙 Śpij wcześnie by uniknąć ciepła</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recipes Tab -->
            <div id="recipes" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div>
                            <div class="card-title">Sezonowe Przepisy</div>
                            <div class="card-subtitle" id="recipesSubtitle">Ulubione Sezonu Ognia</div>
                        </div>
                    </div>
                </div>

                <div id="recipesContainer">
                    <!-- Dynamic recipes will be loaded here -->
                </div>

                <button class="action-btn" style="width: 100%; margin-top: 20px;" onclick="generateShoppingList()">
                    📝 Wygeneruj Listę Zakupów Sezonowych
                </button>
            </div>

            <!-- Wellness Tab -->
            <div id="wellness" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div>
                            <div class="card-title">Praktyki Zdrowotne</div>
                            <div class="card-subtitle">Umysł, Ciało i Duch</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="showWellnessPractice('akupresura')">
                                <i class="fas fa-spa feature-icon"></i>
                                <div class="feature-text">Akupresura</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('qigong')">
                                <i class="fas fa-dumbbell feature-icon"></i>
                                <div class="feature-text">Qigong</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('medytacja')">
                                <i class="fas fa-brain feature-icon"></i>
                                <div class="feature-text">Medytacja</div>
                            </div>
                            <div class="feature-item" onclick="showWellnessPractice('oddychanie')">
                                <i class="fas fa-lungs feature-icon"></i>
                                <div class="feature-text">Oddychanie</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <div class="card-title">Tygodniowy Postęp</div>
                            <div class="card-subtitle">Twoja podróż do zdrowia</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="wellness-metrics">
                            <div class="metric-item">
                                <span id="weeklyPracticeDays" class="metric-value">0</span>
                                <div class="metric-label">Dni Praktyki</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyMinutes" class="metric-value">0</span>
                                <div class="metric-label">Minuty</div>
                            </div>
                            <div class="metric-item">
                                <span id="weeklyRecipes" class="metric-value">0</span>
                                <div class="metric-label">Przepisy Wypróbowane</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant Tab -->
            <div id="ai-assistant" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div>
                            <div class="card-title">AI Asystent TCM</div>
                            <div class="card-subtitle">Ekspert Medycyny Chińskiej</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div id="aiStatus" style="color: #4CAF50; font-size: 14px;">
                                🤖 Gotowy do pomocy
                            </div>
                            <button 
                                onclick="testFullAIWorkflow()"
                                style="
                                    background: linear-gradient(135deg, #2196F3, #03A9F4);
                                    border: none;
                                    border-radius: 12px;
                                    padding: 10px 20px;
                                    color: white;
                                    font-size: 14px;
                                    cursor: pointer;
                                    margin-top: 10px;
                                    transition: all 0.3s ease;
                                "
                                title="Przetestuj połączenie z AI Railway"
                            >
                                🔧 Testuj połączenie AI
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="glass-card" style="min-height: 400px;">
                    <div class="card-content">
                        <div id="chatMessages" style="
                            height: 300px; 
                            overflow-y: auto; 
                            border: 1px solid rgba(255,255,255,0.2); 
                            border-radius: 12px; 
                            padding: 15px; 
                            margin-bottom: 15px;
                            background: rgba(0,0,0,0.1);
                        ">
                            <div class="ai-message">
                                <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">🤖 AI Asystent:</div>
                                <div style="color: rgba(255,255,255,0.9);">
                                    Witaj! Jestem Twoim ekspertem w dziedzinie Tradycyjnej Medycyny Chińskiej. 
                                    Mogę pomóc Ci w:
                                    <br>• 🍽️ Przepisach sezonowych
                                    <br>• 🧘 Ćwiczeniach według sezonu
                                    <br>• 🛒 Listach zakupów
                                    <br>• 🌿 Poradach zdrowotnych TCM
                                    <br><br>Zapytaj mnie o cokolwiek!
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <div style="flex: 1;">
                                <textarea 
                                    id="userInput" 
                                    placeholder="Zapytaj o przepisy, ćwiczenia, porady TCM..."
                                    style="
                                        width: 100%;
                                        min-height: 60px;
                                        max-height: 120px;
                                        padding: 12px;
                                        border: 1px solid rgba(255,255,255,0.3);
                                        border-radius: 12px;
                                        background: rgba(76, 175, 80, 0.1);
                                        color: white;
                                        font-size: 14px;
                                        resize: vertical;
                                        font-family: inherit;
                                        box-sizing: border-box;
                                    "
                                    onkeypress="handleEnterKey(event)"
                                ></textarea>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button 
                                    id="voiceBtn" 
                                    onclick="toggleVoiceRecording()"
                                    style="
                                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="Nagrywanie głosowe"
                                >
                                    <i class="fas fa-microphone"></i>
                                </button>
                                <button 
                                    onclick="sendMessage()"
                                    style="
                                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                                        border: none;
                                        border-radius: 12px;
                                        width: 50px;
                                        height: 50px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        cursor: pointer;
                                        color: white;
                                        font-size: 18px;
                                        transition: all 0.3s ease;
                                    "
                                    title="Wyślij wiadomość"
                                >
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div style="margin-top: 15px;">
                            <div style="color: white; font-size: 12px; margin-bottom: 8px;">Szybkie akcje:</div>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="quick-action-btn" onclick="quickAction('przepisy')">
                                    🍽️ Przepisy sezonowe
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('cwiczenia')">
                                    🧘 Ćwiczenia
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('lista')">
                                    🛒 Lista zakupów
                                </button>
                                <button class="quick-action-btn" onclick="quickAction('porady')">
                                    🌿 Porady TCM
                                </button>
                                <button class="quick-action-btn" onclick="testFullAIWorkflow()" style="background: linear-gradient(135deg, #2196F3, #03A9F4);">
                                    🔧 Test AI
                                </button>
                            </div>
                        </div>

                        <!-- Test Button -->
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                            <div style="color: white; font-size: 12px; margin-bottom: 8px;">Diagnostyka:</div>
                            <button 
                                onclick="testFullAIWorkflow()"
                                style="
                                    background: linear-gradient(135deg, #2196F3, #03A9F4);
                                    border: none;
                                    border-radius: 8px;
                                    padding: 8px 16px;
                                    color: white;
                                    font-size: 12px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                "
                                title="Przetestuj połączenie z AI Railway"
                            >
                                🔧 Testuj połączenie AI
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div>
                            <div class="card-title">Twój Profil</div>
                            <div class="card-subtitle">Konstytucja TCM</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="user-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #4CAF50, #66BB6A); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('user')">
                                    👤
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(76, 175, 80, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('user')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="user-display-name" style="color: white; margin-bottom: 5px;">Eksplorator Zdrowia</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Zrównoważona Konstytucja</p>
                        </div>
                        
                        <div class="feature-grid">
                            <div class="feature-item" onclick="editUserProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="showPremiumModal()">
                                <i class="fas fa-crown feature-icon" style="color: #FFD700;"></i>
                                <div class="feature-text">Premium</div>
                            </div>
                            <div class="feature-item" onclick="testNotifications()">
                                <i class="fas fa-bell feature-icon"></i>
                                <div class="feature-text">Powiadomienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-download feature-icon" id="offline-icon"></i>
                                <div class="feature-text" id="offline-text">Tryb Offline</div>
                            </div>
                            <div class="feature-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt feature-icon" style="color: #F44336;"></i>
                                <div class="feature-text">Wyloguj</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="admin" class="tab-content">
                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <div class="card-title">Panel Administratora</div>
                            <div class="card-subtitle">Zarządzanie aplikacją</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="position: relative; display: inline-block;">
                                <div id="admin-profile-picture" style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #FF6B35, #F7931E); margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; position: relative; overflow: hidden;" onclick="changeProfilePicture('admin')">
                                    👑
                                </div>
                                <div style="position: absolute; bottom: 15px; right: -5px; background: rgba(255, 107, 53, 0.9); width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;" onclick="changeProfilePicture('admin')">
                                    <i class="fas fa-camera" style="font-size: 10px; color: white;"></i>
                                </div>
                            </div>
                            <h3 id="admin-display-name" style="color: white; margin-bottom: 5px;">Administrator</h3>
                            <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Pełne uprawnienia systemu</p>
                        </div>
                        
                        <div class="feature-grid" style="margin-bottom: 20px;">
                            <div class="feature-item" onclick="editAdminProfile()">
                                <i class="fas fa-edit feature-icon"></i>
                                <div class="feature-text">Edytuj Profil</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-profile-offline-icon"></i>
                                <div class="feature-text" id="admin-profile-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div>
                            <div class="card-title">Narzędzia Systemowe</div>
                            <div class="card-subtitle">Konfiguracja i monitoring</div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="feature-grid">
                            <div class="feature-item" onclick="testAPIConnection()">
                                <i class="fas fa-server feature-icon" style="color: #4CAF50;"></i>
                                <div class="feature-text">Test Railway</div>
                            </div>
                            <div class="feature-item" onclick="performBackup()">
                                <i class="fas fa-database feature-icon"></i>
                                <div class="feature-text">Backup</div>
                            </div>
                            <div class="feature-item" onclick="showSystemLogs()">
                                <i class="fas fa-file-alt feature-icon"></i>
                                <div class="feature-text">Logi</div>
                            </div>
                            <div class="feature-item" onclick="showRestoreModal()">
                                <i class="fas fa-upload feature-icon"></i>
                                <div class="feature-text">Przywróć</div>
                            </div>
                            <div class="feature-item" onclick="showSystemSettings()">
                                <i class="fas fa-cogs feature-icon"></i>
                                <div class="feature-text">Ustawienia</div>
                            </div>
                            <div class="feature-item" onclick="toggleOfflineMode()">
                                <i class="fas fa-wifi-slash feature-icon" id="admin-offline-icon"></i>
                                <div class="feature-text" id="admin-offline-text">Tryb Offline</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="bottom-nav-item active" onclick="switchBottomTab(event, 'home')">
                <i class="fas fa-home"></i>
                <span>Główna</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'calendar')">
                <i class="fas fa-calendar-alt"></i>
                <span>Kalendarz</span>
                <div class="notification-badge">3</div>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'recipes')">
                <i class="fas fa-utensils"></i>
                <span>Przepisy</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'wellness')">
                <i class="fas fa-spa"></i>
                <span>Zdrowie</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'ai-assistant')">
                <i class="fas fa-robot"></i>
                <span>AI Asystent</span>
            </div>
            <div class="bottom-nav-item" onclick="switchBottomTab(event, 'profile')">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
            <div class="bottom-nav-item admin-nav" onclick="switchBottomTab(event, 'admin')" style="display: none;">
                <i class="fas fa-shield-alt"></i>
                <span>Admin</span>
            </div>
        </nav>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div id="profileEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 400px; margin: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-edit" style="margin-right: 10px; color: #4CAF50;"></i>
                    Edytuj Profil
                </h3>
                <button onclick="closeProfileEditModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-user" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nazwa użytkownika
                </label>
                <input type="text" id="editDisplayName" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowadź nową nazwę">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-envelope" style="margin-right: 8px; color: #4CAF50;"></i>
                    Email / Login
                </label>
                <input type="email" id="editEmail" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowadź nowy email">
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="color: rgba(255,255,255,0.9); font-size: 14px; margin-bottom: 8px; display: block;">
                    <i class="fas fa-lock" style="margin-right: 8px; color: #4CAF50;"></i>
                    Nowe hasło (opcjonalnie)
                </label>
                <input type="password" id="editPassword" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; backdrop-filter: blur(10px);" placeholder="Wprowadź nowe hasło">
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button onclick="closeProfileEditModal()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Anuluj
                </button>
                <button onclick="saveProfileChanges()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-save" style="margin-right: 8px;"></i>
                    Zapisz
                </button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile picture upload -->
    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">

    <!-- Wellness Practice Modal -->
    <div id="wellnessPracticeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 600px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 id="practiceTitle" style="color: white; margin: 0; font-size: 22px;">
                    <i id="practiceIcon" class="fas fa-spa" style="margin-right: 10px; color: #4CAF50;"></i>
                    Praktyka Zdrowotna
                </h3>
                <button onclick="closeWellnessPractice()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="practiceContent">
                <!-- Practice content will be dynamically loaded here -->
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="startPracticeSession()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-play" style="margin-right: 8px;"></i>
                    Rozpocznij Praktykę
                </button>
                <button onclick="closeWellnessPractice()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    Zamknij
                </button>
            </div>
        </div>
    </div>

    <!-- Element Test Modal -->
    <div id="elementTestModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: white; margin: 0; font-size: 20px;">
                    <i class="fas fa-search" style="margin-right: 10px; color: #4CAF50;"></i>
                    Odkryj swój żywioł TCM
                </h3>
                <button onclick="closeElementTest()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="testContent">
                <!-- Test questions will be dynamically loaded here -->
            </div>
            
            <div id="testResult" style="display: none;">
                <!-- Test results will be shown here -->
            </div>
            
            <div id="testNavigation" style="display: flex; gap: 15px; margin-top: 25px;">
                <button id="prevBtn" onclick="previousQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease; display: none;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
                    Poprzednie
                </button>
                <button id="nextBtn" onclick="nextQuestion()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    Następne
                    <i class="fas fa-arrow-right" style="margin-left: 8px;"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2)); border: 2px solid rgba(255, 215, 0, 0.5); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; margin: 20px; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: #FFD700; margin: 0; font-size: 22px; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);">
                    <i class="fas fa-crown" style="margin-right: 10px; color: #FFD700;"></i>
                    Premium AI Asystent
                </h3>
                <button onclick="closePremiumModal()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 15px;">🤖👑</div>
                <h4 style="color: white; margin-bottom: 10px;">Status AI Asystenta</h4>
                <div id="aiUsageStatus" style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: #FFD700; font-weight: 600; margin-bottom: 5px;">Pozostałe zapytania bezpłatne:</div>
                    <div id="remainingQueries" style="font-size: 24px; color: white; font-weight: 700;">10 / 10</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 12px; margin-top: 5px;">Reset codziennie o północy</div>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: #FFD700; margin-bottom: 15px;">
                    <i class="fas fa-star" style="margin-right: 8px;"></i>
                    Premium Plan - 29.99 PLN/miesiąc
                </h4>
                <ul style="color: white; list-style: none; padding: 0;">
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Nielimitowane zapytania AI</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Priorytetowe odpowiedzi</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Zaawansowane analizy TCM</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>Personalne plany żywieniowe</li>
                    <li style="margin-bottom: 10px;"><i class="fas fa-check" style="color: #4CAF50; margin-right: 10px;"></i>24/7 dostęp bez limitów</li>
                </ul>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
                <button id="subscribeBtn" onclick="initializeStripePayment()" style="width: 100%; padding: 15px; border-radius: 15px; border: none; background: linear-gradient(135deg, #FFD700, #FFC107); color: #000; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 215, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    <i class="fas fa-crown" style="margin-right: 10px;"></i>
                    Aktywuj Premium
                </button>
            </div>

            <div style="text-align: center;">
                <p style="color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 0;">
                    <i class="fas fa-shield-alt" style="margin-right: 5px;"></i>
                    Bezpieczne płatności przez Stripe • Anuluj w dowolnym momencie
                </p>
            </div>
        </div>
    </div>

    <script>
        // === API CONFIGURATION ===
        const API_CONFIG = {
            BASE_URL: 'https://sezonowe-dobro-production.up.railway.app/api',
            ENDPOINTS: {
                HEALTH: '/health',
                LOGIN: '/auth/login',
                REGISTER: '/auth/register',
                AI_QUERY: '/ai/query',
                STRIPE_CHECKOUT: '/payments/create-checkout',
                SUBSCRIPTION_STATUS: '/payments/subscription-status'
            }
        };

        // === API HELPER FUNCTIONS ===
        async function apiCall(endpoint, options = {}) {
            const url = API_CONFIG.BASE_URL + endpoint;
            const token = localStorage.getItem('authToken');
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` }),
                    ...options.headers
                },
                ...options
            };
            
            try {
                const response = await fetch(url, config);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Call failed:', error);
                throw error;
            }
        }

        // === AUTHENTICATION FUNCTIONS ===
        async function realLogin(email, password) {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.LOGIN, {
                    method: 'POST',
                    body: JSON.stringify({ email, password })
                });
                
                // Store token and user data
                localStorage.setItem('authToken', response.token);
                localStorage.setItem('userName', response.user.email);
                localStorage.setItem('userRole', response.user.role);
                
                return response;
            } catch (error) {
                throw new Error('Logowanie nie powiodło się: ' + error.message);
            }
        }

        // === AI INTEGRATION ===
        async function getRealAIResponse(message) {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.AI_QUERY, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        message: message,
                        context: {
                            season: getCurrentSeason(),
                            userRole: localStorage.getItem('userRole') || 'user'
                        }
                    })
                });
                
                return response.response || 'Przepraszam, nie mogę teraz odpowiedzieć.';
                
            } catch (error) {
                // If OpenAI not configured, inform user
                if (error.message.includes('OPENAI_NOT_CONFIGURED')) {
                    console.log('🚧 OpenAI nie skonfigurowany - używam lokalnych odpowiedzi');
                    throw new Error('OpenAI API nie skonfigurowane');
                } else {
                    console.error('AI API Error:', error);
                    throw error;
                }
            }
        }

        // === TEST API CONNECTION ===
        async function testAPIConnection() {
            try {
                const response = await apiCall(API_CONFIG.ENDPOINTS.HEALTH);
                console.log('✅ API Railway połączone:', response);
                showNotification('✅ Połączono z serwerem Railway!');
                return true;
            } catch (error) {
                console.error('❌ API Railway błąd:', error);
                showNotification('❌ Błąd połączenia z serwerem', 'error');
                return false;
            }
        }

        // === TEST FULL AI WORKFLOW ===
        async function testFullAIWorkflow() {
            try {
                // Test 1: Health check
                console.log('🔍 Test 1: Health check...');
                const healthResponse = await apiCall(API_CONFIG.ENDPOINTS.HEALTH);
                console.log('✅ Health response:', healthResponse);
                
                // Test 2: Login
                console.log('🔍 Test 2: Login test...');
                const loginResponse = await apiCall(API_CONFIG.ENDPOINTS.LOGIN, {
                    method: 'POST',
                    body: JSON.stringify({
                        email: 'admin@sezonoweDobro.pl',
                        password: 'Wellness2024!F6C4094CC3919E7C@'
                    })
                });
                console.log('✅ Login response:', loginResponse);
                
                // Test 3: Store token temporarily
                const originalToken = localStorage.getItem('authToken');
                localStorage.setItem('authToken', loginResponse.token);
                
                // Test 4: AI Query
                console.log('🔍 Test 3: AI Query...');
                const aiResponse = await apiCall(API_CONFIG.ENDPOINTS.AI_QUERY, {
                    method: 'POST',
                    body: JSON.stringify({
                        message: 'Pokaż mi przepisy na lato',
                        context: {
                            season: 'lato',
                            userRole: 'admin'
                        }
                    })
                });
                console.log('✅ AI Response:', aiResponse);
                
                // Restore original token
                if (originalToken) {
                    localStorage.setItem('authToken', originalToken);
                } else {
                    localStorage.removeItem('authToken');
                }
                
                showNotification('✅ Wszystkie testy przeszły! AI powinno teraz działać.');
                return true;
                
            } catch (error) {
                console.error('❌ Test error:', error);
                showNotification('❌ Test failed: ' + error.message, 'error');
                return false;
            }
        }

        // Tab Switching
        function switchTab(evt, tabName) {
            var i, tabcontent, navtabs;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        function switchBottomTab(evt, tabName) {
            var i, tabcontent, navtabs, bottomNavItems;
            
            // Hide all tab contents
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Remove active class from all nav tabs
            navtabs = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navtabs.length; i++) {
                navtabs[i].classList.remove("active");
            }

            // Remove active class from all bottom nav items
            bottomNavItems = document.getElementsByClassName("bottom-nav-item");
            for (i = 0; i < bottomNavItems.length; i++) {
                bottomNavItems[i].classList.remove("active");
            }
            
            // Show selected tab and mark nav as active
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
            
            // Find corresponding top nav tab and activate it
            const topNavTabs = document.querySelectorAll('.nav-tab');
            topNavTabs.forEach((tab, index) => {
                if (index === Array.from(bottomNavItems).indexOf(evt.currentTarget)) {
                    tab.classList.add('active');
                }
            });
            
            // Initialize AI Assistant if needed
            if (tabName === 'ai-assistant') {
                initializeSpeechRecognition();
            }
        }

        // Sparkle Effect
        function createSparkle(event) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.innerHTML = '✨';
            sparkle.style.left = event.clientX + 'px';
            sparkle.style.top = event.clientY + 'px';
            sparkle.style.position = 'fixed';
            sparkle.style.fontSize = '20px';
            sparkle.style.zIndex = '9999';
            
            document.body.appendChild(sparkle);
            
            setTimeout(() => {
                document.body.removeChild(sparkle);
            }, 1500);
        }

        // Real-time Notification System
        function testNotifications() {
            showNotificationCenter();
        }
        
        function showNotificationCenter() {
            const modal = document.createElement('div');
            modal.id = 'notificationCenter';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            const userName = localStorage.getItem('userName') || 'Użytkownik';
            const userRole = localStorage.getItem('userRole') || 'user';
            const todayNotifications = generateTodayNotifications();
            
            modal.innerHTML = `
                <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 20px; backdrop-filter: blur(20px); padding: 30px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3 style="color: white; margin: 0; font-size: 22px;">
                            <i class="fas fa-bell" style="margin-right: 10px; color: #4CAF50;"></i>
                            Centrum Powiadomień
                        </h3>
                        <button onclick="closeNotificationCenter()" style="background: none; border: none; color: rgba(255,255,255,0.7); font-size: 24px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="background: rgba(76, 175, 80, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                            <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">👋 Witaj, ${userName}!</div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 14px;">
                                Rola: ${userRole === 'admin' ? '👑 Administrator' : '👤 Użytkownik'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">
                            📅 Dzisiejsze powiadomienia
                        </h4>
                        <div id="todayNotifications">
                            ${todayNotifications.map(notif => `
                                <div style="background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 12px; margin-bottom: 10px; border-left: 3px solid ${notif.color};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <span style="color: ${notif.color}; font-weight: 600;">${notif.icon} ${notif.type}</span>
                                        <span style="color: rgba(255,255,255,0.6); font-size: 12px;">${notif.time}</span>
                                    </div>
                                    <div style="color: rgba(255,255,255,0.9); font-size: 14px;">${notif.message}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: white; margin-bottom: 15px; font-size: 16px;">
                            ⚙️ Ustawienia powiadomień
                        </h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: white;">📱 Powiadomienia push</span>
                            <button onclick="toggleNotificationSetting('push')" id="pushToggle" style="background: #4CAF50; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">ON</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 10px;">
                            <span style="color: white;">🔔 Dźwięki</span>
                            <button onclick="toggleNotificationSetting('sound')" id="soundToggle" style="background: #4CAF50; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">ON</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                            <span style="color: white;">📧 Email</span>
                            <button onclick="toggleNotificationSetting('email')" id="emailToggle" style="background: #9E9E9E; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer;">OFF</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="sendTestNotification()" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-weight: 600; cursor: pointer;">
                            🧪 Test powiadomienia
                        </button>
                        <button onclick="requestNotificationPermission()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; cursor: pointer;">
                            🔓 Włącz uprawnienia
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Log notification center access
            addSystemLog('INFO', 'SYSTEM', 'Otwarto centrum powiadomień', `Użytkownik: ${userName}`);
        }
        
        function generateTodayNotifications() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
            const userRole = localStorage.getItem('userRole') || 'user';
            
            const baseNotifications = [
                {
                    type: 'Zdrowie',
                    icon: '💊',
                    message: 'Czas na poranny napój z ciepłą wodą i cytryną!',
                    time: '07:00',
                    color: '#4CAF50'
                },
                {
                    type: 'Praktyka',
                    icon: '🧘',
                    message: 'Zalecana poranna medytacja - 15 minut spokoju',
                    time: '08:00',
                    color: '#2196F3'
                },
                {
                    type: 'AI Asystent',
                    icon: '🤖',
                    message: 'Pozostałe zapytania dzisiaj: ' + (10 - parseInt(localStorage.getItem('dailyAIUsage') || '0')),
                    time: timeString,
                    color: '#FF9800'
                }
            ];
            
            if (userRole === 'admin') {
                baseNotifications.push({
                    type: 'Admin',
                    icon: '👑',
                    message: 'Backup systemu wykonany automatycznie',
                    time: '06:00',
                    color: '#F44336'
                });
            }
            
            return baseNotifications;
        }
        
        function closeNotificationCenter() {
            const modal = document.getElementById('notificationCenter');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }
        
        function toggleNotificationSetting(type) {
            const button = document.getElementById(type + 'Toggle');
            const isOn = button.textContent === 'ON';
            
            if (isOn) {
                button.textContent = 'OFF';
                button.style.background = '#9E9E9E';
            } else {
                button.textContent = 'ON';
                button.style.background = '#4CAF50';
            }
            
            // Save setting to localStorage
            localStorage.setItem('notification_' + type, !isOn);
            showNotification(`${type} powiadomienia: ${!isOn ? 'włączone' : 'wyłączone'}`);
        }
        
        function sendTestNotification() {
            showNotification('🧪 To jest testowe powiadomienie!');
            
            // Try browser notification if permission granted
            if (Notification.permission === 'granted') {
                new Notification('SezonoweDobro', {
                    body: 'Test powiadomienia przeglądarki',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%234CAF50"/></svg>'
                });
            }
        }
        
        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    if (permission === 'granted') {
                        showNotification('✅ Uprawnienia do powiadomień przyznane!');
                    } else {
                        showNotification('❌ Uprawnienia do powiadomień odrzucone');
                    }
                });
            } else {
                showNotification('❌ Przeglądarka nie obsługuje powiadomień');
            }
        }

        // Notification System
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(76, 175, 80, 0.9);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 14px;
                font-weight: 600;
                z-index: 10000;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.3);
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Dynamic Season Updates
        function updateSeason() {
            const seasons = [
                { 
                    name: 'Sezon Drewna (Wiosna)', 
                    icon: '🌱', 
                    element: 'Drewno',
                    color: '#4CAF50',
                    description: 'Wzrost, odnowa i oczyszczanie',
                    progress: 'Postęp Sezonu Drewna'
                },
                { 
                    name: 'Sezon Ognia (Lato)', 
                    icon: '🔥', 
                    element: 'Ogień',
                    color: '#FF5722',
                    description: 'Radość, aktywność i energia',
                    progress: 'Postęp Sezonu Ognia'
                },
                { 
                    name: 'Sezon Ziemi (Późne Lato)', 
                    icon: '🌾', 
                    element: 'Ziemia',
                    color: '#8D6E63',
                    description: 'Równowaga i stabilność',
                    progress: 'Postęp Sezonu Ziemi'
                },
                { 
                    name: 'Sezon Metalu (Jesień)', 
                    icon: '🍂', 
                    element: 'Metal',
                    color: '#9E9E9E',
                    description: 'Refleksja i przygotowanie',
                    progress: 'Postęp Sezonu Metalu'
                },
                { 
                    name: 'Sezon Wody (Zima)', 
                    icon: '❄️', 
                    element: 'Woda',
                    color: '#2196F3',
                    description: 'Odpoczynek i regeneracja',
                    progress: 'Postęp Sezonu Wody'
                }
            ];
            
            const currentDate = new Date();
            const month = currentDate.getMonth(); // 0-11
            const day = currentDate.getDate();
            let seasonIndex = 0;
            let seasonProgress = 0;
            
            // Dokładne daty sezonów TCM
            if (month >= 2 && month <= 4) { // Marzec-Maj (Wiosna)
                seasonIndex = 0;
                seasonProgress = calculateSeasonProgress(month, day, 2, 4); // Mar-May
            } else if (month >= 5 && month <= 7) { // Czerwiec-Sierpień (Lato)  
                seasonIndex = 1;
                seasonProgress = calculateSeasonProgress(month, day, 5, 7); // Jun-Aug
            } else if (month === 8) { // Wrzesień (Późne Lato)
                seasonIndex = 2;
                seasonProgress = Math.round((day / 30) * 100);
            } else if (month >= 9 && month <= 11) { // Październik-Grudzień (Jesień)
                seasonIndex = 3;
                seasonProgress = calculateSeasonProgress(month, day, 9, 11); // Oct-Dec
            } else { // Styczeń-Luty (Zima)
                seasonIndex = 4;
                if (month <= 1) {
                    seasonProgress = Math.round(((month * 31 + day) / 59) * 100);
                } else {
                    seasonProgress = 100;
                }
            }
            
            const currentSeason = seasons[seasonIndex];
            
            // Update season display
            const seasonTextElement = document.getElementById('currentSeasonText');
            const seasonTitleElement = document.getElementById('currentSeasonTitle');
            const seasonIconElements = document.querySelectorAll('.season-icon');
            const seasonDescElement = document.querySelector('.season-description');
            const seasonDescriptionElement = document.getElementById('seasonDescription');
            const recipesSubtitleElement = document.getElementById('recipesSubtitle');
            const progressTextElement = document.querySelector('.progress-text');
            const progressFillElement = document.querySelector('.progress-fill');
            
            if (seasonTextElement) seasonTextElement.textContent = currentSeason.name;
            if (seasonTitleElement) seasonTitleElement.textContent = currentSeason.name;
            if (seasonDescElement) seasonDescElement.textContent = currentSeason.description;
            if (recipesSubtitleElement) recipesSubtitleElement.textContent = `Ulubione ${currentSeason.name}`;
            if (progressTextElement) progressTextElement.textContent = `${currentSeason.progress}: ${seasonProgress}%`;
            if (progressFillElement) progressFillElement.style.width = `${seasonProgress}%`;
            
            // Update all season icons
            seasonIconElements.forEach(icon => {
                icon.className = getSeasonIconClass(currentSeason.element);
                icon.textContent = currentSeason.icon;
            });
            
            // Update season description paragraph
            if (seasonDescriptionElement) {
                const elementDescriptions = {
                    'Drewno': 'Dzisiejsza energia jest wyrównana z elementem Drewna. Skup się na wzroście, elastyczności i nowych początkach.',
                    'Ogień': 'Dzisiejsza energia jest wyrównana z elementem Ognia. Skup się na radości, aktywności i kultywowaniu ciepła wewnętrznego.',
                    'Ziemia': 'Dzisiejsza energia jest wyrównana z elementem Ziemi. Skup się na równowadze, stabilności i odżywianiu.',
                    'Metal': 'Dzisiejsza energia jest wyrównana z elementem Metalu. Skup się na refleksji, przygotowaniu i wewnętrznej sile.',
                    'Woda': 'Dzisiejsza energia jest wyrównana z elementem Wody. Skup się na odpoczynku, regeneracji i kultywowaniu energii wewnętrznej.'
                };
                seasonDescriptionElement.textContent = elementDescriptions[currentSeason.element];
            }
            
            // Update season button
            const seasonButton = document.querySelector('.season-btn');
            if (seasonButton) {
                seasonButton.innerHTML = `
                    <span class="season-icon">${currentSeason.icon}</span>
                    ${currentSeason.name}
                `;
            }
            
            // Update daily recommendations
            const dailyRecommendationsElement = document.getElementById('dailyRecommendations');
            if (dailyRecommendationsElement) {
                const seasonalRecommendations = {
                    'Drewno': [
                        '🌅 Wstawaj o wschodzie słońca (6:30)',
                        '🧘 Poranne ćwiczenia oddechowe',
                        '🥬 Jedz zielone warzywa liściaste',
                        '🚶 Rób łagodne spacery w naturze',
                        '🌙 Śpij przed 23:00'
                    ],
                    'Ogień': [
                        '☀️ Unikaj przegrzewania w gorące dni',
                        '🧘 Praktykuj spokojną medytację',
                        '🍉 Jedz chłodzące owoce jak arbuz',
                        '🏊 Pływaj lub rób ćwiczenia w cieniu',
                        '🌙 Śpij wcześnie by uniknąć ciepła'
                    ],
                    'Ziemia': [
                        '⚖️ Jedz regularne, zrównoważone posiłki',
                        '🧘 Praktykuj medytację uważności',
                        '🌽 Jedz słodkie i odżywcze pokarmy',
                        '🚶 Rób spokojne spacery po posiłku',
                        '😌 Kultywuj spokój i równowagę'
                    ],
                    'Metal': [
                        '🍃 Oddychaj głęboko świeżym powietrzem',
                        '🧘 Praktykuj ćwiczenia oddechowe',
                        '🍐 Jedz białe pokarmy jak gruszki',
                        '📖 Poświęć czas na refleksję',
                        '🌙 Kładź się spać wcześniej'
                    ],
                    'Woda': [
                        '🔥 Jedz ciepłe, odżywcze potrawy',
                        '🧘 Praktykuj głęboką medytację',
                        '🫘 Dodaj do diety czarne ziarna',
                        '🏠 Oszczędzaj energię, zostań w domu',
                        '💤 Śpij więcej, nawet do 9 godzin'
                    ]
                };
                
                const recommendations = seasonalRecommendations[currentSeason.element] || seasonalRecommendations['Ogień'];
                dailyRecommendationsElement.innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
            }
            
            return currentSeason;
        }
        
        function calculateSeasonProgress(currentMonth, currentDay, startMonth, endMonth) {
            const totalDays = (endMonth - startMonth + 1) * 30; // Przybliżenie
            const currentDays = (currentMonth - startMonth) * 30 + currentDay;
            return Math.min(Math.round((currentDays / totalDays) * 100), 100);
        }
        
        function getSeasonIconClass(element) {
            const iconClasses = {
                'Drewno': 'fas fa-leaf',
                'Ogień': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return iconClasses[element] || 'fas fa-leaf';
        }

        // Authentication System
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userName = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (isLoggedIn) {
                showMainApp();
                updateUserName(userName);
                
                if (userRole === 'admin') {
                    showAdminFeatures();
                } else {
                    hideAdminFeatures();
                }
            } else {
                showLoginScreen();
            }
        }

        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Show loading
            const submitBtn = document.querySelector('#loginForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logowanie...';
            submitBtn.disabled = true;
            
            try {
                // Try real API login first
                const response = await realLogin(email, password);
                
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userName', response.user.email);
                localStorage.setItem('userEmail', response.user.email);
                localStorage.setItem('userRole', response.user.role);
                
                addSystemLog('SUCCESS', 'AUTH', 'Zalogowano przez Railway API', `Email: ${email}, Role: ${response.user.role}`);
                showNotification(`✅ Zalogowano przez Railway! ${response.user.role === 'admin' ? '👑' : '🎉'}`);
                
                setTimeout(() => {
                    showMainApp();
                    updateUserName(response.user.email);
                    if (response.user.role === 'admin') {
                        showAdminFeatures();
                    } else {
                        hideAdminFeatures();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Railway login failed:', error);
                
                // Only Railway API authentication - no demo fallback
                addSystemLog('WARNING', 'AUTH', 'Nieudana próba logowania', `Email: ${email}, Error: ${error.message}`);
                showNotification('❌ Błąd połączenia z serwerem lub nieprawidłowe dane', 'error');
            } finally {
                // Reset button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function register(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            // Simple registration simulation
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userName', name);
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userRole', 'user');
            
            addSystemLog('SUCCESS', 'AUTH', 'Nowe konto zostało utworzone', `Użytkownik: ${name}, Email: ${email}`);
            showNotification('Konto zostało utworzone! 🎉');
            
            setTimeout(() => {
                showMainApp();
                updateUserName(name);
                hideAdminFeatures();
            }, 1000);
        }

        // Real-time Health Metrics System
        let healthMetrics = {
            qi: 85,
            balance: 92,
            energy: 78
        };

        // Load saved metrics or set defaults
        function loadHealthMetrics() {
            const saved = localStorage.getItem('healthMetrics');
            if (saved) {
                healthMetrics = { ...healthMetrics, ...JSON.parse(saved) };
            }
            updateMetricDisplays();
        }

        // Save metrics to localStorage
        function saveHealthMetrics() {
            localStorage.setItem('healthMetrics', JSON.stringify(healthMetrics));
        }

        // Update metric displays in real-time
        function updateMetricDisplays() {
            document.getElementById('qiLevel').textContent = Math.round(healthMetrics.qi);
            document.getElementById('balanceLevel').textContent = Math.round(healthMetrics.balance);
            document.getElementById('energyLevel').textContent = Math.round(healthMetrics.energy);
            
            // Add visual effects for changes
            animateMetricChange('qiLevel');
            animateMetricChange('balanceLevel');
            animateMetricChange('energyLevel');
        }

        // Animate metric changes
        function animateMetricChange(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                element.style.fontWeight = 'bold';
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = '';
                    element.style.fontWeight = '';
                }, 600);
            }
        }

        // Increase metrics based on activities
        function increaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi + qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance + balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy + energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('SUCCESS', 'USER', `Wzrost wskaźników zdrowia: ${reason}`, 
                    `Qi: ${oldQi}→${Math.round(healthMetrics.qi)}, Równowaga: ${oldBalance}→${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}→${Math.round(healthMetrics.energy)}`);
                
                showNotification(`📈 Wzrost zdrowia! ${reason}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Decrease metrics (stress, fatigue, etc.)
        function decreaseMetrics(qi = 0, balance = 0, energy = 0, reason = '') {
            const oldQi = healthMetrics.qi;
            const oldBalance = healthMetrics.balance;
            const oldEnergy = healthMetrics.energy;
            
            // Apply negative changes with limits (0-100)
            healthMetrics.qi = Math.max(0, Math.min(100, healthMetrics.qi - qi));
            healthMetrics.balance = Math.max(0, Math.min(100, healthMetrics.balance - balance));
            healthMetrics.energy = Math.max(0, Math.min(100, healthMetrics.energy - energy));
            
            // Log changes
            if (qi > 0 || balance > 0 || energy > 0) {
                addSystemLog('WARNING', 'USER', `Spadek wskaźników zdrowia: ${reason}`, 
                    `Qi: ${oldQi}→${Math.round(healthMetrics.qi)}, Równowaga: ${oldBalance}→${Math.round(healthMetrics.balance)}, Energia: ${oldEnergy}→${Math.round(healthMetrics.energy)}`);
            }
            
            saveHealthMetrics();
            updateMetricDisplays();
        }

        // Daily natural fluctuations (simulate realistic changes)
        function simulateDailyFluctuations() {
            const currentHour = new Date().getHours();
            
            // Morning boost (6-10 AM)
            if (currentHour >= 6 && currentHour <= 10) {
                increaseMetrics(1, 0, 2, 'Poranny zastrzyk energii');
            }
            // Afternoon dip (13-15)
            else if (currentHour >= 13 && currentHour <= 15) {
                decreaseMetrics(0, 0, 1, 'Popołudniowe zmęczenie');
            }
            // Evening rebalance (18-20)
            else if (currentHour >= 18 && currentHour <= 20) {
                increaseMetrics(0, 1, 0, 'Wieczorna równowaga');
            }
            // Night energy drop (22-24)
            else if (currentHour >= 22) {
                decreaseMetrics(0, 0, 2, 'Naturalne zmęczenie');
            }
        }

        // Reset metrics (for testing or new day)
        function resetHealthMetrics() {
            healthMetrics = { qi: 85, balance: 92, energy: 78 };
            saveHealthMetrics();
            updateMetricDisplays();
            addSystemLog('INFO', 'SYSTEM', 'Wskaźniki zdrowia zostały zresetowane');
            showNotification('🔄 Wskaźniki zdrowia zostały zresetowane!');
        }

        // Weekly Progress Functions
        let weeklyProgress = {
            practiceDays: 0,
            totalMinutes: 0,
            recipesUsed: 0,
            lastPracticeDate: null,
            practicesThisWeek: [],
            recipesThisWeek: [],
            weekStart: getWeekStart()
        };

        function getWeekStart() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const diff = now.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Monday start
            const monday = new Date(now.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function loadWeeklyProgress() {
            const saved = localStorage.getItem('weeklyProgress');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Check if it's a new week
                const currentWeekStart = getWeekStart();
                const savedWeekStart = new Date(data.weekStart);
                
                if (currentWeekStart.getTime() !== savedWeekStart.getTime()) {
                    // New week - reset progress
                    resetWeeklyProgress();
                } else {
                    // Same week - load saved data
                    weeklyProgress = {
                        ...data,
                        weekStart: currentWeekStart,
                        practicesThisWeek: data.practicesThisWeek || [],
                        recipesThisWeek: data.recipesThisWeek || []
                    };
                }
            } else {
                // First time - initialize
                resetWeeklyProgress();
            }
            
            updateWeeklyDisplay();
        }

        function resetWeeklyProgress() {
            weeklyProgress = {
                practiceDays: 0,
                totalMinutes: 0,
                recipesUsed: 0,
                lastPracticeDate: null,
                practicesThisWeek: [],
                recipesThisWeek: [],
                weekStart: getWeekStart()
            };
            saveWeeklyProgress();
        }

        function saveWeeklyProgress() {
            localStorage.setItem('weeklyProgress', JSON.stringify(weeklyProgress));
        }

        function updateWeeklyDisplay() {
            document.getElementById('weeklyPracticeDays').textContent = weeklyProgress.practiceDays;
            document.getElementById('weeklyMinutes').textContent = weeklyProgress.totalMinutes;
            document.getElementById('weeklyRecipes').textContent = weeklyProgress.recipesUsed;
            
            // Add animation effect
            animateMetricUpdate('weeklyPracticeDays');
            animateMetricUpdate('weeklyMinutes');
            animateMetricUpdate('weeklyRecipes');
        }

        function animateMetricUpdate(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#4CAF50';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = 'white';
                }, 300);
            }
        }

        function addPracticeToWeekly(practiceTitle, durationMinutes) {
            const today = new Date().toDateString();
            
            // Check if we already practiced today
            if (!weeklyProgress.practicesThisWeek.includes(today)) {
                weeklyProgress.practiceDays++;
                weeklyProgress.practicesThisWeek.push(today);
            }
            
            weeklyProgress.totalMinutes += durationMinutes;
            weeklyProgress.lastPracticeDate = today;
            
            saveWeeklyProgress();
            updateWeeklyDisplay();
            
            // Log the activity
            addSystemLog('SUCCESS', 'WEEKLY', `Dodano praktykę do tygodniowego postępu`, `${practiceTitle} - ${durationMinutes} min`);
        }

        function addRecipeToWeekly(recipeName) {
            if (!weeklyProgress.recipesThisWeek.includes(recipeName)) {
                weeklyProgress.recipesUsed++;
                weeklyProgress.recipesThisWeek.push(recipeName);
                
                saveWeeklyProgress();
                updateWeeklyDisplay();
                
                // Log the activity
                addSystemLog('SUCCESS', 'WEEKLY', `Dodano przepis do tygodniowego postępu`, recipeName);
                
                showNotification(`📊 +1 Przepis do tygodniowego postępu!`);
            }
        }

        function getWeeklyStats() {
            return {
                practiceDays: weeklyProgress.practiceDays,
                totalMinutes: weeklyProgress.totalMinutes,
                recipesUsed: weeklyProgress.recipesUsed,
                averageMinutesPerDay: weeklyProgress.practiceDays > 0 ? Math.round(weeklyProgress.totalMinutes / weeklyProgress.practiceDays) : 0,
                weekProgress: Math.round((weeklyProgress.practiceDays / 7) * 100)
            };
        }

        // Wellness Practice Functions
        let currentPractice = '';
        
        const practiceData = {
            akupresura: {
                title: 'Akupresura TCM',
                icon: 'fas fa-spa',
                description: 'Akupresura to starożytna technika ucisku określonych punktów na ciele w celu przywrócenia równowagi energetycznej.',
                benefits: [
                    '🎯 Zmniejsza napięcie i stres',
                    '💆 Łagodzi bóle głowy i migrenę',
                    '⚡ Zwiększa przepływ energii Qi',
                    '😌 Poprawia samopoczucie',
                    '🛡️ Wzmacnia odporność'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie',
                        description: 'Znajdź spokojne miejsce. Umyj ręce i rozgrzej dłonie tarcie nimi o siebie.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Punkt Yintang (Trzecie Oko)',
                        description: 'Umieść kciuk między brwiami. Delikatnie uciskaj przez 30 sekund, oddychając spokojnie.',
                        duration: '30 sek'
                    },
                    {
                        step: 3,
                        title: 'Punkt Baihui (Czubek Głowy)',
                        description: 'Znajdź punkt na środku czubka głowy. Uciskaj delikatnie palcem wskazującym.',
                        duration: '30 sek'
                    },
                    {
                        step: 4,
                        title: 'Punkty Taiyang (Skronie)',
                        description: 'Umieść oba kciuki na skroniach. Masuj okrężnymi ruchami w kierunku zgodnym z ruchem wskazówek zegara.',
                        duration: '1 min'
                    },
                    {
                        step: 5,
                        title: 'Punkt Hegu (Dłoń)',
                        description: 'Znajdź punkt między kciukiem a palcem wskazującym. Uciskaj przez 30 sekund na każdej dłoni.',
                        duration: '1 min'
                    }
                ],
                totalDuration: '5 minut'
            },
            qigong: {
                title: 'Qigong - Ruch Energii',
                icon: 'fas fa-dumbbell',
                description: 'Qigong łączy powolne ruchy, oddychanie i medytację w celu harmonizacji przepływu energii Qi.',
                benefits: [
                    '🌊 Harmonizuje przepływ energii Qi',
                    '🧘 Uspokaja umysł i ciało',
                    '💪 Wzmacnia mięśnie i elastyczność',
                    '🫁 Poprawia funkcje układu oddechowego',
                    '⚖️ Przywraca równowagę energetyczną'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa Podstawowa',
                        description: 'Stań prosto, stopy na szerokość ramion. Kolana lekko ugięte, ramiona swobodnie opuszczone.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Podnoszenie Nieba',
                        description: 'Powoli podnieś ręce nad głowę, wdychając. Opuść ręce, wydychając. Wyobraź sobie, że trzymasz energię.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Obejmowanie Drzewa',
                        description: 'Ramiona okrągle przed sobą, jakbyś obejmował duże drzewo. Oddychaj spokojnie przez 2 minuty.',
                        duration: '2 min'
                    },
                    {
                        step: 4,
                        title: 'Kołysanie Qi',
                        description: 'Delikatnie kołysz się z boku na bok, pozwalając energii swobodnie płynąć przez ciało.',
                        duration: '2 min'
                    },
                    {
                        step: 5,
                        title: 'Zakończenie',
                        description: 'Połóż dłonie na brzuchu. Zrób 3 głębokie oddechy, koncentrując się na centrum energii.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '10 minut'
            },
            medytacja: {
                title: 'Medytacja TCM',
                icon: 'fas fa-brain',
                description: 'Medytacja według tradycji chińskiej koncentruje się na uspokojeniu umysłu i harmonizacji energii.',
                benefits: [
                    '🧠 Uspokaja umysł i myśli',
                    '❤️ Obniża ciśnienie krwi',
                    '😌 Redukuje stres i niepokój',
                    '🔄 Przywraca równowagę Yin-Yang',
                    '✨ Zwiększa świadomość'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Przygotowanie Miejsca',
                        description: 'Znajdź ciche miejsce. Usiądź wygodnie z prostymi plecami, nogi skrzyżowane lub na krześle.',
                        duration: '2 min'
                    },
                    {
                        step: 2,
                        title: 'Skupienie na Oddechu',
                        description: 'Zamknij oczy. Skup się na naturalnym rytmie oddechu. Nie zmieniaj go, tylko obserwuj.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Medytacja Dantian',
                        description: 'Skieruj uwagę na punkt 5cm poniżej pępka. To centrum energii. Oddychaj do tego punktu.',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'Uśmiech Wewnętrzny',
                        description: 'Wyślij ciepły uśmiech do swojego serca, następnie do wszystkich organów. Poczuj wdzięczność.',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'Powrót do Świadomości',
                        description: 'Powoli porusz palcami i stopami. Otwórz oczy i przez chwilę pozostań w ciszy.',
                        duration: '2 min'
                    }
                ],
                totalDuration: '15 minut'
            },
            oddychanie: {
                title: 'Oddychanie Terapeutyczne',
                icon: 'fas fa-lungs',
                description: 'Kontrolowane oddychanie według TCM oczyszcza energię i wzmacnia życiową siłę.',
                benefits: [
                    '🫁 Wzmacnia płuca i układ oddechowy',
                    '⚡ Zwiększa poziom energii życiowej',
                    '🧘 Uspokaja system nerwowy',
                    '🔄 Oczyszcza toksyny z organizmu',
                    '💤 Poprawia jakość snu'
                ],
                instructions: [
                    {
                        step: 1,
                        title: 'Postawa i Przygotowanie',
                        description: 'Usiądź wygodnie z prostymi plecami. Jedna ręka na piersi, druga na brzuchu.',
                        duration: '1 min'
                    },
                    {
                        step: 2,
                        title: 'Oddech Brzuszny',
                        description: 'Wdech przez nos - brzuch podnosi się, klatka piersiowa nieruchoma. Wydech przez usta - brzuch opada.',
                        duration: '3 min'
                    },
                    {
                        step: 3,
                        title: 'Rytm 4-7-8',
                        description: 'Wdech przez nos (4 sekundy), zatrzymaj oddech (7 sekund), wydech przez usta (8 sekund).',
                        duration: '5 min'
                    },
                    {
                        step: 4,
                        title: 'Oczyszczający Oddech',
                        description: 'Głęboki wdech przez nos, zatrzymaj na 3 sekundy, silny wydech przez usta ze świstem "Ahhhh".',
                        duration: '3 min'
                    },
                    {
                        step: 5,
                        title: 'Harmonizacja',
                        description: 'Powrót do naturalnego rytmu oddechu. Poczuj jak energia krąży swobodnie po ciele.',
                        duration: '3 min'
                    }
                ],
                totalDuration: '15 minut'
            }
        };

        function showWellnessPractice(practiceType) {
            // Sprawdź czy DOM jest gotowy
            if (document.readyState !== 'complete') {
                setTimeout(() => showWellnessPractice(practiceType), 100);
                return;
            }
            
            currentPractice = practiceType;
            const practice = practiceData[practiceType];
            
            if (!practice) {
                showNotification('❌ Błąd: Nie znaleziono danych praktyki');
                return;
            }
            
            // Poczekaj chwilę przed szukaniem elementów (fix dla timing issues)
            setTimeout(() => {
                const modal = document.getElementById('wellnessPracticeModal');
                const title = document.getElementById('practiceTitle');
                const icon = document.getElementById('practiceIcon');
                const content = document.getElementById('practiceContent');
                
                if (!modal) {
                    showNotification('❌ Błąd: Modal nie został znaleziony');
                    return;
                }
                
                if (!title || !icon || !content) {
                    // Fallback: spróbuj znaleźć elementy bezpośrednio w modalu
                    const titleInModal = modal.querySelector('#practiceTitle') || modal.querySelector('h3');
                    const iconInModal = modal.querySelector('#practiceIcon') || modal.querySelector('i');
                    const contentInModal = modal.querySelector('#practiceContent') || modal.querySelector('div[id*="Content"]');
                    
                    if (!titleInModal || !iconInModal || !contentInModal) {
                        showNotification('❌ Błąd modalu. Spróbuj odświeżyć stronę (F5)');
                        return;
                    }
                    
                    showWellnessPracticeModal(practice, modal, titleInModal, iconInModal, contentInModal);
                } else {
                    showWellnessPracticeModal(practice, modal, title, icon, content);
                }
            }, 50);
        }
        
        function showWellnessPracticeModal(practice, modal, title, icon, content) {
            
            // Update title and icon
            title.innerHTML = `<i class="${practice.icon}" style="margin-right: 10px; color: #4CAF50;"></i>${practice.title}`;
            if (icon.tagName === 'I') {
                icon.className = practice.icon;
            }
            
            // Generate content
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="color: rgba(255,255,255,0.9); font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                        ${practice.description}
                    </p>
                    
                    <div style="background: rgba(76, 175, 80, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                            ✨ Korzyści:
                        </h4>
                        <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                            ${practice.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: #4CAF50; margin: 0; font-size: 16px;">
                                📋 Instrukcje krok po kroku:
                            </h4>
                            <div style="background: rgba(76, 175, 80, 0.3); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                                ⏱️ ${practice.totalDuration}
                            </div>
                        </div>
                        
                        ${practice.instructions.map((instruction, index) => `
                            <div style="border-left: 3px solid #4CAF50; padding-left: 15px; margin-bottom: 15px; position: relative;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h5 style="color: white; margin: 0; font-size: 14px;">
                                        <span style="background: #4CAF50; color: white; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-size: 12px;">${instruction.step}</span>
                                        ${instruction.title}
                                    </h5>
                                    <span style="background: rgba(255,255,255,0.2); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;">
                                        ${instruction.duration}
                                    </span>
                                </div>
                                <p style="color: rgba(255,255,255,0.8); font-size: 13px; line-height: 1.5; margin: 0;">
                                    ${instruction.description}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 15px;">
                        <div style="color: #FFC107; font-size: 14px; font-weight: 600; margin-bottom: 8px;">
                            💡 Wskazówka:
                        </div>
                        <p style="color: rgba(255,255,255,0.9); font-size: 13px; line-height: 1.5; margin: 0;">
                            Praktykuj regularnie, najlepiej codziennie o tej samej porze. Słuchaj swojego ciała i nie wymuszaj ruchów. Każda praktyka to krok ku lepszemu zdrowiu!
                        </p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Log practice view
            addSystemLog('INFO', 'USER', `Wyświetlono praktykę zdrowotną: ${practice.title}`);
        }

        function closeWellnessPractice() {
            const modal = document.getElementById('wellnessPracticeModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function startPracticeSession() {
            const practice = practiceData[currentPractice];
            
            // Increase health metrics for starting practice
            increaseMetrics(2, 3, 1, `Rozpoczęcie praktyki: ${practice.title}`);
            
            // Add to weekly progress immediately (start tracking)
            const durationMinutes = parseDuration(practice.totalDuration) / (60 * 1000); // Convert to minutes
            addPracticeToWeekly(practice.title, durationMinutes);
            
            // Log practice start
            addSystemLog('SUCCESS', 'USER', `Rozpoczęto sesję praktyki: ${practice.title}`, `Czas trwania: ${practice.totalDuration}`);
            
            showNotification(`🧘 Rozpoczęto praktykę: ${practice.title}! Powodzenia!`);
            closeWellnessPractice();
            
            // Set timer for practice completion
            const duration = parseDuration(practice.totalDuration);
            setTimeout(() => {
                completePracticeSession(practice.title);
            }, duration);
        }

        function completePracticeSession(practiceTitle) {
            // Additional health boost for completing practice
            increaseMetrics(3, 5, 4, `Ukończenie praktyki: ${practiceTitle}`);
            
            // Log practice completion
            addSystemLog('SUCCESS', 'USER', `Ukończono praktykę zdrowotną: ${practiceTitle}`);
            
            showNotification(`✨ Gratulacje! Ukończyłeś praktykę: ${practiceTitle}`);
        }

        function parseDuration(durationStr) {
            // Convert duration string like "15 minut" to milliseconds
            const minutes = parseInt(durationStr.match(/\d+/)[0]);
            return minutes * 60 * 1000; // Convert to milliseconds
        }

        // Element Test Functions
        let currentQuestion = 0;
        let testAnswers = [];
        
        const elementQuestions = [
            {
                question: "Jak czujesz się pod względem temperatury ciała?",
                icon: "fas fa-thermometer-half",
                answers: [
                    { text: "Często jest mi zimno, marzną mi ręce i stopy", element: "Woda", points: 3 },
                    { text: "Czasami jest mi zimno, lubię ciepłe napoje", element: "Metal", points: 2 },
                    { text: "Czuję się komfortowo w większości temperatur", element: "Ziemia", points: 1 },
                    { text: "Często jest mi ciepło, lubię chłodne miejsca", element: "Ogień", points: 2 },
                    { text: "Szybko się rozgrzewam, często mam gorące dłonie", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jak wygląda Twoja energia w ciągu dnia?",
                icon: "fas fa-battery-half",
                answers: [
                    { text: "Rano jestem powolny/a, najlepiej czuję się wieczorem", element: "Woda", points: 3 },
                    { text: "Potrzebuję czasu na rozruch, ale potem jestem wydajny/a", element: "Metal", points: 2 },
                    { text: "Moja energia jest stabilna przez cały dzień", element: "Ziemia", points: 3 },
                    { text: "Jestem bardzo energiczny/a rano i w południe", element: "Ogień", points: 3 },
                    { text: "Mam dużo energii rano, potem szybko się męczę", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak reagujesz na stres?",
                icon: "fas fa-brain",
                answers: [
                    { text: "Wycofuję się, potrzebuję spokoju i samotności", element: "Woda", points: 3 },
                    { text: "Staję się smutny/a i pesymistyczny/a", element: "Metal", points: 3 },
                    { text: "Przejmuję się nadmiernie wszystkim", element: "Ziemia", points: 3 },
                    { text: "Staję się podenerwowany/a i mówię za dużo", element: "Ogień", points: 3 },
                    { text: "Denerwuję się i mogę wybuchnąć gniewem", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jakie masz preferencje żywieniowe?",
                icon: "fas fa-utensils",
                answers: [
                    { text: "Lubię ciepłe, gotowane potrawy i zupy", element: "Woda", points: 2 },
                    { text: "Preferuję proste, lekko pikantne jedzenie", element: "Metal", points: 2 },
                    { text: "Lubię słodkie smaki i regularne posiłki", element: "Ziemia", points: 3 },
                    { text: "Uwielbiam różnorodność smaków, często pomijam posiłki", element: "Ogień", points: 2 },
                    { text: "Lubię kwaśne smaki i świeże produkty", element: "Drewno", points: 3 }
                ]
            },
            {
                question: "Jaki jest Twój sen?",
                icon: "fas fa-bed",
                answers: [
                    { text: "Śpię dużo, ale często jestem zmęczony/a", element: "Woda", points: 3 },
                    { text: "Budzę się wcześnie rano, ale czasami mam problemy z zasypianiem", element: "Metal", points: 2 },
                    { text: "Śpię regularnie 7-8 godzin, rzadko mam problemy", element: "Ziemia", points: 3 },
                    { text: "Śpię mało, ale czuję się wypoczęty/a", element: "Ogień", points: 2 },
                    { text: "Sen bywa niespokojny, często się budzę", element: "Drewno", points: 2 }
                ]
            },
            {
                question: "Jak wyglądają Twoje emocje?",
                icon: "fas fa-heart",
                answers: [
                    { text: "Jestem spokojny/a, ale czasami odczuwam lęk", element: "Woda", points: 3 },
                    { text: "Potrafię być melancholijny/a, czasami smutny/a", element: "Metal", points: 3 },
                    { text: "Jestem zrównoważony/a, ale czasami się martwię", element: "Ziemia", points: 3 },
                    { text: "Jestem radosny/a i towarzyski/a, ale czasami nadpobudliwy/a", element: "Ogień", points: 3 },
                    { text: "Jestem energiczny/a, ale czasami wybuchowy/a", element: "Drewno", points: 3 }
                ]
            }
        ];

        function startElementTest() {
            currentQuestion = 0;
            testAnswers = [];
            
            const modal = document.getElementById('elementTestModal');
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            showQuestion();
            
            // Log test start
            addSystemLog('INFO', 'USER', 'Rozpoczęto test żywiołu TCM');
        }

        function closeElementTest() {
            const modal = document.getElementById('elementTestModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function showQuestion() {
            const testContent = document.getElementById('testContent');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const testResult = document.getElementById('testResult');
            
            testResult.style.display = 'none';
            testContent.style.display = 'block';
            
            if (currentQuestion < elementQuestions.length) {
                const question = elementQuestions[currentQuestion];
                
                testContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="background: rgba(76, 175, 80, 0.2); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            <i class="${question.icon}" style="font-size: 24px; color: #4CAF50;"></i>
                        </div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 14px; margin-bottom: 5px;">
                            Pytanie ${currentQuestion + 1} z ${elementQuestions.length}
                        </div>
                        <h4 style="color: white; margin: 0; font-size: 18px; line-height: 1.4;">
                            ${question.question}
                        </h4>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        ${question.answers.map((answer, index) => `
                            <label style="
                                display: flex;
                                align-items: center;
                                padding: 15px;
                                border: 1px solid rgba(255,255,255,0.3);
                                border-radius: 12px;
                                background: rgba(255,255,255,0.05);
                                cursor: pointer;
                                transition: all 0.3s ease;
                                position: relative;
                            " onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                <input type="radio" name="answer" value="${index}" style="margin-right: 12px; transform: scale(1.2);">
                                <span style="color: white; font-size: 14px; line-height: 1.4; flex: 1;">${answer.text}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                
                // Show/hide navigation buttons
                prevBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
                nextBtn.textContent = currentQuestion === elementQuestions.length - 1 ? 'Pokaż wyniki' : 'Następne';
                nextBtn.innerHTML = currentQuestion === elementQuestions.length - 1 ? 
                    '<i class="fas fa-trophy" style="margin-right: 8px;"></i>Pokaż wyniki' :
                    'Następne<i class="fas fa-arrow-right" style="margin-left: 8px;"></i>';
                
            } else {
                showTestResults();
            }
        }

        function nextQuestion() {
            const selectedAnswer = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedAnswer) {
                showNotification('❌ Proszę wybrać odpowiedź!');
                return;
            }
            
            const answerIndex = parseInt(selectedAnswer.value);
            const answer = elementQuestions[currentQuestion].answers[answerIndex];
            
            testAnswers.push({
                question: currentQuestion,
                answer: answer
            });
            
            currentQuestion++;
            
            if (currentQuestion < elementQuestions.length) {
                showQuestion();
            } else {
                showTestResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                testAnswers.pop(); // Remove last answer
                showQuestion();
            }
        }

        function showTestResults() {
            const testContent = document.getElementById('testContent');
            const testResult = document.getElementById('testResult');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            
            testContent.style.display = 'none';
            testResult.style.display = 'block';
            nextBtn.style.display = 'none';
            prevBtn.style.display = 'none';
            
            // Calculate element scores
            const scores = {
                'Drewno': 0,
                'Ogień': 0,
                'Ziemia': 0,
                'Metal': 0,
                'Woda': 0
            };
            
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            
            // Find dominant element
            const dominantElement = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            const elementData = getElementDetails(dominantElement);
            
            testResult.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <div style="background: ${elementData.gradient}; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                        <div style="font-size: 32px;">${elementData.icon}</div>
                    </div>
                    <h3 style="color: white; margin: 0 0 10px 0; font-size: 24px;">
                        Twój dominujący żywioł: ${dominantElement}
                    </h3>
                    <p style="color: rgba(255,255,255,0.8); font-size: 16px; margin: 0;">
                        ${elementData.description}
                    </p>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        🎯 Zalecenia dla Ciebie:
                    </h4>
                    <ul style="color: rgba(255,255,255,0.9); line-height: 1.6; padding-left: 20px; margin: 0;">
                        ${elementData.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 16px;">
                        📊 Twoje wyniki:
                    </h4>
                    ${Object.entries(scores).map(([element, score]) => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: rgba(255,255,255,0.9);">${element}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 100px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${(score / Math.max(...Object.values(scores))) * 100}%; height: 100%; background: ${element === dominantElement ? '#4CAF50' : 'rgba(255,255,255,0.4)'}; transition: width 0.3s ease;"></div>
                                </div>
                                <span style="color: white; font-weight: 600; min-width: 20px;">${score}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button onclick="restartTest()" style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                        <i class="fas fa-redo" style="margin-right: 8px;"></i>
                        Powtórz test
                    </button>
                    <button onclick="saveTestResults('${dominantElement}')" style="flex: 1; padding: 12px; border-radius: 12px; border: none; background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <i class="fas fa-save" style="margin-right: 8px;"></i>
                        Zapisz wyniki
                    </button>
                </div>
            `;
            
            // Log test completion
            addSystemLog('SUCCESS', 'USER', 'Ukończono test żywiołu TCM', `Dominujący żywioł: ${dominantElement}`);
        }

        function getElementDetails(element) {
            const details = {
                'Drewno': {
                    icon: '🌱',
                    gradient: 'linear-gradient(135deg, #4CAF50, #66BB6A)',
                    description: 'Jesteś pełen/a energii i ambicji. Twoja konstytucja jest elastyczna i dynamiczna jak młode drzewo.',
                    recommendations: [
                        '🌿 Jedz zielone warzywa liściaste i kiełki',
                        '🧘 Praktykuj ćwiczenia rozciągające i joga',
                        '😌 Zarządzaj stresem i gniewem przez medytację',
                        '🌅 Wstawaj wcześnie rano (5:00-7:00)',
                        '🍋 Dodaj kwaśne smaki do diety (cytryna, ocet)'
                    ]
                },
                'Ogień': {
                    icon: '🔥',
                    gradient: 'linear-gradient(135deg, #F44336, #FF5722)',
                    description: 'Jesteś radosny/a i towarzyski/a. Twoja energia emanuje ciepłem i komunikatywnością.',
                    recommendations: [
                        '🍉 Jedz chłodzące owoce (arbuz, melon)',
                        '🏊 Unikaj nadmiernego wysiłku w upał',
                        '🧘 Praktykuj uspokajającą medytację',
                        '☀️ Najlepszy czas aktywności: 11:00-13:00',
                        '🍃 Pij zielone i białe herbaty'
                    ]
                },
                'Ziemia': {
                    icon: '🌾',
                    gradient: 'linear-gradient(135deg, #FFC107, #FF9800)',
                    description: 'Jesteś stabilny/a i zrównoważony/a. Twoja konstytucja jest fundamentem dla innych.',
                    recommendations: [
                        '🥕 Jedz słodkie warzywa (marchew, dynia)',
                        '🍚 Włącz ziarna zbóż do diety',
                        '⚖️ Jedz regularne posiłki o stałych porach',
                        '🧘 Praktykuj medytację siedzącą',
                        '🍯 Umiarkowanie w słodkich smakach'
                    ]
                },
                'Metal': {
                    icon: '🍂',
                    gradient: 'linear-gradient(135deg, #9E9E9E, #607D8B)',
                    description: 'Jesteś precyzyjny/a i refleksyjny/a. Twoja konstytucja ceni porządek i strukturę.',
                    recommendations: [
                        '🍐 Jedz białe produkty (gruszki, rzodkiew)',
                        '🫁 Praktykuj ćwiczenia oddechowe',
                        '🌅 Najlepszy czas aktywności: 5:00-7:00 rano',
                        '🌶️ Dodaj łagodnie ostre smaki',
                        '💧 Unikaj suchości - nawilżaj powietrze'
                    ]
                },
                'Woda': {
                    icon: '❄️',
                    gradient: 'linear-gradient(135deg, #2196F3, #03A9F4)',
                    description: 'Jesteś spokojny/a i mądry/a. Twoja konstytucja jest głęboka jak spokojne wody.',
                    recommendations: [
                        '🥲 Jedz ciepłe, gotowane potrawy',
                        '☕ Pij ciepłe napoje i herbaty',
                        '🛏️ Dbaj o odpowiedni sen (8-9 godzin)',
                        '🌙 Najlepszy czas aktywności: wieczorem',
                        '🧂 Dodaj słone smaki w umiarkowanych ilościach'
                    ]
                }
            };
            
            return details[element];
        }

        function restartTest() {
            startElementTest();
        }

        function saveTestResults(dominantElement) {
            const testResult = {
                date: new Date().toISOString(),
                dominantElement: dominantElement,
                allScores: {},
                answers: testAnswers
            };
            
            // Calculate scores for saving
            const scores = { 'Drewno': 0, 'Ogień': 0, 'Ziemia': 0, 'Metal': 0, 'Woda': 0 };
            testAnswers.forEach(answer => {
                scores[answer.answer.element] += answer.answer.points;
            });
            testResult.allScores = scores;
            
            // Save to localStorage
            const savedResults = JSON.parse(localStorage.getItem('elementTestResults') || '[]');
            savedResults.unshift(testResult);
            localStorage.setItem('elementTestResults', JSON.stringify(savedResults.slice(0, 10))); // Keep last 10 results
            
            // Save current dominant element
            localStorage.setItem('userDominantElement', dominantElement);
            
            // Log the save
            addSystemLog('SUCCESS', 'USER', 'Zapisano wyniki testu żywiołu', `Żywioł: ${dominantElement}`);
            
            // Increase health metrics for completing the test
            increaseMetrics(3, 5, 2, 'Ukończenie testu żywiołu TCM');
            
            showNotification('✅ Wyniki testu zostały zapisane!');
            closeElementTest();
        }

        // Profile Edit Functions
        let currentEditingProfile = 'user'; // 'user' or 'admin'

        function editUserProfile() {
            currentEditingProfile = 'user';
            openProfileEditModal();
        }

        function editAdminProfile() {
            currentEditingProfile = 'admin';
            openProfileEditModal();
        }

        function openProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            // Load current values
            if (currentEditingProfile === 'user') {
                nameInput.value = localStorage.getItem('userName') || 'Eksplorator Zdrowia';
                emailInput.value = localStorage.getItem('userEmail') || '';
            } else {
                nameInput.value = localStorage.getItem('adminName') || 'Administrator';
                emailInput.value = localStorage.getItem('adminEmail') || '';
            }
            
            passwordInput.value = '';
            
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            
            // Focus on first input
            setTimeout(() => nameInput.focus(), 100);
        }

        function closeProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function saveProfileChanges() {
            const nameInput = document.getElementById('editDisplayName');
            const emailInput = document.getElementById('editEmail');
            const passwordInput = document.getElementById('editPassword');

            const newName = nameInput.value.trim();
            const newEmail = emailInput.value.trim();
            const newPassword = passwordInput.value.trim();

            // Validate inputs
            if (!newName) {
                showNotification('❌ Nazwa użytkownika nie może być pusta!');
                return;
            }

            if (newEmail && !isValidEmail(newEmail)) {
                showNotification('❌ Wprowadź poprawny adres email!');
                return;
            }

            // Save changes based on profile type
            if (currentEditingProfile === 'user') {
                // Update user profile
                localStorage.setItem('userName', newName);
                if (newEmail) localStorage.setItem('userEmail', newEmail);
                if (newPassword) localStorage.setItem('userPassword', newPassword);

                // Update UI immediately
                document.getElementById('user-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'USER', 'Profil użytkownika został zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('✅ Profil użytkownika został zaktualizowany!');
            } else {
                // Update admin profile
                localStorage.setItem('adminName', newName);
                if (newEmail) localStorage.setItem('adminEmail', newEmail);
                if (newPassword) localStorage.setItem('adminPassword', newPassword);

                // Update UI immediately
                document.getElementById('admin-display-name').textContent = newName;
                
                // Log the change
                addSystemLog('INFO', 'SYSTEM', 'Profil administratora został zaktualizowany', `Nowa nazwa: ${newName}`);
                
                showNotification('✅ Profil administratora został zaktualizowany!');
            }

            closeProfileEditModal();
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Profile Picture Functions
        function changeProfilePicture(profileType) {
            currentEditingProfile = profileType;
            const fileInput = document.getElementById('profilePictureInput');
            
            // Reset the input to ensure onChange fires even if same file is selected
            fileInput.value = '';
            fileInput.click();
        }

        // Initialize profile picture upload handler
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('profilePictureInput');
            
            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showNotification('❌ Proszę wybrać plik obrazu!');
                        return;
                    }
                    
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('❌ Plik jest za duży! Maksymalny rozmiar to 5MB.');
                        return;
                    }
                    
                    // Read file as base64
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = e.target.result;
                        
                        // Save and update profile picture
                        if (currentEditingProfile === 'user') {
                            localStorage.setItem('userProfilePicture', imageData);
                            updateProfilePictureDisplay('user-profile-picture', imageData);
                            addSystemLog('INFO', 'USER', 'Zdjęcie profilowe użytkownika zostało zmienione');
                            showNotification('✅ Zdjęcie profilowe zostało zaktualizowane!');
                        } else {
                            localStorage.setItem('adminProfilePicture', imageData);
                            updateProfilePictureDisplay('admin-profile-picture', imageData);
                            addSystemLog('INFO', 'SYSTEM', 'Zdjęcie profilowe administratora zostało zmienione');
                            showNotification('✅ Zdjęcie profilowe administratora zostało zaktualizowane!');
                        }
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
        });

        function updateProfilePictureDisplay(elementId, imageData) {
            const profilePictureElement = document.getElementById(elementId);
            if (profilePictureElement && imageData) {
                profilePictureElement.style.backgroundImage = `url(${imageData})`;
                profilePictureElement.style.backgroundSize = 'cover';
                profilePictureElement.style.backgroundPosition = 'center';
                profilePictureElement.innerHTML = ''; // Remove emoji/icon
            }
        }

        // Load saved profile pictures on page load
        function loadSavedProfilePictures() {
            const userPicture = localStorage.getItem('userProfilePicture');
            const adminPicture = localStorage.getItem('adminProfilePicture');
            
            if (userPicture) {
                updateProfilePictureDisplay('user-profile-picture', userPicture);
            }
            
            if (adminPicture) {
                updateProfilePictureDisplay('admin-profile-picture', adminPicture);
            }
            
            // Load saved names
            const userName = localStorage.getItem('userName');
            const adminName = localStorage.getItem('adminName');
            
            if (userName && document.getElementById('user-display-name')) {
                document.getElementById('user-display-name').textContent = userName;
            }
            
            if (adminName && document.getElementById('admin-display-name')) {
                document.getElementById('admin-display-name').textContent = adminName;
            }
        }

        function logout() {
            if (confirm('Czy na pewno chcesz się wylogować?')) {
                const userName = localStorage.getItem('userName');
                const userEmail = localStorage.getItem('userEmail');
                
                addSystemLog('INFO', 'AUTH', 'Użytkownik się wylogował', `Użytkownik: ${userName}, Email: ${userEmail}`);
                
                const mainApp = document.getElementById('mainApp');
                mainApp.classList.add('logout-animation');
                
                setTimeout(() => {
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('userEmail');
                    
                    showLoginScreen();
                    showNotification('Zostałeś wylogowany');
                }, 500);
            }
        }

        function showMainApp() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            mainApp.classList.remove('logout-animation');
            mainApp.classList.add('login-animation');
        }

        function showLoginScreen() {
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            
            mainApp.style.display = 'none';
            loginScreen.style.display = 'block';
            loginScreen.classList.add('login-animation');
        }

        function showRegister() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            registerForm.classList.add('login-animation');
        }

        function showLogin() {
            const loginForm = document.getElementById('loginForm').parentElement.parentElement;
            const registerForm = document.getElementById('registerForm');
            
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            loginForm.classList.add('login-animation');
        }

        function updateUserName(name) {
            const userNameElement = document.getElementById('user-display-name');
            if (userNameElement) {
                userNameElement.textContent = name;
            }
            
            // Also update localStorage
            localStorage.setItem('userName', name);
        }

        // Admin Functions
        function showAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'block';
            });
        }

        function hideAdminFeatures() {
            const adminTabs = document.querySelectorAll('.admin-tab, .admin-nav');
            adminTabs.forEach(tab => {
                tab.style.display = 'none';
            });
        }

        // Backup functionality
        function performBackup() {
            // Check if in offline mode
            if (offlineMode && !isOnline) {
                performOfflineBackup();
                return;
            }
            
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Create downloadable backup file
            const backupJson = JSON.stringify(backupData, null, 2);
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Backup_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Update last backup time in localStorage
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('SUCCESS', 'BACKUP', 'Backup został utworzony i pobrany', `Rozmiar backup: ${Math.round(backupJson.length / 1024)} KB`);
            
            // Show success notification
            showNotification('💾 Backup został utworzony i pobrany pomyślnie!');
            
            // Increase health metrics for responsible data management
            increaseMetrics(1, 2, 0, 'Odpowiedzialne zarządzanie danymi');
            
            // Update backup time display if settings modal is open
            updateBackupDisplay();
        }

        function updateBackupDisplay() {
            const lastBackup = localStorage.getItem('lastBackupTime');
            if (lastBackup) {
                const backupTime = new Date(lastBackup);
                const now = new Date();
                const diffMinutes = Math.floor((now - backupTime) / (1000 * 60));
                
                let timeAgo = '';
                if (diffMinutes < 1) {
                    timeAgo = 'teraz';
                } else if (diffMinutes < 60) {
                    timeAgo = `${diffMinutes} min. temu`;
                } else if (diffMinutes < 1440) {
                    const hours = Math.floor(diffMinutes / 60);
                    timeAgo = `${hours} godz. temu`;
                } else {
                    const days = Math.floor(diffMinutes / 1440);
                    timeAgo = `${days} dni temu`;
                }

                // Update backup display in settings modal if exists
                const backupDisplay = document.querySelector('[data-backup-time]');
                if (backupDisplay) {
                    backupDisplay.textContent = `🔄 Ostatni backup: ${timeAgo}`;
                }
            }
        }

        // Restore functionality
        function showRestoreModal() {
            const restoreModal = document.createElement('div');
            restoreModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            restoreModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <h3 style="color: white; margin-bottom: 20px;">📁 Przywróć Backup</h3>
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
                        <p>Wybierz plik backup do przywrócenia:</p>
                    </div>
                    <input type="file" id="backupFileInput" accept=".json" style="
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.3);
                        border-radius: 8px;
                        padding: 10px;
                        color: white;
                        width: 100%;
                        margin-bottom: 20px;
                    ">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="performRestore()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Przywróć</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(restoreModal);
            window.currentModal = restoreModal;
        }

        function performRestore() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('❌ Wybierz plik backup do przywrócenia!');
                return;
            }

            if (!file.name.endsWith('.json')) {
                showNotification('❌ Nieprawidłowy format pliku! Wybierz plik .json');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup structure
                    if (!backupData.data || !backupData.timestamp) {
                        throw new Error('Nieprawidłowa struktura pliku backup');
                    }

                    // Restore user profile data
                    if (backupData.data.userProfile) {
                        const profile = backupData.data.userProfile;
                        if (profile.userRole) localStorage.setItem('userRole', profile.userRole);
                        if (profile.preferences) localStorage.setItem('userPreferences', profile.preferences);
                        if (profile.settings) localStorage.setItem('appSettings', profile.settings);
                    }

                    // Restore session data
                    if (backupData.data.sessionData) {
                        const session = backupData.data.sessionData;
                        if (session.lastVisit) localStorage.setItem('lastVisit', session.lastVisit);
                        if (session.sessionCount) localStorage.setItem('sessionCount', session.sessionCount);
                        if (session.totalUsageTime) localStorage.setItem('totalUsageTime', session.totalUsageTime);
                    }

                    // Restore app data
                    if (backupData.data.appData) {
                        const appData = backupData.data.appData;
                        if (appData.favoriteRecipes) localStorage.setItem('favoriteRecipes', appData.favoriteRecipes);
                        if (appData.healthMetrics) localStorage.setItem('healthMetrics', appData.healthMetrics);
                        if (appData.reminders) localStorage.setItem('reminders', appData.reminders);
                        if (appData.notes) localStorage.setItem('userNotes', appData.notes);
                    }

                    // Restore wellness data
                    if (backupData.data.wellness) {
                        const wellness = backupData.data.wellness;
                        if (wellness.currentSeason) localStorage.setItem('currentSeason', wellness.currentSeason);
                        if (wellness.seasonProgress) localStorage.setItem('seasonProgress', wellness.seasonProgress);
                        if (wellness.dailyTips) localStorage.setItem('dailyTips', wellness.dailyTips);
                    }

                    // Set restore timestamp
                    localStorage.setItem('lastRestoreTime', new Date().toISOString());
                    localStorage.setItem('restoredFromBackup', backupData.timestamp);

                    // Add to system logs
                    addSystemLog('SUCCESS', 'BACKUP', 'Backup został przywrócony pomyślnie', `Przywrócono dane z: ${backupData.timestamp}`);

                    closeModal();
                    showNotification('✅ Backup został przywrócony pomyślnie!');
                    
                    // Refresh page to apply restored data
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);

                } catch (error) {
                    addSystemLog('ERROR', 'BACKUP', 'Błąd podczas przywracania backup', error.message);
                    showNotification('❌ Błąd podczas przywracania backup: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }

        // System Logs functionality
        function initializeLogging() {
            // Initialize logging if not already done
            if (!localStorage.getItem('systemLogs')) {
                const initialLogs = [
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        level: 'INFO',
                        category: 'SYSTEM',
                        message: 'Aplikacja SezonoweDobro została uruchomiona',
                        details: 'Inicjalizacja systemu zakończona pomyślnie'
                    }
                ];
                localStorage.setItem('systemLogs', JSON.stringify(initialLogs));
            }
        }

        function addSystemLog(level, category, message, details = '') {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const newLog = {
                id: logs.length + 1,
                timestamp: new Date().toISOString(),
                level: level.toUpperCase(),
                category: category.toUpperCase(),
                message: message,
                details: details
            };
            
            logs.unshift(newLog); // Add to beginning
            
            // Keep only last 100 logs
            if (logs.length > 100) {
                logs.splice(100);
            }
            
            localStorage.setItem('systemLogs', JSON.stringify(logs));
        }

        function showSystemLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            const logsModal = document.createElement('div');
            logsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            logsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 800px;
                    width: 100%;
                    max-height: 80vh;
                    backdrop-filter: blur(20px);
                    display: flex;
                    flex-direction: column;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: white; margin: 0;">📄 Logi Systemowe</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="logLevelFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie poziomy</option>
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                                <option value="SUCCESS">SUCCESS</option>
                            </select>
                            <select id="logCategoryFilter" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.3);
                                border-radius: 8px;
                                padding: 8px;
                                color: white;
                                font-size: 12px;
                            " onchange="filterLogs()">
                                <option value="">Wszystkie kategorie</option>
                                <option value="SYSTEM">SYSTEM</option>
                                <option value="USER">USER</option>
                                <option value="BACKUP">BACKUP</option>
                                <option value="AUTH">AUTH</option>
                                <option value="API">API</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="logsContainer" style="
                        flex: 1;
                        overflow-y: auto;
                        background: rgba(0, 0, 0, 0.3);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 20px;
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    ">
                        ${generateLogsHTML(logs)}
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportLogs()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">📁 Eksportuj</button>
                        <button onclick="clearLogs()" style="
                            background: linear-gradient(135deg, #f44336, #ff5722);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">🗑️ Wyczyść</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 14px;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(logsModal);
            window.currentModal = logsModal;
            
            // Add event listener for clicking outside
            logsModal.onclick = (e) => {
                if (e.target === logsModal) closeModal();
            };
        }

        function generateLogsHTML(logs) {
            if (logs.length === 0) {
                return '<div style="color: rgba(255,255,255,0.7); text-align: center; padding: 20px;">Brak logów do wyświetlenia</div>';
            }
            
            return logs.map(log => {
                const levelColor = getLevelColor(log.level);
                const formattedTime = new Date(log.timestamp).toLocaleString('pl-PL');
                
                return `
                    <div style="
                        background: rgba(255, 255, 255, 0.05);
                        border-left: 4px solid ${levelColor};
                        margin-bottom: 10px;
                        padding: 12px;
                        border-radius: 8px;
                        border: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="
                                    background: ${levelColor};
                                    color: white;
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                    font-weight: 600;
                                ">${log.level}</span>
                                <span style="
                                    background: rgba(255, 255, 255, 0.1);
                                    color: rgba(255, 255, 255, 0.8);
                                    padding: 2px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                ">${log.category}</span>
                            </div>
                            <span style="color: rgba(255, 255, 255, 0.6); font-size: 12px;">${formattedTime}</span>
                        </div>
                        <div style="color: white; font-weight: 500; margin-bottom: 5px;">${log.message}</div>
                        ${log.details ? `<div style="color: rgba(255, 255, 255, 0.7); font-size: 13px;">${log.details}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function getLevelColor(level) {
            const colors = {
                'INFO': '#2196F3',
                'SUCCESS': '#4CAF50',
                'WARNING': '#FF9800',
                'ERROR': '#f44336'
            };
            return colors[level] || '#607D8B';
        }

        function filterLogs() {
            const levelFilter = document.getElementById('logLevelFilter').value;
            const categoryFilter = document.getElementById('logCategoryFilter').value;
            const allLogs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            
            let filteredLogs = allLogs;
            
            if (levelFilter) {
                filteredLogs = filteredLogs.filter(log => log.level === levelFilter);
            }
            
            if (categoryFilter) {
                filteredLogs = filteredLogs.filter(log => log.category === categoryFilter);
            }
            
            const container = document.getElementById('logsContainer');
            if (container) {
                container.innerHTML = generateLogsHTML(filteredLogs);
            }
        }

        function exportLogs() {
            const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
            const exportData = {
                exported: new Date().toISOString(),
                version: "1.0.0",
                totalLogs: logs.length,
                logs: logs
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            const currentDate = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `SezonoweDobro_Logi_${currentDate}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addSystemLog('INFO', 'SYSTEM', 'Logi zostały wyeksportowane', `Wyeksportowano ${logs.length} wpisów`);
            showNotification('📁 Logi zostały wyeksportowane pomyślnie!');
        }

        function clearLogs() {
            if (confirm('Czy na pewno chcesz wyczyścić wszystkie logi? Ta operacja jest nieodwracalna.')) {
                localStorage.removeItem('systemLogs');
                addSystemLog('WARNING', 'SYSTEM', 'Logi systemowe zostały wyczyszczone', 'Wszystkie poprzednie logi zostały usunięte');
                
                const container = document.getElementById('logsContainer');
                if (container) {
                    const logs = JSON.parse(localStorage.getItem('systemLogs') || '[]');
                    container.innerHTML = generateLogsHTML(logs);
                }
                
                showNotification('🗑️ Logi zostały wyczyszczone');
            }
        }

        // Offline Mode functionality
        let isOnline = navigator.onLine;
        let offlineMode = false;

        function initializeOfflineMode() {
            // Check if offline mode is enabled from previous session
            offlineMode = localStorage.getItem('offlineMode') === 'true';
            updateOfflineStatus();
            
            // Listen for network status changes
            window.addEventListener('online', () => {
                isOnline = true;
                updateNetworkStatus();
                if (!offlineMode) {
                    syncOfflineData();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateNetworkStatus();
                if (!offlineMode) {
                    showNotification('⚠️ Brak połączenia internetowego. Przełączanie na tryb offline...');
                    setTimeout(() => enableOfflineMode(true), 2000);
                }
            });
            
            // Initial network status check
            updateNetworkStatus();
        }

        function toggleOfflineMode() {
            if (offlineMode) {
                disableOfflineMode();
            } else {
                enableOfflineMode();
            }
        }

        function enableOfflineMode(automatic = false) {
            offlineMode = true;
            localStorage.setItem('offlineMode', 'true');
            
            if (!automatic) {
                addSystemLog('INFO', 'SYSTEM', 'Tryb offline został włączony ręcznie', 'Użytkownik przełączył aplikację w tryb offline');
            } else {
                addSystemLog('WARNING', 'SYSTEM', 'Tryb offline został włączony automatycznie', 'Brak połączenia internetowego');
            }
            
            updateOfflineStatus();
            showOfflineModal();
            
            // Cache essential data
            cacheOfflineData();
        }

        function disableOfflineMode() {
            offlineMode = false;
            localStorage.setItem('offlineMode', 'false');
            
            addSystemLog('INFO', 'SYSTEM', 'Tryb offline został wyłączony', 'Powrót do trybu online');
            updateOfflineStatus();
            
            if (isOnline) {
                syncOfflineData();
                showNotification('🌐 Powrót do trybu online. Synchronizacja danych...');
            } else {
                showNotification('⚠️ Tryb offline wyłączony, ale brak połączenia internetowego');
            }
        }

        function updateOfflineStatus() {
            const offlineIcon = document.getElementById('offline-icon');
            const offlineText = document.getElementById('offline-text');
            const adminOfflineIcon = document.getElementById('admin-offline-icon');
            const adminOfflineText = document.getElementById('admin-offline-text');
            
            if (offlineMode) {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-wifi-slash feature-icon';
                    offlineIcon.style.color = '#f44336';
                }
                if (offlineText) {
                    offlineText.textContent = 'Online';
                    offlineText.style.color = '#f44336';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi feature-icon';
                    adminOfflineIcon.style.color = '#4CAF50';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Online';
                    adminOfflineText.style.color = '#4CAF50';
                }
            } else {
                // Update user profile button
                if (offlineIcon) {
                    offlineIcon.className = 'fas fa-download feature-icon';
                    offlineIcon.style.color = '';
                }
                if (offlineText) {
                    offlineText.textContent = 'Tryb Offline';
                    offlineText.style.color = '';
                }
                
                // Update admin panel button
                if (adminOfflineIcon) {
                    adminOfflineIcon.className = 'fas fa-wifi-slash feature-icon';
                    adminOfflineIcon.style.color = '';
                }
                if (adminOfflineText) {
                    adminOfflineText.textContent = 'Tryb Offline';
                    adminOfflineText.style.color = '';
                }
            }
        }

        function updateNetworkStatus() {
            // Add network status indicator to header
            let networkIndicator = document.getElementById('network-status');
            if (!networkIndicator) {
                networkIndicator = document.createElement('div');
                networkIndicator.id = 'network-status';
                networkIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 20px;
                    padding: 5px 10px;
                    border-radius: 15px;
                    font-size: 12px;
                    font-weight: 600;
                    z-index: 9999;
                    transition: all 0.3s ease;
                `;
                document.body.appendChild(networkIndicator);
            }
            
            if (offlineMode) {
                networkIndicator.style.background = 'rgba(255, 193, 7, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = '📱 Offline';
            } else if (isOnline) {
                networkIndicator.style.background = 'rgba(76, 175, 80, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = '🌐 Online';
            } else {
                networkIndicator.style.background = 'rgba(244, 67, 54, 0.9)';
                networkIndicator.style.color = 'white';
                networkIndicator.innerHTML = '⚠️ Brak sieci';
            }
        }

        function showOfflineModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">📱</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Tryb Offline Aktywny</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Aplikacja działa teraz w trybie offline.</p>
                        <br>
                        <p><strong>Dostępne funkcje:</strong></p>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li>• Przeglądanie przepisów</li>
                            <li>• Kalendarz sezonowy</li>
                            <li>• Notatki osobiste</li>
                            <li>• Zapisane dane</li>
                        </ul>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Dane będą zsynchronizowane po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <button onclick="closeModal()" style="
                        background: linear-gradient(135deg, #4CAF50, #66BB6A);
                        color: white;
                        border: none;
                        border-radius: 12px;
                        padding: 12px 24px;
                        cursor: pointer;
                        font-weight: 600;
                    ">Rozumiem</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            
            // Auto close after 10 seconds
            setTimeout(() => {
                if (window.currentModal === modal) {
                    closeModal();
                }
            }, 10000);
        }

        function cacheOfflineData() {
            const offlineCache = {
                timestamp: new Date().toISOString(),
                userData: {
                    profile: {
                        userName: localStorage.getItem('userName'),
                        userEmail: localStorage.getItem('userEmail'),
                        userRole: localStorage.getItem('userRole')
                    },
                    preferences: localStorage.getItem('userPreferences') || '{}',
                    settings: localStorage.getItem('appSettings') || '{}',
                    favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                    healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                    notes: localStorage.getItem('userNotes') || '[]'
                },
                appState: {
                    currentSeason: localStorage.getItem('currentSeason') || '',
                    seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                    lastVisit: localStorage.getItem('lastVisit') || ''
                }
            };
            
            localStorage.setItem('offlineCache', JSON.stringify(offlineCache));
            addSystemLog('INFO', 'SYSTEM', 'Dane zostały zapisane w cache offline', `Rozmiar cache: ${Math.round(JSON.stringify(offlineCache).length / 1024)} KB`);
        }

        function syncOfflineData() {
            const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
            
            if (offlineChanges.length > 0) {
                showNotification('🔄 Synchronizacja danych offline...');
                
                // Simulate sync process
                setTimeout(() => {
                    // Process offline changes
                    offlineChanges.forEach(change => {
                        addSystemLog('INFO', 'SYSTEM', 'Zsynchronizowano zmiany offline', `Typ: ${change.type}, Czas: ${change.timestamp}`);
                    });
                    
                    // Clear offline changes
                    localStorage.removeItem('offlineChanges');
                    
                    showNotification('✅ Synchronizacja zakończona pomyślnie!');
                    addSystemLog('SUCCESS', 'SYSTEM', 'Synchronizacja danych offline zakończona', `Zsynchronizowano ${offlineChanges.length} zmian`);
                }, 2000);
            }
        }

        function performOfflineBackup() {
            const offlineBackupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "offline",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        userName: localStorage.getItem('userName') || '',
                        userEmail: localStorage.getItem('userEmail') || '',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    },
                    systemData: {
                        logs: localStorage.getItem('systemLogs') || '[]',
                        offlineChanges: localStorage.getItem('offlineChanges') || '[]'
                    }
                }
            };

            // Store offline backup
            localStorage.setItem('offlineBackup', JSON.stringify(offlineBackupData));
            localStorage.setItem('lastOfflineBackup', new Date().toISOString());
            
            // Show offline backup modal
            showOfflineBackupModal(offlineBackupData);
            
            addSystemLog('SUCCESS', 'BACKUP', 'Backup offline został utworzony', `Rozmiar: ${Math.round(JSON.stringify(offlineBackupData).length / 1024)} KB`);
            addOfflineChange('backup', { timestamp: new Date().toISOString(), size: JSON.stringify(offlineBackupData).length });
        }

        function showOfflineBackupModal(backupData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            const backupSize = Math.round(JSON.stringify(backupData).length / 1024);
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">💾</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Backup Offline Utworzony</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Backup został zapisany lokalnie w trybie offline.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>📊 Szczegóły backup:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;">• Rozmiar: ${backupSize} KB</p>
                            <p style="font-size: 13px; margin: 5px 0;">• Typ: Offline</p>
                            <p style="font-size: 13px; margin: 5px 0;">• Czas: ${new Date().toLocaleString('pl-PL')}</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Backup będzie dostępny do pobrania po powrocie do trybu online.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="exportOfflineBackup()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">📁 Zapisz Lokalnie</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }

        function exportOfflineBackup() {
            const offlineBackup = localStorage.getItem('offlineBackup');
            if (offlineBackup) {
                const blob = new Blob([offlineBackup], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                const currentDate = new Date().toISOString().split('T')[0];
                a.href = url;
                a.download = `SezonoweDobro_Offline_Backup_${currentDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('💾 Offline backup został pobrany!');
                addSystemLog('SUCCESS', 'BACKUP', 'Offline backup został wyeksportowany', 'Plik zapisany lokalnie');
                closeModal();
            }
        }

        function addOfflineChange(type, data) {
            if (offlineMode) {
                const offlineChanges = JSON.parse(localStorage.getItem('offlineChanges') || '[]');
                offlineChanges.push({
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    type: type,
                    data: data
                });
                localStorage.setItem('offlineChanges', JSON.stringify(offlineChanges));
            }
        }

        function checkSettingsAccessError() {
            const settingsAccessError = localStorage.getItem('settingsAccessError');
            if (settingsAccessError) {
                showNotification('❌ ' + settingsAccessError);
                addSystemLog('WARNING', 'AUTH', 'Nieuprawiony dostęp do ustawień został zablokowany', settingsAccessError);
                localStorage.removeItem('settingsAccessError');
            }
        }

        function showAdminNotification(feature) {
            showNotification(`🔧 ${feature} - funkcja w rozwoju`);
        }

        function showSystemSettings() {
            // Check if user is admin
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (userRole !== 'admin') {
                showNotification('❌ Dostęp do ustawień tylko dla administratorów!');
                addSystemLog('WARNING', 'AUTH', 'Próba dostępu do ustawień bez uprawnień administratora', `Rola użytkownika: ${userRole}`);
                return;
            }
            
            // Log access to settings
            addSystemLog('INFO', 'SYSTEM', 'Administrator wszedł do ustawień systemu', 'Otwarto panel ustawień');
            
            // Open settings.html in new tab/window
            try {
                const settingsWindow = window.open('settings.html', '_blank', 'width=800,height=900,scrollbars=yes,resizable=yes');
                
                if (settingsWindow) {
                    showNotification('⚙️ Otwieranie panelu ustawień administratora...');
                    
                    // Focus the new window
                    settingsWindow.focus();
                    
                    // Add event listener to detect when settings window is closed
                    const checkClosed = setInterval(() => {
                        if (settingsWindow.closed) {
                            showNotification('✅ Panel ustawień został zamknięty');
                            addSystemLog('INFO', 'SYSTEM', 'Panel ustawień został zamknięty', 'Powrót do głównej aplikacji');
                            clearInterval(checkClosed);
                        }
                    }, 1000);
                } else {
                    // Fallback if popup was blocked
                    showAdminSettingsModal();
                }
            } catch (error) {
                addSystemLog('ERROR', 'SYSTEM', 'Błąd podczas otwierania ustawień', error.message);
                showAdminSettingsModal();
            }
        }

        function showAdminSettingsModal() {
            const settingsModal = document.createElement('div');
            settingsModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            settingsModal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.2);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    backdrop-filter: blur(20px);
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #FF6B35, #F7931E);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 32px;
                        margin: 0 auto 20px;
                    ">⚙️</div>
                    
                    <h3 style="color: white; margin-bottom: 15px;">Panel Ustawień Administratora</h3>
                    
                    <div style="color: rgba(255,255,255,0.9); margin-bottom: 20px; line-height: 1.5;">
                        <p>Panel ustawień otwiera się w nowym oknie.</p>
                        <br>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>📊 Status systemu:</strong></p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="server">• Serwer: Online • 2025</p>
                            <p style="font-size: 13px; margin: 5px 0;">• Użycie dysku: 32%</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-backup-time>• Ostatni backup: brak</p>
                            <p style="font-size: 13px; margin: 5px 0;" data-year="active-users">• Aktywni użytkownicy 2025: 347</p>
                        </div>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.7);">
                            Jeśli okno się nie otworzyło, sprawdź blokadę popup w przeglądarce.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="openSettingsManually()" style="
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">🔗 Otwórz Ustawienia</button>
                        <button onclick="closeModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.3);
                            border-radius: 12px;
                            padding: 12px 24px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Zamknij</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(settingsModal);
            window.currentModal = settingsModal;
            
            // Update backup display immediately
            updateBackupDisplay();
        }

        function openSettingsManually() {
            // Close current modal first
            closeModal();
            
            // Open settings page
            window.location.href = 'settings.html';
        }

        function closeModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }

        // Season Details Modal Functions
        function showSeasonDetails(element) {
            const seasonData = getSeasonData(element);
            const userRole = localStorage.getItem('userRole') || 'user';
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeSeasonModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${seasonData.color};">
                    <button class="close-modal-btn" onclick="closeSeasonModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${seasonData.color};">
                            ${seasonData.icon}
                        </div>
                        <div>
                            <div class="season-modal-title">${seasonData.name}</div>
                            <div class="season-modal-subtitle">${seasonData.period} • Element ${seasonData.element}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Opis Elementu
                        </div>
                        <div class="season-info-content">
                            ${seasonData.description}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-heart"></i>
                            Powiązane Organy
                        </div>
                        <div class="season-info-content">
                            <strong>Główny organ:</strong> ${seasonData.mainOrgan}<br>
                            <strong>Organ pomocniczy:</strong> ${seasonData.secondaryOrgan}
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-utensils"></i>
                            Zalecane Pokarmy
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.foods.map(food => `<li>• ${food}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-dumbbell"></i>
                            Zalecane Ćwiczenia
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.exercises.map(exercise => `<li>• ${exercise}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${seasonData.color};">
                        <div class="season-info-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Czego Unikać
                        </div>
                        <ul class="season-info-list">
                            ${seasonData.avoid.map(item => `<li>• ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="season-info-section" style="border-left-color: ${seasonData.color}; background: rgba(255, 193, 7, 0.1);">
                        <div class="season-info-title">
                            <i class="fas fa-crown"></i>
                            Informacje dla Administratora
                        </div>
                        <div class="season-info-content">
                            <strong>Energia:</strong> ${seasonData.adminInfo.energy}<br>
                            <strong>Kierunek:</strong> ${seasonData.adminInfo.direction}<br>
                            <strong>Pora dnia:</strong> ${seasonData.adminInfo.timeOfDay}<br>
                            <strong>Emocja:</strong> ${seasonData.adminInfo.emotion}<br>
                            <strong>Smak:</strong> ${seasonData.adminInfo.taste}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentSeasonModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeSeasonModal() {
            if (window.currentSeasonModal) {
                window.currentSeasonModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentSeasonModal && document.body.contains(window.currentSeasonModal)) {
                        document.body.removeChild(window.currentSeasonModal);
                    }
                    window.currentSeasonModal = null;
                }, 300);
            }
        }

        function getSeasonData(element) {
            const seasonData = {
                'Drewno': {
                    name: 'Element Drewna',
                    period: 'Wiosna (Marzec - Maj)',
                    element: 'Drewno 🌱',
                    icon: '🌱',
                    color: '#4CAF50',
                    description: 'Element Drewna reprezentuje wzrost, elastyczność i nowe początki. To czas odnowy, oczyszczania organizmu i planowania przyszłości. Energia rośnie w górę jak młode pędy.',
                    mainOrgan: 'Wątroba (Gan)',
                    secondaryOrgan: 'Pęcherzyk żółciowy (Dan)',
                    foods: [
                        'Zielone warzywa liściaste (szpinak, rukola)',
                        'Młode kiełki i pędy',
                        'Cytryna i limonka',
                        'Zielona herbata',
                        'Pokrzywy i mniszek lekarski'
                    ],
                    exercises: [
                        'Tai Chi w parku',
                        'Joga rozciągająca',
                        'Spacery w naturze',
                        'Ćwiczenia elastyczności',
                        'Oddychanie brzuchem'
                    ],
                    avoid: [
                        'Nadmierna złość i frustracja',
                        'Przejadanie się',
                        'Alkohol i używki',
                        'Siedzący tryb życia',
                        'Stres i napięcie'
                    ],
                    adminInfo: {
                        energy: 'Yang rosnące',
                        direction: 'Wschód',
                        timeOfDay: 'Wczesny ranek (5:00-7:00)',
                        emotion: 'Gniew (kontrolowany)',
                        taste: 'Kwaśny'
                    }
                },
                'Ogień': {
                    name: 'Element Ognia',
                    period: 'Lato (Czerwiec - Sierpień)',
                    element: 'Ogień 🔥',
                    icon: '🔥',
                    color: '#F44336',
                    description: 'Element Ognia reprezentuje radość, komunikację i ekspansję. To czas maksymalnej aktywności Yang, ciepła i społecznych interakcji. Energia emanuje na zewnątrz.',
                    mainOrgan: 'Serce (Xin)',
                    secondaryOrgan: 'Jelito cienkie (Xiao Chang)',
                    foods: [
                        'Chłodzące owoce (arbuz, melon)',
                        'Pomidory i ogórki',
                        'Mięta i bazylia',
                        'Zielona herbata i herbaty chłodzące',
                        'Lekkie zupy i gazpacho'
                    ],
                    exercises: [
                        'Qigong o świcie',
                        'Pływanie',
                        'Medytacja w cieniu',
                        'Joga chłodząca (Yin)',
                        'Spacery w chłodniejszych porach'
                    ],
                    avoid: [
                        'Przegrzewanie organizmu',
                        'Intensywny wysiłek w upał',
                        'Pikantne i rozgrzewające potrawy',
                        'Nadmierne emocje',
                        'Długie nasłonecznienie'
                    ],
                    adminInfo: {
                        energy: 'Yang maksymalne',
                        direction: 'Południe',
                        timeOfDay: 'Południe (11:00-13:00)',
                        emotion: 'Radość',
                        taste: 'Gorzki'
                    }
                },
                'Ziemia': {
                    name: 'Element Ziemi',
                    period: 'Późne Lato (Wrzesień)',
                    element: 'Ziemia 🌾',
                    icon: '🌾',
                    color: '#FFC107',
                    description: 'Element Ziemi reprezentuje stabilność, równowagę i odżywianie. To czas zbiorów, refleksji i przygotowania do jesieni. Energia koncentruje się w centrum.',
                    mainOrgan: 'Śledziona (Pi)',
                    secondaryOrgan: 'Żołądek (Wei)',
                    foods: [
                        'Słodkie warzywa (marchew, dynia)',
                        'Ziarna zbóż (proso, ryż)',
                        'Słodkie owoce (daty, morele)',
                        'Korzeń lukrecji',
                        'Żółte i pomarańczowe produkty'
                    ],
                    exercises: [
                        'Medytacja siedząca',
                        'Łagodne spacery po posiłku',
                        'Ćwiczenia równowagi',
                        'Tai Chi w centrum',
                        'Joga stabilizująca'
                    ],
                    avoid: [
                        'Przejadanie się',
                        'Zimne napoje z jedzeniem',
                        'Obsesyjne myślenie',
                        'Nieregularne posiłki',
                        'Nadmierne martwieniu'
                    ],
                    adminInfo: {
                        energy: 'Yin-Yang zrównoważone',
                        direction: 'Centrum',
                        timeOfDay: 'Całodobowo (szczególnie przejścia)',
                        emotion: 'Troska (zrównoważona)',
                        taste: 'Słodki'
                    }
                },
                'Metal': {
                    name: 'Element Metalu',
                    period: 'Jesień (Październik - Grudzień)',
                    element: 'Metal ⚡',
                    icon: '🍂',
                    color: '#9E9E9E',
                    description: 'Element Metalu reprezentuje precyzję, refleksję i wewnętrzną siłę. To czas zbierania doświadczeń, oczyszczania i przygotowania na zimę. Energia się zagęszcza.',
                    mainOrgan: 'Płuca (Fei)',
                    secondaryOrgan: 'Jelito grube (Da Chang)',
                    foods: [
                        'Białe produkty (gruszki, rzodkiew)',
                        'Orzchy i nasiona',
                        'Korzeń lotosu',
                        'Biały ryż i proso',
                        'Herbata biała i oolong'
                    ],
                    exercises: [
                        'Głębokie oddychanie',
                        'Qigong dla płuc',
                        'Powolne spacery',
                        'Joga z naciskiem na oddech',
                        'Medytacja oddechowa'
                    ],
                    avoid: [
                        'Suchość powietrza',
                        'Nadmierny smutek',
                        'Intensywny wysiłek',
                        'Zimne napoje',
                        'Zaniedbywanie higieny'
                    ],
                    adminInfo: {
                        energy: 'Yang malejące',
                        direction: 'Zachód',
                        timeOfDay: 'Wczesny wieczór (17:00-19:00)',
                        emotion: 'Smutek (przemijający)',
                        taste: 'Ostry'
                    }
                },
                'Woda': {
                    name: 'Element Wody',
                    period: 'Zima (Styczeń - Luty)',
                    element: 'Woda ❄️',
                    icon: '❄️',
                    color: '#2196F3',
                    description: 'Element Wody reprezentuje głębię, mądrość i potencjał. To czas maksymalnego Yin, odpoczynku i kultywowania energii wewnętrznej. Energia gromadzi się w głębi.',
                    mainOrgan: 'Nerki (Shen)',
                    secondaryOrgan: 'Pęcherz moczowy (Pang Guang)',
                    foods: [
                        'Ciemne produkty (czarne ziarna, goji)',
                        'Kostne buliony i zupy',
                        'Orzechy włoskie i nasiona',
                        'Ciepłe napoje z imbirem',
                        'Morskie algi i owoce morza'
                    ],
                    exercises: [
                        'Delikatne rozciąganie',
                        'Medytacja głęboka',
                        'Qigong dla nerek',
                        'Joga restoratywna',
                        'Spacery kontemplacyjne'
                    ],
                    avoid: [
                        'Wyczerpanie energii',
                        'Nadmierny lęk',
                        'Zimne otoczenie',
                        'Intensywne ćwiczenia',
                        'Bezsenność'
                    ],
                    adminInfo: {
                        energy: 'Yin maksymalne',
                        direction: 'Północ',
                        timeOfDay: 'Noc (23:00-1:00)',
                        emotion: 'Lęk (kontrolowany)',
                        taste: 'Słony'
                    }
                }
            };
            
            return seasonData[element] || seasonData['Ogień'];
        }

        // Dynamic Recipes Functions
        function updateRecipes() {
            const currentSeason = updateSeason();
            const recipesContainer = document.getElementById('recipesContainer');
            
            if (!recipesContainer) return;
            
            const seasonalRecipes = getSeasonalRecipes(currentSeason.element);
            
            recipesContainer.innerHTML = seasonalRecipes.map((recipe, index) => `
                <div class="recipe-card clickable" onclick="showRecipeDetails('${currentSeason.element}', ${index})">
                    <div class="recipe-image">
                        ${recipe.emoji}
                    </div>
                    <div class="recipe-info">
                        <div class="recipe-title">${recipe.name}</div>
                        <div class="recipe-meta">
                            <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                            <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                            <span><i class="${getElementIcon(currentSeason.element)}"></i> ${currentSeason.element}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getSeasonalRecipes(element) {
            const recipes = {
                'Drewno': [
                    {
                        name: 'Wiosenna Sałatka Detoks',
                        emoji: '🥗',
                        time: '15 min',
                        temperature: 'Chłodząca',
                        ingredients: [
                            '2 szklanki młodych liści szpinaku',
                            '1 szklanka roszponki',
                            '1/2 szklanki kiełków rzodkiewki',
                            '1 ogórek',
                            '2 łyżki nasion słonecznika',
                            '1 cytryna (sok)',
                            '2 łyżki oliwy z oliwek',
                            'Świeża mięta do dekoracji'
                        ],
                        instructions: [
                            'Dokładnie umyj wszystkie zielone warzywa w zimnej wodzie.',
                            'Pokrój ogórek w cienkie plasterki.',
                            'W dużej misce połącz szpinak, roszponkę i kiełki.',
                            'Przygotuj dresing: wymieszaj sok z cytryny z oliwą.',
                            'Polej sałatkę dressingiem i delikatnie wymieszaj.',
                            'Posyp nasionami słonecznika i udekoruj miętą.',
                            'Podawaj natychmiast, najlepiej o poranku.'
                        ],
                                                 benefits: `Ta sałatka oczyszcza wątrobę, dostarcza witaminy C i wspiera naturalne procesy detoksykacji organizmu wiosną ${new Date().getFullYear()}.`,
                        tcmProperties: 'Chłodzi Ciepło Wątroby, wzmacnia Qi śledziony, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Mniszka Lekarskiego',
                        emoji: '🍵',
                        time: '10 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '2 łyżeczki suszonych liści mniszka',
                            '1 szklanka wody',
                            '1 plasterek cytryny',
                            '1 łyżeczka miodu (opcjonalnie)',
                            'Świeże liście mięty'
                        ],
                        instructions: [
                            'Zagotuj wodę w czajniku.',
                            'Włóż suszone liście mniszka do zaparzacza.',
                            'Zalej wrzątkiem i pozostaw pod przykryciem na 7-8 minut.',
                            'Przecedź herbatę przez sitko.',
                            'Dodaj plasterek cytryny i miód według smaku.',
                            'Udekoruj listkami mięty.',
                            'Pij rano na czczo dla najlepszego efektu.'
                        ],
                        benefits: 'Wspiera funkcje wątroby, oczyszcza organizm z toksyn i pobudza trawienie po zimie.',
                        tcmProperties: 'Oczyszcza Ciepło-Wilgoć, wzmacnia Qi wątroby, reguluje przepływ Qi'
                    },
                    {
                        name: 'Zielona Owsianka Energetyzująca',
                        emoji: '🥣',
                        time: '25 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '1 szklanka płatków owsianych',
                            '2 szklanki mleka roślinnego',
                            '1 łyżka proszku z chlorelli',
                            '1 banan',
                            '2 łyżki orzechów włoskich',
                            '1 łyżka miodu',
                            'Nasiona chia (1 łyżka)',
                            'Świeże jagody (do dekoracji)'
                        ],
                        instructions: [
                            'W garnku zagotuj mleko roślinne.',
                            'Dodaj płatki owsiane i gotuj na małym ogniu 15 minut.',
                            'Wmieszaj proszek z chlorelli (nadaje zielony kolor).',
                            'Pokrój banana w plasterki.',
                            'Przełóż owsiankę do miski, udekoruj bananem.',
                            'Posyp orzechami, nasionami chia i jagodami.',
                            'Skrop miodem i podawaj ciepłą.'
                        ],
                        benefits: 'Dostarcza energii na cały dzień, wzmacnia wątrobę i wspiera wzrost nowych komórek.',
                        tcmProperties: 'Odżywia Krew wątroby, wzmacnia Qi śledziony, harmonizuje Shen'
                    }
                ],
                'Ogień': [
                    {
                        name: 'Gazpacho Andaluzyjskie',
                        emoji: '🍅',
                        time: '20 min + chłodzenie',
                        temperature: 'Chłodząca',
                        ingredients: [
                            '6 dużych pomidorów',
                            '1 ogórek',
                            '1 czerwona papryka',
                            '1/2 czerwonej cebuli',
                            '3 ząbki czosnku',
                            '4 łyżki oliwy z oliwek extra virgin',
                            '2 łyżki octu sherry',
                            'Sól morska do smaku',
                            'Świeża bazylia do dekoracji'
                        ],
                        instructions: [
                            'Sparż pomidory, obierz ze skóry i usuń nasiona.',
                            'Obierz ogórek i pokrój w grube kawałki.',
                            'Paprykę oczyść z nasion i pokrój.',
                            'Wszystkie warzywa wrzuć do blendera.',
                            'Dodaj oliwę, ocet i przyprawy.',
                            'Miksuj do uzyskania gładkiej konsystencji.',
                            'Wstaw do lodówki na minimum 2 godziny.',
                            'Podawaj ozdobione bazylią.'
                        ],
                                                 benefits: `Ochładza organizm w upalne letnie dni ${new Date().getFullYear()}, dostarcza licopenu i witamin.`,
                        tcmProperties: 'Oczyszcza Ciepło serca, nawadnia płyny ustrojowe, uspokaja Shen'
                    },
                    {
                        name: 'Smoothie z Arbuza i Mięty',
                        emoji: '🍉',
                        time: '5 min',
                        temperature: 'Chłodząca',
                        ingredients: [
                            '3 szklanki pokrojonego arbuza',
                            '10 listków świeżej mięty',
                            '1 limonka (sok)',
                            '1 łyżka miodu',
                            '1/2 szklanki wody kokosowej',
                            'Lód do podania',
                            'Plastry limonki do dekoracji'
                        ],
                        instructions: [
                            'Usuń pestki z arbuza i pokrój miąższ.',
                            'Do blendera wrzuć arbuz i listki mięty.',
                            'Dodaj sok z limonki i miód.',
                            'Wlej wodę kokosową.',
                            'Miksuj przez 30 sekund do gładkości.',
                            'Przelej do szklanek z lodem.',
                            'Udekoruj plastrem limonki i miętą.'
                        ],
                        benefits: 'Intensywnie nawadnia, chłodzi i wspiera pracę serca w gorące dni.',
                        tcmProperties: 'Chłodzi Ciepło serca, uzupełnia Yin, wzmacnia funkcje nerek'
                    },
                    {
                        name: 'Sałatka Grecka z Bazylią',
                        emoji: '🥒',
                        time: '15 min',
                        temperature: 'Chłodząca',
                        ingredients: [
                            '3 duże pomidory',
                            '2 ogórki',
                            '1 czerwona cebula',
                            '200g sera feta',
                            '1/2 szklanki oliwek Kalamata',
                            '4 łyżki oliwy z oliwek',
                            '2 łyżki octu balsamicznego',
                            'Świeża bazylia',
                            'Oregano suszone'
                        ],
                        instructions: [
                            'Pokrój pomidory w ósemki.',
                            'Ogórki pokrój w półplasterki.',
                            'Cebulę pokrój w cienkie plasterki.',
                            'Fetę pokrusz na większe kawałki.',
                            'Połącz wszystkie warzywa w misce.',
                            'Przygotuj dresing z oliwy i octu.',
                            'Polej sałatkę, wymieszaj delikatnie.',
                            'Posyp świeżą bazylią i oregano.'
                        ],
                        benefits: 'Wspiera zdrowie serca, dostarcza zdrowych tłuszczy i elektrolitów.',
                        tcmProperties: 'Odżywia Yin serca, chłodzi Ciepło, harmonizuje emocje'
                    }
                ],
                'Ziemia': [
                    {
                        name: 'Zupa z Dyni i Marchwi',
                        emoji: '🍲',
                        time: '45 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '500g dyni Hokkaido',
                            '3 duże marchwie',
                            '1 cebula',
                            '2 cm świeżego imbiru',
                            '1 litr bulionu warzywnego',
                            '200ml mleka kokosowego',
                            '2 łyżki oliwy z oliwek',
                            'Nasiona dyni do dekoracji',
                            'Sól i pieprz do smaku'
                        ],
                        instructions: [
                            'Obierz dynię i marchew, pokrój w kostki.',
                            'Cebulę pokrój drobno, imbir zetrzyj.',
                            'Rozgrzej oliwę w garnku, zeszklij cebulę.',
                            'Dodaj imbir, dynię i marchew.',
                            'Zalej bulionem i gotuj 30 minut.',
                            'Zmiksuj na gładko blenderem.',
                            'Dodaj mleko kokosowe, dopraw.',
                            'Podawaj z prażonymi nasionami dyni.'
                        ],
                        benefits: 'Wzmacnia śledzionę, poprawia trawienie i dostarcza beta-karotenu.',
                        tcmProperties: 'Wzmacnia Qi śledziony, odżywia Krew, harmonizuje Środkowy Ogrzewacz'
                    },
                    {
                        name: 'Zapiekanka z Prosa i Słodkich Ziemniaków',
                        emoji: '🍠',
                        time: '60 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '1 szklanka prosa',
                            '2 słodkie ziemniaki',
                            '1 cebula',
                            '2 szklanki bulionu',
                            '100g sera koziego',
                            '2 łyżki masła',
                            'Tymianek świeży',
                            'Sól i pieprz',
                            'Oliwa do smarowania'
                        ],
                        instructions: [
                            'Ugotuj proso w bulionie (20 min).',
                            'Słodkie ziemniaki obierz i pokrój w plasterki.',
                            'Cebulę pokrój w półksiężyce.',
                            'Naczynie żaroodporne posmaruj oliwą.',
                            'Ułóż warstwami: proso, ziemniaki, cebulę.',
                            'Rozkrusz ser kozi na wierzchu.',
                            'Dodaj masło w kawałkach i tymianek.',
                            'Piecz 35 minut w 180°C.'
                        ],
                        benefits: 'Stabilizuje poziom cukru, wzmacnia śledzionę i daje długotrwałą energię.',
                        tcmProperties: 'Tonizuje Qi śledziony, wzmacnia Yang nerek, harmonizuje trawienie'
                    },
                    {
                        name: 'Herbata z Korzeniem Lukrecji',
                        emoji: '🫖',
                        time: '15 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '1 łyżeczka korzenia lukrecji (suszonego)',
                            '1 szklanka wody',
                            '1 plasterek świeżego imbiru',
                            '1 łyżeczka miodu',
                            'Cynamon w proszku (szczypta)',
                            'Plaster pomarańczy'
                        ],
                        instructions: [
                            'Korzeń lukrecji zalej wrzątkiem.',
                            'Dodaj plasterek imbiru.',
                            'Gotuj na małym ogniu 10 minut.',
                            'Przecedź przez sitko.',
                            'Dodaj miód i cynamon.',
                            'Udekoruj plastrem pomarańczy.',
                            'Pij ciepłą, najlepiej po posiłku.'
                        ],
                        benefits: 'Harmonizuje trawienie, łagodzi stres i wzmacnia nadnercza.',
                        tcmProperties: 'Harmonizuje wszystkie formuły, wzmacnia Qi śledziony, odżywia Yin'
                    }
                ],
                'Metal': [
                    {
                        name: 'Zupa Gruszkowa z Orzechami',
                        emoji: '🍐',
                        time: '35 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '4 dojrzałe gruszki',
                            '1/2 szklanki orzechów włoskich',
                            '1 litr bulionu warzywnego',
                            '1 cebula',
                            '2 łyżki masła',
                            '1/4 szklanki śmietany 18%',
                            'Tymianek świeży',
                            'Sól i biały pieprz',
                            'Oliwa do skropienia'
                        ],
                        instructions: [
                            'Gruszki obierz i pokrój w ćwiartki.',
                            'Cebulę pokrój drobno.',
                            'Na maśle zeszklij cebulę.',
                            'Dodaj gruszki i duś 10 minut.',
                            'Zalej bulionem, gotuj 20 minut.',
                            'Zmiksuj z orzechami na gładko.',
                            'Dodaj śmietanę, dopraw.',
                            'Podawaj z tymiankiem i oliwą.'
                        ],
                                                 benefits: `Nawilża płuca, łagodzi kaszel i wzmacnia system oddechowy jesienią ${new Date().getFullYear()}.`,
                        tcmProperties: 'Odżywia Yin płuc, oczyszcza Ciepło, łagodzi suchość'
                    },
                    {
                        name: 'Ryż z Korzeniem Lotosu',
                        emoji: '🍚',
                        time: '40 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '1 szklanka białego ryżu',
                            '100g świeżego korzenia lotosu',
                            '2 szklanki bulionu drobiowego',
                            '2 łyżki oleju sezamowego',
                            '1 łyżka sosu sojowego',
                            'Zielona cebulka',
                            'Nasiona sezamu',
                            'Biały pieprz'
                        ],
                        instructions: [
                            'Korzeń lotosu obierz i pokrój w plasterki.',
                            'Ryż przepłucz do czystej wody.',
                            'W garnku rozgrzej olej sezamowy.',
                            'Podsmaż korzeń lotosu 5 minut.',
                            'Dodaj ryż, mieszaj 2 minuty.',
                            'Zalej bulionem, gotuj pod przykryciem 25 min.',
                            'Dopraw sosem sojowym i pieprzem.',
                            'Posyp cebulką i sezamem.'
                        ],
                        benefits: 'Wzmacnia płuca, wspiera trawienie i poprawia krążenie.',
                        tcmProperties: 'Tonizuje Qi płuc, wzmacnia śledzionę, harmonizuje Qi'
                    },
                    {
                        name: 'Herbata Biała z Chryzantemą',
                        emoji: '🌼',
                        time: '8 min',
                        temperature: 'Ciepła',
                        ingredients: [
                            '1 łyżeczka białej herbaty',
                            '5-6 suszonych kwiatów chryzantemy',
                            '1 szklanka wody (80°C)',
                            '1 plasterek gruszki',
                            'Miód do smaku',
                            'Kilka listków mięty'
                        ],
                        instructions: [
                            'Wodę podgrzej do 80°C (nie gotuj!).',
                            'W czajniczku połącz herbatę z chryzantemą.',
                            'Zalej ciepłą wodą.',
                            'Zaparzaj 5-6 minut.',
                            'Przecedź do filiżanki.',
                            'Dodaj plasterek gruszki i miód.',
                            'Udekoruj miętą, pij powoli.'
                        ],
                        benefits: 'Oczyszcza płuca, uspokaja umysł i wspiera jasność myślenia.',
                        tcmProperties: 'Oczyszcza Ciepło z płuc, uspokaja Shen, rozjaśnia oczy'
                    }
                ],
                'Woda': [
                    {
                        name: 'Rosół z Goji i Imbirem',
                        emoji: '🍜',
                        time: '90 min',
                        temperature: 'Gorąca',
                        ingredients: [
                            '1 kg kości wołowych',
                            '2 łyżki jagód goji',
                            '5 cm świeżego imbiru',
                            '2 marchwie',
                            '1 seler naciowy',
                            '1 cebula',
                            '2 liście laurowe',
                            'Pietruszka świeża',
                            'Sól morska'
                        ],
                        instructions: [
                            'Kości opłucz i włóż do garnka.',
                            'Zalej zimną wodą, doprowadź do wrzenia.',
                            'Zdejmij pianę, dodaj pokrojone warzywa.',
                            'Dodaj imbir i liście laurowe.',
                            'Gotuj na małym ogniu 90 minut.',
                            'Na 15 minut przed końcem dodaj goji.',
                            'Przecedź rosół przez sitko.',
                            'Podawaj z pietruszkę i solą.'
                        ],
                                                 benefits: `Wzmacnia nerki, dostarcza kolagenu i rozgrzewa organizm zimą ${new Date().getFullYear()}.`,
                        tcmProperties: 'Tonizuje Yang nerek, wzmacnia esencję Jing, odżywia szpik kostny'
                    },
                    {
                        name: 'Pierogi z Kapustą Kiszoną',
                        emoji: '🥟',
                        time: '120 min',
                        temperature: 'Gorąca',
                        ingredients: [
                            '500g mąki pszennej',
                            '250ml ciepłej wody',
                            '1 jajko',
                            '400g kapusty kiszonej',
                            '200g kiełbasy',
                            '1 cebula',
                            '2 łyżki masła',
                            'Kminek',
                            'Pieprz czarny'
                        ],
                        instructions: [
                            'Z mąki, wody i jajka wyrób ciasto.',
                            'Pozostaw pod ściereczką na 30 minut.',
                            'Kapustę odsącz i drobno posiekaj.',
                            'Kiełbasę i cebulę pokrój w kostki.',
                            'Podsmaż cebulę, dodaj kiełbasę i kapustę.',
                            'Duś 15 minut, dopraw.',
                            'Rozwałkuj ciasto, wytnij koła.',
                            'Nałóż nadzienie, zlepi i ugotuj.'
                        ],
                        benefits: 'Wspiera trawienie, dostarcza probiotyków i rozgrzewa Qi nerek.',
                        tcmProperties: 'Wzmacnia Yang śledziony, tonizuje Qi nerek, reguluje trawienie'
                    },
                    {
                        name: 'Herbata Pu-erh z Cytryną',
                        emoji: '🍋',
                        time: '12 min',
                        temperature: 'Gorąca',
                        ingredients: [
                            '1 łyżeczka herbaty pu-erh',
                            '1 szklanka wody',
                            '2 plasterki cytryny',
                            '1 cm świeżego imbiru',
                            '1 łyżeczka miodu',
                            'Cynamon w lasce',
                            'Goździki (2 sztuki)'
                        ],
                        instructions: [
                            'Herbatę pu-erh przepłucz ciepłą wodą.',
                            'Zagotuj wodę z imbirem i przyprawami.',
                            'Zalej herbatę, zaparzaj 8 minut.',
                            'Przecedź przez sitko.',
                            'Dodaj plasterki cytryny i miód.',
                            'Mieszaj delikatnie.',
                            'Pij gorącą, najlepiej wieczorem.'
                        ],
                        benefits: 'Wspiera trawienie tłuszczy, oczyszcza organizm i rozgrzewa wnętrzności.',
                        tcmProperties: 'Reguluje Qi śledziony, rozpuszcza Wilgoć, wzmacnia Yang'
                    }
                ]
            };
            
            return recipes[element] || recipes['Ogień'];
        }

        function getElementIcon(element) {
            const icons = {
                'Drewno': 'fas fa-leaf',
                'Ogień': 'fas fa-fire',
                'Ziemia': 'fas fa-mountain',
                'Metal': 'fas fa-wind',
                'Woda': 'fas fa-snowflake'
            };
            return icons[element] || 'fas fa-utensils';
        }

        function showRecipeDetails(element, recipeIndex) {
            const recipes = getSeasonalRecipes(element);
            const recipe = recipes[recipeIndex];
            const userRole = localStorage.getItem('userRole') || 'user';
            
            if (!recipe) return;
            
            const modal = document.createElement('div');
            modal.className = 'recipe-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeRecipeModal();
            };
            
            modal.innerHTML = `
                <div class="recipe-modal-content" style="border-color: ${getElementColor(element)};">
                    <button class="close-modal-btn" onclick="closeRecipeModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="recipe-modal-header">
                        <div class="recipe-modal-icon">
                            ${recipe.emoji}
                        </div>
                        <div style="flex: 1;">
                            <div class="recipe-modal-title">${recipe.name}</div>
                            <div class="recipe-modal-meta">
                                <span><i class="fas fa-clock"></i> ${recipe.time}</span>
                                <span><i class="fas fa-thermometer-half"></i> ${recipe.temperature}</span>
                                <span><i class="${getElementIcon(element)}"></i> Element ${element}</span>
                                <span><i class="fas fa-calendar"></i> Sezon ${new Date().getFullYear()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-shopping-cart"></i>
                            Składniki
                        </div>
                        <ul class="recipe-ingredients-list">
                            ${recipe.ingredients.map(ingredient => `<li>• ${ingredient}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-list-ol"></i>
                            Sposób przygotowania
                        </div>
                        <div class="recipe-instructions">
                            <ol>
                                ${recipe.instructions.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                    
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)};">
                        <div class="recipe-section-title">
                            <i class="fas fa-heart"></i>
                            Korzyści zdrowotne
                        </div>
                        <div class="recipe-benefits">
                            ${recipe.benefits}
                        </div>
                    </div>
                    
                    ${userRole === 'admin' ? `
                    <div class="recipe-section" style="border-left-color: ${getElementColor(element)}; background: rgba(255, 193, 7, 0.1);">
                        <div class="recipe-section-title">
                            <i class="fas fa-yin-yang"></i>
                            Właściwości TCM (Admin)
                        </div>
                        <div class="season-info-content">
                            <strong>Działanie na organizm:</strong><br>
                            ${recipe.tcmProperties}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentRecipeModal = modal;
            
            // Add sparkle effect
            setTimeout(() => {
                createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
            }, 300);
        }

        function closeRecipeModal() {
            if (window.currentRecipeModal) {
                window.currentRecipeModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentRecipeModal && document.body.contains(window.currentRecipeModal)) {
                        document.body.removeChild(window.currentRecipeModal);
                    }
                    window.currentRecipeModal = null;
                }, 300);
            }
        }

        function getElementColor(element) {
            const colors = {
                'Drewno': '#4CAF50',
                'Ogień': '#F44336',
                'Ziemia': '#FFC107',
                'Metal': '#9E9E9E',
                'Woda': '#2196F3'
            };
            return colors[element] || '#4CAF50';
        }

        function generateShoppingList() {
            const currentSeason = updateSeason();
            const recipes = getSeasonalRecipes(currentSeason.element);
            
            // Collect all ingredients from current season recipes
            const allIngredients = [];
            recipes.forEach(recipe => {
                allIngredients.push(...recipe.ingredients);
            });
            
            // Remove duplicates and create clean list
            const uniqueIngredients = [...new Set(allIngredients.map(ingredient => 
                ingredient.replace(/^\d+\s*(szklanki?|łyżki?|łyżeczki?|cm|g|ml|kg|sztuki?|litr|plaster|plasterki|ząbki?)\s*/i, '')
                    .replace(/\s*\([^)]*\)/g, '')
                    .trim()
            ))];
            
            const modal = document.createElement('div');
            modal.className = 'season-modal';
            modal.onclick = (e) => {
                if (e.target === modal) closeShoppingListModal();
            };
            
            modal.innerHTML = `
                <div class="season-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                    <button class="close-modal-btn" onclick="closeShoppingListModal()">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="season-modal-header">
                        <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                            🛒
                        </div>
                        <div>
                            <div class="season-modal-title">Lista Zakupów Sezonowych</div>
                                                         <div class="season-modal-subtitle">${currentSeason.name} • Rok ${new Date().getFullYear()}</div>
                        </div>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-shopping-basket"></i>
                            Składniki z przepisów sezonowych
                        </div>
                        <ul class="season-info-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                            ${uniqueIngredients.map(ingredient => `
                                <li style="background: rgba(255,255,255,0.1); padding: 8px; border-radius: 6px;">
                                    ✅ ${ingredient}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div class="season-info-section" style="border-left-color: ${getElementColor(currentSeason.element)};">
                        <div class="season-info-title">
                            <i class="fas fa-info-circle"></i>
                            Porady zakupowe TCM
                        </div>
                        <div class="season-info-content">
                            ${getSeasonalShoppingTips(currentSeason.element)}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="action-btn" onclick="printShoppingList()" style="margin-right: 10px;">
                            🖨️ Wydrukuj listę
                        </button>
                        <button class="action-btn" onclick="shareShoppingList()">
                            📱 Udostępnij
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentShoppingModal = modal;
        }

        function getSeasonalShoppingTips(element) {
            const tips = {
                'Drewno': 'Wybieraj młode, świeże warzywa liściaste. Unikaj przetworzonej żywności. Szukaj produktów bogatych w witaminę C i chlorofil.',
                'Ogień': 'Kupuj chłodzące owoce i warzywa. Unikaj rozgrzewających przypraw. Wybieraj lekkie, łatwo strawne produkty.',
                'Ziemia': 'Skoncentruj się na słodkich, odżywczych produktach. Wybieraj ziarna i korzenie. Unikaj zimnych napojów.',
                'Metal': 'Kupuj białe produkty i te bogate w składniki nawilżające. Wybieraj orzechy i nasiona. Unikaj suchej żywności.',
                'Woda': 'Skoncentruj się na ciepłych, odżywczych produktach. Wybieraj ciemne ziarna i owoce morza. Unikaj zimnych pokarmów.'
            };
            return tips[element] || tips['Ogień'];
        }

        function closeShoppingListModal() {
            if (window.currentShoppingModal) {
                window.currentShoppingModal.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => {
                    if (window.currentShoppingModal && document.body.contains(window.currentShoppingModal)) {
                        document.body.removeChild(window.currentShoppingModal);
                    }
                    window.currentShoppingModal = null;
                }, 300);
            }
        }

        function printShoppingList() {
            window.print();
            showNotification('🖨️ Lista zakupów przygotowana do druku!');
        }

        function shareShoppingList() {
            const currentYear = new Date().getFullYear();
            if (navigator.share) {
                navigator.share({
                    title: `Lista Zakupów Sezonowych - SezonoweDobro ${currentYear}`,
                    text: 'Sprawdź moją listę zakupów według Tradycyjnej Medycyny Chińskiej!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href);
                showNotification('📱 Link do aplikacji skopiowany do schowka!');
            }
        }

        // Dynamic Year Updates
        function updateCurrentYear() {
            const currentYear = new Date().getFullYear();
            
            // Update all year references
            const yearElements = document.querySelectorAll('.current-year');
            yearElements.forEach(element => {
                element.textContent = currentYear;
            });
            
            // Update taglines
            const taglines = document.querySelectorAll('.tagline');
            taglines.forEach(tagline => {
                tagline.textContent = `Tradycyjna Medycyna Chińska dla Współczesnego Życia • ${currentYear}`;
            });
            
            // Update welcome message
            setTimeout(() => {
                if (localStorage.getItem('isLoggedIn') === 'true') {
                    showNotification(`Witaj w Twojej podróży do zdrowia w roku ${currentYear}! 🌟`);
                }
            }, 1000);
            
            // Update admin stats
            updateAdminStats(currentYear);
            
            // Update shopping list modal subtitle
            const shoppingModalSubtitles = document.querySelectorAll('.shopping-modal-subtitle');
            shoppingModalSubtitles.forEach(subtitle => {
                const seasonName = subtitle.textContent.split(' • ')[0];
                subtitle.textContent = `${seasonName} • Rok ${currentYear}`;
            });
            
            return currentYear;
        }
        
                 function updateAdminStats(year) {
             // Update user stats for current year
             const userYearLabels = document.querySelectorAll('[data-year="users"]');
             userYearLabels.forEach(label => {
                 label.textContent = `Użytkownicy ${year}`;
             });
             
             const recipeYearLabels = document.querySelectorAll('[data-year="recipes"]');
             recipeYearLabels.forEach(label => {
                 label.textContent = `Przepisy ${year}`;
             });
             
             const serverStatusElements = document.querySelectorAll('[data-year="server"]');
             serverStatusElements.forEach(element => {
                 element.textContent = `Status serwera: Online • ${year}`;
             });
             
             const activeUserElements = document.querySelectorAll('[data-year="active-users"]');
             activeUserElements.forEach(element => {
                 element.textContent = `Aktywni użytkownicy ${year}: 347`;
             });
         }

         // Herbs and Emotions Functions
         function showHerbsAndEmotions() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'herbs-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeHerbsModal();
             };
             
             const herbsData = getHerbsAndEmotionsData();
             
             modal.innerHTML = `
                 <div class="herbs-modal-content">
                     <button class="close-modal-btn" onclick="closeHerbsModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             🌿
                         </div>
                         <div>
                             <div class="season-modal-title">Zioła i Emocje w TCM</div>
                             <div class="season-modal-subtitle">Naturalne wsparcie emocjonalne • ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${herbsData.map(category => `
                         <div class="herbs-category" onclick="toggleHerbsCategory(this)">
                             <div class="herbs-category-header">
                                 <div class="herbs-category-title">
                                     <div class="herbs-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.emotion} • Element ${category.element}
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down herbs-expand-icon"></i>
                             </div>
                             <div class="herbs-category-content">
                                 <div class="herbs-grid">
                                     ${category.herbs.map(herb => `
                                         <div class="herb-card" style="border-left-color: ${category.color};">
                                             <div class="herb-header">
                                                 <span class="herb-emoji">${herb.emoji}</span>
                                                 <span class="herb-name">${herb.name}</span>
                                             </div>
                                             <div class="herb-description">
                                                 ${herb.description}
                                             </div>
                                             <div class="herb-properties" style="border-left-color: ${category.color};">
                                                 <div class="herb-properties-title">Właściwości TCM</div>
                                                 <div class="herb-properties-text">
                                                     <strong>Działanie:</strong> ${herb.action}<br>
                                                     <strong>Temperatura:</strong> ${herb.temperature}<br>
                                                     <strong>Smak:</strong> ${herb.taste}
                                                     ${userRole === 'admin' ? `<br><strong>Meridian:</strong> ${herb.meridian}<br><strong>Dawkowanie:</strong> ${herb.dosage}` : ''}
                                                 </div>
                                             </div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentHerbsModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleHerbsCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeHerbsModal() {
             if (window.currentHerbsModal) {
                 window.currentHerbsModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentHerbsModal && document.body.contains(window.currentHerbsModal)) {
                         document.body.removeChild(window.currentHerbsModal);
                     }
                     window.currentHerbsModal = null;
                 }, 300);
             }
         }

         // Face Yoga Functions
         function showFaceYoga() {
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'face-yoga-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeFaceYogaModal();
             };
             
             const yogaData = getFaceYogaData();
             
             modal.innerHTML = `
                 <div class="face-yoga-modal-content">
                     <button class="close-modal-btn" onclick="closeFaceYogaModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: #4CAF50;">
                             🧘‍♀️
                         </div>
                         <div>
                             <div class="season-modal-title">Joga Twarzy</div>
                             <div class="season-modal-subtitle">Naturalne odmładzanie według TCM • ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${yogaData.map(category => `
                         <div class="yoga-category" onclick="toggleYogaCategory(this)">
                             <div class="yoga-category-header">
                                 <div class="yoga-category-title">
                                     <div class="yoga-category-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} • ${category.exercises.length} ćwiczeń
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down yoga-expand-icon"></i>
                             </div>
                             <div class="yoga-category-content">
                                 <div class="yoga-exercises-grid">
                                     ${category.exercises.map(exercise => `
                                         <div class="yoga-exercise-card" style="border-left-color: ${category.color};">
                                             <div class="yoga-exercise-header">
                                                 <span class="yoga-exercise-emoji">${exercise.emoji}</span>
                                                 <span class="yoga-exercise-name">${exercise.name}</span>
                                             </div>
                                             <div class="yoga-exercise-description">
                                                 ${exercise.description}
                                             </div>
                                             <div class="yoga-exercise-steps" style="border-left-color: ${category.color};">
                                                 <div class="yoga-steps-title">Instrukcja krok po kroku</div>
                                                 <ul class="yoga-steps-list">
                                                     ${exercise.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="yoga-benefits" style="border-left-color: ${category.color};">
                                                 <div class="yoga-benefits-title">Korzyści</div>
                                                 <div class="yoga-benefits-text">
                                                     ${exercise.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE ADMIN</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Meridian:</strong> ${exercise.meridian}<br>
                                                         <strong>Element TCM:</strong> ${exercise.element}<br>
                                                         <strong>Energia:</strong> ${exercise.energy}<br>
                                                         <strong>Przeciwwskazania:</strong> ${exercise.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="yoga-duration">⏱️ ${exercise.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentFaceYogaModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleYogaCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeFaceYogaModal() {
             if (window.currentFaceYogaModal) {
                 window.currentFaceYogaModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentFaceYogaModal && document.body.contains(window.currentFaceYogaModal)) {
                         document.body.removeChild(window.currentFaceYogaModal);
                     }
                     window.currentFaceYogaModal = null;
                 }, 300);
             }
         }

         // Seasonal Energy Functions
         function updateSeasonalEnergyButton() {
             const currentSeason = updateSeason();
             const button = document.getElementById('seasonalEnergyButton');
             const icon = document.getElementById('seasonalEnergyIcon');
             const text = document.getElementById('seasonalEnergyText');
             
             if (!button || !icon || !text) return;
             
             const seasonalData = {
                 'Drewno': {
                     name: 'Wiosenna Energia',
                     icon: 'fas fa-leaf',
                     emoji: '🌱',
                     color: '#4CAF50'
                 },
                 'Ogień': {
                     name: 'Letnia Energia', 
                     icon: 'fas fa-fire',
                     emoji: '🔥',
                     color: '#F44336'
                 },
                 'Ziemia': {
                     name: 'Energia Ziemi',
                     icon: 'fas fa-mountain',
                     emoji: '🌾',
                     color: '#FFC107'
                 },
                 'Metal': {
                     name: 'Jesienna Energia',
                     icon: 'fas fa-wind',
                     emoji: '🍂',
                     color: '#9E9E9E'
                 },
                 'Woda': {
                     name: 'Zimowa Energia',
                     icon: 'fas fa-snowflake',
                     emoji: '❄️',
                     color: '#2196F3'
                 }
             };
             
             const seasonData = seasonalData[currentSeason.element] || seasonalData['Ogień'];
             
             // Update button appearance
             icon.className = `${seasonData.icon} feature-icon`;
             icon.style.color = seasonData.color;
             text.textContent = seasonData.name;
             
             // Add seasonal gradient background
             button.style.background = `linear-gradient(135deg, ${seasonData.color}15, ${seasonData.color}05)`;
             button.style.borderColor = `${seasonData.color}30`;
         }

         function showSeasonalEnergy() {
             const currentSeason = updateSeason();
             const userRole = localStorage.getItem('userRole') || 'user';
             const currentYear = new Date().getFullYear();
             
             const modal = document.createElement('div');
             modal.className = 'seasonal-energy-modal';
             modal.onclick = (e) => {
                 if (e.target === modal) closeSeasonalEnergyModal();
             };
             
             const energyData = getSeasonalEnergyData(currentSeason.element);
             
             modal.innerHTML = `
                 <div class="seasonal-energy-modal-content" style="border-color: ${getElementColor(currentSeason.element)};">
                     <button class="close-modal-btn" onclick="closeSeasonalEnergyModal()">
                         <i class="fas fa-times"></i>
                     </button>
                     
                     <div class="season-modal-header" style="margin-bottom: 30px;">
                         <div class="season-modal-icon" style="color: ${getElementColor(currentSeason.element)};">
                             ${getSeasonalEmoji(currentSeason.element)}
                         </div>
                         <div>
                             <div class="season-modal-title">${getSeasonalName(currentSeason.element)}</div>
                             <div class="season-modal-subtitle">Praktyki energetyczne według TCM • ${currentYear}</div>
                         </div>
                     </div>
                     
                     ${energyData.map(category => `
                         <div class="energy-practice-category" onclick="toggleEnergyCategory(this)">
                             <div class="energy-practice-header">
                                 <div class="energy-practice-title">
                                     <div class="energy-practice-icon" style="color: ${category.color};">
                                         ${category.emoji}
                                     </div>
                                     <div>
                                         <div>${category.name}</div>
                                         <div style="font-size: 14px; color: rgba(255,255,255,0.7); font-weight: normal;">
                                             ${category.focus} • ${category.practices.length} praktyk
                                         </div>
                                     </div>
                                 </div>
                                 <i class="fas fa-chevron-down energy-expand-icon"></i>
                             </div>
                             <div class="energy-practice-content">
                                 <div class="energy-practices-grid">
                                     ${category.practices.map(practice => `
                                         <div class="energy-practice-card" style="border-left-color: ${category.color};">
                                             <div class="energy-practice-card-header">
                                                 <span class="energy-practice-emoji">${practice.emoji}</span>
                                                 <span class="energy-practice-name">${practice.name}</span>
                                             </div>
                                             <div class="energy-practice-description">
                                                 ${practice.description}
                                             </div>
                                             <div class="energy-practice-steps" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-steps-title">Instrukcja wykonania</div>
                                                 <ul class="energy-practice-steps-list">
                                                     ${practice.steps.map(step => `<li>${step}</li>`).join('')}
                                                 </ul>
                                             </div>
                                             <div class="energy-practice-benefits" style="border-left-color: ${category.color};">
                                                 <div class="energy-practice-benefits-title">Korzyści energetyczne</div>
                                                 <div class="energy-practice-benefits-text">
                                                     ${practice.benefits}
                                                 </div>
                                             </div>
                                             ${userRole === 'admin' ? `
                                                 <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #FFC107;">
                                                     <div style="color: rgba(255,255,255,0.8); font-size: 12px; font-weight: 600; margin-bottom: 5px;">INFORMACJE TCM (ADMIN)</div>
                                                     <div style="color: rgba(255,255,255,0.7); font-size: 12px;">
                                                         <strong>Element:</strong> ${practice.element}<br>
                                                         <strong>Typ energii:</strong> ${practice.energyType}<br>
                                                         <strong>Meridian:</strong> ${practice.meridian}<br>
                                                         <strong>Najlepszy czas:</strong> ${practice.bestTime}<br>
                                                         <strong>Przeciwwskazania:</strong> ${practice.contraindications}
                                                     </div>
                                                 </div>
                                             ` : ''}
                                             <div class="energy-practice-duration" style="background: ${category.color}20;">⏱️ ${practice.duration}</div>
                                         </div>
                                     `).join('')}
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>
             `;
             
             document.body.appendChild(modal);
             window.currentSeasonalEnergyModal = modal;
             
             // Add sparkle effect
             setTimeout(() => {
                 createSparkle({ clientX: window.innerWidth / 2, clientY: window.innerHeight / 2 });
             }, 300);
         }

         function toggleEnergyCategory(categoryElement) {
             categoryElement.classList.toggle('expanded');
         }

         function closeSeasonalEnergyModal() {
             if (window.currentSeasonalEnergyModal) {
                 window.currentSeasonalEnergyModal.style.animation = 'fadeOut 0.3s ease forwards';
                 setTimeout(() => {
                     if (window.currentSeasonalEnergyModal && document.body.contains(window.currentSeasonalEnergyModal)) {
                         document.body.removeChild(window.currentSeasonalEnergyModal);
                     }
                     window.currentSeasonalEnergyModal = null;
                 }, 300);
             }
         }

         function getSeasonalName(element) {
             const names = {
                 'Drewno': 'Wiosenna Energia',
                 'Ogień': 'Letnia Energia',
                 'Ziemia': 'Energia Ziemi',
                 'Metal': 'Jesienna Energia',
                 'Woda': 'Zimowa Energia'
             };
             return names[element] || 'Letnia Energia';
         }

         function getSeasonalEmoji(element) {
             const emojis = {
                 'Drewno': '🌱',
                 'Ogień': '🔥',
                 'Ziemia': '🌾',
                 'Metal': '🍂',
                 'Woda': '❄️'
             };
             return emojis[element] || '🔥';
         }

         function getSeasonalEnergyData(element) {
             const allData = {
                 'Drewno': [
                     {
                         name: 'Medytacje Wzrostu',
                         focus: 'Odnowa i nowe początki',
                         emoji: '🧘‍♀️',
                         color: '#4CAF50',
                         practices: [
                             {
                                 name: 'Medytacja Kiełkowania',
                                 emoji: '🌱',
                                 description: 'Wizualizacja wzrostu nowej energii życiowej, idealna na wiosnę.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'Usiądź wygodnie twarzą na wschód (o wschodzie słońca)',
                                     'Zamknij oczy i wyobraź sobie nasiono w swojej wątrobie',
                                     'Z każdym wdechem nasiono napełnia się zieloną energią',
                                     'Na wydechu wyobraź sobie kiełek przebijający się przez ziemię',
                                     'Poczuj jak energia wzrostu przepływa przez całe ciało',
                                     'Wizualizuj siebie jako młode drzewko pełne życia',
                                     'Zakończ głębokim oddechem i otwórz oczy'
                                 ],
                                 benefits: 'Odświeża energię wątroby, wspiera detoksykację, pobudza kreatywność',
                                 element: 'Drewno',
                                 energyType: 'Yang rosnące',
                                 meridian: 'Wątroba (LV), Pęcherzyk żółciowy (GB)',
                                 bestTime: 'Wschód słońca (5:00-7:00)',
                                 contraindications: 'Nadciśnienie, mania, silne emocje'
                             },
                             {
                                 name: 'Oddychanie Detoksykacyjne',
                                 emoji: '🌿',
                                 description: 'Specjalna technika oddechowa oczyszczająca wątrobę z toksyn.',
                                 duration: '8-12 minut',
                                 steps: [
                                     'Usiądź prosto, ręce na kolanach',
                                     'Wdechnij przez nos przez 4 sekundy',
                                     'Zatrzymaj oddech na 2 sekundy',
                                     'Wydechnij przez usta przez 6 sekund z dźwiękiem "Shu"',
                                     'Podczas wydechu wyobraź sobie zielony dym opuszczający wątrobę',
                                     'Powtórz 12 razy (jeden pełny cykl)',
                                     'Zakończ 3 naturalnymi oddechami'
                                 ],
                                 benefits: 'Oczyszcza wątrobę, redukuje gniew, poprawia elastyczność',
                                 element: 'Drewno',
                                 energyType: 'Yin oczyszczające',
                                 meridian: 'Wątroba (LV)',
                                 bestTime: 'Wczesny ranek, przed jedzeniem',
                                 contraindications: 'Zapalenie wątroby, ciąża, osłabienie'
                             }
                         ]
                     },
                     {
                         name: 'Ćwiczenia Energetyczne',
                         focus: 'Aktywacja Qi wątroby',
                         emoji: '🌿',
                         color: '#4CAF50',
                         practices: [
                             {
                                 name: 'Stretching Smoka',
                                 emoji: '🐉',
                                 description: 'Dynamiczne ruchy przywracające elastyczność meridianów.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'Stań w pozycji szerokiej, ręce wzdłuż ciała',
                                     'Wyciągnij ręce w bok na wysokość ramion',
                                     'Skręć tułów w lewo, wydychając "Shu"',
                                     'Wróć do centrum, wdychając głęboko',
                                     'Skręć tułów w prawo, wydychając "Shu"',
                                     'Powtórz 8 razy w każdą stronę',
                                     'Zakończ trzema głębokimi oddechami'
                                 ],
                                 benefits: 'Uwalnia napięcie w wątrobie, poprawia krążenie Qi',
                                 element: 'Drewno',
                                 energyType: 'Yang mobilizujące',
                                 meridian: 'Pęcherzyk żółciowy (GB)',
                                 bestTime: 'Rano po przebudzeniu',
                                 contraindications: 'Zawroty głowy, problemy z kręgosłupem'
                             }
                         ]
                     }
                 ],
                 'Ogień': [
                     {
                         name: 'Medytacje Radości',
                         focus: 'Harmonia serca i umysłu',
                         emoji: '❤️',
                         color: '#F44336',
                         practices: [
                             {
                                 name: 'Medytacja Serca Lotosu',
                                 emoji: '🪷',
                                 description: 'Uspokajająca praktyka chłodząca nadmierną energię Yang.',
                                 duration: '15-20 minut',
                                 steps: [
                                     'Usiądź w chłodnym, zacienionym miejscu',
                                     'Ręce złóż w mudra lotosu na sercu',
                                     'Oddychaj powoli i głęboko',
                                     'Wyobraź sobie błękitny lotos w swoim sercu',
                                     'Z każdym oddechem lotos się otwiera',
                                     'Poczuj chłodzącą energię rozlewającą się po ciele',
                                     'Pozostań w tym stanie spokoju przez 10 minut',
                                     'Powoli otwórz oczy z uśmiechem'
                                 ],
                                 benefits: 'Chłodzi nadmierną energię, uspokaja emocje, przynosi radość',
                                 element: 'Ogień',
                                 energyType: 'Yin chłodzące',
                                 meridian: 'Serce (HT), Jelito cienkie (SI)',
                                 bestTime: 'Południe (11:00-13:00) w cieniu',
                                 contraindications: 'Depresja, zimno w ciele, osłabienie Yang'
                             },
                             {
                                 name: 'Oddychanie Chłodzące',
                                 emoji: '🌊',
                                 description: 'Technika Sheetali - chłodzące oddychanie z jogi.',
                                 duration: '5-10 minut',
                                 steps: [
                                     'Usiądź twarzą na północ',
                                     'Wyciągnij język jak rurkę',
                                     'Wdychaj powietrze przez zwinięty język',
                                     'Poczuj chłodzące wrażenie w ustach',
                                     'Zamknij usta i wydechnij przez nos',
                                     'Wyobraź sobie chłodzącą energię w sercu',
                                     'Powtórz 20-30 razy',
                                     'Zakończ naturalnym oddychaniem'
                                 ],
                                 benefits: 'Ochładza organizm, uspokaja Shen, redukuje stres cieplny oraz wzmacnia energię Yin w sercu',
                                 element: 'Ogień',
                                 energyType: 'Yin nawilżające',
                                 meridian: 'Serce (HT), Płuca (LU)',
                                 bestTime: 'Gorące dni, po południu',
                                 contraindications: 'Przeziębienie, słaba energia, zima'
                             }
                         ]
                     },
                     {
                         name: 'Ćwiczenia Chłodzące',
                         focus: 'Ochładzanie organizmu',
                         emoji: '❄️',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Ruch Łabędzia w Wodzie',
                                 emoji: '🦢',
                                 description: 'Płynne ruchy łagodzące nadmierną energię Yang.',
                                 duration: '12-20 minut',
                                 steps: [
                                     'Stań tyłem do słońca w cieniu',
                                     'Ręce unieś powoli nad głowę jak skrzydła',
                                     'Pochyl się do przodu z prostymi plecami',
                                     'Ręce opuść w dół jak łabędź nurkujący',
                                     'Powoli prostuj się, unosząc ręce',
                                     'Oddychaj głęboko i spokojnie',
                                     'Powtórz 10-15 razy bardzo powoli'
                                 ],
                                 benefits: 'Uspokaja Shen, ochładza krew, równoważy emocje',
                                 element: 'Ogień',
                                 energyType: 'Yin harmonizujące',
                                 meridian: 'Osierdziк (PC), Trzeci Ogrzewacz (TH)',
                                 bestTime: 'Wczesny wieczór w cieniu',
                                 contraindications: 'Zimno w ciele, depresja, słabość'
                             }
                         ]
                     },
                     {
                         name: 'Wizualizacje Serca',
                         focus: 'Harmonia emocjonalna',
                         emoji: '💖',
                         color: '#E91E63',
                         practices: [
                             {
                                 name: 'Fontanna Szczęścia',
                                 emoji: '⛲',
                                 description: 'Wizualizacja chłodnej fontanny w sercu.',
                                 duration: '8-15 minut',
                                 steps: [
                                     'Usiądź wygodnie twarzą na północ',
                                     'Ręce połóż na sercu',
                                     'Wyobraź sobie chłodną fontannę w centrum piersi',
                                     'Fontanna rozpryskuje krystalicznie czystą wodę',
                                     'Woda chłodzi i uspokaja całe serce',
                                     'Poczuj radość i spokój płynący z fontanny',
                                     'Pozwól wodzie obmyć wszystkie gorące emocje',
                                     'Pozostań w tym chłodnym, radosnym stanie'
                                 ],
                                 benefits: 'Ochładza serce, przynosi radość, uspokaja umysł',
                                 element: 'Ogień',
                                 energyType: 'Yin nawilżające',
                                 meridian: 'Serce (HT)',
                                 bestTime: 'Południe, podczas największego upału',
                                 contraindications: 'Słabe serce, zimno w piersiach, smutek'
                             }
                         ]
                     }
                 ],
                 'Ziemia': [
                     {
                         name: 'Medytacje Stabilizujące',
                         focus: 'Równowaga i wewnętrzny spokój',
                         emoji: '⚖️',
                         color: '#FFC107',
                         practices: [
                             {
                                 name: 'Medytacja Korzeni',
                                 emoji: '🌳',
                                 description: 'Uziemienie energii i stabilizacja emocji.',
                                 duration: '12-18 minut',
                                 steps: [
                                     'Usiądź na ziemi lub podłodze',
                                     'Wyobraź sobie korzenie wyrastające z podstawy kręgosłupa',
                                     'Korzenie sięgają głęboko do centrum Ziemi',
                                     'Poczuj stabilność i uziemienie',
                                     'Oddychaj do brzucha, wzmacniając śledzionę',
                                     'Z każdym oddechem stajesz się bardziej stabilny',
                                     'Wizualizuj złotą energię w obszarze żołądka',
                                     'Pozostań w tym uziemionym stanie'
                                 ],
                                 benefits: 'Stabilizuje emocje, wzmacnia trawienie, daje poczucie bezpieczeństwa',
                                 element: 'Ziemia',
                                 energyType: 'Qi centrujące',
                                 meridian: 'Śledziona (SP), Żołądek (ST)',
                                 bestTime: 'Późne popołudnie (15:00-17:00)',
                                 contraindications: 'Silne lęki, claustrofobia, mania'
                             }
                         ]
                     },
                     {
                         name: 'Ćwiczenia Równowagi',
                         focus: 'Stabilizacja centrum',
                         emoji: '⚖️',
                         color: '#FFC107',
                         practices: [
                             {
                                 name: 'Postawa Góry',
                                 emoji: '⛰️',
                                 description: 'Statyczne pozycje wzmacniające centrum ciała.',
                                 duration: '5-12 minut',
                                 steps: [
                                     'Stań w pozycji hip-width apart',
                                     'Wyobraź sobie korzenie wyrastające ze stóp',
                                     'Korona głowy ciągnie w górę do nieba',
                                     'Oddychaj do brzucha, powiększając go na wdechu',
                                     'Poczuj stabilność między niebem a ziemią',
                                     'Pozostań nieruchomo jak góra',
                                     'Skoncentruj się na centrum ciała',
                                     'Zakończ trzema głębokimi oddechami'
                                 ],
                                 benefits: 'Wzmacnia śledzionę, poprawia równowagę, stabilizuje emocje',
                                 element: 'Ziemia',
                                 energyType: 'Qi centrowujące',
                                 meridian: 'Śledziona (SP), Żołądek (ST)',
                                 bestTime: 'Przejścia między sezonami',
                                 contraindications: 'Problemy z równowagą, zawroty głowy'
                             }
                         ]
                     }
                 ],
                 'Metal': [
                     {
                         name: 'Medytacje Oczyszczające',
                         focus: 'Oddech i wewnętrzna siła',
                         emoji: '🫁',
                         color: '#9E9E9E',
                         practices: [
                             {
                                 name: 'Medytacja Białego Tygrysa',
                                 emoji: '🐅',
                                 description: 'Wzmacnia płuca i wewnętrzną siłę obronną Wei Qi.',
                                 duration: '10-15 minut',
                                 steps: [
                                     'Usiądź twarzą na zachód',
                                     'Ręce ułóż na piersiach',
                                     'Oddychaj głęboko do płuc',
                                     'Wyobraź sobie białego tygrysa w płucach',
                                     'Tygrys jest strażnikiem Twojej energii',
                                     'Z każdym wdechem tygrys staje się silniejszy',
                                     'Poczuj siłę i ochronę w klatce piersiowej',
                                     'Na wydechu wypuść wszystko co zbędne'
                                 ],
                                 benefits: 'Wzmacnia odporność, oczyszcza płuca, buduje Wei Qi',
                                 element: 'Metal',
                                 energyType: 'Yang obronne',
                                 meridian: 'Płuca (LU), Jelito grube (LI)',
                                 bestTime: 'Zachód słońca (17:00-19:00)',
                                 contraindications: 'Astma ostra, silne emocje, nadciśnienie'
                             }
                         ]
                     },
                     {
                         name: 'Ćwiczenia Oddechowe',
                         focus: 'Wzmocnienie płuc',
                         emoji: '🌬️',
                         color: '#9E9E9E',
                         practices: [
                             {
                                 name: 'Oddychanie Jesiennego Wiatru',
                                 emoji: '🍃',
                                 description: 'Oczyszczająca technika oddechowa na jesień.',
                                 duration: '8-15 minut',
                                 steps: [
                                     'Usiądź twarzą na zachód',
                                     'Ręce ułóż na dolnych żebrach',
                                     'Wdechnij głęboko, rozszerzając żebra',
                                     'Wydechnij powoli z dźwiękiem "Si"',
                                     'Wyobraź sobie biały dym opuszczający płuca',
                                     'Poczuj jak płuca się oczyszczają',
                                     'Powtórz 18 razy (liczba Metal)',
                                     'Zakończ naturalnym oddychaniem'
                                 ],
                                 benefits: 'Oczyszcza płuca, wzmacnia Wei Qi, poprawia odporność',
                                 element: 'Metal',
                                 energyType: 'Yang oczyszczające',
                                 meridian: 'Płuca (LU), Jelito grube (LI)',
                                 bestTime: 'Jesienne poranki',
                                 contraindications: 'Astma ciężka, silny kaszel, gorączka'
                             }
                         ]
                     }
                 ],
                 'Woda': [
                     {
                         name: 'Medytacje Regenerujące',
                         focus: 'Odnowa i głęboki odpoczynek',
                         emoji: '🌙',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Medytacja Ciemnej Wody',
                                 emoji: '🌊',
                                 description: 'Głęboka regeneracja energii Yin i esencji Jing.',
                                 duration: '20-30 minut',
                                 steps: [
                                     'Ułóż się wygodnie w ciemnym pomieszczeniu',
                                     'Ręce połóż na dolnej części brzucha',
                                     'Oddychaj bardzo powoli i głęboko',
                                     'Wyobraź sobie czarną wodę w nerkach',
                                     'Woda jest spokojna i głęboka jak ocean',
                                     'Poczuj jak energia gromadzi się w nerkach',
                                     'Pozwól ciału całkowicie się zrelaksować',
                                     'Pozostań w tym stanie głębokiego spokoju'
                                 ],
                                 benefits: 'Odnawia esencję Jing, wzmacnia nerki, regeneruje Yin',
                                 element: 'Woda',
                                 energyType: 'Yin esencjonalne',
                                 meridian: 'Nerki (KI), Pęcherz moczowy (BL)',
                                 bestTime: 'Wieczór (19:00-21:00)',
                                 contraindications: 'Depresja, nadmierna senność, brak motywacji'
                             }
                         ]
                     },
                     {
                         name: 'Ćwiczenia Regenerujące',
                         focus: 'Odnowa esencji życiowej',
                         emoji: '🔋',
                         color: '#2196F3',
                         practices: [
                             {
                                 name: 'Masaż Nerek',
                                 emoji: '👐',
                                 description: 'Gentle self-massage do wzmocnienia Jing.',
                                 duration: '10-20 minut',
                                 steps: [
                                     'Usiądź wygodnie, plecy proste',
                                     'Rozgrzej dłonie pocierając je o siebie',
                                     'Połóż dłonie na dolnej części pleców (nerki)',
                                     'Masuj okrężnymi ruchami 36 razy',
                                     'Poczuj ciepło przenikające do nerek',
                                     'Oddychaj głęboko do brzucha',
                                     'Wizualizuj czarną wodę napełniającą nerki',
                                     'Zakończ, pozostawiając dłonie na nerkach'
                                 ],
                                 benefits: 'Wzmacnia esencję Jing, regeneruje nerki, poprawia witalność',
                                 element: 'Woda',
                                 energyType: 'Yang aktywizujące',
                                 meridian: 'Nerki (KI)',
                                 bestTime: 'Wieczór przed snem',
                                 contraindications: 'Zapalenie nerek, gorączka, hiperttensja'
                             }
                         ]
                     },
                     {
                         name: 'Medytacje Nocne',
                         focus: 'Głęboka regeneracja',
                         emoji: '🌜',
                         color: '#1A237E',
                         practices: [
                             {
                                 name: 'Sen Nefrytu',
                                 emoji: '💎',
                                 description: 'Przygotowanie do regenerującego snu.',
                                 duration: '15-30 minut',
                                 steps: [
                                     'Połóż się w ciemnym, cichym pokoju',
                                     'Ręce na dolnej części brzucha (Dan Tian)',
                                     'Oddychaj bardzo powoli i cicho',
                                     'Wyobraź sobie czarny nefryty w nerkach',
                                     'Nefryty gromadzi energię życiową',
                                     'Pozwól ciału całkowicie się rozluźnić',
                                     'Poczuj jak energia zgromadzona w nerkach',
                                     'Płynnie przejdź w sen lub głęboką relaksację'
                                 ],
                                 benefits: 'Restauruje Jing, przygotowuje do głębokiego snu, odnawia życie',
                                 element: 'Woda',
                                 energyType: 'Yin esencjonalne',
                                 meridian: 'Nerki (KI), Pęcherz (BL)',
                                 bestTime: 'Tuż przed snem (21:00-23:00)',
                                 contraindications: 'Bezsenność, lęki, nadmiernia stymulacja'
                             }
                         ]
                     }
                 ]
             };
             
             return allData[element] || allData['Ogień'];
         }

         function getFaceYogaData() {
             return [
                 {
                     name: 'Ćwiczenia na Oczy',
                     focus: 'Redukcja zmarszczek i worków',
                     emoji: '👁️',
                     color: '#2196F3',
                     exercises: [
                         {
                             name: 'Mruganie Motylem',
                             emoji: '🦋',
                             description: 'Delikatne ćwiczenie poprawiające krążenie wokół oczu i redukujące napięcie.',
                             duration: '2-3 minuty',
                             steps: [
                                 'Usiądź wygodnie z prostymi plecami',
                                 'Zamknij oczy delikatnie, bez napinania',
                                 'Powoli otwórz oczy jak motyl rozpościerający skrzydła',
                                 'Mrugaj bardzo powoli 10 razy',
                                 'Następnie mrugaj szybko przez 10 sekund',
                                 'Zakończ 3 głębokimi, powolnymi mrugnięciami'
                             ],
                             benefits: 'Poprawia krążenie, redukuje zmarszczki wokół oczu, łagodzi zmęczenie wzroku',
                             meridian: 'Pęcherzyk żółciowy (GB), Wątroba (LV)',
                             element: 'Drewno',
                             energy: 'Tonizuje Yin, wzmacnia Esencję Nerek',
                             contraindications: 'Świeże operacje oczu, zapalenie spojówek'
                         },
                         {
                             name: 'Masaż Punktów Energetycznych',
                             emoji: '☯️',
                             description: 'Akupresura punktów wokół oczu według tradycji TCM.',
                             duration: '3-5 minut',
                             steps: [
                                 'Znajdź punkt Yuyao (środek brwi)',
                                 'Delikatnie masuj okrężnymi ruchami przez 30 sekund',
                                 'Przejdź do punktu Sizhukong (koniec brwi)',
                                 'Masuj punkt Tongziliao (zewnętrzny kącik oka)',
                                 'Zakończ masażem punktu Jingming (wewnętrzny kącik)',
                                 'Powtórz całą sekwencję 3 razy'
                             ],
                             benefits: 'Aktywuje meridian żółciaoka, poprawia jasność wzroku, redukuje obrzęki',
                             meridian: 'Pęcherzyk żółciowy (GB), Mały Jelito (SI)',
                             element: 'Drewno/Ogień',
                             energy: 'Reguluje przepływ Qi, rozpraszra stagnację',
                             contraindications: 'Bardzo wrażliwa skóra, niedawne zabiegi kosmetyczne'
                         }
                     ]
                 },
                 {
                     name: 'Ćwiczenia na Czoło',
                     focus: 'Wygładzenie zmarszczek poziomych',
                     emoji: '🤔',
                     color: '#FFC107',
                     exercises: [
                         {
                             name: 'Lifting Czoła',
                             emoji: '⬆️',
                             description: 'Naturalne wygładzanie zmarszczek poziomych na czole.',
                             duration: '2-4 minuty',
                             steps: [
                                 'Połóż palce wskazujące nad brwiami',
                                 'Delikatnie naciśnij skórę w dół',
                                 'Jednocześnie próbuj podnieść brwi do góry',
                                 'Utrzymaj napięcie przez 5 sekund',
                                 'Zrelaksuj mięśnie przez 3 sekundy',
                                 'Powtórz 10-15 razy'
                             ],
                             benefits: 'Wzmacnia mięśnie czoła, redukuje zmarszczki poziome, poprawia krążenie',
                             meridian: 'Pęcherzyk moczowy (BL), Żołądek (ST)',
                             element: 'Ziemia/Woda',
                             energy: 'Podnosi Yang Qi, wzmacnia Śledzionę',
                             contraindications: 'Botoks w obszarze czoła (ostatnie 6 miesięcy)'
                         },
                         {
                             name: 'Masaż Czakry Trzeciego Oka',
                             emoji: '🧘',
                             description: 'Stymulacja punktu Yintang dla relaksu i koncentracji.',
                             duration: '3-5 minut',
                             steps: [
                                 'Znajdź punkt między brwiami (Yintang)',
                                 'Połóż kciuk na tym punkcie',
                                 'Rób delikatne okrężne ruchy przez 1 minutę',
                                 'Następnie naciśnij i puść 10 razy',
                                 'Przesuwaj kciuk w górę do punktu Shenting',
                                 'Zakończ delikatnym masażem całego czoła'
                             ],
                             benefits: 'Uspokaja umysł, redukuje stres, wygładza czoło, poprawia koncentrację',
                             meridian: 'Vessel Governing (GV), Dodatkowy Yangming',
                             element: 'Ziemia',
                             energy: 'Uspokaja Shen, harmonizuje Qi',
                             contraindications: 'Nadciśnienie, migrena w fazie aktywnej'
                         }
                     ]
                 },
                 {
                     name: 'Ćwiczenia na Policzki',
                     focus: 'Ujędrnienie i lifting naturalny',
                     emoji: '😊',
                     color: '#E91E63',
                     exercises: [
                         {
                             name: 'Balon w Policzkach',
                             emoji: '🎈',
                             description: 'Wzmacnianie mięśni policzków i poprawianie owalu twarzy.',
                             duration: '3-5 minut',
                             steps: [
                                 'Napełnij powietrzem jeden policzek jak balon',
                                 'Utrzymaj przez 10 sekund',
                                 'Przerzuć powietrze do drugiego policzka',
                                 'Utrzymaj kolejne 10 sekund',
                                 'Przerzuć powietrze pod górną wargę',
                                 'Na koniec pod dolną wargę',
                                 'Powtórz całą sekwencję 5 razy'
                             ],
                             benefits: 'Ujędrnia policzki, poprawia owal twarzy, wzmacnia mięśnie mimiczne',
                             meridian: 'Żołądek (ST), Jelito Grube (LI)',
                             element: 'Ziemia/Metal',
                             energy: 'Tonizuje Qi Śledziony, wzmacnia Yang',
                             contraindications: 'Problemy z szczęką (TMJ), niedawne zabiegi dentystyczne'
                         },
                         {
                             name: 'Uśmiech Buddy',
                             emoji: '😌',
                             description: 'Medytacyjne ćwiczenie łączące relaks z wzmocnieniem mięśni.',
                             duration: '5-7 minut',
                             steps: [
                                 'Usiądź w pozycji medytacyjnej',
                                 'Zamknij oczy i oddychaj głęboko',
                                 'Narysuj lekki uśmiech na twarzy',
                                 'Poczuj jak energia płynie przez policzki',
                                 'Stopniowo poszerz uśmiech',
                                 'Utrzymaj przez 30 sekund',
                                 'Powoli powróć do pozycji neutralnej'
                             ],
                             benefits: 'Poprawia nastrój, redukuje stres, naturalnie podnosi kąciki ust',
                             meridian: 'Serce (HT), Jelito Cienkie (SI)',
                             element: 'Ogień',
                             energy: 'Raduje Shen, harmonizuje emocje',
                             contraindications: 'Depresja głęboka (wymaga ostrożności)'
                         }
                     ]
                 },
                 {
                     name: 'Ćwiczenia na Szyję',
                     focus: 'Redukcja podwójnego podbródka',
                     emoji: '🦢',
                     color: '#9C27B0',
                     exercises: [
                         {
                             name: 'Łabędź',
                             emoji: '🦢',
                             description: 'Eleganckie wydłużanie i wzmacnianie mięśni szyi.',
                             duration: '4-6 minut',
                             steps: [
                                 'Usiądź prosto z wyprostowaną szyją',
                                 'Powoli wyciągnij szyję do przodu jak łabędź',
                                 'Jednocześnie unieś podbródek',
                                 'Poczuj rozciągnięcie pod podbródkiem',
                                 'Utrzymaj pozycję przez 5 sekund',
                                 'Powoli wróć do pozycji początkowej',
                                 'Powtórz 12-15 razy'
                             ],
                             benefits: 'Redukuje podwójny podbródek, wzmacnia mięśnie szyi, poprawia postawę',
                             meridian: 'Pęcherzyk żółciowy (GB), Vessel Governing (GV)',
                             element: 'Drewno',
                             energy: 'Podnosi Yang, wzmacnia Wei Qi',
                             contraindications: 'Problemy z kręgosłupem szyjnym, niedawne urazy'
                         },
                         {
                             name: 'Pocałunek Nieba',
                             emoji: '😘',
                             description: 'Ćwiczenie wzmacniające dolną część twarzy.',
                             duration: '3-4 minuty',
                             steps: [
                                 'Usiądź lub stań prosto',
                                 'Unieś głowę delikatnie do góry',
                                 'Wyciągnij usta jak do pocałunku',
                                 'Wyciągnij usta tak daleko jak możesz',
                                 'Utrzymaj przez 5 sekund',
                                 'Zrelaksuj i powtórz 10 razy',
                                 'Zakończ delikatnym masażem szyi'
                             ],
                             benefits: 'Ujędrnia szyję, redukuje zwiotczenie skóry, poprawia elastyczność',
                             meridian: 'Vessel Conception (CV), Nerki (KI)',
                             element: 'Woda',
                             energy: 'Tonizuje Yin Nerek, wzmacnia Esencję',
                             contraindications: 'Zawroty głowy, problemy z ciśnieniem'
                         }
                     ]
                 },
                 {
                     name: 'Ćwiczenia na Usta',
                     focus: 'Pełniejsze i młodsze usta',
                     emoji: '💋',
                     color: '#F44336',
                     exercises: [
                         {
                             name: 'Rybka',
                             emoji: '🐠',
                             description: 'Naturalne powiększanie i ujędrnianie ust.',
                             duration: '2-3 minuty',
                             steps: [
                                 'Zassij policzki do środka jak ryba',
                                 'Jednocześnie wyciągnij usta do przodu',
                                 'Utrzymaj pozycję przez 5 sekund',
                                 'Następnie otwórz usta szeroko w "O"',
                                 'Utrzymaj przez 5 sekund',
                                 'Powróć do pozycji ryby',
                                 'Powtórz całą sekwencję 8-10 razy'
                             ],
                             benefits: 'Powiększa usta, redukuje zmarszczki wokół ust, wzmacnia mięśnie',
                             meridian: 'Żołądek (ST), Śledziona (SP)',
                             element: 'Ziemia',
                             energy: 'Wzmacnia Qi Śledziony, harmonizuje trawienie',
                             contraindications: 'Niedawne wypełnienia ust, herpes w fazie aktywnej'
                         },
                         {
                             name: 'Mantra OM',
                             emoji: '🕉️',
                             description: 'Wibracyjne ćwiczenie łączące dźwięk z ruchem.',
                             duration: '5-7 minut',
                             steps: [
                                 'Usiądź w pozycji medytacyjnej',
                                 'Głęboko wdechnij przez nos',
                                 'Na wydechu śpiewaj "OMMMMM"',
                                 'Poczuj wibracje w ustach i twarzy',
                                 'Powtórz 21 razy',
                                 'Po każdych 7 razach rób krótką przerwę',
                                 'Zakończ ciszą i obserwacją wrażeń'
                             ],
                             benefits: 'Relaksuje całą twarz, poprawia rezonans głosu, uspokaja umysł',
                             meridian: 'Vessel Governing (GV), Serce (HT)',
                             element: 'Ogień',
                             energy: 'Uspokaja Shen, harmonizuje wszystkie energie',
                             contraindications: 'Problemy z głosem, zapalenie krtani'
                         }
                     ]
                 }
             ];
         }

         function getHerbsAndEmotionsData() {
             return [
                 {
                     name: 'Złość i Frustracja',
                     emotion: 'Gniew',
                     element: 'Drewno',
                     emoji: '😤',
                     color: '#4CAF50',
                     herbs: [
                         {
                             name: 'Rumianek (Gan Ju)',
                             emoji: '🌼',
                             description: 'Łagodzi napięcie nerwowe i uspokaja umysł. Idealny na wieczór po stresującym dniu.',
                             action: 'Oczyszcza Ciepło Wątroby, uspokaja Shen',
                             temperature: 'Chłodna',
                             taste: 'Słodki, gorzki',
                             meridian: 'Wątroba, Pęcherzyk żółciowy',
                             dosage: '3-6g dziennie, herbata'
                         },
                         {
                             name: 'Melisa (Xiang Feng Cao)',
                             emoji: '🌿',
                             description: 'Uspokaja nadpobudliwy system nerwowy i pomaga w kontroli emocji.',
                             action: 'Reguluje Qi Wątroby, harmonizuje emocje',
                             temperature: 'Chłodna',
                             taste: 'Słodki, lekko gorzki',
                             meridian: 'Wątroba, Serce',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Mniszek Lekarski (Pu Gong Ying)',
                             emoji: '🌻',
                             description: 'Oczyszcza wątrobę z toksyn emocjonalnych i fizycznych.',
                             action: 'Detoksykuje Wątrobę, redukuje Ciepło',
                             temperature: 'Zimna',
                             taste: 'Gorzki, słodki',
                             meridian: 'Wątroba, Żołądek',
                             dosage: '10-30g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Smutek i Depresja',
                     emotion: 'Melancholia',
                     element: 'Metal',
                     emoji: '😢',
                     color: '#9E9E9E',
                     herbs: [
                         {
                             name: 'Dziurawiec (Guan Ye Lian Qiao)',
                             emoji: '🌻',
                             description: 'Naturalny antydepresant, podnosi nastrój i przywraca radość życia.',
                             action: 'Podnosi Yang Qi, rozjaśnia Shen',
                             temperature: 'Ciepła',
                             taste: 'Gorzki, słodki',
                             meridian: 'Serce, Płuca',
                             dosage: '300-900mg ekstraktu dziennie'
                         },
                         {
                             name: 'Lawenda (Xun Yi Cao)',
                             emoji: '💜',
                             description: 'Uspokaja umysł, redukuje lęk i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, reguluje Qi',
                             temperature: 'Chłodna',
                             taste: 'Ostry, gorzki',
                             meridian: 'Serce, Płuca',
                             dosage: '1-4g dziennie, olejek eteryczny'
                         },
                         {
                             name: 'Szafran (Fan Hong Hua)',
                             emoji: '🟡',
                             description: 'Poprawia nastrój, zwiększa energię życiową i wspiera pozytywne myślenie.',
                             action: 'Aktywuje Krew, podnosi Shen',
                             temperature: 'Ciepła',
                             taste: 'Słodki, lekko gorzki',
                             meridian: 'Serce, Wątroba',
                             dosage: '1-3g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'Lęk i Niepokój',
                     emotion: 'Strach',
                     element: 'Woda',
                     emoji: '😰',
                     color: '#2196F3',
                     herbs: [
                         {
                             name: 'Waleriana (Jie Gu Mu)',
                             emoji: '🌸',
                             description: 'Silnie uspokajające zioło, redukuje lęk i pomaga w zasypianiu.',
                             action: 'Uspokaja Shen, wzmacnia Yin',
                             temperature: 'Ciepła',
                             taste: 'Słodki, ostry',
                             meridian: 'Serce, Nerki',
                             dosage: '300-600mg ekstraktu przed snem'
                         },
                         {
                             name: 'Pokrzywa (Xun Ma)',
                             emoji: '🌱',
                             description: 'Wzmacnia nadnercza, poprawia odporność na stres.',
                             action: 'Tonizuje Yang Nerek, wzmacnia Qi',
                             temperature: 'Ciepła',
                             taste: 'Słodki, lekko gorzki',
                             meridian: 'Nerki, Wątroba',
                             dosage: '2-4g dziennie, napar'
                         },
                         {
                             name: 'Passiflora (Xi Fan Lian)',
                             emoji: '🌺',
                             description: 'Łagodzi napięcia nerwowe i redukuje poziom stresu.',
                             action: 'Uspokaja Shen, reguluje Qi Serca',
                             temperature: 'Chłodna',
                             taste: 'Słodki, lekko gorzki',
                             meridian: 'Serce, Wątroba',
                             dosage: '4-8g dziennie, napar'
                         }
                     ]
                 },
                 {
                     name: 'Nadpobudliwość i Mania',
                     emotion: 'Przesadna Radość',
                     element: 'Ogień',
                     emoji: '🤩',
                     color: '#F44336',
                     herbs: [
                         {
                             name: 'Chmiela (Pi Jiu Hua)',
                             emoji: '🌿',
                             description: 'Uspokaja nadpobudliwość, pomaga w kontroli emocji.',
                             action: 'Chłodzi Ciepło Serca, uspokaja Shen',
                             temperature: 'Chłodna',
                             taste: 'Gorzki',
                             meridian: 'Serce, Żołądek',
                             dosage: '0.5-2g dziennie, napar'
                         },
                         {
                             name: 'Mięta (Bo He)',
                             emoji: '🌿',
                             description: 'Ochładza nadmierną energię Yang, przywraca równowagę.',
                             action: 'Chłodzi Ciepło, reguluje Qi',
                             temperature: 'Chłodna',
                             taste: 'Ostry',
                             meridian: 'Płuca, Wątroba',
                             dosage: '1-3g dziennie, napar'
                         },
                         {
                             name: 'Lukrecja (Gan Cao)',
                             emoji: '🍯',
                             description: 'Harmonizuje wszystkie energie, łagodzi skrajne emocje.',
                             action: 'Harmonizuje wszystkie formuły, wzmacnia Qi',
                             temperature: 'Ciepła',
                             taste: 'Słodki',
                             meridian: 'Wszystkie meridiany',
                             dosage: '2-12g dziennie, odwar'
                         }
                     ]
                 },
                 {
                     name: 'Obsesje i Nadmierne Myślenie',
                     emotion: 'Zamartwianie',
                     element: 'Ziemia',
                     emoji: '🤔',
                     color: '#FFC107',
                     herbs: [
                         {
                             name: 'Róża (Mei Gui Hua)',
                             emoji: '🌹',
                             description: 'Uwalnia zablokowane emocje, poprawia przepływ energii.',
                             action: 'Reguluje Qi, uspokaja Shen',
                             temperature: 'Ciepła',
                             taste: 'Słodki, lekko gorzki',
                             meridian: 'Wątroba, Serce',
                             dosage: '3-6g dziennie, napar'
                         },
                         {
                             name: 'Korzeniówka (Bai Zhu)',
                             emoji: '🌾',
                             description: 'Wzmacnia śledzionę, poprawia koncentrację i pamięć.',
                             action: 'Tonizuje Qi Śledziony, suszu Wilgoć',
                             temperature: 'Ciepła',
                             taste: 'Słodki, gorzki',
                             meridian: 'Śledziona, Żołądek',
                             dosage: '6-12g dziennie, odwar'
                         },
                         {
                             name: 'Ginko (Yin Xing Ye)',
                             emoji: '🍃',
                             description: 'Poprawia krążenie mózgowe, wspiera jasność myślenia.',
                             action: 'Aktywuje Krew, otwiera meridiany',
                             temperature: 'Neutralna',
                             taste: 'Słodki, gorzki',
                             meridian: 'Serce, Płuca',
                             dosage: '40-80mg ekstraktu dziennie'
                         }
                     ]
                 }
             ];
         }

        // AI Assistant Functions
        let isRecording = false;
        let recognition = null;

        // Initialize Speech Recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'pl-PL';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    sendMessage();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    stopRecording();
                    showNotification('Błąd rozpoznawania mowy. Spróbuj ponownie.');
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        function toggleVoiceRecording() {
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (recognition) {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.add('voice-recording');
                voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                
                document.getElementById('aiStatus').innerHTML = '🎤 Słucham...';
                recognition.start();
            } else {
                showNotification('Rozpoznawanie mowy nie jest dostępne w tej przeglądarce.');
            }
        }

        function stopRecording() {
            isRecording = false;
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('voice-recording');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            
            document.getElementById('aiStatus').innerHTML = '🤖 Gotowy do pomocy';
            if (recognition) {
                recognition.stop();
            }
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message === '') return;
            
            // Check if user is admin - unlimited access
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'admin') {
                // Check AI usage limits for regular users
                if (!checkAIUsageLimit()) {
                    addMessageToChat(message, 'user');
                    userInput.value = '';
                    setTimeout(() => {
                        addMessageToChat('🚫 **Osiągnąłeś limit bezpłatnych zapytań!**<br><br>Masz dostęp do 10 zapytań dziennie. Aby cieszyć się nielimitowanym dostępem do AI Asystenta, przejdź na plan Premium.<br><br><button onclick="showPremiumModal()" style="background: linear-gradient(135deg, #FFD700, #FFC107); border: none; padding: 10px 20px; border-radius: 10px; color: #000; font-weight: 600; cursor: pointer; margin-top: 10px;">🔓 Odblokuj Premium</button>', 'ai');
                    }, 500);
                    return;
                }
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            userInput.value = '';
            
            // Increment AI usage for non-admin users
            if (userRole !== 'admin') {
                incrementAIUsage();
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process AI response with Railway API
            setTimeout(async () => {
                hideTypingIndicator();
                try {
                    const response = await getRealAIResponse(message);
                    addMessageToChat(response, 'ai');
                } catch (error) {
                    console.error('AI Error:', error);
                    // Fallback to local response if API fails
                    const fallbackResponse = generateAIResponse(message);
                    addMessageToChat(fallbackResponse + '<br><br><small>ℹ️ Odpowiedź z lokalnej bazy (API niedostępne)</small>', 'ai');
                }
                
                // Update usage display if premium modal is open
                updateAIUsageDisplay();
            }, 800);
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div style="color: #66BB6A; font-weight: 600; margin-bottom: 5px;">👤 Ty:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div style="color: #4CAF50; font-weight: 600; margin-bottom: 5px;">🤖 AI Asystent:</div>
                    <div style="color: rgba(255,255,255,0.9);">${message}</div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <span>🤖 AI myśli...</span>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const currentSeason = getCurrentSeason();
            
            // Detect intent
            if (message.includes('przepis') || message.includes('potrawa') || message.includes('jedzenie') || message.includes('gotowanie')) {
                return generateRecipeResponse(currentSeason);
            } else if (message.includes('ćwiczenie') || message.includes('trening') || message.includes('fitness') || message.includes('gimnastyka')) {
                return generateExerciseResponse(currentSeason);
            } else if (message.includes('lista') || message.includes('zakupy') || message.includes('składniki') || message.includes('kupić')) {
                return generateShoppingListResponse(currentSeason);
            } else if (message.includes('sezon') || message.includes('pora roku')) {
                return generateSeasonResponse(currentSeason);
            } else if (message.includes('zdrowie') || message.includes('dolegliwości') || message.includes('ból') || message.includes('energia')) {
                return generateHealthAdvice(currentSeason, message);
            } else {
                return generateGeneralResponse(currentSeason);
            }
        }

        function getCurrentSeason() {
            const month = new Date().getMonth(); // 0-11
            if (month >= 2 && month <= 4) return 'wiosna';
            if (month >= 5 && month <= 7) return 'lato'; 
            if (month === 8) return 'późne lato';
            if (month >= 9 && month <= 11) return 'jesień';
            return 'zima';
        }

        function generateRecipeResponse(season) {
            const recipes = {
                'wiosna': [
                    'Zupa z młodych pokrzyw - oczyszcza wątrobę i dodaje energii',
                    'Sałatka z roszponką i kiełkami - wspiera regenerację organizmu',
                    'Herbata z mniszka lekarskiego - detoksykuje i wzmacnia'
                ],
                'lato': [
                    'Gazpacho z ogórkiem - chłodzi organizm w upalne dni',
                    'Smoothie z arbuza i mięty - nawadnia i orzeźwia',
                    'Sałatka z pomidorów i bazylii - wspiera pracę serca'
                ],
                'późne lato': [
                    'Zupa z kukurydzy i marchwi - wzmacnia śledzionę',
                    'Zapiekanka z dyni i prosa - stabilizuje energię',
                    'Herbata z korzeniem lukrecji - harmonizuje trawienie'
                ],
                'jesień': [
                    'Zupa dyniowa z imbirem - wzmacnia odporność',
                    'Kompot z jabłek i cynamonu - wspiera trawienie',
                    'Gulasz z korzeniem lotosu - odżywia i wzmacnia'
                ],
                'zima': [
                    'Rosół z goji i imbirem - rozgrzewa i wzmacnia energię',
                    'Pierogi z kapustą kiszoną - wspierają trawienie',
                    'Herbata pu-erh z cytryną - rozgrzewa i oczyszcza'
                ]
            };
            
            const seasonRecipes = recipes[season] || recipes['lato'];
            const randomRecipe = seasonRecipes[Math.floor(Math.random() * seasonRecipes.length)];
            
            // Add recipe to weekly progress
            addRecipeToWeekly(randomRecipe.split(' - ')[0]); // Extract recipe name before description
            
            return `🍽️ **Przepis na ${season}:**<br><br>**${randomRecipe}**<br><br>Zgodnie z TCM, ${season} to czas, gdy organizm potrzebuje specjalnych składników odżywczych. Czy chcesz, żebym przygotował dla Ciebie listę zakupów na ten przepis?`;
        }

        function generateExerciseResponse(season) {
            const exercises = {
                'wiosna': [
                    'Tai Chi w parku - harmonizuje energię wątroby',
                    'Joga rozciągająca - aktywuje przepływ Qi',
                    'Spacery w naturze - łączy z energią wzrostu'
                ],
                'lato': [
                    'Qigong o świcie - uspokaja umysł w gorące dni',
                    'Pływanie - chłodzi Shen (ducha)',
                    'Medytacja w cieniu - balansuje energię serca'
                ],
                'późne lato': [
                    'Medytacja siedząca - wzmacnia śledzionę',
                    'Łagodne spacery po posiłku - wspiera trawienie',
                    'Ćwiczenia równowagi - stabilizuje energię ziemi'
                ],
                'jesień': [
                    'Oddychanie brzuchem - wzmacnia płuca',
                    'Powolne spacery - harmonizuje energię metalu',
                    'Joga z naciskiem na płuca - przygotowuje na zimę'
                ],
                'zima': [
                    'Delikatne rozciąganie - oszczędza energię nerek',
                    'Medytacja siedząca - kultywuje energię wewnętrzną',
                    'Qi Gong dla nerek - wzmacnia esencję życiową'
                ]
            };
            
            const seasonExercises = exercises[season] || exercises['lato'];
            const randomExercise = seasonExercises[Math.floor(Math.random() * seasonExercises.length)];
            
            return `🧘 **Ćwiczenie na ${season}:**<br><br>**${randomExercise}**<br><br>W medycynie chińskiej każda pora roku odpowiada innemu organowi. ${season} jest idealną porą na te praktyki, które harmonizują Twoje ciało z naturalnymi cyklami.`;
        }

        function generateShoppingListResponse(season) {
            const shoppingLists = {
                'wiosna': ['młode pokrzywy', 'roszponka', 'kiełki', 'mniszek lekarski', 'cytryna', 'imbir', 'szczypiorek'],
                'lato': ['ogórek', 'arbuz', 'mięta', 'pomidory', 'bazylia', 'sałata', 'melon'],
                'późne lato': ['kukurydza', 'marchew', 'dynia', 'proso', 'korzeń lukrecji', 'słodkie ziemniaki', 'pszenica'],
                'jesień': ['dynia', 'imbir', 'jabłka', 'cynamon', 'korzeń lotosu', 'marchew', 'brokuły'],
                'zima': ['jagody goji', 'imbir', 'kapusta kiszona', 'herbata pu-erh', 'cytryna', 'czosnek', 'cebula']
            };
            
            const seasonIngredients = shoppingLists[season] || shoppingLists['lato'];
            
            let listHTML = `🛒 **Lista zakupów na ${season}:**<br><br>`;
            listHTML += '<div class="shopping-list">';
            listHTML += '<h4>🌿 Składniki sezonowe TCM:</h4>';
            listHTML += '<ul>';
            
            seasonIngredients.forEach(ingredient => {
                listHTML += `<li>✅ ${ingredient}</li>`;
            });
            
            listHTML += '</ul></div>';
            listHTML += '<br>Te składniki wspierają Twój organizm zgodnie z zasadami medycyny chińskiej dla obecnej pory roku.';
            
            return listHTML;
        }

        function generateSeasonResponse(season) {
            const seasonInfo = {
                'wiosna': 'Wiosna w TCM odpowiada elementowi Drewna i organowi wątroby. To czas wzrostu, odnowy i oczyszczania organizmu.',
                'lato': 'Lato w TCM odpowiada elementowi Ognia i organowi serca. To czas radości, aktywności i kultywowania ciepła wewnętrznego.',
                'późne lato': 'Późne lato w TCM odpowiada elementowi Ziemi i organom śledziony i żołądka. To czas równowagi, stabilności i harmonii trawienia.',
                'jesień': 'Jesień w TCM odpowiada elementowi Metalu i organom płuc. To czas zbierania energii i przygotowywania na zimę.',
                'zima': 'Zima w TCM odpowiada elementowi Wody i organom nerek. To czas odpoczynku, kultywowania energii wewnętrznej i wzmacniania esencji życiowej.'
            };
            
            return `🌿 **Mądrość TCM dla ${season}:**<br><br>${seasonInfo[season]}<br><br>Czy chcesz poznać specjalne przepisy, ćwiczenia lub porady zdrowotne na tę porę roku?`;
        }

        function generateHealthAdvice(season, message) {
            const advice = {
                'wiosna': 'Wiosną wzmacniaj wątrobę zielonymi warzywami, unikaj nadmiernej złości i praktykuj łagodne rozciąganie.',
                'lato': 'Latem chroń serce przed przegrzaniem, pij dużo płynów i praktykuj spokojną medytację.',
                'późne lato': 'W późne lato wzmacniaj śledzionę słodkimi pokarmami, unikaj przejadania się i praktykuj umiarkowanie.',
                'jesień': 'Jesienią dbaj o płuca, jedz białe pokarmy jak gruszki i rzodkiew, unikaj suchości.',
                'zima': 'Zimą wzmacniaj nerki ciepłymi potrawami, oszczędzaj energię i praktykuj głębokie oddychanie.'
            };
            
            return `🌿 **Porada zdrowotna na ${season}:**<br><br>${advice[season]}<br><br>Pamiętaj, że w TCM profilaktyka jest najważniejsza. Dostosowuj swój tryb życia do naturalnych cykli przyrody.`;
        }

        function generateGeneralResponse(season) {
            return `🤖 Jestem Twoim asystentem TCM! Mogę pomóc Ci w:<br><br>• 🍽️ **Przepisach sezonowych** - zdrowe potrawy na ${season}<br>• 🧘 **Ćwiczeniach** - praktyki dostosowane do pory roku<br>• 🛒 **Listach zakupów** - składniki zgodne z TCM<br>• 🌿 **Poradach zdrowotnych** - mądrość tradycyjnej medycyny chińskiej<br><br>Po prostu zapytaj: "Pokaż mi przepisy na ${season}" lub "Jakie ćwiczenia na dziś?"`;
        }

        function quickAction(type) {
            const actions = {
                'przepisy': 'Pokaż mi przepisy sezonowe',
                'cwiczenia': 'Jakie ćwiczenia polecasz na dziś?',
                'lista': 'Stwórz listę zakupów sezonowych',
                'porady': 'Daj mi poradę zdrowotną na obecną porę roku'
            };
            
            document.getElementById('userInput').value = actions[type];
            sendMessage();
        }

        // Automatic backup functionality
        function initializeAutoBackup() {
            // Check if auto backup is enabled (enabled by default)
            const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
            const autoBackupInterval = parseInt(localStorage.getItem('autoBackupInterval')) || 24; // hours
            
            if (autoBackupEnabled) {
                const lastAutoBackup = localStorage.getItem('lastAutoBackup');
                const now = new Date().getTime();
                
                if (!lastAutoBackup || (now - parseInt(lastAutoBackup)) > (autoBackupInterval * 60 * 60 * 1000)) {
                    // Perform automatic backup after 30 seconds
                    setTimeout(() => {
                        performAutoBackup();
                    }, 30000);
                }
                
                // Schedule periodic auto backups
                setInterval(() => {
                    const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') !== 'false';
                    if (autoBackupEnabled) {
                        performAutoBackup();
                    }
                }, autoBackupInterval * 60 * 60 * 1000); // Convert hours to milliseconds
            }
        }

        function performAutoBackup() {
            const backupData = {
                timestamp: new Date().toISOString(),
                version: "1.0.0",
                type: "auto",
                data: {
                    userProfile: {
                        userRole: localStorage.getItem('userRole') || 'user',
                        preferences: localStorage.getItem('userPreferences') || '{}',
                        settings: localStorage.getItem('appSettings') || '{}'
                    },
                    sessionData: {
                        lastVisit: localStorage.getItem('lastVisit') || '',
                        sessionCount: localStorage.getItem('sessionCount') || '0',
                        totalUsageTime: localStorage.getItem('totalUsageTime') || '0'
                    },
                    appData: {
                        favoriteRecipes: localStorage.getItem('favoriteRecipes') || '[]',
                        healthMetrics: localStorage.getItem('healthMetrics') || '[]',
                        reminders: localStorage.getItem('reminders') || '[]',
                        notes: localStorage.getItem('userNotes') || '[]'
                    },
                    wellness: {
                        currentSeason: localStorage.getItem('currentSeason') || '',
                        seasonProgress: localStorage.getItem('seasonProgress') || '{}',
                        dailyTips: localStorage.getItem('dailyTips') || '[]'
                    }
                }
            };

            // Store backup in localStorage as well
            localStorage.setItem('autoBackupData', JSON.stringify(backupData));
            localStorage.setItem('lastAutoBackup', new Date().getTime().toString());
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            
            // Add to system logs
            addSystemLog('INFO', 'BACKUP', 'Automatyczny backup został wykonany', `Rozmiar: ${Math.round(JSON.stringify(backupData).length / 1024)} KB`);
            
            showNotification('🔄 Automatyczny backup został wykonany');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            updateSeason();
            updateRecipes();
            updateCurrentYear();
            updateSeasonalEnergyButton();
            loadWeeklyProgress(); // Initialize weekly progress tracking
            initializeAutoBackup(); // Initialize auto backup
            initializeLogging(); // Initialize logging system
            initializeOfflineMode(); // Initialize offline mode
            checkSettingsAccessError(); // Check if there was an error accessing settings
            
            // Update season, recipes, year and seasonal energy every hour to ensure accuracy
            setInterval(() => {
                updateSeason();
                updateRecipes();
                updateCurrentYear();
                updateSeasonalEnergyButton();
            }, 3600000); // 1 hour = 3600000ms
            
            // Add some random sparkles for delight
            setInterval(() => {
                if (Math.random() > 0.95) {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    createSparkle({ clientX: x, clientY: y });
                }
            }, 1000);
            
            // Welcome message will be updated by updateCurrentYear function
        });

        // Admin notification sender
        function sendNotificationToUsers() {
            // Create modal with form instead of using prompt()
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(76, 175, 80, 0.15);
                    border: 1px solid rgba(255, 255, 255, 0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    backdrop-filter: blur(20px);
                    color: white;
                ">
                    <h2 style="margin: 0 0 20px 0; color: white;">📢 Wyślij Powiadomienie</h2>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Tytuł:</label>
                        <input type="text" id="notifTitle" value="Ważna informacja" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            box-sizing: border-box;
                        ">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Treść:</label>
                        <textarea id="notifMessage" style="
                            width: 100%;
                            height: 80px;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                            resize: none;
                            box-sizing: border-box;
                        ">Witamy w naszej aplikacji wellness!</textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px;">Odbiorcy:</label>
                        <select id="notifTarget" style="
                            width: 100%;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 8px;
                            background: rgba(255,255,255,0.1);
                            color: white;
                        ">
                            <option value="0">Wszyscy użytkownicy (347)</option>
                            <option value="1">Aktywni użytkownicy (68)</option>
                            <option value="2">Premium użytkownicy (23)</option>
                            <option value="3">Nowi użytkownicy (12)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="sendNotificationNow()" style="
                            flex: 1;
                            background: linear-gradient(135deg, #4CAF50, #66BB6A);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px;
                            cursor: pointer;
                            font-weight: bold;
                        ">📤 Wyślij</button>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: rgba(255,255,255,0.2);
                            color: white;
                            border: none;
                            border-radius: 10px;
                            padding: 12px 20px;
                            cursor: pointer;
                        ">Anuluj</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => e.target === modal && modal.remove();
        }
        
        function sendNotificationNow() {
            const title = document.getElementById('notifTitle').value;
            const message = document.getElementById('notifMessage').value;
            const targetIndex = document.getElementById('notifTarget').value;
            
            if (!title || !message) {
                showNotification('❌ Wypełnij wszystkie pola', 'error');
                return;
            }
            
            const targets = ['Wszyscy użytkownicy (347)', 'Aktywni użytkownicy (68)', 'Premium użytkownicy (23)', 'Nowi użytkownicy (12)'];
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
            
            // Simulate sending
            showNotification('📤 Wysyłanie powiadomienia...', 'info');
            
            setTimeout(() => {
                const notification = {
                    id: Date.now(),
                    title: title,
                    message: message,
                    target: targets[targetIndex],
                    timestamp: new Date().toLocaleString(),
                    status: 'sent'
                };
                
                // Save to localStorage
                const sentNotifications = JSON.parse(localStorage.getItem('sentNotifications') || '[]');
                sentNotifications.unshift(notification);
                localStorage.setItem('sentNotifications', JSON.stringify(sentNotifications.slice(0, 50)));
                
                showNotification('✅ Powiadomienie wysłane do: ' + targets[targetIndex], 'success');
            }, 2000);
        }

        // Export user data
        function exportUserData() {
            showNotification('📊 Przygotowywanie eksportu danych...', 'info');
            
            setTimeout(() => {
                const userData = [
                    { id: 1, name: 'Anna Kowalska', email: 'anna@example.com', status: 'active', joinDate: '2024-01-15', lastLogin: '2024-12-20' },
                    { id: 2, name: 'Piotr Nowak', email: 'piotr@example.com', status: 'active', joinDate: '2024-02-20', lastLogin: '2024-12-19' },
                    { id: 3, name: 'Maria Wiśniewska', email: 'maria@example.com', status: 'active', joinDate: '2024-03-10', lastLogin: '2024-12-18' },
                    { id: 4, name: 'Tomasz Admin', email: 'admin@example.com', status: 'admin', joinDate: '2024-01-01', lastLogin: '2024-12-20' },
                    { id: 5, name: 'Karolina Spam', email: 'spam@example.com', status: 'blocked', joinDate: '2024-11-15', lastLogin: '2024-11-20' }
                ];

                const content = JSON.stringify(userData, null, 2);
                const blob = new Blob([content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'users_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('✅ Dane użytkowników zostały wyeksportowane!', 'success');
            }, 1500);
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideUp {
                from {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('✅ ServiceWorker registered: ', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('❌ ServiceWorker registration failed: ', error);
                    });
            });
        }

        // Initialize profiles when page loads
        window.addEventListener('load', function() {
            loadSavedProfilePictures();
            loadHealthMetrics();
            
            // Initialize offline mode indicators
            updateOfflineStatus();
            
            // Auto-load backup display
            updateBackupDisplay();
            
            // Start daily fluctuations simulation
            setInterval(simulateDailyFluctuations, 60000 * 60); // Every hour
        });

        // Also run initialization when DOM is ready (for faster loading)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadSavedProfilePictures();
                loadHealthMetrics();
            });
        } else {
            loadSavedProfilePictures();
            loadHealthMetrics();
        }

        // ====== PREMIUM FUNCTIONS ======

        // Initialize Stripe
        const stripe = Stripe('pk_test_51234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890'); // Demo key - replace with real
        
        // Initialize Premium system on page load
        initializePremiumSystem();

        function initializePremiumSystem() {
            // Initialize daily AI usage tracking
            const today = new Date().toDateString();
            const lastResetDate = localStorage.getItem('lastAIReset');
            
            if (lastResetDate !== today) {
                // Reset daily usage at midnight
                localStorage.setItem('dailyAIUsage', '0');
                localStorage.setItem('lastAIReset', today);
            }
            
            // Check if user has premium
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                // User has premium - no limits
                return;
            }
            
            // Update AI usage display if premium modal is open
            updateAIUsageDisplay();
        }

        function checkAIUsageLimit() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return true; // Premium users have unlimited access
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const dailyLimit = 10; // Free users get 10 queries per day
            
            return dailyUsage < dailyLimit;
        }

        function incrementAIUsage() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                return; // Premium users don't have usage tracked
            }
            
            const currentUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            localStorage.setItem('dailyAIUsage', (currentUsage + 1).toString());
            
            // Add to system logs
            addSystemLog('INFO', 'AI', 'AI Query używane', `Dzienne użycie: ${currentUsage + 1}/10`);
        }

        function updateAIUsageDisplay() {
            const remainingElement = document.getElementById('remainingQueries');
            if (!remainingElement) return;
            
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                remainingElement.textContent = '∞ Nielimitowane';
                remainingElement.style.color = '#FFD700';
                return;
            }
            
            const dailyUsage = parseInt(localStorage.getItem('dailyAIUsage') || '0');
            const remaining = Math.max(0, 10 - dailyUsage);
            
            remainingElement.textContent = `${remaining} / 10`;
            
            if (remaining === 0) {
                remainingElement.style.color = '#F44336';
            } else if (remaining <= 3) {
                remainingElement.style.color = '#FF9800';
            } else {
                remainingElement.style.color = '#4CAF50';
            }
        }

        function showPremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                modal.style.display = 'flex';
                updateAIUsageDisplay();
                
                // Add premium modal animation
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeIn 0.3s ease';
                
                // Add golden particle effect
                createPremiumParticles();
            }
        }

        function closePremiumModal() {
            const modal = document.getElementById('premiumModal');
            if (modal) {
                const modalContent = modal.querySelector('div');
                modalContent.style.animation = 'fadeOut 0.3s ease';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        function createPremiumParticles() {
            const particles = ['👑', '✨', '💎', '🌟', '💰'];
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.cssText = `
                        position: fixed;
                        font-size: 20px;
                        pointer-events: none;
                        z-index: 10001;
                        left: ${Math.random() * window.innerWidth}px;
                        top: ${Math.random() * window.innerHeight}px;
                        animation: premiumFloat 3s ease-out forwards;
                    `;
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        async function initializeStripePayment() {
            const subscribeBtn = document.getElementById('subscribeBtn');
            
            // Show loading state
            subscribeBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i>Przetwarzanie...';
            subscribeBtn.disabled = true;
            
            try {
                // Real Stripe payment integration with Railway API
                const paymentResult = await realStripePayment();
                
                // If redirected to Stripe, stop here
                if (paymentResult.status === 'redirected') {
                    return;
                }
                
                // Success - activate premium
                localStorage.setItem('premiumStatus', 'active');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                
                // Show success message
                showPremiumSuccessModal();
                
                // Update UI
                updatePremiumUI();
                
                // Close premium modal
                closePremiumModal();
                
                // Add to system logs
                addSystemLog('SUCCESS', 'PREMIUM', 'Premium subskrypcja aktywowana', 'Użytkownik przeszedł na plan Premium');
                
                // Show notification
                showNotification('🎉 Premium zostało aktywowane! Ciesz się nielimitowanym dostępem do AI!');
                
            } catch (error) {
                // Handle payment error
                showNotification('❌ Błąd płatności. Spróbuj ponownie.', 'error');
                addSystemLog('ERROR', 'PREMIUM', 'Błąd płatności Premium', error.message);
            } finally {
                // Reset button
                subscribeBtn.innerHTML = '<i class="fas fa-crown" style="margin-right: 10px;"></i>Aktywuj Premium';
                subscribeBtn.disabled = false;
            }
        }

        async function realStripePayment() {
            try {
                // Call Railway API to create Stripe checkout session
                const response = await apiCall(API_CONFIG.ENDPOINTS.STRIPE_CHECKOUT, {
                    method: 'POST',
                    body: JSON.stringify({
                        priceId: 'price_monthly' // This would be your real Stripe price ID
                    })
                });
                
                // Redirect to Stripe checkout
                if (response.url) {
                    window.location.href = response.url;
                    return { status: 'redirected', url: response.url };
                } else {
                    throw new Error('Nie otrzymano URL płatności');
                }
                
            } catch (error) {
                // If Stripe not configured, fall back to demo mode
                if (error.message.includes('STRIPE_NOT_CONFIGURED')) {
                    console.log('🚧 Stripe nie skonfigurowany - tryb demo');
                    showNotification('🚧 Tryb demo - Stripe nie skonfigurowany');
                    
                    // Simulate successful payment in demo mode
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return {
                        id: 'demo_' + Math.random().toString(36).substr(2, 9),
                        status: 'succeeded',
                        amount: 2999,
                        currency: 'pln',
                        demo: true
                    };
                } else {
                    throw error;
                }
            }
        }

        function showPremiumSuccessModal() {
            const successModal = document.createElement('div');
            successModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10002;
                animation: fadeIn 0.3s ease;
            `;
            
            successModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 193, 7, 0.3));
                    border: 2px solid rgba(255, 215, 0, 0.7);
                    border-radius: 20px;
                    backdrop-filter: blur(20px);
                    padding: 40px;
                    text-align: center;
                    max-width: 400px;
                    margin: 20px;
                    animation: bounceIn 0.5s ease;
                ">
                    <div style="font-size: 60px; margin-bottom: 20px;">🎉👑</div>
                    <h3 style="color: #FFD700; margin-bottom: 15px; font-size: 24px;">
                        Gratulacje!
                    </h3>
                    <p style="color: white; margin-bottom: 20px; line-height: 1.6;">
                        Twoja subskrypcja Premium została aktywowana!<br><br>
                        <strong>Teraz masz dostęp do:</strong><br>
                        ✨ Nielimitowanych zapytań AI<br>
                        🚀 Priorytetowych odpowiedzi<br>
                        🌟 Zaawansowanych analiz TCM
                    </p>
                    <button onclick="this.closest('div').remove()" style="
                        background: linear-gradient(135deg, #FFD700, #FFC107);
                        border: none;
                        padding: 12px 30px;
                        border-radius: 10px;
                        color: #000;
                        font-weight: 700;
                        cursor: pointer;
                        font-size: 16px;
                    ">
                        Rozpocznij korzystanie!
                    </button>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    successModal.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        if (successModal.parentNode) {
                            successModal.parentNode.removeChild(successModal);
                        }
                    }, 300);
                }
            }, 5000);
        }

        function updatePremiumUI() {
            // Update premium button to show status instead of purchase
            const premiumButtons = document.querySelectorAll('[onclick="showPremiumModal()"]');
            premiumButtons.forEach(btn => {
                const textElement = btn.querySelector('.feature-text');
                if (textElement) {
                    textElement.textContent = 'Premium ✓';
                    btn.style.background = 'linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.2))';
                    btn.style.border = '1px solid rgba(255, 215, 0, 0.5)';
                }
            });
            
            // Update AI usage display
            updateAIUsageDisplay();
        }

        // Check premium status on page load
        function checkPremiumStatus() {
            const premiumStatus = localStorage.getItem('premiumStatus');
            if (premiumStatus === 'active') {
                updatePremiumUI();
            }
        }

        // Add premium floating animation CSS
        const premiumStyle = document.createElement('style');
        premiumStyle.textContent = `
            @keyframes premiumFloat {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: translateY(-50px) rotate(180deg);
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }
            
            @keyframes bounceIn {
                0% {
                    transform: scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(premiumStyle);

        // === RAILWAY INTEGRATION INITIALIZATION ===
        async function initializeRailwayIntegration() {
            console.log('🚀 Inicjalizacja integracji Railway...');
            
            // Test API connection
            const apiConnected = await testAPIConnection();
            
            // Show integration status
            if (apiConnected) {
                showNotification('🎉 Railway API połączone! Wszystkie funkcje dostępne.', 'success');
                console.log('✅ Integracja Railway: AKTYWNA');
            } else {
                showNotification('⚠️ Railway API niedostępne - tryb demo aktywny', 'warning');
                console.log('⚠️ Integracja Railway: TRYB DEMO');
            }
            
            // Log integration status
            addSystemLog('INFO', 'SYSTEM', 'Inicjalizacja aplikacji', 
                `Railway API: ${apiConnected ? 'Połączone' : 'Tryb demo'}`);
        }

        // Initialize premium status and Railway integration on page load
        setTimeout(() => {
            checkPremiumStatus();
            initializeRailwayIntegration();
        }, 500);
    </script>
</body>
</html> 